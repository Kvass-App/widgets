import{q as go,r as kr,b as gr,i as Gc,D as Hd,o as wi,c as Er,a as ys,t as Ln,d as Tr,y as qc,E as G2,G as d5,H as C_,e as ro,w as $o,I as jg,g as _r,F as p5,m as Dn,j as ra,J as f5,K as m5,z as UT,v as ul,C as I_,A as GT,f as Wd,L as g5,n as Id,M as _5,N as y5,O as x5,s as q2,P as v5,_ as b5,h as w5,p as T5}from"./_plugin-vue_export-helper.js";var E5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qT={exports:{}};(function(d,h){(function(m,v){d.exports=v()})(E5,function(){var m,v,w;function C(L,k){if(!m)m=k;else if(!v)v=k;else{var J="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",G={};m(G),w=k(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([J],{type:"text/javascript"})))}}C(["exports"],function(L){var k=typeof self<"u"?self:{},J="3.1.2";let G;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(G==null){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{G={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):e}catch{G=e}}return G},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!X.API_URL)return null;try{const e=new URL(X.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},et={supported:!1,testSupport:function(e){!dt&&gt&&(At?Jt(e):ct=e)}};let ct,gt,dt=!1,At=!1;function Jt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,gt),e.isContextLost())return;et.supported=!0}catch{}e.deleteTexture(t),dt=!0}k.document&&(gt=k.document.createElement("img"),gt.onload=function(){ct&&Jt(ct),ct=null,At=!0},gt.onerror=function(){dt=!0,ct=null},gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qe="01";function ke(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Be=hi;function hi(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}hi.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var o=this.sampleCurveX(i)-e;if(Math.abs(o)<t)return i;var n=this.sampleCurveDerivativeX(i);if(Math.abs(n)<1e-6)break;i-=o/n}var s=0,a=1;for(i=e,r=0;r<20&&(o=this.sampleCurveX(i),!(Math.abs(o-e)<t));r++)e>o?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var ze=ke(Be),yi=pe;function pe(e,t){this.x=e,this.y=t}pe.prototype={clone:function(){return new pe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),o=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pe.convert=function(e){return e instanceof pe?e:Array.isArray(e)?new pe(e[0],e[1]):e};var B=ke(yi);function st(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!st(e[i],t[i]))return!1;return!0}if(typeof e=="object"&&e!==null&&t!==null){if(typeof t!="object"||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!st(e[i],t[i]))return!1;return!0}return e===t}const Qt=Math.PI/180,Le=180/Math.PI;function Ft(e){return e*Qt}function Te(e){return e*Le}const ai=[[0,0],[1,0],[1,1],[0,1]];function ri(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Ai(e){let t=1/0,i=1/0,r=-1/0,o=-1/0;for(const n of e)t=Math.min(t,n.x),i=Math.min(i,n.y),r=Math.max(r,n.x),o=Math.max(o,n.y);return{min:new B(t,i),max:new B(r,o)}}function Sr(e,t,i=0,r=!0){const o=new B(i,i),n=e.sub(o),s=t.add(o),a=[n,new B(s.x,n.y),s,new B(n.x,s.y)];return r&&a.push(n.clone()),a}function Mr(e,t,i,r){const o=new ze(e,t,i,r);return function(n){return o.solve(n)}}const Gi=Mr(.25,.1,.25,1);function Ut(e,t,i){return Math.min(i,Math.max(t,e))}function oo(e,t,i){return(i=Ut((i-e)/(t-e),0,1))*i*(3-2*i)}function Nr(e,t,i){const r=i-t,o=((e-t)%r+r)%r+t;return o===t?i:o}function Do(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const o=new Array(e.length);let n=null;e.forEach((s,a)=>{t(s,(l,c)=>{l&&(n=l),o[a]=c,--r==0&&i(n,o)})})}function ws(e){const t=[];for(const i in e)t.push(e[i]);return t}function Vt(e,...t){for(const i of t)for(const r in i)e[r]=i[r];return e}function Vr(e,t){const i={};for(let r=0;r<t.length;r++){const o=t[r];o in e&&(i[o]=e[o])}return i}let tp=1;function ca(){return tp++}function Xc(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Yc(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Jc(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ir(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function ua(e,t){return e.indexOf(t,e.length-t.length)!==-1}function ha(e,t,i){const r={};for(const o in e)r[o]=t.call(i||this,e[o],o,e);return r}function Et(e,t,i){const r={};for(const o in e)t.call(i||this,e[o],o,e)&&(r[o]=e[o]);return r}function V(e){return Array.isArray(e)?e.map(V):typeof e=="object"&&e?ha(e,V):e}const q={};function Y(e){q[e]||(typeof console<"u"&&console.warn(e),q[e]=!0)}function _t(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function xt(e){let t=0;for(let i,r,o=0,n=e.length,s=n-1;o<n;s=o++)i=e[o],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}function Bt([e,t,i]){const r=Ft(t+90),o=Ft(i);return{x:e*Math.cos(r)*Math.sin(o),y:e*Math.sin(r)*Math.sin(o),z:e*Math.cos(o),azimuthal:t,polar:i}}function Zt(e,t,i){const r=Math.sqrt(e*e+t*t+i*i),o=r>0?Math.acos(i/r)*Le:0;let n=e!==0||t!==0?Math.atan2(-t,-e)*Le+90:0;return n<0&&(n+=360),[r,n,o]}function vt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wt(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,o,n)=>{const s=o||n;return t[r]=!s||s.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let ue=null;function le(){return!!k.document.fullscreenElement||!!k.document.webkitFullscreenElement}function ui(e){try{const t=k[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function ki(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function cr(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]}function Di(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Ni(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const mi="mapbox-tiles";let yr=500,Dr=50,zr,zo;function da(){try{return k.caches}catch{}}function jr(){da()&&!zr&&(zr=k.caches.open(mi))}function hn(e){const t=e.indexOf("?");if(t<0)return e;const i=function(o){const n=o.indexOf("?");return n>0?o.slice(n+1).split("&"):[]}(e),r=i.filter(o=>{const n=o.split("=");return n[0]==="language"||n[0]==="worldview"});return r.length?`${e.slice(0,t)}?${r.join("&")}`:e.slice(0,t)}let Nn=1/0;function pa(e){Nn++,Nn>Dr&&(e.getActor().send("enforceCacheSizeLimit",yr),Nn=0)}const ht={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ht);class ft extends Error{constructor(t,i,r){i===401&&zi(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const wt=vt()?()=>self.worker&&self.worker.referrer:()=>(k.location.protocol==="blob:"?k.parent:k).location.href,St=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(wt())&&!/^\w+:/.test(i))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(r,o){const n=new k.AbortController,s=new k.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:wt(),referrerPolicy:r.referrerPolicy,signal:n.signal});let a=!1,l=!1;const c=(u=s.url).indexOf("sku=")>0&&zi(u);var u;r.type==="json"&&s.headers.set("Accept","application/json");const p=(g,_,y)=>{if(l)return;if(g&&g.message!=="SecurityError"&&Y(g.toString()),_&&y)return f(_);const x=Date.now();k.fetch(s).then(b=>{if(b.ok){const T=c?b.clone():null;return f(b,T,x)}return o(new ft(b.statusText,b.status,r.url))}).catch(b=>{b.name!=="AbortError"&&o(new Error(`${b.message} ${r.url}`))})},f=(g,_,y)=>{(r.type==="arrayBuffer"?g.arrayBuffer():r.type==="json"?g.json():g.text()).then(x=>{l||(_&&y&&function(b,T,S){if(jr(),!zr)return;const M={status:T.status,statusText:T.statusText,headers:new k.Headers};T.headers.forEach((I,z)=>M.headers.set(z,I));const E=Wt(T.headers.get("Cache-Control")||"");if(E["no-store"])return;E["max-age"]&&M.headers.set("Expires",new Date(S+1e3*E["max-age"]).toUTCString());const A=M.headers.get("Expires");A&&(new Date(A).getTime()-S<42e4||function(I,z){if(zo===void 0)try{new Response(new ReadableStream),zo=!0}catch{zo=!1}zo?z(I.body):I.blob().then(z)}(T,I=>{const z=new k.Response(I,M);jr(),zr&&zr.then(P=>P.put(hn(b.url),z)).catch(P=>Y(P.message))}))}(s,_,y),a=!0,o(null,x,g.headers.get("Cache-Control"),g.headers.get("Expires")))}).catch(x=>{l||o(new Error(x.message))})};return c?function(g,_){if(jr(),!zr)return _(null);const y=hn(g.url);zr.then(x=>{x.match(y).then(b=>{const T=function(S){if(!S)return!1;const M=new Date(S.headers.get("Expires")||0),E=Wt(S.headers.get("Cache-Control")||"");return M>Date.now()&&!E["no-cache"]}(b);x.delete(y),T&&x.put(y,b.clone()),_(null,b,T)}).catch(_)}).catch(_)}(s,p):p(null,null),{cancel:()=>{l=!0,a||n.abort()}}}(e,t);if(vt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(r,o){const n=new k.XMLHttpRequest;n.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(n.responseType="arraybuffer");for(const s in r.headers)n.setRequestHeader(s,r.headers[s]);return r.type==="json"&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials=r.credentials==="include",n.onerror=()=>{o(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||n.status===0)&&n.response!==null){let s=n.response;if(r.type==="json")try{s=JSON.parse(n.response)}catch(a){return o(a)}o(null,s,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else o(new ft(n.statusText,n.status,r.url))},n.send(r.body),{cancel:()=>n.abort()}}(e,t)},Mt=function(e,t){return St(Vt(e,{type:"json"}),t)},Dt=function(e,t){return St(Vt(e,{type:"arrayBuffer"}),t)};function Pt(e){const t=k.document.createElement("a");return t.href=e,t.protocol===k.document.location.protocol&&t.host===k.document.location.host}const Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gt,zt;Gt=[],zt=0;const _e=function(e,t){if(et.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),zt>=X.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Gt.push(n),n}zt++;let i=!1;const r=()=>{if(!i)for(i=!0,zt--;Gt.length&&zt<X.MAX_PARALLEL_IMAGE_REQUESTS;){const n=Gt.shift(),{requestParameters:s,callback:a,cancelled:l}=n;l||(n.cancel=_e(s,a).cancel)}},o=Dt(e,(n,s,a,l)=>{r(),n?t(n):s&&(k.createImageBitmap?function(c,u){const p=new k.Blob([new Uint8Array(c)],{type:"image/png"});k.createImageBitmap(p).then(f=>{u(null,f)}).catch(f=>{u(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(s,(c,u)=>t(c,u,a,l)):function(c,u){const p=new k.Image,f=k.URL;p.onload=()=>{u(null,p),f.revokeObjectURL(p.src),p.onload=null,k.requestAnimationFrame(()=>{p.src=Ct})},p.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new k.Blob([new Uint8Array(c)],{type:"image/png"});p.src=c.byteLength?f.createObjectURL(g):Ct}(s,(c,u)=>t(c,u,a,l)))});return{cancel:()=>{o.cancel(),r()}}},oi="NO_ACCESS_TOKEN";class Kt{constructor(t,i,r){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let i="";for(let r=0;r<10;r++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qe,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!Ke(t))return t;const r=rr(t);return r.params.push(`sdk=js-${J}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!Ke(t))return t;const r=rr(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeModelURL(t,i){if(!Ke(t))return t;const r=rr(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeSourceURL(t,i,r,o){if(!Ke(t))return t;const n=rr(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),r&&n.params.push(`language=${r}`),o&&n.params.push(`worldview=${o}`),this._makeAPIURL(n,this._customAccessToken||i)}normalizeSpriteURL(t,i,r,o){const n=rr(t);return Ke(t)?(n.path=`/styles/v1${n.path}/sprite${i}${r}`,this._makeAPIURL(n,this._customAccessToken||o)):(n.path+=`${i}${r}`,Pr(n))}normalizeTileURL(t,i,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ke(t))return t;const o=rr(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||r&&o.authority!=="raster"&&r===512?"@2x":""}${et.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${X.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${X.TILE_URL_VERSION}${o.path}`);const n=this._customAccessToken||function(s){for(const a of s){const l=a.match(/^access_token=(.*)$/);if(l)return l[1]}return null}(o.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,n)}canonicalizeTileURL(t,i){const r=rr(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let o="mapbox://";r.path.match(/^\/raster\/v1\//)?o+=`raster/${r.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${r.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let n=r.params;return i&&(n=n.filter(s=>!s.match(/^access_token=/))),n.length&&(o+=`?${n.join("&")}`),o}canonicalizeTileset(t,i){const r=!!i&&Ke(i),o=[];for(const n of t.tiles||[])zi(n)?o.push(this.canonicalizeTileURL(n,r)):o.push(n);return o}_makeAPIURL(t,i){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=rr(X.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){const n=t.params.indexOf("secure");n>=0&&t.params.splice(n,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!X.REQUIRE_ACCESS_TOKEN)return Pr(t);if(i=i||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(n=>n.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),Pr(t)}}function Ke(e){return e.indexOf("mapbox:")===0}function zi(e){return X.API_URL_REGEX.test(e)}function Vi(e){return X.API_CDN_URL_REGEX.test(e)}function Xi(e){return X.API_STYLE_REGEX.test(e)&&!xr(e)}function xr(e){return X.API_SPRITE_REGEX.test(e)}const _o=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rr(e){const t=e.match(_o);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Pr(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const vr="mapbox.eventData";function fa(e){if(!e)return null;const t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Vn{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=fa(X.ACCESS_TOKEN);let r="";return r=i&&i.u?k.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(o,n)=>String.fromCharCode(+("0x"+n)))):X.ACCESS_TOKEN||"",t?`${vr}.${t}:${r}`:`${vr}:${r}`}fetchEventData(){const t=ui("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const o=k.localStorage.getItem(i);o&&(this.eventData=JSON.parse(o));const n=k.localStorage.getItem(r);n&&(this.anonId=n)}catch{Y("Unable to read from LocalStorage")}}saveEventData(){const t=ui("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{k.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Y("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,r,o){if(!X.EVENTS_URL)return;const n=rr(X.EVENTS_URL);n.params.push(`access_token=${o||X.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=i?Vt(s,i):s,l={url:Pr(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(c,u){return St(Vt(c,{method:"POST"}),u)}(l,c=>{this.pendingRequest=null,r(c),this.saveEventData(),this.processRequests(o)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const ma=new class extends Vn{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>Ke(i)||zi(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=fa(X.ACCESS_TOKEN),i=t?t.u:X.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;Jc(this.anonId)||(this.anonId=Xc(),r=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const n=new Date(this.eventData.lastSuccess),s=new Date(o),a=(o-this.eventData.lastSuccess)/864e5;r=r||a>=1||a<-1||n.getDate()!==s.getDate()}else r=!0;r?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:qe,"enabled.telemetry":!1,userId:this.anonId},n=>{n||(this.eventData.lastSuccess=o,this.eventData.tokenU=i)},e):this.processRequests()}},ep=ma.postTurnstileEvent.bind(ma),G_=new class extends Vn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,r){this.skuToken=t,this.errorCb=r,X.EVENTS_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(oi)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Jc(this.anonId)||(this.anonId=Xc()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:J,skuId:qe,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):t&&(this.success[t]=!0)},e))}},HE=G_.postMapLoadEvent.bind(G_),q_=new class extends Vn{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){X.EVENTS_URL&&(e||X.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),r=function(o){const n=k.performance.getEntriesByType("resource"),s=k.performance.getEntriesByType("mark"),a=function(f){const g={};if(f){for(const _ in f)if(_!=="other")for(const y of f[_]){const x=`${_}ResolveRangeMin`,b=`${_}ResolveRangeMax`,T=`${_}RequestCount`,S=`${_}RequestCachedCount`;g[x]=Math.min(g[x]||1/0,y.startTime),g[b]=Math.max(g[b]||-1/0,y.responseEnd);const M=E=>{g[E]===void 0&&(g[E]=0),++g[E]};y.transferSize!==void 0&&y.transferSize===0&&M(S),M(T)}}return g}(function(f,g){const _={};if(f)for(const y of f){const x=g(y);_[x]===void 0&&(_[x]=[]),_[x].push(y)}return _}(n,YE)),l=k.devicePixelRatio,c=k.navigator.connection||k.navigator.mozConnection||k.navigator.webkitConnection,u={counters:[],metadata:[],attributes:[]},p=(f,g,_)=>{_!=null&&f.push({name:g,value:_.toString()})};for(const f in a)p(u.counters,f,a[f]);if(o.interactionRange[0]!==1/0&&o.interactionRange[1]!==-1/0&&(p(u.counters,"interactionRangeMin",o.interactionRange[0]),p(u.counters,"interactionRangeMax",o.interactionRange[1])),s)for(const f of Object.keys(Qc)){const g=Qc[f],_=s.find(y=>y.name===g);_&&p(u.counters,g,_.startTime)}return p(u.counters,"visibilityHidden",o.visibilityHidden),p(u.attributes,"style",function(f){if(f)for(const g of f){const _=g.name.split("?")[0];if(Xi(_)){const y=_.split("/").slice(-2);if(y.length===2)return`mapbox://styles/${y[0]}/${y[1]}`}}}(n)),p(u.attributes,"terrainEnabled",o.terrainEnabled?"true":"false"),p(u.attributes,"fogEnabled",o.fogEnabled?"true":"false"),p(u.attributes,"projection",o.projection),p(u.attributes,"zoom",o.zoom),p(u.metadata,"devicePixelRatio",l),p(u.metadata,"connectionEffectiveType",c?c.effectiveType:void 0),p(u.metadata,"navigatorUserAgent",k.navigator.userAgent),p(u.metadata,"screenWidth",k.screen.width),p(u.metadata,"screenHeight",k.screen.height),p(u.metadata,"windowWidth",k.innerWidth),p(u.metadata,"windowHeight",k.innerHeight),p(u.metadata,"mapWidth",o.width/l),p(u.metadata,"mapHeight",o.height/l),p(u.metadata,"webglRenderer",o.renderer),p(u.metadata,"webglVendor",o.vendor),p(u.metadata,"sdkVersion",J),p(u.metadata,"sdkIdentifier","mapbox-gl-js"),u}(i);for(const o of r.metadata);for(const o of r.counters);for(const o of r.attributes);this.postEvent(t,r,()=>{},e)}},WE=q_.postPerformanceEvent.bind(q_),$_=new class extends Vn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,r){if(!X.API_URL||!X.SESSION_PATH)return;const o=rr(X.API_URL+X.SESSION_PATH);o.params.push(`sku=${t||""}`),o.params.push(`access_token=${r||X.ACCESS_TOKEN||""}`);const n={url:Pr(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(s,a){return St(Vt(s,{method:"GET"}),a)}(n,s=>{this.pendingRequest=null,i(s),this.saveEventData(),this.processRequests(r)})}getSessionAPI(e,t,i,r){this.skuToken=t,this.errorCb=r,X.SESSION_PATH&&X.API_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(oi)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):t&&(this.success[t]=!0)},e)}},XE=$_.getSessionAPI.bind($_),Kc=new Set;function Z_(e,t){t?Kc.add(e):Kc.delete(e)}const Qc={create:"create",load:"load",fullLoad:"fullLoad"},H_={mark(e){k.performance.mark(e)},measure(e,t,i){k.performance.measure(e,t,i)}};function YE(e){const t=e.name.split("?")[0];return Vi(t)&&t.includes("mapbox-gl.js")?"javascript":Vi(t)&&t.includes("mapbox-gl.css")?"css":function(i){return X.API_FONTS_REGEX.test(i)}(t)?"fontRange":xr(t)?"sprite":Xi(t)?"style":function(i){return X.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}const JE=k.performance;function W_(e){const t=e?e.url.toString():void 0;return JE.getEntriesByName(t)}var X_=ip;function ip(e){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var r,o,n=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(n);try{o=new Worker(s),r=!0}catch{r=!1}return o&&o.terminate(),URL.revokeObjectURL(s),r}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var r=document.createElement("canvas");r.width=r.height=1;var o=r.getContext("2d");if(!o)return!1;var n=o.getImageData(0,0,1,1);return n&&n.width===r.width}()?(rp[i=t&&t.failIfMajorPerformanceCaveat]===void 0&&(rp[i]=function(r){var o,n=function(s){var a=document.createElement("canvas"),l=Object.create(ip.webGLContextAttributes);return l.failIfMajorPerformanceCaveat=s,a.getContext("webgl",l)||a.getContext("experimental-webgl",l)}(r);if(!n)return!1;try{o=n.createShader(n.VERTEX_SHADER)}catch{return!1}return!(!o||n.isContextLost())&&(n.shaderSource(o,"void main() {}"),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)===!0)}(i)),rp[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(e)}var rp={};let op,tu,np,eu,Ts;function Y_(){return op==null&&(op=k.OffscreenCanvas&&new k.OffscreenCanvas(1,1).getContext("2d")&&typeof k.createImageBitmap=="function"),op}ip.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ce={now:()=>eu!==void 0?eu:k.performance.now(),setNow(e){eu=e},restoreNow(){eu=void 0},frame(e){const t=k.requestAnimationFrame(e);return{cancel:()=>k.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:r}=e;Ts||(Ts=k.document.createElement("canvas"));const o=Ts.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>Ts.width||r>Ts.height)&&(Ts.width=i,Ts.height=r),o.clearRect(-t,-t,i+2*t,r+2*t),o.drawImage(e,0,0,i,r),o.getImageData(-t,-t,i+2*t,r+2*t)},resolveURL:e=>(tu||(tu=k.document.createElement("a")),tu.href=e,tu.href),get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(np==null&&(np=k.matchMedia("(prefers-reduced-motion: reduce)")),np.matches)},hasCanvasFingerprintNoise(){if(!Y_())return!1;const e=new k.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let o=0;o<e.width;++o)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(o,0,1,1);const r=t.getImageData(0,0,e.width,e.height);i=0;for(let o=0;o<r.data.length;++o)if(o%4!=3&&i++!==r.data[o])return!0;return!1}};function ci(e,t,i){const r=k.document.createElement(e);return t!==void 0&&(r.className=t),i&&i.appendChild(r),r}function dn(e,t,i){const r=k.document.createElementNS("http://www.w3.org/2000/svg",e);for(const o of Object.keys(t))r.setAttributeNS(null,o,t[o]);return i&&i.appendChild(r),r}const Es=k.document&&k.document.documentElement.style,gl=Es&&Es.userSelect!==void 0?"userSelect":"WebkitUserSelect";let J_;function K_(){Es&&gl&&(J_=Es[gl],Es[gl]="none")}function Q_(){Es&&gl&&(Es[gl]=J_)}function sp(e){e.preventDefault(),e.stopPropagation(),k.removeEventListener("click",sp,!0)}function ap(){k.addEventListener("click",sp,!0),k.setTimeout(()=>{k.removeEventListener("click",sp,!0)},0)}function _l(e,t){const i=e.getBoundingClientRect();return e0(e,i,t)}function iu(e,t){const i=e.getBoundingClientRect(),r=[];for(let o=0;o<t.length;o++)r.push(e0(e,i,t[o]));return r}function t0(e){return k.InstallTrigger!==void 0&&e.button===2&&e.ctrlKey&&k.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function e0(e,t,i){const r=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new B((i.clientX-t.left)*r,(i.clientY-t.top)*r)}function i0(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function lp(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);r!==-1&&i[e].splice(r,1)}}class Tt{constructor(t,i={}){Vt(this,i),this.type=t}}class ae extends Tt{constructor(t,i={}){super("error",Vt({error:t},i))}}class qi{on(t,i){return this._listeners=this._listeners||{},i0(t,i,this._listeners),this}off(t,i){return lp(t,i,this._listeners),lp(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},i0(t,i,this._oneTimeListeners),this):new Promise(r=>this.once(t,r))}fire(t,i){typeof t=="string"&&(t=new Tt(t,i||{}));const r=t.type;if(this.listens(r)){t.target=this;const o=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const a of o)a.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const a of n)lp(r,a,this._oneTimeListeners),a.call(this,t);const s=this._eventedParent;s&&(Vt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),s.fire(t))}else t instanceof ae&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Nt{constructor(t,i,r,o){this.message=(t?`${t}: `:"")+r,o&&(this.identifier=o),i!=null&&i.__line__&&(this.line=i.__line__)}}class Ss extends Nt{}function pn(e,...t){for(const i of t)for(const r in i)e[r]=i[r];return e}function Yi(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function fn(e){if(Array.isArray(e))return e.map(fn);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=fn(e[i]);return t}return Yi(e)}class KE extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Zo=KE;class cp{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[r,o]of i)this.bindings[r]=o}concat(t){return new cp(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var QE=cp;const ga={kind:"null"},Lt={kind:"number"},je={kind:"string"},Ze={kind:"boolean"},yo={kind:"color"},_a={kind:"object"},Ge={kind:"value"},ru={kind:"collator"},yl={kind:"formatted"},xl={kind:"resolvedImage"};function Ur(e,t){return{kind:"array",itemType:e,N:t}}function $i(e){if(e.kind==="array"){const t=$i(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}const t3=[ga,Lt,je,Ze,yo,yl,_a,Ur(Ge),xl];function vl(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!vl(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const i of t3)if(!vl(i,t))return null}}return`Expected ${$i(e)} but found ${$i(t)} instead.`}function up(e,t){return t.some(i=>i.kind===e.kind)}function bl(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var hp,r0={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ou(e){return(e=Math.round(e))<0?0:e>255?255:e}function dp(e){return ou(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function nu(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function pp(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{hp={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in r0)return r0[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=i.indexOf("("),o=i.indexOf(")");if(r!==-1&&o+1===i.length){var n=i.substr(0,r),s=i.substr(r+1,o-(r+1)).split(","),a=1;switch(n){case"rgba":if(s.length!==4)return null;a=nu(s.pop());case"rgb":return s.length!==3?null:[dp(s[0]),dp(s[1]),dp(s[2]),a];case"hsla":if(s.length!==4)return null;a=nu(s.pop());case"hsl":if(s.length!==3)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=nu(s[1]),u=nu(s[2]),p=u<=.5?u*(c+1):u+c-u*c,f=2*u-p;return[ou(255*pp(f,p,l+1/3)),ou(255*pp(f,p,l)),ou(255*pp(f,p,l-1/3)),a];default:return null}}return null}}catch{}class Gr{constructor(t,i,r,o=1){this.r=t,this.g=i,this.b=r,this.a=o}static parse(t){if(!t)return;if(t instanceof Gr)return t;if(typeof t!="string")return;const i=hp(t);return i?new Gr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,r,o]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(r)},${o})`}toArray(){const{r:t,g:i,b:r,a:o}=this;return o===0?[0,0,0,0]:[255*t/o,255*i/o,255*r/o,o]}toArray01(){const{r:t,g:i,b:r,a:o}=this;return o===0?[0,0,0,0]:[t/o,i/o,r/o,o]}toArray01Scaled(t){const{r:i,g:r,b:o,a:n}=this;return n===0?[0,0,0]:[i/n*t,r/n*t,o/n*t]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:r,a:o}=this;return[t,i,r,o]}toArray01Linear(){const{r:t,g:i,b:r,a:o}=this;return o===0?[0,0,0,0]:[Math.pow(t/o,2.2),Math.pow(i/o,2.2),Math.pow(r/o,2.2),o]}}Gr.black=new Gr(0,0,0,1),Gr.white=new Gr(1,1,1,1),Gr.transparent=new Gr(0,0,0,0),Gr.red=new Gr(1,0,0,1),Gr.blue=new Gr(0,0,1,1);var xe=Gr;class fp{constructor(t,i,r){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mp{constructor(t,i,r,o,n){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=r,this.fontStack=o,this.textColor=n}}class qr{constructor(t){this.sections=t}static fromString(t){return new qr([new mp(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof qr?t:qr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(r)}return t}}class xo{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,i){return t?new xo({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function o0(e,t,i,r){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ya(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof xe||e instanceof fp||e instanceof qr||e instanceof xo)return!0;if(Array.isArray(e)){for(const t of e)if(!ya(t))return!1;return!0}if(typeof e=="object"){for(const t in e)if(!ya(e[t]))return!1;return!0}return!1}function or(e){if(e===null)return ga;if(typeof e=="string")return je;if(typeof e=="boolean")return Ze;if(typeof e=="number")return Lt;if(e instanceof xe)return yo;if(e instanceof fp)return ru;if(e instanceof qr)return yl;if(e instanceof xo)return xl;if(Array.isArray(e)){const t=e.length;let i;for(const r of e){const o=or(r);if(i){if(i===o)continue;i=Ge;break}i=o}return Ur(i||Ge,t)}return _a}function wl(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof xe||e instanceof qr||e instanceof xo?e.toString():JSON.stringify(e)}class gp{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ya(t[1]))return i.error("invalid value");const r=t[1];let o=or(r);const n=i.expectedType;return o.kind!=="array"||o.N!==0||!n||n.kind!=="array"||typeof n.N=="number"&&n.N!==0||(o=n),new gp(o,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xe?["rgba"].concat(this.value.toArray()):this.value instanceof qr?this.value.serialize():this.value}}var Tl=gp,ur=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const _p={string:je,number:Lt,boolean:Ze,object:_a};class yp{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let r,o=1;const n=t[0];if(n==="array"){let a,l;if(t.length>2){const c=t[1];if(typeof c!="string"||!(c in _p)||c==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);a=_p[c],o++}else a=Ge;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);l=t[2],o++}r=Ur(a,l)}else r=_p[n];const s=[];for(;o<t.length;o++){const a=i.parse(t[o],o,Ge);if(!a)return null;s.push(a)}return new yp(r,s)}evaluate(t){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(t);if(!vl(this.type,or(r)))return r;if(i===this.args.length-1)throw new ur(`Expected value to be of type ${$i(this.type)}, but found ${$i(or(r))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const r=t.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const o=t.N;(typeof o=="number"||this.args.length>1)&&i.push(o)}}return i.concat(this.args.map(r=>r.serialize()))}}var mn=yp;class El{constructor(t){this.type=yl,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const o=[];let n=!1;for(let s=1;s<=t.length-1;++s){const a=t[s];if(n&&typeof a=="object"&&!Array.isArray(a)){n=!1;let l=null;if(a["font-scale"]&&(l=i.parse(a["font-scale"],1,Lt),!l))return null;let c=null;if(a["text-font"]&&(c=i.parse(a["text-font"],1,Ur(je)),!c))return null;let u=null;if(a["text-color"]&&(u=i.parse(a["text-color"],1,yo),!u))return null;const p=o[o.length-1];p.scale=l,p.font=c,p.textColor=u}else{const l=i.parse(t[s],1,Ge);if(!l)return null;const c=l.type.kind;if(c!=="string"&&c!=="value"&&c!=="null"&&c!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,o.push({content:l,scale:null,font:null,textColor:null})}}return new El(o)}evaluate(t){return new qr(this.sections.map(i=>{const r=i.content.evaluate(t);return or(r)===xl?new mp("",r,null,null,null):new mp(wl(r),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),t.push(r)}return t}}class Sl{constructor(t,i){this.type=xl,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");const r=i.parse(t[1],1,je);if(!r)return i.error("No image name provided.");if(t.length===2)return new Sl(r);const o=i.parse(t[2],1,je);return o?new Sl(r,o):i.error("Secondary image variant is not a string.")}evaluate(t){const i=xo.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Qe(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}const e3={"to-boolean":Ze,"to-color":yo,"to-number":Lt,"to-string":je};class xp{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const r=t[0],o=[];let n=ga;if(r==="to-array"){if(!Array.isArray(t[1]))return null;const s=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);n=Ur(i.expectedType.itemType,s)}else{if(!(s>0&&ya(t[1][0])))return null;n=Ur(or(t[1][0]),s)}for(let a=0;a<s;a++){const l=t[1][a];let c;if(Qe(l)==="array")c=i.parse(l,void 0,n.itemType);else{const u=Qe(l);if(u!==n.itemType.kind)return i.error(`Expected ${n.itemType.kind} but found ${u}.`);c=i.registry.literal.parse(["literal",l===void 0?null:l],i)}if(!c)return null;o.push(c)}}else{if((r==="to-boolean"||r==="to-string")&&t.length!==2)return i.error("Expected one argument.");n=e3[r];for(let s=1;s<t.length;s++){const a=i.parse(t[s],s,Ge);if(!a)return null;o.push(a)}}return new xp(n,o)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,r;for(const o of this.args){if(i=o.evaluate(t),r=null,i instanceof xe)return i;if(typeof i=="string"){const n=t.parseColor(i);if(n)return n}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:o0(i[0],i[1],i[2],i[3]),!r))return new xe(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ur(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(t),i===null)return 0;const o=Number(i);if(!isNaN(o))return o}throw new ur(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?qr.fromString(wl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?xo.fromString(wl(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):wl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new El([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sl(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Ms=xp;const i3=["Unknown","Point","LineString","Polygon"];var n0=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?i3[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=xe.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class As{constructor(t,i,r,o,n){this.name=t,this.type=i,this._evaluate=r,this.args=o,this._overloadIndex=n}evaluate(t){if(!this._evaluate){const i=As.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const r=t[0],o=As.definitions[r];if(!o)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(o)?o[0]:o.type,s=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,a=[];let l=null,c=-1;for(const[u,p]of s){if(Array.isArray(u)&&u.length!==t.length-1)continue;a.push(u),c++,l=new w0(i.registry,i.path,null,i.scope,void 0,i.options);const f=[];let g=!1;for(let _=1;_<t.length;_++){const y=t[_],x=Array.isArray(u)?u[_-1]:u.type,b=l.parse(y,1+f.length,x);if(!b){g=!0;break}f.push(b)}if(!g)if(Array.isArray(u)&&u.length!==f.length)l.error(`Expected ${u.length} arguments, but found ${f.length} instead.`);else{for(let _=0;_<f.length;_++){const y=Array.isArray(u)?u[_]:u.type,x=f[_];l.concat(_+1).checkSubtype(y,x.type)}if(l.errors.length===0)return new As(r,n,p,f,c)}}if(a.length===1)i.errors.push(...l.errors);else{const u=(a.length?a:s.map(([f])=>f)).map(r3).join(" | "),p=[];for(let f=1;f<t.length;f++){const g=i.parse(t[f],1+p.length);if(!g)return null;p.push($i(g.type))}i.error(`Expected arguments of type ${u}, but found (${p.join(", ")}) instead.`)}return null}static register(t,i){As.definitions=i;for(const r in i)t[r]=As}}function r3(e){return Array.isArray(e)?`(${e.map($i).join(", ")})`:`(${$i(e.type)}...)`}var Ho=As;class su{constructor(t,i,r){this.type=ru,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const r=t[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const o=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Ze);if(!o)return null;const n=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Ze);if(!n)return null;let s=null;return r.locale&&(s=i.parse(r.locale,1,je),!s)?null:new su(o,n,s)}evaluate(t){return new fp(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var s0={exports:{}};s0.exports=function(){function e(r,o,n,s,a){for(;s>n;){if(s-n>600){var l=s-n+1,c=o-n+1,u=Math.log(l),p=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*p*(l-p)/l)*(c-l/2<0?-1:1);e(r,o,Math.max(n,Math.floor(o-c*p/l+f)),Math.min(s,Math.floor(o+(l-c)*p/l+f)),a)}var g=r[o],_=n,y=s;for(t(r,n,o),a(r[s],g)>0&&t(r,n,s);_<y;){for(t(r,_,y),_++,y--;a(r[_],g)<0;)_++;for(;a(r[y],g)>0;)y--}a(r[n],g)===0?t(r,n,y):t(r,++y,s),y<=o&&(n=y+1),o<=y&&(s=y-1)}}function t(r,o,n){var s=r[o];r[o]=r[n],r[n]=s}function i(r,o){return r<o?-1:r>o?1:0}return function(r,o,n,s,a){e(r,o,n||0,s||r.length-1,a||i)}}();var o3=ke(s0.exports);function n3(e){let t=0;for(let i,r,o=0,n=e.length,s=n-1;o<n;s=o++)i=e[o],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}function Ml(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Al(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function s3(e,t,i){const r=e[0]-t[0],o=e[1]-t[1],n=e[0]-i[0],s=e[1]-i[1];return r*s-n*o==0&&r*n<=0&&o*s<=0}function xa(e,t,i=!1){let r=!1;for(let a=0,l=t.length;a<l;a++){const c=t[a];for(let u=0,p=c.length,f=p-1;u<p;f=u++){const g=c[f],_=c[u];if(s3(e,g,_))return i;(n=g)[1]>(o=e)[1]!=(s=_)[1]>o[1]&&o[0]<(s[0]-n[0])*(o[1]-n[1])/(s[1]-n[1])+n[0]&&(r=!r)}}var o,n,s;return r}function a0(e,t,i,r){const o=r[0]-i[0],n=r[1]-i[1],s=(e[0]-i[0])*n-o*(e[1]-i[1]),a=(t[0]-i[0])*n-o*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function au(e,t,i,r){return(o=[r[0]-i[0],r[1]-i[1]])[0]*(n=[t[0]-e[0],t[1]-e[1]])[1]-o[1]*n[0]!=0&&!(!a0(e,t,i,r)||!a0(i,r,e,t));var o,n}const jn=8192;function a3(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,o=Math.pow(2,t.z);return[Math.round(i*o*jn),Math.round(r*o*jn)]}function l3(e,t){for(let i=0;i<t.length;i++)if(xa(e,t[i]))return!0;return!1}function c3(e,t,i){for(const r of i)for(let o=0,n=r.length,s=n-1;o<n;s=o++)if(au(e,t,r[s],r[o]))return!0;return!1}function l0(e,t){for(let i=0;i<e.length;++i)if(!xa(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(c3(e[i],e[i+1],t))return!1;return!0}function u3(e,t){for(let i=0;i<t.length;i++)if(l0(e,t[i]))return!0;return!1}function vp(e,t,i){const r=[];for(let o=0;o<e.length;o++){const n=[];for(let s=0;s<e[o].length;s++){const a=a3(e[o][s],i);Ml(t,a),n.push(a)}r.push(n)}return r}function c0(e,t,i){const r=[];for(let o=0;o<e.length;o++){const n=vp(e[o],t,i);r.push(n)}return r}function u0(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const o=.5*r;let n=e[0]-i[0]>o?-r:i[0]-e[0]>o?r:0;n===0&&(n=e[0]-i[2]>o?-r:i[2]-e[0]>o?r:0),e[0]+=n}Ml(t,e)}function h0(e,t,i,r){const o=Math.pow(2,r.z)*jn,n=[r.x*jn,r.y*jn],s=[];if(!e)return s;for(const a of e)for(const l of a){const c=[l.x+n[0],l.y+n[1]];u0(c,t,i,o),s.push(c)}return s}function d0(e,t,i,r){const o=Math.pow(2,r.z)*jn,n=[r.x*jn,r.y*jn],s=[];if(!e)return s;for(const l of e){const c=[];for(const u of l){const p=[u.x+n[0],u.y+n[1]];Ml(t,p),c.push(p)}s.push(c)}if(t[2]-t[0]<=o/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const l of s)for(const c of l)u0(c,t,i,o)}var a;return s}class Cl{constructor(t,i){this.type=Ze,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ya(t[1])){const r=t[1];if(r.type==="FeatureCollection")for(let o=0;o<r.features.length;++o){const n=r.features[o].geometry.type;if(n==="Polygon"||n==="MultiPolygon")return new Cl(r,r.features[o].geometry)}else if(r.type==="Feature"){const o=r.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new Cl(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Cl(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,r){const o=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if(!s)return!1;if(r.type==="Polygon"){const a=vp(r.coordinates,n,s),l=h0(i.geometry(),o,n,s);if(!Al(o,n))return!1;for(const c of l)if(!xa(c,a))return!1}if(r.type==="MultiPolygon"){const a=c0(r.coordinates,n,s),l=h0(i.geometry(),o,n,s);if(!Al(o,n))return!1;for(const c of l)if(!l3(c,a))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,r){const o=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=i.canonicalID();if(!s)return!1;if(r.type==="Polygon"){const a=vp(r.coordinates,n,s),l=d0(i.geometry(),o,n,s);if(!Al(o,n))return!1;for(const c of l)if(!l0(c,a))return!1}if(r.type==="MultiPolygon"){const a=c0(r.coordinates,n,s),l=d0(i.geometry(),o,n,s);if(!Al(o,n))return!1;for(const c of l)if(!u3(c,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var bp=Cl,p0={exports:{}};p0.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),r=Math.PI/180,o=function(c,u){if(c===void 0)throw new Error("No latitude given.");if(u&&!e[u])throw new Error("Unknown unit "+u+". Use one of: "+Object.keys(e).join(", "));var p=6378.137*r*(u?e[u]:1),f=Math.cos(c*r),g=1/(1-i*(1-f*f)),_=Math.sqrt(g);this.kx=p*_*f,this.ky=p*_*g*(1-i)},n={units:{configurable:!0}};function s(c,u){return c[0]===u[0]&&c[1]===u[1]}function a(c,u,p){var f=l(u[0]-c[0]);return[c[0]+f*p,c[1]+(u[1]-c[1])*p]}function l(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}return o.fromTile=function(c,u,p){var f=Math.PI*(1-2*(c+.5)/Math.pow(2,u)),g=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/r;return new o(g,p)},n.units.get=function(){return e},o.prototype.distance=function(c,u){var p=l(c[0]-u[0])*this.kx,f=(c[1]-u[1])*this.ky;return Math.sqrt(p*p+f*f)},o.prototype.bearing=function(c,u){var p=l(u[0]-c[0])*this.kx;return Math.atan2(p,(u[1]-c[1])*this.ky)/r},o.prototype.destination=function(c,u,p){var f=p*r;return this.offset(c,Math.sin(f)*u,Math.cos(f)*u)},o.prototype.offset=function(c,u,p){return[c[0]+u/this.kx,c[1]+p/this.ky]},o.prototype.lineDistance=function(c){for(var u=0,p=0;p<c.length-1;p++)u+=this.distance(c[p],c[p+1]);return u},o.prototype.area=function(c){for(var u=0,p=0;p<c.length;p++)for(var f=c[p],g=0,_=f.length,y=_-1;g<_;y=g++)u+=l(f[g][0]-f[y][0])*(f[g][1]+f[y][1])*(p?-1:1);return Math.abs(u)/2*this.kx*this.ky},o.prototype.along=function(c,u){var p=0;if(u<=0)return c[0];for(var f=0;f<c.length-1;f++){var g=c[f],_=c[f+1],y=this.distance(g,_);if((p+=y)>u)return a(g,_,(u-(p-y))/y)}return c[c.length-1]},o.prototype.pointToSegmentDistance=function(c,u,p){var f=u[0],g=u[1],_=l(p[0]-f)*this.kx,y=(p[1]-g)*this.ky,x=0;return _===0&&y===0||((x=(l(c[0]-f)*this.kx*_+(c[1]-g)*this.ky*y)/(_*_+y*y))>1?(f=p[0],g=p[1]):x>0&&(f+=_/this.kx*x,g+=y/this.ky*x)),_=l(c[0]-f)*this.kx,y=(c[1]-g)*this.ky,Math.sqrt(_*_+y*y)},o.prototype.pointOnLine=function(c,u){for(var p,f,g,_,y=1/0,x=0;x<c.length-1;x++){var b=c[x][0],T=c[x][1],S=l(c[x+1][0]-b)*this.kx,M=(c[x+1][1]-T)*this.ky,E=0;S===0&&M===0||((E=(l(u[0]-b)*this.kx*S+(u[1]-T)*this.ky*M)/(S*S+M*M))>1?(b=c[x+1][0],T=c[x+1][1]):E>0&&(b+=S/this.kx*E,T+=M/this.ky*E));var A=(S=l(u[0]-b)*this.kx)*S+(M=(u[1]-T)*this.ky)*M;A<y&&(y=A,p=b,f=T,g=x,_=E)}return{point:[p,f],index:g,t:Math.max(0,Math.min(1,_))}},o.prototype.lineSlice=function(c,u,p){var f=this.pointOnLine(p,c),g=this.pointOnLine(p,u);if(f.index>g.index||f.index===g.index&&f.t>g.t){var _=f;f=g,g=_}var y=[f.point],x=f.index+1,b=g.index;!s(p[x],y[0])&&x<=b&&y.push(p[x]);for(var T=x+1;T<=b;T++)y.push(p[T]);return s(p[b],g.point)||y.push(g.point),y},o.prototype.lineSliceAlong=function(c,u,p){for(var f=0,g=[],_=0;_<p.length-1;_++){var y=p[_],x=p[_+1],b=this.distance(y,x);if((f+=b)>c&&g.length===0&&g.push(a(y,x,(c-(f-b))/b)),f>=u)return g.push(a(y,x,(u-(f-b))/b)),g;f>c&&g.push(x)}return g},o.prototype.bufferPoint=function(c,u){var p=u/this.ky,f=u/this.kx;return[c[0]-f,c[1]-p,c[0]+f,c[1]+p]},o.prototype.bufferBBox=function(c,u){var p=u/this.ky,f=u/this.kx;return[c[0]-f,c[1]-p,c[2]+f,c[3]+p]},o.prototype.insideBBox=function(c,u){return l(c[0]-u[0])>=0&&l(c[0]-u[2])<=0&&c[1]>=u[1]&&c[1]<=u[3]},Object.defineProperties(o,n),o}();var wp=ke(p0.exports),f0={exports:{}};f0.exports=function(){var e=function(i,r){if(i===void 0&&(i=[]),r===void 0&&(r=t),this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};function t(i,r){return i<r?-1:i>r?1:0}return e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var r=this.data,o=this.compare,n=r[i];i>0;){var s=i-1>>1,a=r[s];if(o(n,a)>=0)break;r[i]=a,i=s}r[i]=n},e.prototype._down=function(i){for(var r=this.data,o=this.compare,n=this.length>>1,s=r[i];i<n;){var a=1+(i<<1),l=r[a],c=a+1;if(c<this.length&&o(r[c],l)<0&&(a=c,l=r[c]),o(l,s)>=0)break;r[i]=l,i=a}r[i]=s},e}();var Tp=ke(f0.exports),at=8192;function m0(e,t){return t.dist-e.dist}const Ep=100,Sp=50;function g0(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function lu(e){return e[1]-e[0]+1}function gn(e,t){const i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Mp(e,t){if(e[0]>e[1])return[null,null];const i=lu(e);if(t){if(i===2)return[e,null];const r=Math.floor(i/2);return[[e[0],e[0]+r],[e[0]+r,e[1]]]}{if(i===1)return[e,null];const r=Math.floor(i/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}}function Cs(e,t){const i=[1/0,1/0,-1/0,-1/0];if(!gn(t,e.length))return i;for(let r=t[0];r<=t[1];++r)Ml(i,e[r]);return i}function cu(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let r=0;r<e[i].length;++r)Ml(t,e[i][r]);return t}function va(e,t,i){if(g0(e)||g0(t))return NaN;let r=0,o=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(o=e[1]-t[3]),e[3]<t[1]&&(o=t[1]-e[3]),i.distance([0,0],[r,o])}function Ap(e,t){const i=Math.pow(2,t.z);return[(o=(e.x/at+t.x)/i,360*o-180),(r=(e.y/at+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,o}function h3(e,t){const i=[];for(let r=0;r<e.length;++r)i.push(Ap(e[r],t));return i}function _0(e,t,i){const r=i.pointOnLine(t,e).point;return i.distance(e,r)}function y0(e,t,i,r,o){const n=i.slice(r[0],r[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if((s=Math.min(s,_0(e[a],n,o)))===0)return 0;return s}function Cp(e,t,i,r,o){const n=Math.min(o.pointToSegmentDistance(e,i,r),o.pointToSegmentDistance(t,i,r)),s=Math.min(o.pointToSegmentDistance(i,e,t),o.pointToSegmentDistance(r,e,t));return Math.min(n,s)}function d3(e,t,i,r,o){if(!gn(t,e.length)||!gn(r,i.length))return NaN;let n=1/0;for(let s=t[0];s<t[1];++s)for(let a=r[0];a<r[1];++a){if(au(e[s],e[s+1],i[a],i[a+1]))return 0;n=Math.min(n,Cp(e[s],e[s+1],i[a],i[a+1],o))}return n}function p3(e,t,i,r,o){if(!gn(t,e.length)||!gn(r,i.length))return NaN;let n=1/0;for(let s=t[0];s<=t[1];++s)for(let a=r[0];a<=r[1];++a)if((n=Math.min(n,o.distance(e[s],i[a])))===0)return n;return n}function f3(e,t,i){if(xa(e,t,!0))return 0;let r=1/0;for(const o of t){const n=o.length;if(n<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(o[0]!==o[n-1]&&(r=Math.min(r,i.pointToSegmentDistance(e,o[n-1],o[0])))===0||(r=Math.min(r,_0(e,o,i)))===0)return r}return r}function m3(e,t,i,r){if(!gn(t,e.length))return NaN;for(let n=t[0];n<=t[1];++n)if(xa(e[n],i,!0))return 0;let o=1/0;for(let n=t[0];n<t[1];++n)for(const s of i)for(let a=0,l=s.length,c=l-1;a<l;c=a++){if(au(e[n],e[n+1],s[c],s[a]))return 0;o=Math.min(o,Cp(e[n],e[n+1],s[c],s[a],r))}return o}function x0(e,t){for(const i of e)for(let r=0;r<=i.length-1;++r)if(xa(i[r],t,!0))return!0;return!1}function g3(e,t,i,r=1/0){const o=cu(e),n=cu(t);if(r!==1/0&&va(o,n,i)>=r)return r;if(Al(o,n)){if(x0(e,t))return 0}else if(x0(t,e))return 0;let s=r;for(const a of e)for(let l=0,c=a.length,u=c-1;l<c;u=l++)for(const p of t)for(let f=0,g=p.length,_=g-1;f<g;_=f++){if(au(a[u],a[l],p[_],p[f]))return 0;s=Math.min(s,Cp(a[u],a[l],p[_],p[f],i))}return s}function uu(e,t,i,r,o,n,s){if(n===null||s===null)return;const a=va(Cs(r,n),Cs(o,s),i);a<t&&e.push({dist:a,range1:n,range2:s})}function _3(e,t,i,r,o=1/0){let n=Math.min(r.distance(e[0],i[0][0]),o);if(n===0)return n;const s=new Tp([{dist:0,range1:[0,e.length-1],range2:[0,0]}],m0),a=t?Sp:Ep,l=cu(i);for(;s.length;){const c=s.pop();if(c.dist>=n)continue;const u=c.range1;if(lu(u)<=a){if(!gn(u,e.length))return NaN;if(t){const p=m3(e,u,i,r);if((n=Math.min(n,p))===0)return n}else for(let p=u[0];p<=u[1];++p){const f=f3(e[p],i,r);if((n=Math.min(n,f))===0)return n}}else{const p=Mp(u,t);if(p[0]!==null){const f=va(Cs(e,p[0]),l,r);f<n&&s.push({dist:f,range1:p[0],range2:[0,0]})}if(p[1]!==null){const f=va(Cs(e,p[1]),l,r);f<n&&s.push({dist:f,range1:p[1],range2:[0,0]})}}}return n}function v0(e,t,i,r,o,n=1/0){let s=Math.min(n,o.distance(e[0],i[0]));if(s===0)return s;const a=new Tp([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],m0),l=t?Sp:Ep,c=r?Sp:Ep;for(;a.length;){const u=a.pop();if(u.dist>=s)continue;const p=u.range1,f=u.range2;if(lu(p)<=l&&lu(f)<=c){if(!gn(p,e.length)||!gn(f,i.length))return NaN;if(t&&r?s=Math.min(s,d3(e,p,i,f,o)):t||r?t&&!r?s=Math.min(s,y0(i,f,e,p,o)):!t&&r&&(s=Math.min(s,y0(e,p,i,f,o))):s=Math.min(s,p3(e,p,i,f,o)),s===0)return s}else{const g=Mp(p,t),_=Mp(f,r);uu(a,s,o,e,i,g[0],_[0]),uu(a,s,o,e,i,g[0],_[1]),uu(a,s,o,e,i,g[1],_[0]),uu(a,s,o,e,i,g[1],_[1])}}return s}function Ip(e,t,i,r,o=1/0){let n=o;const s=Cs(e,[0,e.length-1]);for(const a of i)if(!(n!==1/0&&va(s,Cs(a,[0,a.length-1]),r)>=n)&&(n=Math.min(n,v0(e,t,a,!0,r,n)),n===0))return n;return n}function hu(e,t,i,r,o=1/0){let n=o;const s=Cs(e,[0,e.length-1]);for(const a of i){if(n!==1/0&&va(s,cu(a),r)>=n)continue;const l=_3(e,t,a,r,n);if(isNaN(l))return l;if((n=Math.min(n,l))===0)return n}return n}function kp(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class Il{constructor(t,i){this.type=Lt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ya(t[1])){const r=t[1];if(r.type==="FeatureCollection"){for(let o=0;o<r.features.length;++o)if(kp(r.features[o].geometry.type))return new Il(r,r.features[o].geometry)}else if(r.type==="Feature"){if(kp(r.geometry.type))return new Il(r,r.geometry)}else if(kp(r.type))return new Il(r,r)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const i=t.geometry(),r=t.canonicalID();if(i!=null&&r!=null){if(t.geometryType()==="Point")return function(o,n,s){const a=[];for(const c of o)for(const u of c)a.push(Ap(u,n));const l=new wp(a[0][1],"meters");return s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString"?v0(a,!1,s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",l):s.type==="MultiLineString"?Ip(a,!1,s.coordinates,l):s.type==="Polygon"||s.type==="MultiPolygon"?hu(a,!1,s.type==="Polygon"?[s.coordinates]:s.coordinates,l):null}(i,r,this.geometries);if(t.geometryType()==="LineString")return function(o,n,s){const a=[];for(const c of o){const u=[];for(const p of c)u.push(Ap(p,n));a.push(u)}const l=new wp(a[0][0][1],"meters");if(s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString")return Ip(s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",a,l);if(s.type==="MultiLineString"){let c=1/0;for(let u=0;u<s.coordinates.length;u++){const p=Ip(s.coordinates[u],!0,a,l,c);if(isNaN(p))return p;if((c=Math.min(c,p))===0)return c}return c}if(s.type==="Polygon"||s.type==="MultiPolygon"){let c=1/0;for(let u=0;u<a.length;u++){const p=hu(a[u],!0,s.type==="Polygon"?[s.coordinates]:s.coordinates,l,c);if(isNaN(p))return p;if((c=Math.min(c,p))===0)return c}return c}return null}(i,r,this.geometries);if(t.geometryType()==="Polygon")return function(o,n,s){const a=[];for(const c of function(u,p){const f=u.length;if(f<=1)return[u];const g=[];let _,y;for(let x=0;x<f;x++){const b=n3(u[x]);b!==0&&(u[x].area=Math.abs(b),y===void 0&&(y=b<0),y===b<0?(_&&g.push(_),_=[u[x]]):_.push(u[x]))}return _&&g.push(_),g}(o)){const u=[];for(let p=0;p<c.length;++p)u.push(h3(c[p],n));a.push(u)}const l=new wp(a[0][0][0][1],"meters");if(s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString")return hu(s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",a,l);if(s.type==="MultiLineString"){let c=1/0;for(let u=0;u<s.coordinates.length;u++){const p=hu(s.coordinates[u],!0,a,l,c);if(isNaN(p))return p;if((c=Math.min(c,p))===0)return c}return c}return s.type==="Polygon"||s.type==="MultiPolygon"?function(c,u,p){let f=1/0;for(const g of c)for(const _ of u){const y=g3(g,_,p,f);if(isNaN(y))return y;if((f=Math.min(f,y))===0)return f}return f}(s.type==="Polygon"?[s.coordinates]:s.coordinates,a,l):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Dp=Il;function ba(e){if(e instanceof Ho&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof bp||e instanceof Dp)return!1;let t=!0;return e.eachChild(i=>{t&&!ba(i)&&(t=!1)}),t}function kl(e){if(e instanceof Ho&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!kl(i)&&(t=!1)}),t}function zp(e){if(e instanceof Ho&&e.name==="config")return!1;let t=!0;return e.eachChild(i=>{t&&!zp(i)&&(t=!1)}),t}function wa(e,t){if(e instanceof Ho&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(r=>{i&&!wa(r,t)&&(i=!1)}),i}class Pp{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=t[1];return i.scope.has(r)?new Pp(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var b0=Pp;class Rp{constructor(t,i=[],r,o=new QE,n=[],s){this.registry=t,this.path=i,this.key=i.map(a=>`[${a}]`).join(""),this.scope=o,this.errors=n,this.expectedType=r,this.options=s}parse(t,i,r,o,n={}){return i||r?this.concat(i,r,o)._parse(t,n):this._parse(t,n)}_parse(t,i){function r(o,n,s){return s==="assert"?new mn(n,[o]):s==="coerce"?new Ms(n,[o]):o}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(o){let n=o.parse(t,this);if(!n)return null;if(this.expectedType){const s=this.expectedType,a=n.type;if(s.kind!=="string"&&s.kind!=="number"&&s.kind!=="boolean"&&s.kind!=="object"&&s.kind!=="array"||a.kind!=="value")if(s.kind!=="color"&&s.kind!=="formatted"&&s.kind!=="resolvedImage"||a.kind!=="value"&&a.kind!=="string"){if(this.checkSubtype(s,a))return null}else n=r(n,s,i.typeAnnotation||"coerce");else n=r(n,s,i.typeAnnotation||"assert")}if(!(n instanceof Tl)&&n.type.kind!=="resolvedImage"&&Lp(n)){const s=new n0(this.options);try{n=new Tl(n.type,n.evaluate(s))}catch(a){return this.error(a.message),null}}return n}return Ms.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,r){const o=typeof t=="number"?this.path.concat(t):this.path,n=r?this.scope.concat(r):this.scope;return new Rp(this.registry,o,i||null,n,this.errors,this.options)}error(t,...i){const r=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new Zo(r,t))}checkSubtype(t,i){const r=vl(t,i);return r&&this.error(r),r}}var w0=Rp;function Lp(e){if(e instanceof b0)return Lp(e.boundExpression);if(e instanceof Ho&&e.name==="error"||e instanceof Ho&&e.name==="config"||e instanceof su||e instanceof bp||e instanceof Dp)return!1;const t=e instanceof Ms||e instanceof mn;let i=!0;return e.eachChild(r=>{i=t?i&&Lp(r):i&&r instanceof Tl}),!!i&&ba(e)&&wa(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function du(e,t){const i=e.length-1;let r,o,n=0,s=i,a=0;for(;n<=s;)if(a=Math.floor((n+s)/2),r=e[a],o=e[a+1],r<=t){if(a===i||t<o)return a;n=a+1}else{if(!(r>t))throw new ur("Input is not a number.");s=a-1}return 0}class Op{constructor(t,i,r){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[o,n]of r)this.labels.push(o),this.outputs.push(n)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(t[1],1,Lt);if(!r)return null;const o=[];let n=null;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);for(let s=1;s<t.length;s+=2){const a=s===1?-1/0:t[s],l=t[s+1],c=s,u=s+1;if(typeof a!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(o.length&&o[o.length-1][0]>=a)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',c);const p=i.parse(l,u,n);if(!p)return null;n=n||p.type,o.push([a,p])}return new Op(n,r,o)}evaluate(t){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(t);const o=this.input.evaluate(t);if(o<=i[0])return r[0].evaluate(t);const n=i.length;return o>=i[n-1]?r[n-1].evaluate(t):r[du(i,o)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var Bp=Op;function ne(e,t,i){return e*(1-i)+t*i}function T0(e,t,i){return e.map((r,o)=>ne(r,t[o],i))}var pu=Object.freeze({__proto__:null,array:T0,color:function(e,t,i){return new xe(ne(e.r,t.r,i),ne(e.g,t.g,i),ne(e.b,t.b,i),ne(e.a,t.a,i))},number:ne});const E0=.95047,S0=1.08883,M0=4/29,Ta=6/29,A0=3*Ta*Ta,y3=Ta*Ta*Ta,x3=Math.PI/180,v3=180/Math.PI;function Fp(e){return e>y3?Math.pow(e,1/3):e/A0+M0}function Np(e){return e>Ta?e*e*e:A0*(e-M0)}function Vp(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function jp(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function C0(e){const t=jp(e.r),i=jp(e.g),r=jp(e.b),o=Fp((.4124564*t+.3575761*i+.1804375*r)/E0),n=Fp((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*n-16,a:500*(o-n),b:200*(n-Fp((.0193339*t+.119192*i+.9503041*r)/S0)),alpha:e.a}}function I0(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Np(t),i=E0*Np(i),r=S0*Np(r),new xe(Vp(3.2404542*i-1.5371385*t-.4985314*r),Vp(-.969266*i+1.8760108*t+.041556*r),Vp(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function b3(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Dl={forward:C0,reverse:I0,interpolate:function(e,t,i){return{l:ne(e.l,t.l,i),a:ne(e.a,t.a,i),b:ne(e.b,t.b,i),alpha:ne(e.alpha,t.alpha,i)}}},zl={forward:function(e){const{l:t,a:i,b:r}=C0(e),o=Math.atan2(r,i)*v3;return{h:o<0?o+360:o,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*x3,i=e.c;return I0({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:b3(e.h,t.h,i),c:ne(e.c,t.c,i),l:ne(e.l,t.l,i),alpha:ne(e.alpha,t.alpha,i)}}};var k0=Object.freeze({__proto__:null,hcl:zl,lab:Dl});class fu{constructor(t,i,r,o,n){this.type=t,this.operator=i,this.interpolation=r,this.input=o,this.labels=[],this.outputs=[];for(const[s,a]of n)this.labels.push(s),this.outputs.push(a)}static interpolationFactor(t,i,r,o){let n=0;if(t.name==="exponential")n=Up(i,t.base,r,o);else if(t.name==="linear")n=Up(i,1,r,o);else if(t.name==="cubic-bezier"){const s=t.controlPoints;n=new ze(s[0],s[1],s[2],s[3]).solve(Up(i,1,r,o))}return n}static parse(t,i){let[r,o,n,...s]=t;if(!Array.isArray(o)||o.length===0)return i.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const c=o[1];if(typeof c!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:c}}else{if(o[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const c=o.slice(1);if(c.length!==4||c.some(u=>typeof u!="number"||u<0||u>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:c}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(n=i.parse(n,2,Lt),!n)return null;const a=[];let l=null;r==="interpolate-hcl"||r==="interpolate-lab"?l=yo:i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let c=0;c<s.length;c+=2){const u=s[c],p=s[c+1],f=c+3,g=c+4;if(typeof u!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(a.length&&a[a.length-1][0]>=u)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const _=i.parse(p,g,l);if(!_)return null;l=l||_.type,a.push([u,_])}return l.kind==="number"||l.kind==="color"||l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number"?new fu(l,r,o,n,a):i.error(`Type ${$i(l)} is not interpolatable.`)}evaluate(t){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(t);const o=this.input.evaluate(t);if(o<=i[0])return r[0].evaluate(t);const n=i.length;if(o>=i[n-1])return r[n-1].evaluate(t);const s=du(i,o),a=fu.interpolationFactor(this.interpolation,o,i[s],i[s+1]),l=r[s].evaluate(t),c=r[s+1].evaluate(t);return this.operator==="interpolate"?pu[this.type.kind.toLowerCase()](l,c,a):this.operator==="interpolate-hcl"?zl.reverse(zl.interpolate(zl.forward(l),zl.forward(c),a)):Dl.reverse(Dl.interpolate(Dl.forward(l),Dl.forward(c),a))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function Up(e,t,i,r){const o=r-i,n=e-i;return o===0?0:t===1?n/o:(Math.pow(t,n)-1)/(Math.pow(t,o)-1)}var Wo=fu;class Gp{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let r=null;const o=i.expectedType;o&&o.kind!=="value"&&(r=o);const n=[];for(const a of t.slice(1)){const l=i.parse(a,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,n.push(l)}const s=o&&n.some(a=>vl(o,a.type));return new Gp(s?Ge:r,n)}evaluate(t){let i,r=null,o=0;for(const n of this.args){if(o++,r=n.evaluate(t),r&&r instanceof xo&&!r.available&&(i||(i=r),r=null,o===this.args.length))return i;if(r!==null)break}return r}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var D0=Gp;class qp{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let n=1;n<t.length-1;n+=2){const s=t[n];if(typeof s!="string")return i.error(`Expected string, but found ${typeof s} instead.`,n);if(/[^a-zA-Z0-9_]/.test(s))return i.error("Variable names must contain only alphanumeric characters or '_'.",n);const a=i.parse(t[n+1],n+1);if(!a)return null;r.push([s,a])}const o=i.parse(t[t.length-1],t.length-1,i.expectedType,r);return o?new qp(r,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,r]of this.bindings)t.push(i,r.serialize());return t.push(this.result.serialize()),t}}var z0=qp;class $p{constructor(t,i,r){this.type=t,this.index=i,this.input=r}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=i.parse(t[1],1,Lt),o=i.parse(t[2],2,Ur(i.expectedType||Ge));return r&&o?new $p(o.type.itemType,r,o):null}evaluate(t){const i=this.index.evaluate(t),r=this.input.evaluate(t);if(i<0)throw new ur(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new ur(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new ur(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var w3=$p;class Zp{constructor(t,i){this.type=Ze,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=i.parse(t[1],1,Ge),o=i.parse(t[2],2,Ge);return r&&o?up(r.type,[Ze,je,Lt,ga,Ge])?new Zp(r,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(r.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(r==null)return!1;if(!bl(i,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${$i(or(i))} instead.`);if(!bl(r,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${$i(or(r))} instead.`);return r.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var T3=Zp;class mu{constructor(t,i,r){this.type=Lt,this.needle=t,this.haystack=i,this.fromIndex=r}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=i.parse(t[1],1,Ge),o=i.parse(t[2],2,Ge);if(!r||!o)return null;if(!up(r.type,[Ze,je,Lt,ga,Ge]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(r.type)} instead`);if(t.length===4){const n=i.parse(t[3],3,Lt);return n?new mu(r,o,n):null}return new mu(r,o)}evaluate(t){const i=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!bl(i,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${$i(or(i))} instead.`);if(!bl(r,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${$i(or(r))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(t);return r.indexOf(i,o)}return r.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var E3=mu;class Hp{constructor(t,i,r,o,n,s){this.inputType=t,this.type=i,this.input=r,this.cases=o,this.outputs=n,this.otherwise=s}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let r,o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const n={},s=[];for(let c=2;c<t.length-1;c+=2){let u=t[c];const p=t[c+1];Array.isArray(u)||(u=[u]);const f=i.concat(c);if(u.length===0)return f.error("Expected at least one branch label.");for(const _ of u){if(typeof _!="number"&&typeof _!="string")return f.error("Branch labels must be numbers or strings.");if(typeof _=="number"&&Math.abs(_)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _=="number"&&Math.floor(_)!==_)return f.error("Numeric branch labels must be integer values.");if(r){if(f.checkSubtype(r,or(_)))return null}else r=or(_);if(n[String(_)]!==void 0)return f.error("Branch labels must be unique.");n[String(_)]=s.length}const g=i.parse(p,c,o);if(!g)return null;o=o||g.type,s.push(g)}const a=i.parse(t[1],1,Ge);if(!a)return null;const l=i.parse(t[t.length-1],t.length-1,o);return l?a.type.kind!=="value"&&i.concat(1).checkSubtype(r,a.type)?null:new Hp(r,o,a,n,s,l):null}evaluate(t){const i=this.input.evaluate(t);return(or(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],o={};for(const s of i){const a=o[this.cases[s]];a===void 0?(o[this.cases[s]]=r.length,r.push([this.cases[s],[s]])):r[a][1].push(s)}const n=s=>this.inputType.kind==="number"?Number(s):s;for(const[s,a]of r)t.push(a.length===1?n(a[0]):a.map(n)),t.push(this.outputs[s].serialize());return t.push(this.otherwise.serialize()),t}}var S3=Hp;class Wp{constructor(t,i,r){this.type=t,this.branches=i,this.otherwise=r}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const o=[];for(let s=1;s<t.length-1;s+=2){const a=i.parse(t[s],s,Ze);if(!a)return null;const l=i.parse(t[s+1],s+1,r);if(!l)return null;o.push([a,l]),r=r||l.type}const n=i.parse(t[t.length-1],t.length-1,r);return n?new Wp(r,o,n):null}evaluate(t){for(const[i,r]of this.branches)if(i.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,r]of this.branches)t(i),t(r);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var M3=Wp;class gu{constructor(t,i,r,o){this.type=t,this.input=i,this.beginIndex=r,this.endIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=i.parse(t[1],1,Ge),o=i.parse(t[2],2,Lt);if(!r||!o)return null;if(!up(r.type,[Ur(Ge),je,Ge]))return i.error(`Expected first argument to be of type array or string, but found ${$i(r.type)} instead`);if(t.length===4){const n=i.parse(t[3],3,Lt);return n?new gu(r.type,r,o,n):null}return new gu(r.type,r,o)}evaluate(t){const i=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!bl(i,["string","array"]))throw new ur(`Expected first argument to be of type array or string, but found ${$i(or(i))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(t);return i.slice(r,o)}return i.slice(r)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var A3=gu;function P0(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function R0(e,t,i,r){return r.compare(t,i)===0}function Ea(e,t,i){const r=e!=="=="&&e!=="!=";return class $T{constructor(n,s,a){this.type=Ze,this.lhs=n,this.rhs=s,this.collator=a,this.hasUntypedArgument=n.type.kind==="value"||s.type.kind==="value"}static parse(n,s){if(n.length!==3&&n.length!==4)return s.error("Expected two or three arguments.");const a=n[0];let l=s.parse(n[1],1,Ge);if(!l)return null;if(!P0(a,l.type))return s.concat(1).error(`"${a}" comparisons are not supported for type '${$i(l.type)}'.`);let c=s.parse(n[2],2,Ge);if(!c)return null;if(!P0(a,c.type))return s.concat(2).error(`"${a}" comparisons are not supported for type '${$i(c.type)}'.`);if(l.type.kind!==c.type.kind&&l.type.kind!=="value"&&c.type.kind!=="value")return s.error(`Cannot compare types '${$i(l.type)}' and '${$i(c.type)}'.`);r&&(l.type.kind==="value"&&c.type.kind!=="value"?l=new mn(c.type,[l]):l.type.kind!=="value"&&c.type.kind==="value"&&(c=new mn(l.type,[c])));let u=null;if(n.length===4){if(l.type.kind!=="string"&&c.type.kind!=="string"&&l.type.kind!=="value"&&c.type.kind!=="value")return s.error("Cannot use collator to compare non-string types.");if(u=s.parse(n[3],3,ru),!u)return null}return new $T(l,c,u)}evaluate(n){const s=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const l=or(s),c=or(a);if(l.kind!==c.kind||l.kind!=="string"&&l.kind!=="number")throw new ur(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${l.kind}, ${c.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=or(s),c=or(a);if(l.kind!=="string"||c.kind!=="string")return t(n,s,a)}return this.collator?i(n,s,a,this.collator.evaluate(n)):t(n,s,a)}eachChild(n){n(this.lhs),n(this.rhs),this.collator&&n(this.collator)}outputDefined(){return!0}serialize(){const n=[e];return this.eachChild(s=>{n.push(s.serialize())}),n}}}const C3=Ea("==",function(e,t,i){return t===i},R0),I3=Ea("!=",function(e,t,i){return t!==i},function(e,t,i,r){return!R0(0,t,i,r)}),k3=Ea("<",function(e,t,i){return t<i},function(e,t,i,r){return r.compare(t,i)<0}),D3=Ea(">",function(e,t,i){return t>i},function(e,t,i,r){return r.compare(t,i)>0}),z3=Ea("<=",function(e,t,i){return t<=i},function(e,t,i,r){return r.compare(t,i)<=0}),P3=Ea(">=",function(e,t,i){return t>=i},function(e,t,i,r){return r.compare(t,i)>=0});class Xp{constructor(t,i,r,o,n,s){this.type=je,this.number=t,this.locale=i,this.currency=r,this.unit=o,this.minFractionDigits=n,this.maxFractionDigits=s}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const r=i.parse(t[1],1,Lt);if(!r)return null;const o=t[2];if(typeof o!="object"||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let n=null;if(o.locale&&(n=i.parse(o.locale,1,je),!n))return null;let s=null;if(o.currency&&(s=i.parse(o.currency,1,je),!s))return null;let a=null;if(o.unit&&(a=i.parse(o.unit,1,je),!a))return null;let l=null;if(o["min-fraction-digits"]&&(l=i.parse(o["min-fraction-digits"],1,Lt),!l))return null;let c=null;return o["max-fraction-digits"]&&(c=i.parse(o["max-fraction-digits"],1,Lt),!c)?null:new Xp(r,n,s,a,l,c)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Yp{constructor(t){this.type=Lt,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=i.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${$i(r.type)} instead.`):new Yp(r):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ur(`Expected value to be of type string or array, but found ${$i(or(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function Jp(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const L0={"==":C3,"!=":I3,">":D3,"<":k3,">=":P3,"<=":z3,array:mn,at:w3,boolean:mn,case:M3,coalesce:D0,collator:su,format:El,image:Sl,in:T3,"index-of":E3,interpolate:Wo,"interpolate-hcl":Wo,"interpolate-lab":Wo,length:Yp,let:z0,literal:Tl,match:S3,number:mn,"number-format":Xp,object:mn,slice:A3,step:Bp,string:mn,"to-boolean":Ms,"to-color":Ms,"to-number":Ms,"to-string":Ms,var:b0,within:bp,distance:Dp};function O0(e,[t,i,r,o]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const n=o?o.evaluate(e):1,s=o0(t,i,r,n);if(s)throw new ur(s);return new xe(t/255*n,i/255*n,r/255*n,n)}function B0(e,[t,i,r,o]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const n=o?o.evaluate(e):1,s=function(c,u,p,f){return typeof c=="number"&&c>=0&&c<=360?typeof u=="number"&&u>=0&&u<=100&&typeof p=="number"&&p>=0&&p<=100?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid hsla value [${[c,u,p,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof f=="number"?[c,u,p,f]:[c,u,p]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof f=="number"?[c,u,p,f]:[c,u,p]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,r,n);if(s)throw new ur(s);const a=`hsla(${t}, ${i}%, ${r}%, ${n})`,l=xe.parse(a);if(!l)throw new ur(`Failed to parse HSLA color: ${a}`);return l}function F0(e,t){return e in t}function Kp(e,t){const i=t[e];return i===void 0?null:i}function N0(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return xe.parse(t)}return t}function V0(e,t,i,r){return r!==void 0&&(e=r*Math.round(e/r)),t!==void 0&&e<t&&(e=t),i!==void 0&&e>i&&(e=i),e}function j0(e,t,i){i.length&&(t+=`${i}`);const r=e.getConfig(t);if(!r)return null;const{type:o,value:n,values:s,minValue:a,maxValue:l,stepValue:c}=r,u=r.default.evaluate(e);let p=n?n.evaluate(e):u;return o&&(p=N0(o,p)),n!==void 0&&p!==void 0&&s&&!s.includes(p)&&(p=u,o&&(p=N0(o,p))),p===void 0||a===void 0&&l===void 0&&c===void 0||(typeof p=="number"?p=V0(p,a,l,c):Array.isArray(p)&&(p=p.map(f=>typeof f=="number"?V0(f,a,l,c):f))),p}function Is(e){return{type:e}}Ho.register(L0,{error:[{kind:"error"},[je],(e,[t])=>{throw new ur(t.evaluate(e))}],typeof:[je,[Ge],(e,[t])=>$i(or(t.evaluate(e)))],"to-rgba":[Ur(Lt,4),[yo],(e,[t])=>t.evaluate(e).toArray()],rgb:[yo,[Lt,Lt,Lt],O0],rgba:[yo,[Lt,Lt,Lt,Lt],O0],hsl:[yo,[Lt,Lt,Lt],B0],hsla:[yo,[Lt,Lt,Lt,Lt],B0],has:{type:Ze,overloads:[[[je],(e,[t])=>F0(t.evaluate(e),e.properties())],[[je,_a],(e,[t,i])=>F0(t.evaluate(e),i.evaluate(e))]]},get:{type:Ge,overloads:[[[je],(e,[t])=>Kp(t.evaluate(e),e.properties())],[[je,_a],(e,[t,i])=>Kp(t.evaluate(e),i.evaluate(e))]]},config:{type:Ge,overloads:[[[je],(e,[t])=>j0(e,t.evaluate(e),"")],[[je,je],(e,[t,i])=>j0(e,t.evaluate(e),i.evaluate(e))]]},"feature-state":[Ge,[je],(e,[t])=>Kp(t.evaluate(e),e.featureState||{})],properties:[_a,[],e=>e.properties()],"geometry-type":[je,[],e=>e.geometryType()],id:[Ge,[],e=>e.id()],zoom:[Lt,[],e=>e.globals.zoom],pitch:[Lt,[],e=>e.globals.pitch||0],"distance-from-center":[Lt,[],e=>e.distanceFromCenter()],"measure-light":[Lt,[je],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Lt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Lt,[],e=>e.globals.lineProgress||0],"raster-value":[Lt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Lt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ge,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[Lt,Is(Lt),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Lt,Is(Lt),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Lt,overloads:[[[Lt,Lt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Lt],(e,[t])=>-t.evaluate(e)]]},"/":[Lt,[Lt,Lt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Lt,[Lt,Lt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Lt,[Lt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Lt,[Lt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Lt,[Lt],(e,[t])=>Math.log(t.evaluate(e))],log2:[Lt,[Lt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Lt,[Lt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Lt,[Lt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Lt,[Lt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Lt,[Lt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Lt,[Lt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Lt,[Lt],(e,[t])=>Math.atan(t.evaluate(e))],min:[Lt,Is(Lt),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[Lt,Is(Lt),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[Lt,[Lt],(e,[t])=>Math.abs(t.evaluate(e))],round:[Lt,[Lt],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Lt,[Lt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Lt,[Lt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ze,[je,Ge],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ze,[Ge],(e,[t])=>e.id()===t.value],"filter-type-==":[Ze,[je],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ze,[je,Ge],(e,[t,i])=>{const r=e.properties()[t.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[Ze,[Ge],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[Ze,[je,Ge],(e,[t,i])=>{const r=e.properties()[t.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[Ze,[Ge],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ze,[je,Ge],(e,[t,i])=>{const r=e.properties()[t.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[Ze,[Ge],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ze,[je,Ge],(e,[t,i])=>{const r=e.properties()[t.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[Ze,[Ge],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ze,[Ge],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ze,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Ze,[Ur(je)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ze,[Ur(Ge)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ze,[je,Ur(Ge)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ze,[je,Ur(Ge)],(e,[t,i])=>function(r,o,n,s){for(;n<=s;){const a=n+s>>1;if(o[a]===r)return!0;o[a]>r?s=a-1:n=a+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Is(Ze),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Is(Ze),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ze,[Ze],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ze,[je],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[je,[je],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[je,[je],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[je,Is(Ge),(e,t)=>t.map(i=>wl(i.evaluate(e))).join("")],"resolved-locale":[je,[ru],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Lt,[Lt,Lt,Ge],(e,t)=>{const[i,r,o]=t.map(s=>s.evaluate(e));if(i>r||i===r)return i;let n;if(typeof o=="string")n=function(s){let a=0;if(s.length===0)return a;for(let l=0;l<s.length;l++)a=(a<<5)-a+s.charCodeAt(l),a&=a;return a}(o);else{if(typeof o!="number")throw new ur(`Invalid seed input: ${o}`);n=o}return i+Jp(n)()*(r-i)}]});var Pl=L0;function U0(e){return{result:"success",value:e}}function ks(e){return{result:"error",value:e}}function G0(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Ds(e){return e["property-type"]==="data-driven"}function q0(e){return G0(e.expression,"measure-light")}function Qp(e){return G0(e.expression,"zoom")}function tf(e){return!!e.expression&&e.expression.interpolated}function _u(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function R3(e){return e}function $0(e,t){const i=t.type==="color",r=e.stops&&typeof e.stops[0][0]=="object",o=r||!(r||e.property!==void 0),n=e.type||(tf(t)?"exponential":"interval");if(i&&((e=pn({},e)).stops&&(e.stops=e.stops.map(c=>[c[0],xe.parse(c[1])])),e.default=xe.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!k0[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if(n==="exponential")s=Z0;else if(n==="interval")s=O3;else if(n==="categorical"){s=L3,a=Object.create(null);for(const c of e.stops)a[c[0]]=c[1];l=typeof e.stops[0][0]}else{if(n!=="identity")throw new Error(`Unknown function type "${n}"`);s=B3}if(r){const c={},u=[];for(let g=0;g<e.stops.length;g++){const _=e.stops[g],y=_[0].zoom;c[y]===void 0&&(c[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},u.push(y)),c[y].stops.push([_[0].value,_[1]])}const p=[];for(const g of u)p.push([c[g].zoom,$0(c[g],t)]);const f={name:"linear"};return{kind:"composite",interpolationType:f,interpolationFactor:Wo.interpolationFactor.bind(void 0,f),zoomStops:p.map(g=>g[0]),evaluate:({zoom:g},_)=>Z0({stops:p,base:e.base},t,g).evaluate(g,_)}}if(o){const c=n==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:c,interpolationFactor:Wo.interpolationFactor.bind(void 0,c),zoomStops:e.stops.map(u=>u[0]),evaluate:({zoom:u})=>s(e,t,u,a,l)}}return{kind:"source",evaluate(c,u){const p=u&&u.properties?u.properties[e.property]:void 0;return p===void 0?Rl(e.default,t.default):s(e,t,p,a,l)}}}function Rl(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function L3(e,t,i,r,o){return Rl(typeof i===o?r[i]:void 0,e.default,t.default)}function O3(e,t,i){if(Qe(i)!=="number")return Rl(e.default,t.default);const r=e.stops.length;if(r===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=du(e.stops.map(n=>n[0]),i);return e.stops[o][1]}function Z0(e,t,i){const r=e.base!==void 0?e.base:1;if(Qe(i)!=="number")return Rl(e.default,t.default);const o=e.stops.length;if(o===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[o-1][0])return e.stops[o-1][1];const n=du(e.stops.map(u=>u[0]),i),s=function(u,p,f,g){const _=g-f,y=u-f;return _===0?0:p===1?y/_:(Math.pow(p,y)-1)/(Math.pow(p,_)-1)}(i,r,e.stops[n][0],e.stops[n+1][0]),a=e.stops[n][1],l=e.stops[n+1][1];let c=pu[t.type]||R3;if(e.colorSpace&&e.colorSpace!=="rgb"){const u=k0[e.colorSpace];c=(p,f)=>u.reverse(u.interpolate(u.forward(p),u.forward(f),s))}return typeof a.evaluate=="function"?{evaluate(...u){const p=a.evaluate.apply(void 0,u),f=l.evaluate.apply(void 0,u);if(p!==void 0&&f!==void 0)return c(p,f,s)}}:c(a,l,s)}function B3(e,t,i){return t.type==="color"?i=xe.parse(i):t.type==="formatted"?i=qr.fromString(i.toString()):t.type==="resolvedImage"?i=xo.fromString(i.toString()):Qe(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Rl(i,e.default,t.default)}class ef{constructor(t,i,r){this.expression=t,this._warningHistory={},this._evaluator=new n0(r),this._defaultValue=i?function(o){return o.type==="color"&&(_u(o.default)||Array.isArray(o.default))?new xe(0,0,0,0):o.type==="color"?xe.parse(o.default)||null:o.default===void 0?null:o.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,r,o,n,s,a,l){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=o||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,r,o,n,s,a,l){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=o||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null;try{const c=this.expression.evaluate(this._evaluator);if(c==null||typeof c=="number"&&c!=c)return this._defaultValue;if(this._enumValues&&!(c in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(u=>JSON.stringify(u)).join(", ")}, but found ${JSON.stringify(c)} instead.`);return c}catch(c){return this._warningHistory[c.message]||(this._warningHistory[c.message]=!0,typeof console<"u"&&console.warn(c.message)),this._defaultValue}}}function yu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Pl}function Un(e,t,i){const r=new w0(Pl,[],t?function(n){const s={color:yo,string:je,number:Lt,enum:je,boolean:Ze,formatted:yl,resolvedImage:xl};return n.type==="array"?Ur(s[n.value]||Ge,n.length):s[n.type]}(t):void 0,void 0,void 0,i),o=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?U0(new ef(o,t,i)):ks(r.errors)}class rf{constructor(t,i,r){this.kind=t,this._styleExpression=i,this.isLightConstant=r,this.isStateDependent=t!=="constant"&&!kl(i.expression),this.isConfigDependent=!zp(i.expression)}evaluateWithoutErrorHandling(t,i,r,o,n,s){return this._styleExpression.evaluateWithoutErrorHandling(t,i,r,o,n,s)}evaluate(t,i,r,o,n,s){return this._styleExpression.evaluate(t,i,r,o,n,s)}}class Gn{constructor(t,i,r,o,n){this.kind=t,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!kl(i.expression),this.isLightConstant=n,this.isConfigDependent=!zp(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(t,i,r,o,n,s){return this._styleExpression.evaluateWithoutErrorHandling(t,i,r,o,n,s)}evaluate(t,i,r,o,n,s){return this._styleExpression.evaluate(t,i,r,o,n,s)}interpolationFactor(t,i,r){return this.interpolationType?Wo.interpolationFactor(this.interpolationType,t,i,r):0}}function of(e,t,i){if((e=Un(e,t,i)).result==="error")return e;const r=e.value.expression,o=ba(r);if(!o&&!Ds(t))return ks([new Zo("","data expressions not supported")]);const n=wa(r,["zoom","pitch","distance-from-center"]);if(!n&&!Qp(t))return ks([new Zo("","zoom expressions not supported")]);const s=wa(r,["measure-light"]);if(!s&&!q0(t))return ks([new Zo("","measure-light expression not supported")]);const a=t.expression&&t.expression.relaxZoomRestriction,l=vu(r);return l||n||a?l instanceof Zo?ks([l]):l instanceof Wo&&!tf(t)?ks([new Zo("",'"interpolate" expressions cannot be used with this property')]):U0(l?new Gn(o?"camera":"composite",e.value,l.labels,l instanceof Wo?l.interpolation:void 0,s):new rf(o?"constant":"source",e.value,s)):ks([new Zo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xu{constructor(t,i){this._parameters=t,this._specification=i,pn(this,$0(this._parameters,this._specification))}static deserialize(t){return new xu(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function vu(e){let t=null;if(e instanceof z0)t=vu(e.result);else if(e instanceof D0){for(const i of e.args)if(t=vu(i),t)break}else(e instanceof Bp||e instanceof Wo)&&e.input instanceof Ho&&e.input.name==="zoom"&&(t=e);return t instanceof Zo||e.eachChild(i=>{const r=vu(i);r instanceof Zo?t=r:t&&r&&t!==r&&(t=new Zo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function vo(e){const t=e.key,i=e.value,r=e.valueSpec||{},o=e.objectElementValidators||{},n=e.style,s=e.styleSpec;let a=[];const l=Qe(i);if(l!=="object")return[new Nt(t,i,`object expected, ${l} found`)];for(const c in i){const u=c.split(".")[0];let p;o[u]?p=o[u]:r[u]?p=pr:o["*"]?p=o["*"]:r["*"]&&(p=pr),p?a=a.concat(p({key:(t&&`${t}.`)+c,value:i[c],valueSpec:r[u]||r["*"],style:n,styleSpec:s,object:i,objectKey:c},i)):a.push(new Ss(t,i[c],`unknown property "${c}"`))}for(const c in r)o[c]||r[c].required&&r[c].default===void 0&&i[c]===void 0&&a.push(new Nt(t,i,`missing required property "${c}"`));return a}function H0(e){const t=e.value,i=e.valueSpec,r=e.style,o=e.styleSpec,n=e.key,s=e.arrayElementValidator||pr;if(Qe(t)!=="array")return[new Nt(n,t,`array expected, ${Qe(t)} found`)];if(i.length&&t.length!==i.length)return[new Nt(n,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Nt(n,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};o.$version<7&&(a.function=i.function),Qe(i.value)==="object"&&(a=i.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(s({array:t,arrayIndex:c,value:t[c],valueSpec:a,style:r,styleSpec:o,key:`${n}[${c}]`},!0));return l}function W0(e){const t=e.key,i=e.value,r=e.valueSpec;let o=Qe(i);if(o==="number"&&i!=i&&(o="NaN"),o!=="number")return[new Nt(t,i,`number expected, ${o} found`)];if("minimum"in r){let n=r.minimum;if(Qe(r.minimum)==="array"&&(n=r.minimum[e.arrayIndex]),i<n)return[new Nt(t,i,`${i} is less than the minimum value ${n}`)]}if("maximum"in r){let n=r.maximum;if(Qe(r.maximum)==="array"&&(n=r.maximum[e.arrayIndex]),i>n)return[new Nt(t,i,`${i} is greater than the maximum value ${n}`)]}return[]}function X0(e){const t=e.valueSpec,i=Yi(e.value.type);let r,o,n,s={};const a=i!=="categorical"&&e.value.property===void 0,l=!a,c=Qe(e.value.stops)==="array"&&Qe(e.value.stops[0])==="array"&&Qe(e.value.stops[0][0])==="object",u=vo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(g){if(i==="identity")return[new Nt(g.key,g.value,'identity function may not have a "stops" property')];let _=[];const y=g.value;return _=_.concat(H0({key:g.key,value:y,valueSpec:g.valueSpec,style:g.style,styleSpec:g.styleSpec,arrayElementValidator:p})),Qe(y)==="array"&&y.length===0&&_.push(new Nt(g.key,y,"array must have at least one stop")),_},default:function(g){return pr({key:g.key,value:g.value,valueSpec:t,style:g.style,styleSpec:g.styleSpec})}}});return i==="identity"&&a&&u.push(new Nt(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||u.push(new Nt(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!tf(e.valueSpec)&&u.push(new Nt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Ds(e.valueSpec)?u.push(new Nt(e.key,e.value,"property functions not supported")):a&&!Qp(e.valueSpec)&&u.push(new Nt(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!c||e.value.property!==void 0||u.push(new Nt(e.key,e.value,'"property" property is required')),u;function p(g){let _=[];const y=g.value,x=g.key;if(Qe(y)!=="array")return[new Nt(x,y,`array expected, ${Qe(y)} found`)];if(y.length!==2)return[new Nt(x,y,`array length 2 expected, length ${y.length} found`)];if(c){if(Qe(y[0])!=="object")return[new Nt(x,y,`object expected, ${Qe(y[0])} found`)];if(y[0].zoom===void 0)return[new Nt(x,y,"object stop key must have zoom")];if(y[0].value===void 0)return[new Nt(x,y,"object stop key must have value")];const b=Yi(y[0].zoom);if(typeof b!="number")return[new Nt(x,y[0].zoom,"stop zoom values must be numbers")];if(n&&n>b)return[new Nt(x,y[0].zoom,"stop zoom values must appear in ascending order")];b!==n&&(n=b,o=void 0,s={}),_=_.concat(vo({key:`${x}[0]`,value:y[0],valueSpec:{zoom:{}},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{zoom:W0,value:f}}))}else _=_.concat(f({key:`${x}[0]`,value:y[0],valueSpec:{},style:g.style,styleSpec:g.styleSpec},y));return yu(fn(y[1]))?_.concat([new Nt(`${x}[1]`,y[1],"expressions are not allowed in function stops.")]):_.concat(pr({key:`${x}[1]`,value:y[1],valueSpec:t,style:g.style,styleSpec:g.styleSpec}))}function f(g,_){const y=Qe(g.value),x=Yi(g.value),b=g.value!==null?g.value:_;if(r){if(y!==r)return[new Nt(g.key,b,`${y} stop domain type must match previous stop domain type ${r}`)]}else r=y;if(y!=="number"&&y!=="string"&&y!=="boolean"&&typeof x!="number"&&typeof x!="string"&&typeof x!="boolean")return[new Nt(g.key,b,"stop domain value must be a number, string, or boolean")];if(y!=="number"&&i!=="categorical"){let T=`number expected, ${y} found`;return Ds(t)&&i===void 0&&(T+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(g.key,b,T)]}return i!=="categorical"||y!=="number"||typeof x=="number"&&isFinite(x)&&Math.floor(x)===x?i!=="categorical"&&y==="number"&&typeof x=="number"&&typeof o=="number"&&o!==void 0&&x<o?[new Nt(g.key,b,"stop domain values must appear in ascending order")]:(o=x,i==="categorical"&&x in s?[new Nt(g.key,b,"stop domain values must be unique")]:(s[x]=!0,[])):[new Nt(g.key,b,`integer expected, found ${String(x)}`)]}}function zs(e){const t=(e.expressionContext==="property"?of:Un)(fn(e.value),e.valueSpec);if(t.result==="error")return t.value.map(r=>new Nt(`${e.key}${r.key}`,e.value,r.message));const i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new Nt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!kl(i))return[new Nt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return Y0(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!wa(i,["zoom","feature-state"]))return[new Nt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ba(i))return[new Nt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Y0(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const o of t.valueSpec.expression.parameters)i.delete(o);if(i.size===0)return[];const r=[];return e instanceof Ho&&i.has(e.name)?[new Nt(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(o=>{r.push(...Y0(o,t))}),r)}function bu(e){const t=e.key,i=e.value,r=e.valueSpec,o=[];return Array.isArray(r.values)?r.values.indexOf(Yi(i))===-1&&o.push(new Nt(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(Yi(i))===-1&&o.push(new Nt(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),o}function nf(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!nf(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function wu(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nf(e)||(e=Tu(e));const i=e;let r=!0;try{r=function(c){if(!Sa(c))return c;let u=fn(c);return K0(u),u=J0(u),u}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const o=tt[`filter_${t}`],n=Un(r,o);let s=null;if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));s=(c,u,p)=>n.value.evaluate(c,u,{},p);let a=null,l=null;if(r!==i){const c=Un(i,o);if(c.result==="error")throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));a=(u,p,f,g,_)=>c.value.evaluate(u,p,{},f,void 0,void 0,g,_),l=!ba(c.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Q0(r),needFeature:!!l}}function J0(e){if(!Array.isArray(e))return e;const t=function(i){if(F3.has(i[0])){for(let r=1;r<i.length;r++)if(Sa(i[r]))return!0}return i}(e);return t===!0?t:t.map(i=>J0(i))}function K0(e){let t=!1;const i=[];if(e[0]==="case"){for(let r=1;r<e.length-1;r+=2)t=t||Sa(e[r]),i.push(e[r+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||Sa(e[1]);for(let r=2;r<e.length-1;r+=2)i.push(e[r+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||Sa(e[1]);for(let r=1;r<e.length-1;r+=2)i.push(e[r+1])}t&&(e.length=0,e.push("any",...i));for(let r=1;r<e.length;r++)K0(e[r])}function Sa(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(Sa(e[i]))return!0;return!1}const F3=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function N3(e,t){return e<t?-1:e>t?1:0}function Q0(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(Q0(e[t]))return!0;return!1}function Tu(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?sf(e[1],e[2],"=="):t==="!="?Eu(sf(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?sf(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(Tu))):t==="all"?["all"].concat(e.slice(1).map(Tu)):t==="none"?["all"].concat(e.slice(1).map(Tu).map(Eu)):t==="in"?ty(e[1],e.slice(2)):t==="!in"?Eu(ty(e[1],e.slice(2))):t==="has"?ey(e[1]):t!=="!has"||Eu(ey(e[1]));var i}function sf(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function ty(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(N3)]]:["filter-in-small",e,["literal",t]]}}function ey(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Eu(e){return["!",e]}function af(e){return nf(fn(e.value))?zs(pn({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):iy(e)}function iy(e){const t=e.value,i=e.key;if(Qe(t)!=="array")return[new Nt(i,t,`array expected, ${Qe(t)} found`)];const r=e.styleSpec;let o,n=[];if(t.length<1)return[new Nt(i,t,"filter array must have at least 1 element")];switch(n=n.concat(bu({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Yi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yi(t[1])==="$type"&&n.push(new Nt(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&n.push(new Nt(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(o=Qe(t[1]),o!=="string"&&n.push(new Nt(`${i}[1]`,t[1],`string expected, ${o} found`)));for(let s=2;s<t.length;s++)o=Qe(t[s]),Yi(t[1])==="$type"?n=n.concat(bu({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&n.push(new Nt(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let s=1;s<t.length;s++)n=n.concat(iy({key:`${i}[${s}]`,value:t[s],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=Qe(t[1]),t.length!==2?n.push(new Nt(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):o!=="string"&&n.push(new Nt(`${i}[1]`,t[1],`string expected, ${o} found`))}return n}function ry(e,t){const i=e.key,r=e.style,o=e.layer,n=e.styleSpec,s=e.value,a=e.objectKey,l=n[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if(t==="paint"&&c&&l[c[1]]&&l[c[1]].transition)return pr({key:i,value:s,valueSpec:n.transition,style:r,styleSpec:n});const u=e.valueSpec||l[a];if(!u)return[new Ss(i,s,`unknown property "${a}"`)];let p;if(Qe(s)==="string"&&Ds(u)&&!u.tokens&&(p=/^{([^}]+)}$/.exec(s))){const g=`\`{ "type": "identity", "property": ${p?JSON.stringify(p[1]):'"_"'} }\``;return[new Nt(i,s,`"${a}" does not support interpolation syntax
Use an identity property function instead: ${g}.`)]}const f=[];if(e.layerType==="symbol")a!=="text-field"||!r||r.glyphs||r.imports||f.push(new Nt(i,s,'use of "text-field" requires a style "glyphs" property')),a==="text-font"&&_u(fn(s))&&Yi(s.type)==="identity"&&f.push(new Nt(i,s,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&Ds(u)&&(q0(u)||Qp(u))){const g=of(fn(s),u),_=g.value.expression||g.value._styleExpression.expression;_&&!wa(_,["measure-light"])&&(a==="model-emissive-strength"&&ba(_)&&kl(_)||f.push(new Nt(i,s,`${a} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return f.concat(pr({key:e.key,value:s,valueSpec:u,style:r,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:a}))}function oy(e){return ry(e,"paint")}function ny(e){return ry(e,"layout")}function sy(e){let t=[];const i=e.value,r=e.key,o=e.style,n=e.styleSpec;i.type||i.ref||t.push(new Nt(r,i,'either "type" or "ref" is required'));let s=Yi(i.type);const a=Yi(i.ref);if(i.id){const l=Yi(i.id);for(let c=0;c<e.arrayIndex;c++){const u=o.layers[c];Yi(u.id)===l&&t.push(new Nt(r,i.id,`duplicate layer id "${i.id}", previously used at line ${u.id.__line__}`))}}if("ref"in i){let l;["type","source","source-layer","filter","layout"].forEach(c=>{c in i&&t.push(new Nt(r,i[c],`"${c}" is prohibited for ref layers`))}),o.layers.forEach(c=>{Yi(c.id)===a&&(l=c)}),l?l.ref?t.push(new Nt(r,i.ref,"ref cannot reference another ref layer")):s=Yi(l.type):typeof a=="string"&&t.push(new Nt(r,i.ref,`ref layer "${a}" not found`))}else if(s!=="background"&&s!=="sky"&&s!=="slot")if(i.source){const l=o.sources&&o.sources[i.source],c=l&&Yi(l.type);l?c==="vector"&&s==="raster"?t.push(new Nt(r,i.source,`layer "${i.id}" requires a raster source`)):c==="raster"&&s!=="raster"?t.push(new Nt(r,i.source,`layer "${i.id}" requires a vector source`)):c!=="vector"||i["source-layer"]?c==="raster-dem"&&s!=="hillshade"?t.push(new Nt(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):s!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||c==="geojson"&&l.lineMetrics||t.push(new Nt(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Nt(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Nt(r,i.source,`source "${i.source}" not found`))}else t.push(new Nt(r,i,'missing required property "source"'));return t=t.concat(vo({key:r,value:i,valueSpec:n.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pr({key:`${r}.type`,value:i.type,valueSpec:n.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:l=>af(pn({layerType:s},l)),layout:l=>vo({layer:i,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":c=>ny(pn({layerType:s},c))}}),paint:l=>vo({layer:i,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":c=>oy(pn({layerType:s,layer:i},c))}})}})),t}function Ma(e){const t=e.value,i=e.key,r=Qe(t);return r!=="string"?[new Nt(i,t,`string expected, ${r} found`)]:[]}const ay={promoteId:function({key:e,value:t}){if(Qe(t)==="string")return Ma({key:e,value:t});{const i=[];for(const r in t)i.push(...Ma({key:`${e}.${r}`,value:t[r]}));return i}}};function ly(e){const t=e.value,i=e.key,r=e.styleSpec,o=e.style;if(!t.type)return[new Nt(i,t,'"type" is required')];const n=Yi(t.type);let s=[];switch(["vector","raster","raster-dem"].includes(n)&&(t.url||t.tiles||s.push(new Nt(i,t,'Either "url" or "tiles" is required.'))),n){case"vector":case"raster":case"raster-dem":return s=s.concat(vo({key:i,value:t,valueSpec:r[`source_${n.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:ay})),s;case"geojson":if(s=vo({key:i,value:t,valueSpec:r.source_geojson,style:o,styleSpec:r,objectElementValidators:ay}),t.cluster)for(const a in t.clusterProperties){const[l,c]=t.clusterProperties[a],u=typeof l=="string"?[l,["accumulated"],["get",a]]:l;s.push(...zs({key:`${i}.${a}.map`,value:c,expressionContext:"cluster-map"})),s.push(...zs({key:`${i}.${a}.reduce`,value:u,expressionContext:"cluster-reduce"}))}return s;case"video":return vo({key:i,value:t,valueSpec:r.source_video,style:o,styleSpec:r});case"image":return vo({key:i,value:t,valueSpec:r.source_image,style:o,styleSpec:r});case"canvas":return[new Nt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bu({key:`${i}.type`,value:t.type,valueSpec:{values:V3(r)},style:o,styleSpec:r})}}function V3(e){return e.source.reduce((t,i)=>{const r=e[i];return r.type.type==="enum"&&(t=t.concat(Object.keys(r.type.values))),t},[])}function cy(e){const t=e.value;let i=[];if(!t)return i;const r=Qe(t);return r!=="string"?(i=i.concat([new Nt(e.key,t,`string expected, "${r}" found`)]),i):(function(o){const n=o.indexOf("://")===-1;try{return new URL(o,n?"http://example.com":void 0),!0}catch{return!1}}(t)||(i=i.concat([new Nt(e.key,t,`invalid url "${t}"`)])),i)}function uy(e){const t=e.value,i=e.styleSpec,r=i.light,o=e.style;let n=[];const s=Qe(t);if(t===void 0)return n;if(s!=="object")return n=n.concat([new Nt("light",t,`object expected, ${s} found`)]),n;for(const a in t){const l=a.match(/^(.*)-transition$/);n=n.concat(l&&r[l[1]]&&r[l[1]].transition?pr({key:a,value:t[a],valueSpec:i.transition,style:o,styleSpec:i}):r[a]?pr({key:a,value:t[a],valueSpec:r[a],style:o,styleSpec:i}):[new Nt(a,t[a],`unknown property "${a}"`)])}return n}function hy(e){const t=e.value;let i=[];if(!t)return i;const r=Qe(t);if(r!=="object")return i=i.concat([new Nt("light-3d",t,`object expected, ${r} found`)]),i;const o=e.styleSpec,n=o["light-3d"],s=e.key,a=e.style,l=e.style.lights;for(const p of["type","id"])if(!(p in t))return i=i.concat([new Nt("light-3d",t,`missing property ${p} on light`)]),i;if(t.type&&l)for(let p=0;p<e.arrayIndex;p++){const f=Yi(t.type),g=l[p];Yi(g.type)===f&&i.push(new Nt(s,t.id,`duplicate light type "${t.type}", previously defined at line ${g.id.__line__}`))}const c=`properties_light_${t.type}`;if(!(c in o))return i=i.concat([new Nt("light-3d",t,`Invalid light type ${t.type}`)]),i;const u=o[c];for(const p in t)if(p==="properties"){const f=t[p],g=Qe(f);if(g!=="object")return i=i.concat([new Nt("properties",f,`object expected, ${g} found`)]),i;for(const _ in f)i=i.concat(u[_]?pr({key:_,value:f[_],valueSpec:u[_],style:a,styleSpec:o}):[new Ss(e.key,f[_],`unknown property "${_}"`)])}else{const f=p.match(/^(.*)-transition$/);i=i.concat(f&&n[f[1]]&&n[f[1]].transition?pr({key:p,value:t[p],valueSpec:o.transition,style:a,styleSpec:o}):n[p]?pr({key:p,value:t[p],valueSpec:n[p],style:a,styleSpec:o}):[new Ss(p,t[p],`unknown property "${p}"`)])}return i}function dy(e){const t=e.value,i=e.key,r=e.style,o=e.styleSpec,n=o.terrain;let s=[];const a=Qe(t);if(t===void 0||a==="null")return s;if(a!=="object")return s=s.concat([new Nt("terrain",t,`object expected, ${a} found`)]),s;for(const l in t){const c=l.match(/^(.*)-transition$/);s=s.concat(c&&n[c[1]]&&n[c[1]].transition?pr({key:l,value:t[l],valueSpec:o.transition,style:r,styleSpec:o}):n[l]?pr({key:l,value:t[l],valueSpec:n[l],style:r,styleSpec:o}):[new Ss(l,t[l],`unknown property "${l}"`)])}if(t.source){const l=r.sources&&r.sources[t.source],c=l&&Yi(l.type);l?c!=="raster-dem"&&s.push(new Nt(i,t.source,`terrain cannot be used with a source of type ${String(c)}, it only be used with a "raster-dem" source type`)):s.push(new Nt(i,t.source,`source "${t.source}" not found`))}else s.push(new Nt(i,t,'terrain is missing required property "source"'));return s}function py(e){const t=e.value,i=e.style,r=e.styleSpec,o=r.fog;let n=[];const s=Qe(t);if(t===void 0)return n;if(s!=="object")return n=n.concat([new Nt("fog",t,`object expected, ${s} found`)]),n;for(const a in t){const l=a.match(/^(.*)-transition$/);n=n.concat(l&&o[l[1]]&&o[l[1]].transition?pr({key:a,value:t[a],valueSpec:r.transition,style:i,styleSpec:r}):o[a]?pr({key:a,value:t[a],valueSpec:o[a],style:i,styleSpec:r}):[new Ss(a,t[a],`unknown property "${a}"`)])}return n}const fy={"*":()=>[],array:H0,boolean:function(e){const t=e.value,i=e.key,r=Qe(t);return r!=="boolean"?[new Nt(i,t,`boolean expected, ${r} found`)]:[]},number:W0,color:function(e){const t=e.key,i=e.value,r=Qe(i);return r!=="string"?[new Nt(t,i,`color expected, ${r} found`)]:hp(i)===null?[new Nt(t,i,`color expected, "${i}" found`)]:[]},enum:bu,filter:af,function:X0,layer:sy,object:vo,source:ly,model:cy,light:uy,"light-3d":hy,terrain:dy,fog:py,string:Ma,formatted:function(e){return Ma(e).length===0?[]:zs(e)},resolvedImage:function(e){return Ma(e).length===0?[]:zs(e)},projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,o=e.style;let n=[];const s=Qe(t);if(s==="object")for(const a in t)n=n.concat(pr({key:a,value:t[a],valueSpec:r[a],style:o,styleSpec:i}));else s!=="string"&&(n=n.concat([new Nt("projection",t,`object or string expected, ${s} found`)]));return n},import:function(e){const{value:t,styleSpec:i}=e,{data:r,...o}=t;Object.defineProperty(o,"__line__",{value:t.__line__,enumerable:!1});let n=vo(pn({},e,{value:o,valueSpec:i.import}));return Yi(o.id)===""&&n.push(new Nt(`${e.key}.id`,o,"import id can't be an empty string")),r&&(n=n.concat(my(r,i,{key:`${e.key}.data`}))),n}};function pr(e,t=!1){const i=e.value,r=e.valueSpec,o=e.styleSpec;if(r.expression&&_u(Yi(i)))return X0(e);if(r.expression&&yu(fn(i)))return zs(e);if(r.type&&fy[r.type]){const n=fy[r.type](e);return t===!0&&n.length>0&&Qe(e.value)==="array"?zs(e):n}return vo(pn({},e,{valueSpec:r.type?o[r.type]:r}))}function j3(e){const t=e.value,i=e.key,r=Ma(e);return r.length||(t.indexOf("{fontstack}")===-1&&r.push(new Nt(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&r.push(new Nt(i,t,'"glyphs" url must include a "{range}" token'))),r}function my(e,t=tt,i={}){return pr({key:i.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:j3,"*":()=>[]}})}function Aa(e,t=tt){return Po(my(e,t))}const U3=e=>Po(ly(e)),G3=e=>Po(uy(e)),q3=e=>Po(hy(e)),$3=e=>Po(dy(e)),Z3=e=>Po(py(e)),H3=e=>Po(sy(e)),lf=e=>Po(af(e)),W3=e=>Po(oy(e)),X3=e=>Po(ny(e)),Y3=e=>Po(cy(e));function Po(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Su(e,t){let i=!1;if(t&&t.length)for(const r of t)r instanceof Ss?Y(r.message):(e.fire(new ae(new Error(r.message))),i=!0);return i}var J3=Xo,qn=3;function Xo(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var o=new Int32Array(this.arrayBuffer);e=o[0],this.d=(t=o[1])+2*(i=o[2]);for(var n=0;n<this.d*this.d;n++){var s=o[qn+n],a=o[qn+n+1];r.push(s===a?null:o.subarray(s,a))}var l=o[qn+r.length+1];this.keys=o.subarray(o[qn+r.length],l),this.bboxes=o.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}Xo.prototype.insert=function(e,t,i,r,o){this._forEachCell(t,i,r,o,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o)},Xo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xo.prototype._insertCell=function(e,t,i,r,o,n){this.cells[o].push(n)},Xo.prototype.query=function(e,t,i,r,o){var n=this.min,s=this.max;if(e<=n&&t<=n&&s<=i&&s<=r&&!o)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,r,this._queryCell,a,{},o),a},Xo.prototype._queryCell=function(e,t,i,r,o,n,s,a){var l=this.cells[o];if(l!==null)for(var c=this.keys,u=this.bboxes,p=0;p<l.length;p++){var f=l[p];if(s[f]===void 0){var g=4*f;(a?a(u[g+0],u[g+1],u[g+2],u[g+3]):e<=u[g+2]&&t<=u[g+3]&&i>=u[g+0]&&r>=u[g+1])?(s[f]=!0,n.push(c[f])):s[f]=!1}}},Xo.prototype._forEachCell=function(e,t,i,r,o,n,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),p=this._convertToCellCoord(r),f=l;f<=u;f++)for(var g=c;g<=p;g++){var _=this.d*g+f;if((!a||a(this._convertFromCellCoord(f),this._convertFromCellCoord(g),this._convertFromCellCoord(f+1),this._convertFromCellCoord(g+1)))&&o.call(this,e,t,i,r,_,n,s,a))return}},Xo.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Xo.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Xo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=qn+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var o=new Int32Array(t+i+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var n=t,s=0;s<e.length;s++){var a=e[s];o[qn+s]=n,o.set(a,n),n+=a.length}return o[qn+e.length]=n,o.set(this.keys,n),o[qn+e.length+1]=n+=this.keys.length,o.set(this.bboxes,n),n+=this.bboxes.length,o.buffer};var Ca=ke(J3);const Mu={};function jt(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Mu[t]={klass:e,omit:i.omit||[]}}jt(Object,"Object"),Ca.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},Ca.deserialize=function(e){return new Ca(e.buffer)},Object.defineProperty(Ca,"name",{value:"Grid"}),jt(Ca,"Grid"),jt(xe,"Color"),jt(Error,"Error"),jt(ft,"AJAXError"),jt(xo,"ResolvedImage"),jt(xu,"StylePropertyFunction"),jt(ef,"StyleExpression",{omit:["_evaluator"]}),jt(Gn,"ZoomDependentExpression"),jt(rf,"ZoomConstantExpression"),jt(Ho,"CompoundExpression",{omit:["_evaluate"]});for(const e in Pl)Mu[Pl[e]._classRegistryKey]||jt(Pl[e],`Expression${e}`);function gy(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function _y(e){return k.ImageBitmap&&e instanceof k.ImageBitmap}function Ia(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(gy(e)||_y(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.add(i.buffer),i}if(e instanceof k.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(Ia(r,t));return i}if(e instanceof Map){const i={$name:"Map"};for(const[r,o]of e.entries())i[r]=Ia(o);return i}if(typeof e=="object"){const i=e.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const o=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const n in e)e.hasOwnProperty(n)&&(Mu[r].omit.indexOf(n)>=0||(o[n]=Ia(e[n],t)));e instanceof Error&&(o.message=e.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(o.$name=r),o}throw new Error("can't serialize object of type "+typeof e)}function ka(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||gy(e)||_y(e)||ArrayBuffer.isView(e)||e instanceof k.ImageData)return e;if(Array.isArray(e))return e.map(ka);if(typeof e=="object"){const t=e.$name||"Object";if(t==="Map"){const o=new Map;for(const n of Object.keys(e))n!=="$name"&&o.set(n,ka(e[n]));return o}const{klass:i}=Mu[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const o of Object.keys(e))o!=="$name"&&(r[o]=ka(e[o]));return r}throw new Error("can't deserialize object of type "+typeof e)}const qt={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function cf(e){for(const t of e)if(uf(t.charCodeAt(0)))return!0;return!1}function K3(e){for(const t of e)if(!Q3(t.charCodeAt(0)))return!1;return!0}function Q3(e){return!(qt.Arabic(e)||qt["Arabic Supplement"](e)||qt["Arabic Extended-A"](e)||qt["Arabic Presentation Forms-A"](e)||qt["Arabic Presentation Forms-B"](e))}function uf(e){return!(e!==746&&e!==747&&(e<4352||!(qt["Bopomofo Extended"](e)||qt.Bopomofo(e)||qt["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||qt["CJK Compatibility Ideographs"](e)||qt["CJK Compatibility"](e)||qt["CJK Radicals Supplement"](e)||qt["CJK Strokes"](e)||!(!qt["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||qt["CJK Unified Ideographs Extension A"](e)||qt["CJK Unified Ideographs"](e)||qt["Enclosed CJK Letters and Months"](e)||qt["Hangul Compatibility Jamo"](e)||qt["Hangul Jamo Extended-A"](e)||qt["Hangul Jamo Extended-B"](e)||qt["Hangul Jamo"](e)||qt["Hangul Syllables"](e)||qt.Hiragana(e)||qt["Ideographic Description Characters"](e)||qt.Kanbun(e)||qt["Kangxi Radicals"](e)||qt["Katakana Phonetic Extensions"](e)||qt.Katakana(e)&&e!==12540||!(!qt["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!qt["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||qt["Unified Canadian Aboriginal Syllabics"](e)||qt["Unified Canadian Aboriginal Syllabics Extended"](e)||qt["Vertical Forms"](e)||qt["Yijing Hexagram Symbols"](e)||qt["Yi Syllables"](e)||qt["Yi Radicals"](e))))}function yy(e){return!(uf(e)||function(t){return!!(qt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||qt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||qt["Letterlike Symbols"](t)||qt["Number Forms"](t)||qt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||qt["Control Pictures"](t)&&t!==9251||qt["Optical Character Recognition"](t)||qt["Enclosed Alphanumerics"](t)||qt["Geometric Shapes"](t)||qt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||qt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||qt["CJK Symbols and Punctuation"](t)||qt.Katakana(t)||qt["Private Use Area"](t)||qt["CJK Compatibility Forms"](t)||qt["Small Form Variants"](t)||qt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function xy(e){return e>=1424&&e<=2303||qt["Arabic Presentation Forms-A"](e)||qt["Arabic Presentation Forms-B"](e)}function tS(e,t){return!(!t&&xy(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||qt.Khmer(e))}function eS(e){for(const t of e)if(xy(t.charCodeAt(0)))return!0;return!1}const hf="deferred",df="loading",pf="loaded";let ff=null,$r="unavailable",$n=null;const vy=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&($r="error"),ff&&ff(e)};function mf(){gf.fire(new Tt("pluginStateChange",{pluginStatus:$r,pluginURL:$n}))}const gf=new qi,_f=function(){return $r},by=function(){if($r!==hf||!$n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$r=df,mf(),$n&&Dt({url:$n},e=>{e?vy(e):($r=pf,mf())})},bo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$r===pf||bo.applyArabicShaping!=null,isLoading:()=>$r===df,setState(e){$r=e.pluginStatus,$n=e.pluginURL},isParsed:()=>bo.applyArabicShaping!=null&&bo.processBidirectionalText!=null&&bo.processStyledBidirectionalText!=null,getPluginURL:()=>$n};class Ti{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,r){for(const o of i)if(!tS(o.charCodeAt(0),r))return!1;return!0}(t,bo.isLoaded())}}class Au{constructor(t,i,r){this.property=t,this.value=i,this.expression=function(o,n,s){if(_u(o))return new xu(o,n);if(yu(o)||Array.isArray(o)&&o.length>0){const a=of(o,n,s);if(a.result==="error")throw new Error(a.value.map(l=>`${l.key}: ${l.message}`).join(", "));return a.value}{let a=o;return typeof o=="string"&&n.type==="color"&&(a=xe.parse(o)),{kind:"constant",isConfigDependent:!1,evaluate:()=>a}}}(i===void 0?t.specification.default:i,t.specification,r)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,r){return this.property.possiblyEvaluate(this,t,i,r)}}class yf{constructor(t,i){this.property=t,this.value=new Au(t,void 0,i)}transitioned(t,i){return new wy(this.property,this.value,i,Vt({},t.transition,this.transition),t.now)}untransitioned(){return new wy(this.property,this.value,null,{},0)}}class Ll{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return V(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new yf(this._values[t].property,this._options)),this._values[t].value=new Au(this._values[t].property,i===null?void 0:V(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);const r=this._properties.properties;if(t)for(const o in t){const n=t[o];if(ua(o,"-transition")){const s=o.slice(0,-11);r[s]&&this.setTransition(s,n)}else r[o]&&this.setValue(o,n)}}getTransition(t){return V(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new yf(this._values[t].property)),this._values[t].transition=V(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(t[i]=r);const o=this.getTransition(i);o!==void 0&&(t[`${i}-transition`]=o)}return t}transitioned(t,i){const r=new Ty(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].transitioned(t,i._values[o]);return r}untransitioned(){const t=new Ty(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class wy{constructor(t,i,r,o,n){const s=o.delay||0,a=o.duration||0;n=n||0,this.property=t,this.value=i,this.begin=n+s,this.end=this.begin+a,t.specification.transition&&(o.delay||o.duration)&&(this.prior=r)}possiblyEvaluate(t,i,r){const o=t.now||0,n=this.value.possiblyEvaluate(t,i,r),s=this.prior;if(s){if(o>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(o<this.begin)return s.possiblyEvaluate(t,i,r);{const a=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,i,r),n,ri(a))}}return n}}class Ty{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,r){const o=new Ol(this._properties);for(const n of Object.keys(this._values))o._values[n]=this._values[n].possiblyEvaluate(t,i,r);return o}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class iS{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return V(this._values[t].value)}setValue(t,i){this._values[t]=new Au(this._values[t].property,i===null?void 0:V(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(t[i]=r)}return t}possiblyEvaluate(t,i,r){const o=new Ol(this._properties);for(const n of Object.keys(this._values))o._values[n]=this._values[n].possiblyEvaluate(t,i,r);return o}}class Da{constructor(t,i,r){this.property=t,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,r,o){return this.property.evaluate(this.value,this.parameters,t,i,r,o)}}class Ol{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,r){const o=pu[this.specification.type];return o?o(t,i,r):t}}class Yt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,r,o){return new Da(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},r,o)}:t.expression,i)}interpolate(t,i,r){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Da(this,{kind:"constant",value:void 0},t.parameters);const o=pu[this.specification.type];return o?new Da(this,{kind:"constant",value:o(t.value.value,i.value.value,r)},t.parameters):t}evaluate(t,i,r,o,n,s){return t.kind==="constant"?t.value:t.evaluate(i,r,o,n,s)}}class Bl{constructor(t){this.specification=t}possiblyEvaluate(t,i,r,o){return!!t.expression.evaluate(i,null,{},r,o)}interpolate(){return!1}}class Pi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ti(0,{});for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const n=this.defaultPropertyValues[r]=new Au(o,void 0),s=this.defaultTransitionablePropertyValues[r]=new yf(o);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=n.possiblyEvaluate(i)}}}jt(Yt,"DataDrivenProperty"),jt(bt,"DataConstantProperty"),jt(Bl,"ColorRampProperty");const Cu="";function Ey(e){return e.indexOf(Cu)>=0}function br(e,t){return t?`${e}${Cu}${t}`:e}function Iu(e){const t=e.indexOf(Cu);return t>=0?e.slice(0,t):e}const Sy="-transition";class no extends qi{constructor(t,i,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=r,t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new iS(i.layout,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ll(i.paint,r);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ol(i.paint)}}setScope(t){this.scope=t,this.fqid=br(this.id,t)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,r={}){if(i!=null&&this._validate(X3,`layers.${this.id}.layout.${t}`,t,i,r))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[t]&&(o.setValue(t,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return ua(t,Sy)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,r={}){if(i!=null&&this._validate(W3,`layers.${this.id}.paint.${t}`,t,i,r))return!1;const o=this._transitionablePaint,n=o._properties.properties;if(ua(t,Sy)){const f=t.slice(0,-11);return n[f]&&o.setTransition(f,i||void 0),!1}if(!n[t])return!1;const s=o._values[t],a=s.value.isDataDriven(),l=s.value;o.setValue(t,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const c=o._values[t].value,u=c.isDataDriven(),p=ua(t,"pattern")||t==="line-dasharray";return u||a||p||this._handleOverridablePaintPropertyUpdate(t,l,c)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,r){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Et({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}_validate(t,i,r,o,n={}){return(!n||n.validate!==!1)&&Su(this,t.call(Aa,{key:i,layerType:this.type,objectKey:r,value:o,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Da&&Ds(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class rS{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){const i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const oS={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ku{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function He(e,t=1){let i=0,r=0;return{members:e.map(o=>{const n=oS[o.type].BYTES_PER_ELEMENT,s=i=My(i,Math.max(t,n)),a=o.components||1;return r=Math.max(r,n),i+=n*a,{name:o.name,type:o.type,components:a,offset:s}}),size:My(i,Math.max(r,t)),alignment:t}}function My(e,t){return Math.ceil(e/t)*t}class Zr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,i)}emplace(t,i,r){const o=2*t;return this.int16[o+0]=i,this.int16[o+1]=r,t}}Zr.prototype.bytesPerElement=4,jt(Zr,"StructArrayLayout2i4");class Du extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,i,r)}emplace(t,i,r,o){const n=3*t;return this.int16[n+0]=i,this.int16[n+1]=r,this.int16[n+2]=o,t}}Du.prototype.bytesPerElement=6,jt(Du,"StructArrayLayout3i6");class Ps extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,t,i,r,o)}emplace(t,i,r,o,n){const s=4*t;return this.int16[s+0]=i,this.int16[s+1]=r,this.int16[s+2]=o,this.int16[s+3]=n,t}}Ps.prototype.bytesPerElement=8,jt(Ps,"StructArrayLayout4i8");class xf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,i,r,o,n)}emplace(t,i,r,o,n,s){const a=5*t;return this.int16[a+0]=i,this.int16[a+1]=r,this.int16[a+2]=o,this.int16[a+3]=n,this.int16[a+4]=s,t}}xf.prototype.bytesPerElement=10,jt(xf,"StructArrayLayout5i10");class vf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,r,o,n,s,a)}emplace(t,i,r,o,n,s,a,l){const c=6*t,u=12*t,p=3*t;return this.int16[c+0]=i,this.int16[c+1]=r,this.uint8[u+4]=o,this.uint8[u+5]=n,this.uint8[u+6]=s,this.uint8[u+7]=a,this.float32[p+2]=l,t}}vf.prototype.bytesPerElement=12,jt(vf,"StructArrayLayout2i4ub1f12");class _n extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,t,i,r,o)}emplace(t,i,r,o,n){const s=4*t;return this.float32[s+0]=i,this.float32[s+1]=r,this.float32[s+2]=o,this.float32[s+3]=n,t}}_n.prototype.bytesPerElement=16,jt(_n,"StructArrayLayout4f16");class Zn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,i,r,o,n)}emplace(t,i,r,o,n,s){const a=6*t,l=3*t;return this.uint16[a+0]=i,this.uint16[a+1]=r,this.uint16[a+2]=o,this.uint16[a+3]=n,this.float32[l+2]=s,t}}Zn.prototype.bytesPerElement=12,jt(Zn,"StructArrayLayout4ui1f12");class zu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,t,i,r,o)}emplace(t,i,r,o,n){const s=4*t;return this.uint16[s+0]=i,this.uint16[s+1]=r,this.uint16[s+2]=o,this.uint16[s+3]=n,t}}zu.prototype.bytesPerElement=8,jt(zu,"StructArrayLayout4ui8");class Pu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,i,r,o,n,s)}emplace(t,i,r,o,n,s,a){const l=6*t;return this.int16[l+0]=i,this.int16[l+1]=r,this.int16[l+2]=o,this.int16[l+3]=n,this.int16[l+4]=s,this.int16[l+5]=a,t}}Pu.prototype.bytesPerElement=12,jt(Pu,"StructArrayLayout6i12");class bf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a,l,c,u,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,r,o,n,s,a,l,c,u,p,f)}emplace(t,i,r,o,n,s,a,l,c,u,p,f,g){const _=12*t;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=o,this.int16[_+3]=n,this.uint16[_+4]=s,this.uint16[_+5]=a,this.uint16[_+6]=l,this.uint16[_+7]=c,this.int16[_+8]=u,this.int16[_+9]=p,this.int16[_+10]=f,this.int16[_+11]=g,t}}bf.prototype.bytesPerElement=24,jt(bf,"StructArrayLayout4i4ui4i24");class wf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,i,r,o,n,s)}emplace(t,i,r,o,n,s,a){const l=10*t,c=5*t;return this.int16[l+0]=i,this.int16[l+1]=r,this.int16[l+2]=o,this.float32[c+2]=n,this.float32[c+3]=s,this.float32[c+4]=a,t}}wf.prototype.bytesPerElement=20,jt(wf,"StructArrayLayout3i3f20");class Tf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Tf.prototype.bytesPerElement=4,jt(Tf,"StructArrayLayout1ul4");class Hn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,i)}emplace(t,i,r){const o=2*t;return this.uint16[o+0]=i,this.uint16[o+1]=r,t}}Hn.prototype.bytesPerElement=4,jt(Hn,"StructArrayLayout2ui4");class Ef extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a,l,c,u,p,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,i,r,o,n,s,a,l,c,u,p,f,g)}emplace(t,i,r,o,n,s,a,l,c,u,p,f,g,_){const y=20*t,x=10*t;return this.int16[y+0]=i,this.int16[y+1]=r,this.int16[y+2]=o,this.int16[y+3]=n,this.int16[y+4]=s,this.float32[x+3]=a,this.float32[x+4]=l,this.float32[x+5]=c,this.float32[x+6]=u,this.int16[y+14]=p,this.uint32[x+8]=f,this.uint16[y+18]=g,this.uint16[y+19]=_,t}}Ef.prototype.bytesPerElement=40,jt(Ef,"StructArrayLayout5i4f1i1ul2ui40");class Ru extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,r,o,n,s,a)}emplace(t,i,r,o,n,s,a,l){const c=8*t;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=o,this.int16[c+4]=n,this.int16[c+5]=s,this.int16[c+6]=a,this.int16[c+7]=l,t}}Ru.prototype.bytesPerElement=16,jt(Ru,"StructArrayLayout3i2i2i16");class Sf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,i,r,o,n)}emplace(t,i,r,o,n,s){const a=4*t,l=8*t;return this.float32[a+0]=i,this.float32[a+1]=r,this.float32[a+2]=o,this.int16[l+6]=n,this.int16[l+7]=s,t}}Sf.prototype.bytesPerElement=16,jt(Sf,"StructArrayLayout2f1f2i16");class Mf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,t,i,r,o)}emplace(t,i,r,o,n){const s=12*t,a=3*t;return this.uint8[s+0]=i,this.uint8[s+1]=r,this.float32[a+1]=o,this.float32[a+2]=n,t}}Mf.prototype.bytesPerElement=12,jt(Mf,"StructArrayLayout2ub2f12");class Zi extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,i,r)}emplace(t,i,r,o){const n=3*t;return this.uint16[n+0]=i,this.uint16[n+1]=r,this.uint16[n+2]=o,t}}Zi.prototype.bytesPerElement=6,jt(Zi,"StructArrayLayout3ui6");class Af extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E){const A=this.length;return this.resize(A+1),this.emplace(A,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E)}emplace(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E,A){const I=30*t,z=15*t,P=60*t;return this.int16[I+0]=i,this.int16[I+1]=r,this.int16[I+2]=o,this.float32[z+2]=n,this.float32[z+3]=s,this.uint16[I+8]=a,this.uint16[I+9]=l,this.uint32[z+5]=c,this.uint32[z+6]=u,this.uint32[z+7]=p,this.uint16[I+16]=f,this.uint16[I+17]=g,this.uint16[I+18]=_,this.float32[z+10]=y,this.float32[z+11]=x,this.uint8[P+48]=b,this.uint8[P+49]=T,this.uint8[P+50]=S,this.uint32[z+13]=M,this.int16[I+28]=E,this.uint8[P+58]=A,t}}Af.prototype.bytesPerElement=60,jt(Af,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E,A,I,z,P,R,F,N,U,O,Z,W){const K=this.length;return this.resize(K+1),this.emplace(K,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E,A,I,z,P,R,F,N,U,O,Z,W)}emplace(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E,A,I,z,P,R,F,N,U,O,Z,W,K){const $=20*t,H=40*t,it=80*t;return this.float32[$+0]=i,this.float32[$+1]=r,this.int16[H+4]=o,this.int16[H+5]=n,this.int16[H+6]=s,this.int16[H+7]=a,this.int16[H+8]=l,this.int16[H+9]=c,this.int16[H+10]=u,this.int16[H+11]=p,this.int16[H+12]=f,this.uint16[H+13]=g,this.uint16[H+14]=_,this.uint16[H+15]=y,this.uint16[H+16]=x,this.uint16[H+17]=b,this.uint16[H+18]=T,this.uint16[H+19]=S,this.uint16[H+20]=M,this.uint16[H+21]=E,this.uint16[H+22]=A,this.uint16[H+23]=I,this.uint16[H+24]=z,this.uint16[H+25]=P,this.uint16[H+26]=R,this.uint16[H+27]=F,this.uint32[$+14]=N,this.float32[$+15]=U,this.float32[$+16]=O,this.float32[$+17]=Z,this.float32[$+18]=W,this.uint8[it+76]=K,t}}Cf.prototype.bytesPerElement=80,jt(Cf,"StructArrayLayout2f9i15ui1ul4f1ub80");class Fl extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Fl.prototype.bytesPerElement=4,jt(Fl,"StructArrayLayout1f4");class Rs extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,i,r,o,n)}emplace(t,i,r,o,n,s){const a=5*t;return this.float32[a+0]=i,this.float32[a+1]=r,this.float32[a+2]=o,this.float32[a+3]=n,this.float32[a+4]=s,t}}Rs.prototype.bytesPerElement=20,jt(Rs,"StructArrayLayout5f20");class If extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,r,o,n,s,a)}emplace(t,i,r,o,n,s,a,l){const c=7*t;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=o,this.float32[c+3]=n,this.float32[c+4]=s,this.float32[c+5]=a,this.float32[c+6]=l,t}}If.prototype.bytesPerElement=28,jt(If,"StructArrayLayout7f28");class kf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,t,i,r,o)}emplace(t,i,r,o,n){const s=6*t;return this.uint32[3*t+0]=i,this.uint16[s+2]=r,this.uint16[s+3]=o,this.uint16[s+4]=n,t}}kf.prototype.bytesPerElement=12,jt(kf,"StructArrayLayout1ul3ui12");class Nl extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Nl.prototype.bytesPerElement=2,jt(Nl,"StructArrayLayout1ui2");class Ls extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,i,r)}emplace(t,i,r,o){const n=3*t;return this.float32[n+0]=i,this.float32[n+1]=r,this.float32[n+2]=o,t}}Ls.prototype.bytesPerElement=12,jt(Ls,"StructArrayLayout3f12");class Vl extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,i)}emplace(t,i,r){const o=2*t;return this.float32[o+0]=i,this.float32[o+1]=r,t}}Vl.prototype.bytesPerElement=8,jt(Vl,"StructArrayLayout2f8");class Df extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x)}emplace(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b){const T=16*t;return this.float32[T+0]=i,this.float32[T+1]=r,this.float32[T+2]=o,this.float32[T+3]=n,this.float32[T+4]=s,this.float32[T+5]=a,this.float32[T+6]=l,this.float32[T+7]=c,this.float32[T+8]=u,this.float32[T+9]=p,this.float32[T+10]=f,this.float32[T+11]=g,this.float32[T+12]=_,this.float32[T+13]=y,this.float32[T+14]=x,this.float32[T+15]=b,t}}Df.prototype.bytesPerElement=64,jt(Df,"StructArrayLayout16f64");class Lu extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,r,o,n,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,r,o,n,s,a)}emplace(t,i,r,o,n,s,a,l){const c=10*t,u=5*t;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=o,this.uint16[c+3]=n,this.float32[u+2]=s,this.float32[u+3]=a,this.float32[u+4]=l,t}}Lu.prototype.bytesPerElement=20,jt(Lu,"StructArrayLayout4ui3f20");class zf extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}zf.prototype.bytesPerElement=1,jt(zf,"StructArrayLayout1ub1");class Ay extends ku{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ay.prototype.size=40;class Pf extends Ef{get(t){return new Ay(this,t)}}jt(Pf,"CollisionBoxArray");class Cy extends ku{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Cy.prototype.size=60;class Iy extends Af{get(t){return new Cy(this,t)}}jt(Iy,"PlacedSymbolArray");class ky extends ku{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ky.prototype.size=80;class Dy extends Cf{get(t){return new ky(this,t)}}jt(Dy,"SymbolInstanceArray");class zy extends Fl{getoffsetX(t){return this.float32[1*t+0]}}jt(zy,"GlyphOffsetArray");class Py extends Zr{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}jt(Py,"SymbolLineVertexArray");class Ry extends ku{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ry.prototype.size=12;class Ly extends kf{get(t){return new Ry(this,t)}}jt(Ly,"FeatureIndexArray");class Oy extends Hn{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}jt(Oy,"FillExtrusionCentroidArray");const nS=He([{name:"a_pos",components:2,type:"Int16"}],4),sS=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ti{constructor(t=[]){this.segments=t}_prepareSegment(t,i,r,o){let n=this.segments[this.segments.length-1];return t>ti.MAX_VERTEX_ARRAY_LENGTH&&Y(`Max vertices per segment is ${ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>ti.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==o)&&(n={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},o!==void 0&&(n.sortKey=o),this.segments.push(n)),n}prepareSegment(t,i,r,o){return this._prepareSegment(t,i.length,r.length,o)}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,r,o){return new ti([{vertexOffset:t,primitiveOffset:i,vertexLength:r,primitiveLength:o,vaos:{},sortKey:0}])}}function By(e,t){return 256*(e=Ut(Math.floor(e),0,255))+Ut(Math.floor(t),0,255)}ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(ti,"SegmentVector");const aS=He([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lS=He([{name:"a_dash",components:4,type:"Uint16"}]);var Ou={exports:{}},Fy={exports:{}};(function(e){e.exports=function(t,i){var r,o,n,s,a,l,c,u;for(o=t.length-(r=3&t.length),n=i,a=3432918353,l=461845907,u=0;u<o;)c=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,n=27492+(65535&(s=5*(65535&(n=(n^=c=(65535&(c=(c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*l+(((c>>>16)*l&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&t.charCodeAt(u+2))<<16;case 2:c^=(255&t.charCodeAt(u+1))<<8;case 1:n^=c=(65535&(c=(c=(65535&(c^=255&t.charCodeAt(u)))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<15|c>>>17))*l+(((c>>>16)*l&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})(Fy);var cS=Fy.exports,Ny={exports:{}};(function(e){e.exports=function(t,i){for(var r,o=t.length,n=i^o,s=0;o>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++s;switch(o){case 3:n^=(255&t.charCodeAt(s+2))<<16;case 2:n^=(255&t.charCodeAt(s+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(s)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})(Ny);var Vy=cS,uS=Ny.exports;Ou.exports=Vy,Ou.exports.murmur3=Vy,Ou.exports.murmur2=uS;var Rf=ke(Ou.exports);class jl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,r,o){this.ids.push(jy(t)),this.positions.push(i,r,o)}eachPosition(t,i){const r=jy(t);let o=0,n=this.ids.length-1;for(;o<n;){const s=o+n>>1;this.ids[s]>=r?n=s:o=s+1}for(;this.ids[o]===r;)i(this.positions[3*o],this.positions[3*o+1],this.positions[3*o+2]),o++}static serialize(t,i){const r=new Float64Array(t.ids),o=new Uint32Array(t.positions);return Lf(r,o,0,r.length-1),i&&(i.add(r.buffer),i.add(o.buffer)),{ids:r,positions:o}}static deserialize(t){const i=new jl;let r;i.ids=t.ids,i.positions=t.positions;for(const o of i.ids)o!==r&&i.uniqueIds.push(o),r=o;return i.indexed=!0,i}}function jy(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Rf(String(e))}function Lf(e,t,i,r){for(;i<r;){const o=e[i+r>>1];let n=i-1,s=r+1;for(;;){do n++;while(e[n]<o);do s--;while(e[s]>o);if(n>=s)break;Bu(e,n,s),Bu(t,3*n,3*s),Bu(t,3*n+1,3*s+1),Bu(t,3*n+2,3*s+2)}s-i<r-s?(Lf(e,t,i,s),i=s+1):(Lf(e,t,s+1,r),r=s)}}function Bu(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}jt(jl,"FeaturePositionMap");class yn{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class Ee extends yn{constructor(t){super(t),this.current=0}set(t,i,r){this.fetchUniformLocation(t,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class yt extends yn{constructor(t){super(t),this.current=0}set(t,i,r){this.fetchUniformLocation(t,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Se extends yn{constructor(t){super(t),this.current=[0,0]}set(t,i,r){this.fetchUniformLocation(t,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class fe extends yn{constructor(t){super(t),this.current=[0,0,0]}set(t,i,r){this.fetchUniformLocation(t,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Hr extends yn{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,r){this.fetchUniformLocation(t,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class za extends yn{constructor(t){super(t),this.current=xe.transparent}set(t,i,r){this.fetchUniformLocation(t,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const hS=new Float32Array(16);class he extends yn{constructor(t){super(t),this.current=hS}set(t,i,r){if(this.fetchUniformLocation(t,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let o=1;o<16;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const dS=new Float32Array(9);class Of extends yn{constructor(t){super(t),this.current=dS}set(t,i,r){if(this.fetchUniformLocation(t,i)){for(let o=0;o<9;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}}const pS=new Float32Array(4);class Bf extends yn{constructor(t){super(t),this.current=pS}set(t,i,r){if(this.fetchUniformLocation(t,i)){for(let o=0;o<4;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function Ff(e){return[By(255*e.r,255*e.g),By(255*e.b,255*e.a)]}class Ul{constructor(t,i,r){this.value=t,this.uniformNames=i.map(o=>`u_${o}`),this.type=r}setUniform(t,i,r,o,n){i.set(t,n,o.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new za(t):new yt(t)}}class Pa{constructor(t,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,r,o,n){const s=n==="u_pattern"||n==="u_dash"?this.pattern:n==="u_pixel_ratio"?this.pixelRatio:null;s&&i.set(t,n,s)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new Hr(t):new yt(t)}}class xn{constructor(t,i,r,o){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(n=>({name:`a_${n}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,i,r,o,n,s,a){const l=this.paintVertexArray.length,c=this.expression.evaluate(new Ti(0,{brightness:s}),i,{},n,o,a);this.paintVertexArray.resize(t),this._setPaintValue(l,t,c)}updatePaintArray(t,i,r,o,n,s,a){const l=this.expression.evaluate({zoom:0,brightness:a},r,o,void 0,n);this._setPaintValue(t,i,l)}_setPaintValue(t,i,r){if(this.type==="color"){const o=Ff(r);for(let n=t;n<i;n++)this.paintVertexArray.emplace(n,o[0],o[1])}else{for(let o=t;o<i;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ro{constructor(t,i,r,o,n,s){this.expression=t,this.uniformNames=i.map(a=>`u_${a}_t`),this.type=r,this.useIntegerZoom=o,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=i.map(a=>({name:`a_${a}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(t,i,r,o,n,s,a){const l=this.expression.evaluate(new Ti(this.zoom,{brightness:s}),i,{},n,o,a),c=this.expression.evaluate(new Ti(this.zoom+1,{brightness:s}),i,{},n,o,a),u=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(u,t,l,c)}updatePaintArray(t,i,r,o,n,s,a){const l=this.expression.evaluate({zoom:this.zoom,brightness:a},r,o,void 0,n),c=this.expression.evaluate({zoom:this.zoom+1,brightness:a},r,o,void 0,n);this._setPaintValue(t,i,l,c)}_setPaintValue(t,i,r,o){if(this.type==="color"){const n=Ff(r),s=Ff(o);for(let a=t;a<i;a++)this.paintVertexArray.emplace(a,n[0],n[1],s[0],s[1])}else{for(let n=t;n<i;n++)this.paintVertexArray.emplace(n,r,o);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,r,o,n){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Ut(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);i.set(t,n,a)}getBinding(t,i){return new yt(t)}}class Wn{constructor(t,i,r,o,n){this.expression=t,this.layerId=n,this.paintVertexAttributes=(r==="array"?lS:aS).members;for(let s=0;s<i.length;++s);this.paintVertexArray=new o}populatePaintArray(t,i,r){const o=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(o,t,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(t,i,r,o,n,s,a){this._setPaintValues(t,i,r.patterns&&r.patterns[this.layerId],s)}_setPaintValues(t,i,r,o){if(!o||!r)return;const n=o[r];if(!n)return;const{tl:s,br:a,pixelRatio:l}=n;for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,s[0],s[1],a[0],a[1],l)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Os{constructor(t,i,r=()=>!0){this.binders={},this._buffers=[];const o=[];for(const n in t.paint._values){const s=t.paint.get(n);if(!r(n)||!(s instanceof Da&&Ds(s.property.specification)))continue;const a=mS(n,t.type),l=s.value,c=s.property.specification.type,u=!!s.property.useIntegerZoom,p=n==="line-dasharray"||n.endsWith("pattern"),f=n==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(l.kind!=="constant"||f)if(l.kind==="source"||f||p){const g=Uy(n,c,"source");this.binders[n]=p?new Wn(l,a,c,g,t.id):new xn(l,a,c,g),o.push(`/a_${n}`)}else{const g=Uy(n,c,"composite");this.binders[n]=new Ro(l,a,c,u,i,g),o.push(`/z_${n}`)}else this.binders[n]=p?new Pa(l.value,a):new Ul(l.value,a,c),o.push(`/u_${n}`)}this.cacheKey=o.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof xn||i instanceof Ro?i.maxValue:0}populatePaintArrays(t,i,r,o,n,s,a){for(const l in this.binders){const c=this.binders[l];(c instanceof xn||c instanceof Ro||c instanceof Wn)&&c.populatePaintArray(t,i,r,o,n,s,a)}}setConstantPatternPositions(t){for(const i in this.binders){const r=this.binders[i];r instanceof Pa&&r.setConstantPatternPositions(t)}}updatePaintArrays(t,i,r,o,n,s,a,l){let c=!1;const u=Object.keys(t),p=u.length!==0,f=p?u:i.uniqueIds;for(const g in this.binders){const _=this.binders[g];if((_ instanceof xn||_ instanceof Ro||_ instanceof Wn)&&(_.expression.isStateDependent===!0||_.expression.isLightConstant===!1)){const y=n.paint.get(g);_.expression=y.value;for(const x of f){const b=t[x.toString()];i.eachPosition(x,(T,S,M)=>{const E=o.feature(T);_.updatePaintArray(S,M,E,b,s,a,l)})}if(!p)for(const x of r.uniqueIds){const b=t[x.toString()];r.eachPosition(x,(T,S,M)=>{const E=o.feature(T);_.updatePaintArray(S,M,E,b,s,a,l)})}c=!0}}return c}defines(){const t=[];for(const i in this.binders){const r=this.binders[i];(r instanceof Ul||r instanceof Pa)&&t.push(...r.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof xn||r instanceof Ro||r instanceof Wn)for(let o=0;o<r.paintVertexAttributes.length;o++)t.push(r.paintVertexAttributes[o].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Ul||r instanceof Pa||r instanceof Ro)for(const o of r.uniformNames)t.push(o)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ul||o instanceof Pa||o instanceof Ro)for(const n of o.uniformNames)i.push({name:n,property:r,binding:o.getBinding(t,n)})}return i}setUniforms(t,i,r,o,n){for(const{name:s,property:a,binding:l}of r)this.binders[a].setUniform(t,l,n,o.get(a),s)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof xn||i instanceof Ro||i instanceof Wn)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const r=this.binders[i];(r instanceof xn||r instanceof Ro||r instanceof Wn)&&r.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof xn||i instanceof Ro||i instanceof Wn)&&i.destroy()}}}class Xn{constructor(t,i,r=()=>!0){this.programConfigurations={};for(const o of t)this.programConfigurations[o.id]=new Os(o,i,r);this.needsUpload=!1,this._featureMap=new jl,this._featureMapWithoutIds=new jl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,r,o,n,s,a,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(t,i,o,n,s,a,l);i.id!==void 0?this._featureMap.add(i.id,r,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,r,o,n,s){for(const a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,a,o,n,s||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const fS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function mS(e,t){return fS[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const gS={"line-pattern":{source:Zn,composite:Zn},"fill-pattern":{source:Zn,composite:Zn},"fill-extrusion-pattern":{source:Zn,composite:Zn},"line-dasharray":{source:zu,composite:zu}},_S={color:{source:Vl,composite:_n},number:{source:Fl,composite:Vl}};function Uy(e,t,i){const r=gS[e];return r&&r[i]||_S[t][i]}jt(Ul,"ConstantBinder"),jt(Pa,"PatternConstantBinder"),jt(xn,"SourceExpressionBinder"),jt(Wn,"PatternCompositeBinder"),jt(Ro,"CompositeExpressionBinder"),jt(Os,"ProgramConfiguration",{omit:["_buffers"]}),jt(Xn,"ProgramConfigurationSet");class Wr{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof se?new se(t.lng,t.lat):se.convert(t),this}setSouthWest(t){return this._sw=t instanceof se?new se(t.lng,t.lat):se.convert(t),this}extend(t){const i=this._sw,r=this._ne;let o,n;if(t instanceof se)o=t,n=t;else{if(!(t instanceof Wr))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Wr.convert(t)):this.extend(se.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(se.convert(t)):this;if(o=t._sw,n=t._ne,!o||!n)return this}return i||r?(i.lng=Math.min(o.lng,i.lng),i.lat=Math.min(o.lat,i.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new se(o.lng,o.lat),this._ne=new se(n.lng,n.lat)),this}getCenter(){return new se((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new se(this.getWest(),this.getNorth())}getSouthEast(){return new se(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:r}=se.convert(t);let o=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&o}static convert(t){return!t||t instanceof Wr?t:new Wr(t)}}var nr={},sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.setMatrixArrayType=function(e){sr.ARRAY_TYPE=qy=e},sr.toRadian=function(e){return e*xS},sr.equals=function(e,t){return Math.abs(e-t)<=Gy*Math.max(1,Math.abs(e),Math.abs(t))},sr.RANDOM=sr.ARRAY_TYPE=sr.EPSILON=void 0;var Gy=1e-6;sr.EPSILON=Gy;var qy=typeof Float32Array<"u"?Float32Array:Array;sr.ARRAY_TYPE=qy;var yS=Math.random;sr.RANDOM=yS;var xS=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Si={};function Nf(e){return Nf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nf(e)}Object.defineProperty(Si,"__esModule",{value:!0}),Si.create=function(){var e=new Yn.ARRAY_TYPE(4);return Yn.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},Si.clone=function(e){var t=new Yn.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Si.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Si.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},Si.fromValues=function(e,t,i,r){var o=new Yn.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o},Si.set=function(e,t,i,r,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e},Si.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},Si.invert=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=i*n-o*r;return s?(e[0]=n*(s=1/s),e[1]=-r*s,e[2]=-o*s,e[3]=i*s,e):null},Si.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},Si.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},Si.multiply=Zy,Si.rotate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=o*l+s*a,e[2]=r*-a+n*l,e[3]=o*-a+s*l,e},Si.scale=function(e,t,i){var r=t[1],o=t[2],n=t[3],s=i[0],a=i[1];return e[0]=t[0]*s,e[1]=r*s,e[2]=o*a,e[3]=n*a,e},Si.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},Si.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},Si.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Si.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},Si.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},Si.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Si.subtract=Hy,Si.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Si.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-s)<=Yn.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=Yn.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-l)<=Yn.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(n-c)<=Yn.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},Si.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Si.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},Si.sub=Si.mul=void 0;var Yn=function(e,t){if(e&&e.__esModule)return e;if(e===null||Nf(e)!=="object"&&typeof e!="function")return{default:e};var i=$y(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function $y(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return($y=function(r){return r?i:t})(e)}function Zy(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*a+n*l,e[1]=o*a+s*l,e[2]=r*c+n*u,e[3]=o*c+s*u,e}function Hy(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}Si.mul=Zy,Si.sub=Hy;var Ci={};function Vf(e){return Vf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vf(e)}Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.create=function(){var e=new Yo.ARRAY_TYPE(6);return Yo.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},Ci.clone=function(e){var t=new Yo.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Ci.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Ci.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},Ci.fromValues=function(e,t,i,r,o,n){var s=new Yo.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s[4]=o,s[5]=n,s},Ci.set=function(e,t,i,r,o,n,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e[4]=n,e[5]=s,e},Ci.invert=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=i*n-r*o;return l?(e[0]=n*(l=1/l),e[1]=-r*l,e[2]=-o*l,e[3]=i*l,e[4]=(o*a-n*s)*l,e[5]=(r*s-i*a)*l,e):null},Ci.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},Ci.multiply=Xy,Ci.rotate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(i),u=Math.cos(i);return e[0]=r*u+n*c,e[1]=o*u+s*c,e[2]=r*-c+n*u,e[3]=o*-c+s*u,e[4]=a,e[5]=l,e},Ci.scale=function(e,t,i){var r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=i[0],c=i[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=o*c,e[3]=n*c,e[4]=s,e[5]=a,e},Ci.translate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r,e[1]=o,e[2]=n,e[3]=s,e[4]=r*c+n*u+a,e[5]=o*c+s*u+l,e},Ci.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e},Ci.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},Ci.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},Ci.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},Ci.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},Ci.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},Ci.subtract=Yy,Ci.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},Ci.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},Ci.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},Ci.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],p=t[3],f=t[4],g=t[5];return Math.abs(i-l)<=Yo.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Yo.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-u)<=Yo.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(n-p)<=Yo.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=Yo.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-g)<=Yo.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))},Ci.sub=Ci.mul=void 0;var Yo=function(e,t){if(e&&e.__esModule)return e;if(e===null||Vf(e)!=="object"&&typeof e!="function")return{default:e};var i=Wy(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function Wy(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Wy=function(r){return r?i:t})(e)}function Xy(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=i[0],u=i[1],p=i[2],f=i[3],g=i[4],_=i[5];return e[0]=r*c+n*u,e[1]=o*c+s*u,e[2]=r*p+n*f,e[3]=o*p+s*f,e[4]=r*g+n*_+a,e[5]=o*g+s*_+l,e}function Yy(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}Ci.mul=Xy,Ci.sub=Yy;var li={};function jf(e){return jf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jf(e)}Object.defineProperty(li,"__esModule",{value:!0}),li.create=function(){var e=new so.ARRAY_TYPE(9);return so.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},li.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},li.clone=function(e){var t=new so.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},li.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},li.fromValues=function(e,t,i,r,o,n,s,a,l){var c=new so.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=o,c[5]=n,c[6]=s,c[7]=a,c[8]=l,c},li.set=function(e,t,i,r,o,n,s,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e[4]=n,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},li.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},li.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},li.invert=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=u*s-a*c,f=-u*n+a*l,g=c*n-s*l,_=i*p+r*f+o*g;return _?(e[0]=p*(_=1/_),e[1]=(-u*r+o*c)*_,e[2]=(a*r-o*s)*_,e[3]=f*_,e[4]=(u*i-o*l)*_,e[5]=(-a*i+o*n)*_,e[6]=g*_,e[7]=(-c*i+r*l)*_,e[8]=(s*i-r*n)*_,e):null},li.adjoint=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=o*c-r*u,e[2]=r*a-o*s,e[3]=a*l-n*u,e[4]=i*u-o*l,e[5]=o*n-i*a,e[6]=n*c-s*l,e[7]=r*l-i*c,e[8]=i*s-r*n,e},li.determinant=function(e){var t=e[3],i=e[4],r=e[5],o=e[6],n=e[7],s=e[8];return e[0]*(s*i-r*n)+e[1]*(-s*t+r*o)+e[2]*(n*t-i*o)},li.multiply=Ky,li.translate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=i[0],g=i[1];return e[0]=r,e[1]=o,e[2]=n,e[3]=s,e[4]=a,e[5]=l,e[6]=f*r+g*s+c,e[7]=f*o+g*a+u,e[8]=f*n+g*l+p,e},li.rotate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=Math.sin(i),g=Math.cos(i);return e[0]=g*r+f*s,e[1]=g*o+f*a,e[2]=g*n+f*l,e[3]=g*s-f*r,e[4]=g*a-f*o,e[5]=g*l-f*n,e[6]=c,e[7]=u,e[8]=p,e},li.scale=function(e,t,i){var r=i[0],o=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},li.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},li.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},li.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},li.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},li.fromQuat=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=i+i,a=r+r,l=o+o,c=i*s,u=r*s,p=r*a,f=o*s,g=o*a,_=o*l,y=n*s,x=n*a,b=n*l;return e[0]=1-p-_,e[3]=u-b,e[6]=f+x,e[1]=u+b,e[4]=1-c-_,e[7]=g-y,e[2]=f-x,e[5]=g+y,e[8]=1-c-p,e},li.normalFromMat4=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=t[9],f=t[10],g=t[11],_=t[12],y=t[13],x=t[14],b=t[15],T=i*a-r*s,S=i*l-o*s,M=i*c-n*s,E=r*l-o*a,A=r*c-n*a,I=o*c-n*l,z=u*y-p*_,P=u*x-f*_,R=u*b-g*_,F=p*x-f*y,N=p*b-g*y,U=f*b-g*x,O=T*U-S*N+M*F+E*R-A*P+I*z;return O?(e[0]=(a*U-l*N+c*F)*(O=1/O),e[1]=(l*R-s*U-c*P)*O,e[2]=(s*N-a*R+c*z)*O,e[3]=(o*N-r*U-n*F)*O,e[4]=(i*U-o*R+n*P)*O,e[5]=(r*R-i*N-n*z)*O,e[6]=(y*I-x*A+b*E)*O,e[7]=(x*M-_*I-b*S)*O,e[8]=(_*A-y*M+b*T)*O,e):null},li.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},li.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},li.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},li.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},li.subtract=Qy,li.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},li.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},li.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},li.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=t[0],f=t[1],g=t[2],_=t[3],y=t[4],x=t[5],b=t[6],T=t[7],S=t[8];return Math.abs(i-p)<=so.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=so.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-g)<=so.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(n-_)<=so.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-y)<=so.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(a-x)<=so.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-b)<=so.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-T)<=so.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-S)<=so.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))},li.sub=li.mul=void 0;var so=function(e,t){if(e&&e.__esModule)return e;if(e===null||jf(e)!=="object"&&typeof e!="function")return{default:e};var i=Jy(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function Jy(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Jy=function(r){return r?i:t})(e)}function Ky(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=i[0],g=i[1],_=i[2],y=i[3],x=i[4],b=i[5],T=i[6],S=i[7],M=i[8];return e[0]=f*r+g*s+_*c,e[1]=f*o+g*a+_*u,e[2]=f*n+g*l+_*p,e[3]=y*r+x*s+b*c,e[4]=y*o+x*a+b*u,e[5]=y*n+x*l+b*p,e[6]=T*r+S*s+M*c,e[7]=T*o+S*a+M*u,e[8]=T*n+S*l+M*p,e}function Qy(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}li.mul=Ky,li.sub=Qy;var ge={};function Uf(e){return Uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uf(e)}Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var e=new Li.ARRAY_TYPE(16);return Li.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},ge.clone=function(e){var t=new Li.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},ge.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},ge.fromValues=function(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y){var x=new Li.ARRAY_TYPE(16);return x[0]=e,x[1]=t,x[2]=i,x[3]=r,x[4]=o,x[5]=n,x[6]=s,x[7]=a,x[8]=l,x[9]=c,x[10]=u,x[11]=p,x[12]=f,x[13]=g,x[14]=_,x[15]=y,x},ge.set=function(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e[4]=n,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=p,e[11]=f,e[12]=g,e[13]=_,e[14]=y,e[15]=x,e},ge.identity=e1,ge.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],o=t[3],n=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=o,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},ge.invert=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=t[9],f=t[10],g=t[11],_=t[12],y=t[13],x=t[14],b=t[15],T=i*a-r*s,S=i*l-o*s,M=i*c-n*s,E=r*l-o*a,A=r*c-n*a,I=o*c-n*l,z=u*y-p*_,P=u*x-f*_,R=u*b-g*_,F=p*x-f*y,N=p*b-g*y,U=f*b-g*x,O=T*U-S*N+M*F+E*R-A*P+I*z;return O?(e[0]=(a*U-l*N+c*F)*(O=1/O),e[1]=(o*N-r*U-n*F)*O,e[2]=(y*I-x*A+b*E)*O,e[3]=(f*A-p*I-g*E)*O,e[4]=(l*R-s*U-c*P)*O,e[5]=(i*U-o*R+n*P)*O,e[6]=(x*M-_*I-b*S)*O,e[7]=(u*I-f*M+g*S)*O,e[8]=(s*N-a*R+c*z)*O,e[9]=(r*R-i*N-n*z)*O,e[10]=(_*A-y*M+b*T)*O,e[11]=(p*M-u*A-g*T)*O,e[12]=(a*P-s*F-l*z)*O,e[13]=(i*F-r*P+o*z)*O,e[14]=(y*S-_*E-x*T)*O,e[15]=(u*E-p*S+f*T)*O,e):null},ge.adjoint=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=t[9],f=t[10],g=t[11],_=t[12],y=t[13],x=t[14],b=t[15];return e[0]=a*(f*b-g*x)-p*(l*b-c*x)+y*(l*g-c*f),e[1]=-(r*(f*b-g*x)-p*(o*b-n*x)+y*(o*g-n*f)),e[2]=r*(l*b-c*x)-a*(o*b-n*x)+y*(o*c-n*l),e[3]=-(r*(l*g-c*f)-a*(o*g-n*f)+p*(o*c-n*l)),e[4]=-(s*(f*b-g*x)-u*(l*b-c*x)+_*(l*g-c*f)),e[5]=i*(f*b-g*x)-u*(o*b-n*x)+_*(o*g-n*f),e[6]=-(i*(l*b-c*x)-s*(o*b-n*x)+_*(o*c-n*l)),e[7]=i*(l*g-c*f)-s*(o*g-n*f)+u*(o*c-n*l),e[8]=s*(p*b-g*y)-u*(a*b-c*y)+_*(a*g-c*p),e[9]=-(i*(p*b-g*y)-u*(r*b-n*y)+_*(r*g-n*p)),e[10]=i*(a*b-c*y)-s*(r*b-n*y)+_*(r*c-n*a),e[11]=-(i*(a*g-c*p)-s*(r*g-n*p)+u*(r*c-n*a)),e[12]=-(s*(p*x-f*y)-u*(a*x-l*y)+_*(a*f-l*p)),e[13]=i*(p*x-f*y)-u*(r*x-o*y)+_*(r*f-o*p),e[14]=-(i*(a*x-l*y)-s*(r*x-o*y)+_*(r*l-o*a)),e[15]=i*(a*f-l*p)-s*(r*f-o*p)+u*(r*l-o*a),e},ge.determinant=function(e){var t=e[0],i=e[1],r=e[2],o=e[3],n=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],p=e[10],f=e[11],g=e[12],_=e[13],y=e[14],x=e[15];return(t*s-i*n)*(p*x-f*y)-(t*a-r*n)*(u*x-f*_)+(t*l-o*n)*(u*y-p*_)+(i*a-r*s)*(c*x-f*g)-(i*l-o*s)*(c*y-p*g)+(r*l-o*a)*(c*_-u*g)},ge.multiply=i1,ge.translate=function(e,t,i){var r,o,n,s,a,l,c,u,p,f,g,_,y=i[0],x=i[1],b=i[2];return t===e?(e[12]=t[0]*y+t[4]*x+t[8]*b+t[12],e[13]=t[1]*y+t[5]*x+t[9]*b+t[13],e[14]=t[2]*y+t[6]*x+t[10]*b+t[14],e[15]=t[3]*y+t[7]*x+t[11]*b+t[15]):(o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=t[9],g=t[10],_=t[11],e[0]=r=t[0],e[1]=o,e[2]=n,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=p,e[9]=f,e[10]=g,e[11]=_,e[12]=r*y+a*x+p*b+t[12],e[13]=o*y+l*x+f*b+t[13],e[14]=n*y+c*x+g*b+t[14],e[15]=s*y+u*x+_*b+t[15]),e},ge.scale=function(e,t,i){var r=i[0],o=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},ge.rotate=function(e,t,i,r){var o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E,A,I,z,P,R,F,N=r[0],U=r[1],O=r[2],Z=Math.hypot(N,U,O);return Z<Li.EPSILON?null:(N*=Z=1/Z,U*=Z,O*=Z,o=Math.sin(i),n=Math.cos(i),l=t[1],c=t[2],u=t[3],f=t[5],g=t[6],_=t[7],x=t[9],b=t[10],T=t[11],A=N*U*(s=1-n)-O*o,I=U*U*s+n,z=O*U*s+N*o,P=N*O*s+U*o,R=U*O*s-N*o,F=O*O*s+n,e[0]=(a=t[0])*(S=N*N*s+n)+(p=t[4])*(M=U*N*s+O*o)+(y=t[8])*(E=O*N*s-U*o),e[1]=l*S+f*M+x*E,e[2]=c*S+g*M+b*E,e[3]=u*S+_*M+T*E,e[4]=a*A+p*I+y*z,e[5]=l*A+f*I+x*z,e[6]=c*A+g*I+b*z,e[7]=u*A+_*I+T*z,e[8]=a*P+p*R+y*F,e[9]=l*P+f*R+x*F,e[10]=c*P+g*R+b*F,e[11]=u*P+_*R+T*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},ge.rotateX=function(e,t,i){var r=Math.sin(i),o=Math.cos(i),n=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*o+c*r,e[5]=s*o+u*r,e[6]=a*o+p*r,e[7]=l*o+f*r,e[8]=c*o-n*r,e[9]=u*o-s*r,e[10]=p*o-a*r,e[11]=f*o-l*r,e},ge.rotateY=function(e,t,i){var r=Math.sin(i),o=Math.cos(i),n=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*o-c*r,e[1]=s*o-u*r,e[2]=a*o-p*r,e[3]=l*o-f*r,e[8]=n*r+c*o,e[9]=s*r+u*o,e[10]=a*r+p*o,e[11]=l*r+f*o,e},ge.rotateZ=function(e,t,i){var r=Math.sin(i),o=Math.cos(i),n=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*o+c*r,e[1]=s*o+u*r,e[2]=a*o+p*r,e[3]=l*o+f*r,e[4]=c*o-n*r,e[5]=u*o-s*r,e[6]=p*o-a*r,e[7]=f*o-l*r,e},ge.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},ge.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ge.fromRotation=function(e,t,i){var r,o,n,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<Li.EPSILON?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(t),o=Math.cos(t),e[0]=s*s*(n=1-o)+o,e[1]=a*s*n+l*r,e[2]=l*s*n-a*r,e[3]=0,e[4]=s*a*n-l*r,e[5]=a*a*n+o,e[6]=l*a*n+s*r,e[7]=0,e[8]=s*l*n+a*r,e[9]=a*l*n-s*r,e[10]=l*l*n+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},ge.fromXRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ge.fromYRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ge.fromZRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ge.fromRotationTranslation=r1,ge.fromQuat2=function(e,t){var i=new Li.ARRAY_TYPE(3),r=-t[0],o=-t[1],n=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=r*r+o*o+n*n+s*s;return p>0?(i[0]=2*(a*s+u*r+l*n-c*o)/p,i[1]=2*(l*s+u*o+c*r-a*n)/p,i[2]=2*(c*s+u*n+a*o-l*r)/p):(i[0]=2*(a*s+u*r+l*n-c*o),i[1]=2*(l*s+u*o+c*r-a*n),i[2]=2*(c*s+u*n+a*o-l*r)),r1(e,t,i),e},ge.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},ge.getScaling=o1,ge.getRotation=function(e,t){var i=new Li.ARRAY_TYPE(3);o1(i,t);var r=1/i[0],o=1/i[1],n=1/i[2],s=t[0]*r,a=t[1]*o,l=t[2]*n,c=t[4]*r,u=t[5]*o,p=t[6]*n,f=t[8]*r,g=t[9]*o,_=t[10]*n,y=s+u+_,x=0;return y>0?(x=2*Math.sqrt(y+1),e[3]=.25*x,e[0]=(p-g)/x,e[1]=(f-l)/x,e[2]=(a-c)/x):s>u&&s>_?(x=2*Math.sqrt(1+s-u-_),e[3]=(p-g)/x,e[0]=.25*x,e[1]=(a+c)/x,e[2]=(f+l)/x):u>_?(x=2*Math.sqrt(1+u-s-_),e[3]=(f-l)/x,e[0]=(a+c)/x,e[1]=.25*x,e[2]=(p+g)/x):(x=2*Math.sqrt(1+_-s-u),e[3]=(a-c)/x,e[0]=(f+l)/x,e[1]=(p+g)/x,e[2]=.25*x),e},ge.fromRotationTranslationScale=function(e,t,i,r){var o=t[0],n=t[1],s=t[2],a=t[3],l=o+o,c=n+n,u=s+s,p=o*l,f=o*c,g=o*u,_=n*c,y=n*u,x=s*u,b=a*l,T=a*c,S=a*u,M=r[0],E=r[1],A=r[2];return e[0]=(1-(_+x))*M,e[1]=(f+S)*M,e[2]=(g-T)*M,e[3]=0,e[4]=(f-S)*E,e[5]=(1-(p+x))*E,e[6]=(y+b)*E,e[7]=0,e[8]=(g+T)*A,e[9]=(y-b)*A,e[10]=(1-(p+_))*A,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},ge.fromRotationTranslationScaleOrigin=function(e,t,i,r,o){var n=t[0],s=t[1],a=t[2],l=t[3],c=n+n,u=s+s,p=a+a,f=n*c,g=n*u,_=n*p,y=s*u,x=s*p,b=a*p,T=l*c,S=l*u,M=l*p,E=r[0],A=r[1],I=r[2],z=o[0],P=o[1],R=o[2],F=(1-(y+b))*E,N=(g+M)*E,U=(_-S)*E,O=(g-M)*A,Z=(1-(f+b))*A,W=(x+T)*A,K=(_+S)*I,$=(x-T)*I,H=(1-(f+y))*I;return e[0]=F,e[1]=N,e[2]=U,e[3]=0,e[4]=O,e[5]=Z,e[6]=W,e[7]=0,e[8]=K,e[9]=$,e[10]=H,e[11]=0,e[12]=i[0]+z-(F*z+O*P+K*R),e[13]=i[1]+P-(N*z+Z*P+$*R),e[14]=i[2]+R-(U*z+W*P+H*R),e[15]=1,e},ge.fromQuat=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=i+i,a=r+r,l=o+o,c=i*s,u=r*s,p=r*a,f=o*s,g=o*a,_=o*l,y=n*s,x=n*a,b=n*l;return e[0]=1-p-_,e[1]=u+b,e[2]=f-x,e[3]=0,e[4]=u-b,e[5]=1-c-_,e[6]=g+y,e[7]=0,e[8]=f+x,e[9]=g-y,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},ge.frustum=function(e,t,i,r,o,n,s){var a=1/(i-t),l=1/(o-r),c=1/(n-s);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(o+r)*l,e[10]=(s+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*n*2*c,e[15]=0,e},ge.perspectiveNO=n1,ge.perspectiveZO=function(e,t,i,r,o){var n,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0?(e[10]=o*(n=1/(r-o)),e[14]=o*r*n):(e[10]=-1,e[14]=-r),e},ge.perspectiveFromFieldOfView=function(e,t,i,r){var o=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(o+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(o-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},ge.orthoNO=s1,ge.orthoZO=function(e,t,i,r,o,n,s){var a=1/(t-i),l=1/(r-o),c=1/(n-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*a,e[13]=(o+r)*l,e[14]=n*c,e[15]=1,e},ge.lookAt=function(e,t,i,r){var o,n,s,a,l,c,u,p,f,g,_=t[0],y=t[1],x=t[2],b=r[0],T=r[1],S=r[2],M=i[0],E=i[1],A=i[2];return Math.abs(_-M)<Li.EPSILON&&Math.abs(y-E)<Li.EPSILON&&Math.abs(x-A)<Li.EPSILON?e1(e):(u=_-M,p=y-E,f=x-A,o=T*(f*=g=1/Math.hypot(u,p,f))-S*(p*=g),n=S*(u*=g)-b*f,s=b*p-T*u,(g=Math.hypot(o,n,s))?(o*=g=1/g,n*=g,s*=g):(o=0,n=0,s=0),a=p*s-f*n,l=f*o-u*s,c=u*n-p*o,(g=Math.hypot(a,l,c))?(a*=g=1/g,l*=g,c*=g):(a=0,l=0,c=0),e[0]=o,e[1]=a,e[2]=u,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=s,e[9]=c,e[10]=f,e[11]=0,e[12]=-(o*_+n*y+s*x),e[13]=-(a*_+l*y+c*x),e[14]=-(u*_+p*y+f*x),e[15]=1,e)},ge.targetTo=function(e,t,i,r){var o=t[0],n=t[1],s=t[2],a=r[0],l=r[1],c=r[2],u=o-i[0],p=n-i[1],f=s-i[2],g=u*u+p*p+f*f;g>0&&(u*=g=1/Math.sqrt(g),p*=g,f*=g);var _=l*f-c*p,y=c*u-a*f,x=a*p-l*u;return(g=_*_+y*y+x*x)>0&&(_*=g=1/Math.sqrt(g),y*=g,x*=g),e[0]=_,e[1]=y,e[2]=x,e[3]=0,e[4]=p*x-f*y,e[5]=f*_-u*x,e[6]=u*y-p*_,e[7]=0,e[8]=u,e[9]=p,e[10]=f,e[11]=0,e[12]=o,e[13]=n,e[14]=s,e[15]=1,e},ge.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},ge.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},ge.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},ge.subtract=a1,ge.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},ge.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},ge.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},ge.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=e[9],f=e[10],g=e[11],_=e[12],y=e[13],x=e[14],b=e[15],T=t[0],S=t[1],M=t[2],E=t[3],A=t[4],I=t[5],z=t[6],P=t[7],R=t[8],F=t[9],N=t[10],U=t[11],O=t[12],Z=t[13],W=t[14],K=t[15];return Math.abs(i-T)<=Li.EPSILON*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(r-S)<=Li.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(o-M)<=Li.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(n-E)<=Li.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-A)<=Li.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(a-I)<=Li.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-z)<=Li.EPSILON*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(c-P)<=Li.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(u-R)<=Li.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(p-F)<=Li.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(f-N)<=Li.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(g-U)<=Li.EPSILON*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(_-O)<=Li.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(y-Z)<=Li.EPSILON*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(x-W)<=Li.EPSILON*Math.max(1,Math.abs(x),Math.abs(W))&&Math.abs(b-K)<=Li.EPSILON*Math.max(1,Math.abs(b),Math.abs(K))},ge.sub=ge.mul=ge.ortho=ge.perspective=void 0;var Li=function(e,t){if(e&&e.__esModule)return e;if(e===null||Uf(e)!=="object"&&typeof e!="function")return{default:e};var i=t1(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function t1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(t1=function(r){return r?i:t})(e)}function e1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i1(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],f=t[9],g=t[10],_=t[11],y=t[12],x=t[13],b=t[14],T=t[15],S=i[0],M=i[1],E=i[2],A=i[3];return e[0]=S*r+M*a+E*p+A*y,e[1]=S*o+M*l+E*f+A*x,e[2]=S*n+M*c+E*g+A*b,e[3]=S*s+M*u+E*_+A*T,e[4]=(S=i[4])*r+(M=i[5])*a+(E=i[6])*p+(A=i[7])*y,e[5]=S*o+M*l+E*f+A*x,e[6]=S*n+M*c+E*g+A*b,e[7]=S*s+M*u+E*_+A*T,e[8]=(S=i[8])*r+(M=i[9])*a+(E=i[10])*p+(A=i[11])*y,e[9]=S*o+M*l+E*f+A*x,e[10]=S*n+M*c+E*g+A*b,e[11]=S*s+M*u+E*_+A*T,e[12]=(S=i[12])*r+(M=i[13])*a+(E=i[14])*p+(A=i[15])*y,e[13]=S*o+M*l+E*f+A*x,e[14]=S*n+M*c+E*g+A*b,e[15]=S*s+M*u+E*_+A*T,e}function r1(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=r+r,l=o+o,c=n+n,u=r*a,p=r*l,f=r*c,g=o*l,_=o*c,y=n*c,x=s*a,b=s*l,T=s*c;return e[0]=1-(g+y),e[1]=p+T,e[2]=f-b,e[3]=0,e[4]=p-T,e[5]=1-(u+y),e[6]=_+x,e[7]=0,e[8]=f+b,e[9]=_-x,e[10]=1-(u+g),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function o1(e,t){var i=t[4],r=t[5],o=t[6],n=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,o),e[2]=Math.hypot(n,s,a),e}function n1(e,t,i,r,o){var n,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0?(e[10]=(o+r)*(n=1/(r-o)),e[14]=2*o*r*n):(e[10]=-1,e[14]=-2*r),e}function s1(e,t,i,r,o,n,s){var a=1/(t-i),l=1/(r-o),c=1/(n-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(o+r)*l,e[14]=(s+n)*c,e[15]=1,e}function a1(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}ge.perspective=n1,ge.ortho=s1,ge.mul=i1,ge.sub=a1;var de={},me={};function Gf(e){return Gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gf(e)}Object.defineProperty(me,"__esModule",{value:!0}),me.create=c1,me.clone=function(e){var t=new vn.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},me.length=u1,me.fromValues=function(e,t,i){var r=new vn.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=i,r},me.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},me.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},me.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},me.subtract=h1,me.multiply=d1,me.divide=p1,me.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},me.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},me.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},me.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},me.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},me.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},me.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},me.distance=f1,me.squaredDistance=m1,me.squaredLength=g1,me.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},me.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},me.normalize=function(e,t){var i=t[0],r=t[1],o=t[2],n=i*i+r*r+o*o;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},me.dot=_1,me.cross=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=i[0],a=i[1],l=i[2];return e[0]=o*l-n*a,e[1]=n*s-r*l,e[2]=r*a-o*s,e},me.lerp=function(e,t,i,r){var o=t[0],n=t[1],s=t[2];return e[0]=o+r*(i[0]-o),e[1]=n+r*(i[1]-n),e[2]=s+r*(i[2]-s),e},me.hermite=function(e,t,i,r,o,n){var s=n*n,a=s*(2*n-3)+1,l=s*(n-2)+n,c=s*(n-1),u=s*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+o[0]*u,e[1]=t[1]*a+i[1]*l+r[1]*c+o[1]*u,e[2]=t[2]*a+i[2]*l+r[2]*c+o[2]*u,e},me.bezier=function(e,t,i,r,o,n){var s=1-n,a=s*s,l=n*n,c=a*s,u=3*n*a,p=3*l*s,f=l*n;return e[0]=t[0]*c+i[0]*u+r[0]*p+o[0]*f,e[1]=t[1]*c+i[1]*u+r[1]*p+o[1]*f,e[2]=t[2]*c+i[2]*u+r[2]*p+o[2]*f,e},me.random=function(e,t){t=t||1;var i=2*vn.RANDOM()*Math.PI,r=2*vn.RANDOM()-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*o,e[1]=Math.sin(i)*o,e[2]=r*t,e},me.transformMat4=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=i[3]*r+i[7]*o+i[11]*n+i[15];return e[0]=(i[0]*r+i[4]*o+i[8]*n+i[12])/(s=s||1),e[1]=(i[1]*r+i[5]*o+i[9]*n+i[13])/s,e[2]=(i[2]*r+i[6]*o+i[10]*n+i[14])/s,e},me.transformMat3=function(e,t,i){var r=t[0],o=t[1],n=t[2];return e[0]=r*i[0]+o*i[3]+n*i[6],e[1]=r*i[1]+o*i[4]+n*i[7],e[2]=r*i[2]+o*i[5]+n*i[8],e},me.transformQuat=function(e,t,i){var r=i[0],o=i[1],n=i[2],s=t[0],a=t[1],l=t[2],c=o*l-n*a,u=n*s-r*l,p=r*a-o*s,f=o*p-n*u,g=n*c-r*p,_=r*u-o*c,y=2*i[3];return u*=y,p*=y,g*=2,_*=2,e[0]=s+(c*=y)+(f*=2),e[1]=a+u+g,e[2]=l+p+_,e},me.rotateX=function(e,t,i,r){var o=[],n=[];return o[0]=t[0]-i[0],o[1]=t[1]-i[1],o[2]=t[2]-i[2],n[0]=o[0],n[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),n[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},me.rotateY=function(e,t,i,r){var o=[],n=[];return o[0]=t[0]-i[0],o[1]=t[1]-i[1],o[2]=t[2]-i[2],n[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),n[1]=o[1],n[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},me.rotateZ=function(e,t,i,r){var o=[],n=[];return o[0]=t[0]-i[0],o[1]=t[1]-i[1],o[2]=t[2]-i[2],n[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),n[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),n[2]=o[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},me.angle=function(e,t){var i=e[0],r=e[1],o=e[2],n=t[0],s=t[1],a=t[2],l=Math.sqrt(i*i+r*r+o*o)*Math.sqrt(n*n+s*s+a*a),c=l&&_1(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},me.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},me.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},me.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},me.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=t[0],s=t[1],a=t[2];return Math.abs(i-n)<=vn.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=vn.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-a)<=vn.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))},me.forEach=me.sqrLen=me.len=me.sqrDist=me.dist=me.div=me.mul=me.sub=void 0;var vn=function(e,t){if(e&&e.__esModule)return e;if(e===null||Gf(e)!=="object"&&typeof e!="function")return{default:e};var i=l1(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function l1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(l1=function(r){return r?i:t})(e)}function c1(){var e=new vn.ARRAY_TYPE(3);return vn.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function u1(e){return Math.hypot(e[0],e[1],e[2])}function h1(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function d1(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function p1(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function f1(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function m1(e,t){var i=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return i*i+r*r+o*o}function g1(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function _1(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}me.sub=h1,me.mul=d1,me.div=p1,me.dist=f1,me.sqrDist=m1,me.len=u1,me.sqrLen=g1;var bn,vS=(bn=c1(),function(e,t,i,r,o,n){var s,a;for(t||(t=3),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,s=i;s<a;s+=t)bn[0]=e[s],bn[1]=e[s+1],bn[2]=e[s+2],o(bn,bn,n),e[s]=bn[0],e[s+1]=bn[1],e[s+2]=bn[2];return e});me.forEach=vS;var Ce={};function qf(e){return qf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qf(e)}Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=x1,Ce.clone=function(e){var t=new wo.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ce.fromValues=function(e,t,i,r){var o=new wo.ARRAY_TYPE(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o},Ce.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ce.set=function(e,t,i,r,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e},Ce.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Ce.subtract=v1,Ce.multiply=b1,Ce.divide=w1,Ce.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Ce.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Ce.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},Ce.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},Ce.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Ce.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Ce.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},Ce.distance=T1,Ce.squaredDistance=E1,Ce.length=S1,Ce.squaredLength=M1,Ce.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Ce.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Ce.normalize=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=i*i+r*r+o*o+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=o*s,e[3]=n*s,e},Ce.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Ce.cross=function(e,t,i,r){var o=i[0]*r[1]-i[1]*r[0],n=i[0]*r[2]-i[2]*r[0],s=i[0]*r[3]-i[3]*r[0],a=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],u=t[0],p=t[1],f=t[2],g=t[3];return e[0]=p*c-f*l+g*a,e[1]=-u*c+f*s-g*n,e[2]=u*l-p*s+g*o,e[3]=-u*a+p*n-f*o,e},Ce.lerp=function(e,t,i,r){var o=t[0],n=t[1],s=t[2],a=t[3];return e[0]=o+r*(i[0]-o),e[1]=n+r*(i[1]-n),e[2]=s+r*(i[2]-s),e[3]=a+r*(i[3]-a),e},Ce.random=function(e,t){var i,r,o,n,s,a;t=t||1;do s=(i=2*wo.RANDOM()-1)*i+(r=2*wo.RANDOM()-1)*r;while(s>=1);do a=(o=2*wo.RANDOM()-1)*o+(n=2*wo.RANDOM()-1)*n;while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*o*l,e[3]=t*n*l,e},Ce.transformMat4=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3];return e[0]=i[0]*r+i[4]*o+i[8]*n+i[12]*s,e[1]=i[1]*r+i[5]*o+i[9]*n+i[13]*s,e[2]=i[2]*r+i[6]*o+i[10]*n+i[14]*s,e[3]=i[3]*r+i[7]*o+i[11]*n+i[15]*s,e},Ce.transformQuat=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*o,p=c*o+l*r-s*n,f=c*n+s*o-a*r,g=-s*r-a*o-l*n;return e[0]=u*c+g*-s+p*-l-f*-a,e[1]=p*c+g*-a+f*-s-u*-l,e[2]=f*c+g*-l+u*-a-p*-s,e[3]=t[3],e},Ce.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Ce.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ce.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Ce.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-s)<=wo.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=wo.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-l)<=wo.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(n-c)<=wo.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},Ce.forEach=Ce.sqrLen=Ce.len=Ce.sqrDist=Ce.dist=Ce.div=Ce.mul=Ce.sub=void 0;var wo=function(e,t){if(e&&e.__esModule)return e;if(e===null||qf(e)!=="object"&&typeof e!="function")return{default:e};var i=y1(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function y1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(y1=function(r){return r?i:t})(e)}function x1(){var e=new wo.ARRAY_TYPE(4);return wo.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function v1(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function b1(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function w1(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function T1(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function E1(e,t){var i=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+o*o+n*n}function S1(e){return Math.hypot(e[0],e[1],e[2],e[3])}function M1(e){var t=e[0],i=e[1],r=e[2],o=e[3];return t*t+i*i+r*r+o*o}Ce.sub=v1,Ce.mul=b1,Ce.div=w1,Ce.dist=T1,Ce.sqrDist=E1,Ce.len=S1,Ce.sqrLen=M1;var bS=function(){var e=x1();return function(t,i,r,o,n,s){var a,l;for(i||(i=4),r||(r=0),l=o?Math.min(o*i+r,t.length):t.length,a=r;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],n(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function $f(e){return $f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$f(e)}Ce.forEach=bS,Object.defineProperty(de,"__esModule",{value:!0}),de.create=Zf,de.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},de.setAxisAngle=C1,de.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Bs.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},de.getAngle=function(e,t){var i=R1(e,t);return Math.acos(2*i*i-1)},de.multiply=I1,de.rotateX=function(e,t,i){i*=.5;var r=t[0],o=t[1],n=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=o*l+n*a,e[2]=n*l-o*a,e[3]=s*l-r*a,e},de.rotateY=function(e,t,i){i*=.5;var r=t[0],o=t[1],n=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=o*l+s*a,e[2]=n*l+r*a,e[3]=s*l-o*a,e},de.rotateZ=function(e,t,i){i*=.5;var r=t[0],o=t[1],n=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=o*l-r*a,e[2]=n*l+s*a,e[3]=s*l-n*a,e},de.calculateW=function(e,t){var i=t[0],r=t[1],o=t[2];return e[0]=i,e[1]=r,e[2]=o,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-o*o)),e},de.exp=k1,de.ln=D1,de.pow=function(e,t,i){return D1(e,t),P1(e,e,i),k1(e,e),e},de.slerp=Nu,de.random=function(e){var t=Bs.RANDOM(),i=Bs.RANDOM(),r=Bs.RANDOM(),o=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=o*Math.sin(2*Math.PI*i),e[1]=o*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e},de.invert=function(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=i*i+r*r+o*o+n*n,a=s?1/s:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-o*a,e[3]=n*a,e},de.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},de.fromMat3=z1,de.fromEuler=function(e,t,i,r){var o=.5*Math.PI/180;t*=o,i*=o,r*=o;var n=Math.sin(t),s=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return e[0]=n*l*u-s*a*c,e[1]=s*a*u+n*l*c,e[2]=s*l*c-n*a*u,e[3]=s*l*u+n*a*c,e},de.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},de.setAxes=de.sqlerp=de.rotationTo=de.equals=de.exactEquals=de.normalize=de.sqrLen=de.squaredLength=de.len=de.length=de.lerp=de.dot=de.scale=de.mul=de.add=de.set=de.copy=de.fromValues=de.clone=void 0;var Bs=Fu(sr),wS=Fu(li),wn=Fu(me),ao=Fu(Ce);function A1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(A1=function(r){return r?i:t})(e)}function Fu(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||$f(e)!=="object"&&typeof e!="function")return{default:e};var i=A1(t);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function Zf(){var e=new Bs.ARRAY_TYPE(4);return Bs.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function C1(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function I1(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+s*a+o*c-n*l,e[1]=o*u+s*l+n*a-r*c,e[2]=n*u+s*c+r*l-o*a,e[3]=s*u-r*a-o*l-n*c,e}function k1(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=Math.sqrt(i*i+r*r+o*o),a=Math.exp(n),l=s>0?a*Math.sin(s)/s:0;return e[0]=i*l,e[1]=r*l,e[2]=o*l,e[3]=a*Math.cos(s),e}function D1(e,t){var i=t[0],r=t[1],o=t[2],n=t[3],s=Math.sqrt(i*i+r*r+o*o),a=s>0?Math.atan2(s,n)/s:0;return e[0]=i*a,e[1]=r*a,e[2]=o*a,e[3]=.5*Math.log(i*i+r*r+o*o+n*n),e}function Nu(e,t,i,r){var o,n,s,a,l,c=t[0],u=t[1],p=t[2],f=t[3],g=i[0],_=i[1],y=i[2],x=i[3];return(n=c*g+u*_+p*y+f*x)<0&&(n=-n,g=-g,_=-_,y=-y,x=-x),1-n>Bs.EPSILON?(o=Math.acos(n),s=Math.sin(o),a=Math.sin((1-r)*o)/s,l=Math.sin(r*o)/s):(a=1-r,l=r),e[0]=a*c+l*g,e[1]=a*u+l*_,e[2]=a*p+l*y,e[3]=a*f+l*x,e}function z1(e,t){var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var n=(o+1)%3,s=(o+2)%3;i=Math.sqrt(t[3*o+o]-t[3*n+n]-t[3*s+s]+1),e[o]=.5*i,e[3]=(t[3*n+s]-t[3*s+n])*(i=.5/i),e[n]=(t[3*n+o]+t[3*o+n])*i,e[s]=(t[3*s+o]+t[3*o+s])*i}return e}de.clone=ao.clone,de.fromValues=ao.fromValues,de.copy=ao.copy,de.set=ao.set,de.add=ao.add,de.mul=I1;var P1=ao.scale;de.scale=P1;var R1=ao.dot;de.dot=R1,de.lerp=ao.lerp;var L1=ao.length;de.length=L1,de.len=L1;var O1=ao.squaredLength;de.squaredLength=O1,de.sqrLen=O1;var Hf=ao.normalize;de.normalize=Hf,de.exactEquals=ao.exactEquals,de.equals=ao.equals;var Lo,B1,F1,TS=(Lo=wn.create(),B1=wn.fromValues(1,0,0),F1=wn.fromValues(0,1,0),function(e,t,i){var r=wn.dot(t,i);return r<-.999999?(wn.cross(Lo,B1,t),wn.len(Lo)<1e-6&&wn.cross(Lo,F1,t),wn.normalize(Lo,Lo),C1(e,Lo,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(wn.cross(Lo,t,i),e[0]=Lo[0],e[1]=Lo[1],e[2]=Lo[2],e[3]=1+r,Hf(e,e))});de.rotationTo=TS;var Wf,Xf,ES=(Wf=Zf(),Xf=Zf(),function(e,t,i,r,o,n){return Nu(Wf,t,o,n),Nu(Xf,i,r,n),Nu(e,Wf,Xf,2*n*(1-n)),e});de.sqlerp=ES;var Oo,SS=(Oo=wS.create(),function(e,t,i,r){return Oo[0]=i[0],Oo[3]=i[1],Oo[6]=i[2],Oo[1]=r[0],Oo[4]=r[1],Oo[7]=r[2],Oo[2]=-t[0],Oo[5]=-t[1],Oo[8]=-t[2],Hf(e,z1(e,Oo))});de.setAxes=SS;var Pe={};function Yf(e){return Yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yf(e)}Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.create=function(){var e=new Rr.ARRAY_TYPE(8);return Rr.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Pe.clone=function(e){var t=new Rr.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Pe.fromValues=function(e,t,i,r,o,n,s,a){var l=new Rr.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=r,l[4]=o,l[5]=n,l[6]=s,l[7]=a,l},Pe.fromRotationTranslationValues=function(e,t,i,r,o,n,s){var a=new Rr.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=i,a[3]=r;var l=.5*o,c=.5*n,u=.5*s;return a[4]=l*r+c*i-u*t,a[5]=c*r+u*e-l*i,a[6]=u*r+l*t-c*e,a[7]=-l*e-c*t-u*i,a},Pe.fromRotationTranslation=j1,Pe.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Pe.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Pe.fromMat4=function(e,t){var i=Tn.create();N1.getRotation(i,t);var r=new Rr.ARRAY_TYPE(3);return N1.getTranslation(r,t),j1(e,i,r),e},Pe.copy=U1,Pe.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Pe.set=function(e,t,i,r,o,n,s,a,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=o,e[4]=n,e[5]=s,e[6]=a,e[7]=l,e},Pe.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Pe.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Pe.getTranslation=function(e,t){var i=t[4],r=t[5],o=t[6],n=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(i*c+n*s+r*l-o*a),e[1]=2*(r*c+n*a+o*s-i*l),e[2]=2*(o*c+n*l+i*a-r*s),e},Pe.translate=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=t[4],p=t[5],f=t[6],g=t[7];return e[0]=r,e[1]=o,e[2]=n,e[3]=s,e[4]=s*a+o*c-n*l+u,e[5]=s*l+n*a-r*c+p,e[6]=s*c+r*l-o*a+f,e[7]=-r*a-o*l-n*c+g,e},Pe.rotateX=function(e,t,i){var r=-t[0],o=-t[1],n=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=a*s+u*r+l*n-c*o,f=l*s+u*o+c*r-a*n,g=c*s+u*n+a*o-l*r,_=u*s-a*r-l*o-c*n;return Tn.rotateX(e,t,i),e[4]=p*(s=e[3])+_*(r=e[0])+f*(n=e[2])-g*(o=e[1]),e[5]=f*s+_*o+g*r-p*n,e[6]=g*s+_*n+p*o-f*r,e[7]=_*s-p*r-f*o-g*n,e},Pe.rotateY=function(e,t,i){var r=-t[0],o=-t[1],n=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=a*s+u*r+l*n-c*o,f=l*s+u*o+c*r-a*n,g=c*s+u*n+a*o-l*r,_=u*s-a*r-l*o-c*n;return Tn.rotateY(e,t,i),e[4]=p*(s=e[3])+_*(r=e[0])+f*(n=e[2])-g*(o=e[1]),e[5]=f*s+_*o+g*r-p*n,e[6]=g*s+_*n+p*o-f*r,e[7]=_*s-p*r-f*o-g*n,e},Pe.rotateZ=function(e,t,i){var r=-t[0],o=-t[1],n=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=a*s+u*r+l*n-c*o,f=l*s+u*o+c*r-a*n,g=c*s+u*n+a*o-l*r,_=u*s-a*r-l*o-c*n;return Tn.rotateZ(e,t,i),e[4]=p*(s=e[3])+_*(r=e[0])+f*(n=e[2])-g*(o=e[1]),e[5]=f*s+_*o+g*r-p*n,e[6]=g*s+_*n+p*o-f*r,e[7]=_*s-p*r-f*o-g*n,e},Pe.rotateByQuatAppend=function(e,t,i){var r=i[0],o=i[1],n=i[2],s=i[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*r+l*n-c*o,e[1]=l*s+u*o+c*r-a*n,e[2]=c*s+u*n+a*o-l*r,e[3]=u*s-a*r-l*o-c*n,e[4]=(a=t[4])*s+(u=t[7])*r+(l=t[5])*n-(c=t[6])*o,e[5]=l*s+u*o+c*r-a*n,e[6]=c*s+u*n+a*o-l*r,e[7]=u*s-a*r-l*o-c*n,e},Pe.rotateByQuatPrepend=function(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+s*a+o*c-n*l,e[1]=o*u+s*l+n*a-r*c,e[2]=n*u+s*c+r*l-o*a,e[3]=s*u-r*a-o*l-n*c,e[4]=r*(u=i[7])+s*(a=i[4])+o*(c=i[6])-n*(l=i[5]),e[5]=o*u+s*l+n*a-r*c,e[6]=n*u+s*c+r*l-o*a,e[7]=s*u-r*a-o*l-n*c,e},Pe.rotateAroundAxis=function(e,t,i,r){if(Math.abs(r)<Rr.EPSILON)return U1(e,t);var o=Math.hypot(i[0],i[1],i[2]);r*=.5;var n=Math.sin(r),s=n*i[0]/o,a=n*i[1]/o,l=n*i[2]/o,c=Math.cos(r),u=t[0],p=t[1],f=t[2],g=t[3];e[0]=u*c+g*s+p*l-f*a,e[1]=p*c+g*a+f*s-u*l,e[2]=f*c+g*l+u*a-p*s,e[3]=g*c-u*s-p*a-f*l;var _=t[4],y=t[5],x=t[6],b=t[7];return e[4]=_*c+b*s+y*l-x*a,e[5]=y*c+b*a+x*s-_*l,e[6]=x*c+b*l+_*a-y*s,e[7]=b*c-_*s-y*a-x*l,e},Pe.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Pe.multiply=G1,Pe.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Pe.lerp=function(e,t,i,r){var o=1-r;return q1(t,i)<0&&(r=-r),e[0]=t[0]*o+i[0]*r,e[1]=t[1]*o+i[1]*r,e[2]=t[2]*o+i[2]*r,e[3]=t[3]*o+i[3]*r,e[4]=t[4]*o+i[4]*r,e[5]=t[5]*o+i[5]*r,e[6]=t[6]*o+i[6]*r,e[7]=t[7]*o+i[7]*r,e},Pe.invert=function(e,t){var i=Vu(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Pe.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Pe.normalize=function(e,t){var i=Vu(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i,o=t[1]/i,n=t[2]/i,s=t[3]/i,a=t[4],l=t[5],c=t[6],u=t[7],p=r*a+o*l+n*c+s*u;e[0]=r,e[1]=o,e[2]=n,e[3]=s,e[4]=(a-r*p)/i,e[5]=(l-o*p)/i,e[6]=(c-n*p)/i,e[7]=(u-s*p)/i}return e},Pe.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Pe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Pe.equals=function(e,t){var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=t[0],p=t[1],f=t[2],g=t[3],_=t[4],y=t[5],x=t[6],b=t[7];return Math.abs(i-u)<=Rr.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-p)<=Rr.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-f)<=Rr.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(n-g)<=Rr.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-_)<=Rr.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-y)<=Rr.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-x)<=Rr.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-b)<=Rr.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},Pe.sqrLen=Pe.squaredLength=Pe.len=Pe.length=Pe.dot=Pe.mul=Pe.setReal=Pe.getReal=void 0;var Rr=Jf(sr),Tn=Jf(de),N1=Jf(ge);function V1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(V1=function(r){return r?i:t})(e)}function Jf(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Yf(e)!=="object"&&typeof e!="function")return{default:e};var i=V1(t);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}function j1(e,t,i){var r=.5*i[0],o=.5*i[1],n=.5*i[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=r*c+o*l-n*a,e[5]=o*c+n*s-r*l,e[6]=n*c+r*a-o*s,e[7]=-r*s-o*a-n*l,e}function U1(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function G1(e,t,i){var r=t[0],o=t[1],n=t[2],s=t[3],a=i[4],l=i[5],c=i[6],u=i[7],p=t[4],f=t[5],g=t[6],_=t[7],y=i[0],x=i[1],b=i[2],T=i[3];return e[0]=r*T+s*y+o*b-n*x,e[1]=o*T+s*x+n*y-r*b,e[2]=n*T+s*b+r*x-o*y,e[3]=s*T-r*y-o*x-n*b,e[4]=r*u+s*a+o*c-n*l+p*T+_*y+f*b-g*x,e[5]=o*u+s*l+n*a-r*c+f*T+_*x+g*y-p*b,e[6]=n*u+s*c+r*l-o*a+g*T+_*b+p*x-f*y,e[7]=s*u-r*a-o*l-n*c+_*T-p*y-f*x-g*b,e}Pe.getReal=Tn.copy,Pe.setReal=Tn.copy,Pe.mul=G1;var q1=Tn.dot;Pe.dot=q1;var $1=Tn.length;Pe.length=$1,Pe.len=$1;var Vu=Tn.squaredLength;Pe.squaredLength=Vu,Pe.sqrLen=Vu;var be={};function Kf(e){return Kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kf(e)}Object.defineProperty(be,"__esModule",{value:!0}),be.create=H1,be.clone=function(e){var t=new Fs.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},be.fromValues=function(e,t){var i=new Fs.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},be.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},be.set=function(e,t,i){return e[0]=t,e[1]=i,e},be.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},be.subtract=W1,be.multiply=X1,be.divide=Y1,be.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},be.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},be.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},be.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},be.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},be.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},be.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},be.distance=J1,be.squaredDistance=K1,be.length=Q1,be.squaredLength=tx,be.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},be.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},be.normalize=function(e,t){var i=t[0],r=t[1],o=i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e},be.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},be.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},be.lerp=function(e,t,i,r){var o=t[0],n=t[1];return e[0]=o+r*(i[0]-o),e[1]=n+r*(i[1]-n),e},be.random=function(e,t){t=t||1;var i=2*Fs.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},be.transformMat2=function(e,t,i){var r=t[0],o=t[1];return e[0]=i[0]*r+i[2]*o,e[1]=i[1]*r+i[3]*o,e},be.transformMat2d=function(e,t,i){var r=t[0],o=t[1];return e[0]=i[0]*r+i[2]*o+i[4],e[1]=i[1]*r+i[3]*o+i[5],e},be.transformMat3=function(e,t,i){var r=t[0],o=t[1];return e[0]=i[0]*r+i[3]*o+i[6],e[1]=i[1]*r+i[4]*o+i[7],e},be.transformMat4=function(e,t,i){var r=t[0],o=t[1];return e[0]=i[0]*r+i[4]*o+i[12],e[1]=i[1]*r+i[5]*o+i[13],e},be.rotate=function(e,t,i,r){var o=t[0]-i[0],n=t[1]-i[1],s=Math.sin(r),a=Math.cos(r);return e[0]=o*a-n*s+i[0],e[1]=o*s+n*a+i[1],e},be.angle=function(e,t){var i=e[0],r=e[1],o=t[0],n=t[1],s=Math.sqrt(i*i+r*r)*Math.sqrt(o*o+n*n);return Math.acos(Math.min(Math.max(s&&(i*o+r*n)/s,-1),1))},be.zero=function(e){return e[0]=0,e[1]=0,e},be.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},be.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},be.equals=function(e,t){var i=e[0],r=e[1],o=t[0],n=t[1];return Math.abs(i-o)<=Fs.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-n)<=Fs.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))},be.forEach=be.sqrLen=be.sqrDist=be.dist=be.div=be.mul=be.sub=be.len=void 0;var Fs=function(e,t){if(e&&e.__esModule)return e;if(e===null||Kf(e)!=="object"&&typeof e!="function")return{default:e};var i=Z1(void 0);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}(sr);function Z1(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Z1=function(r){return r?i:t})(e)}function H1(){var e=new Fs.ARRAY_TYPE(2);return Fs.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function W1(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function X1(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function Y1(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function J1(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function K1(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function Q1(e){return Math.hypot(e[0],e[1])}function tx(e){var t=e[0],i=e[1];return t*t+i*i}be.len=Q1,be.sub=W1,be.mul=X1,be.div=Y1,be.dist=J1,be.sqrDist=K1,be.sqrLen=tx;var MS=function(){var e=H1();return function(t,i,r,o,n,s){var a,l;for(i||(i=2),r||(r=0),l=o?Math.min(o*i+r,t.length):t.length,a=r;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],n(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function Qf(e){return Qf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qf(e)}be.forEach=MS,Object.defineProperty(nr,"__esModule",{value:!0});var ei=nr.vec4=j=nr.vec3=nr.vec2=nr.quat2=fr=nr.quat=Q=nr.mat4=Lr=nr.mat3=nr.mat2d=Ra=nr.mat2=nr.glMatrix=void 0,AS=Jo(sr);nr.glMatrix=AS;var CS=Jo(Si),Ra=nr.mat2=CS,IS=Jo(Ci);nr.mat2d=IS;var kS=Jo(li),Lr=nr.mat3=kS,DS=Jo(ge),Q=nr.mat4=DS,zS=Jo(de),fr=nr.quat=zS,PS=Jo(Pe);nr.quat2=PS;var RS=Jo(be);nr.vec2=RS;var LS=Jo(me),j=nr.vec3=LS,OS=Jo(Ce);function ex(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(ex=function(r){return r?i:t})(e)}function Jo(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Qf(e)!=="object"&&typeof e!="function")return{default:e};var i=ex(t);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,i&&i.set(e,r),r}ei=nr.vec4=OS;const BS=He([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ju}=BS,ix=He([{name:"a_pos_3",components:3,type:"Int16"}]);var Jn=He([{name:"a_pos",type:"Int16",components:2}]),rx={};(function(e,t){(function(i){function r(n,s,a){var l=o(256*n,256*(s=Math.pow(2,a)-s-1),a),c=o(256*(n+1),256*(s+1),a);return l[0]+","+l[1]+","+c[0]+","+c[1]}function o(n,s,a){var l=2*Math.PI*6378137/256/Math.pow(2,a);return[n*l-2*Math.PI*6378137/2,s*l-2*Math.PI*6378137/2]}i.getURL=function(n,s,a,l,c,u){return u=u||{},n+"?"+["bbox="+r(a,l,c),"format="+(u.format||"image/png"),"service="+(u.service||"WMS"),"version="+(u.version||"1.1.1"),"request="+(u.request||"GetMap"),"srs="+(u.srs||"EPSG:3857"),"width="+(u.width||256),"height="+(u.height||256),"layers="+s].join("&")},i.getTileBBox=r,i.getMercCoords=o,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,rx);var FS=rx;class To{constructor(t,i,r){this.z=t,this.x=i,this.y=r,this.key=Gl(0,t,t,i,r)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const r=FS.getTileBBox(this.x,this.y,this.z),o=function(n,s,a){let l,c="";for(let u=n;u>0;u--)l=1<<u-1,c+=(s&l?1:0)+(a&l?2:0);return c}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tm{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Gl(t,i.z,i.z,i.x,i.y)}}class Ue{constructor(t,i,r,o,n){this.overscaledZ=t,this.wrap=i,this.canonical=new To(r,+o,+n),this.key=i===0&&t===r?this.canonical.key:Gl(i,t,r,o,n)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Ue(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ue(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Gl(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-t;return Gl(this.wrap*+i,t,t,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Ue(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,o=2*this.canonical.y;return[new Ue(i,this.wrap,i,r,o),new Ue(i,this.wrap,i,r+1,o),new Ue(i,this.wrap,i,r,o+1),new Ue(i,this.wrap,i,r+1,o+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ue(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ue(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gl(e,t,i,r,o){const n=1<<Math.min(i,22);let s=n*(o%n)+r%n;return e&&i<22&&(s+=n*n*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*s+i)+(t-i)}const ox=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new Ue(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new Ue(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new Ue(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new Ue(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];jt(To,"CanonicalTileID"),jt(Ue,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class Uu{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,r){const o=j.dot(i,this.dir);if(Math.abs(o)<1e-6)return!1;const n=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/o;return r[0]=this.pos[0]+this.dir[0]*n,r[1]=this.pos[1]+this.dir[1]*n,r[2]=this.pos[2]+this.dir[2]*n,!0}closestPointOnSphere(t,i,r){if(j.equals(this.pos,t)||i===0)return r[0]=r[1]=r[2]=0,!1;const[o,n,s]=this.dir,a=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],u=o*o+n*n+s*s,p=2*(a*o+l*n+c*s),f=p*p-4*u*(a*a+l*l+c*c-i*i);if(f<0){const g=Math.max(-p/2,0),_=a+o*g,y=l+n*g,x=c+s*g,b=Math.hypot(_,y,x);return r[0]=_*i/b,r[1]=y*i/b,r[2]=x*i/b,!1}{const g=(-p-Math.sqrt(f))/(2*u);if(g<0){const _=Math.hypot(a,l,c);return r[0]=a*i/_,r[1]=l*i/_,r[2]=c*i/_,!1}return r[0]=a+o*g,r[1]=l+n*g,r[2]=c+s*g,!0}}}class em{constructor(t,i,r,o,n){this.TL=t,this.TR=i,this.BR=r,this.BL=o,this.horizon=n}static fromInvProjectionMatrix(t,i,r){const o=[-1,1,1],n=[1,1,1],s=[1,-1,1],a=[-1,-1,1],l=j.transformMat4(o,o,t),c=j.transformMat4(n,n,t),u=j.transformMat4(s,s,t),p=j.transformMat4(a,a,t);return new em(l,c,u,p,i/r)}}function ql(e,t,i){let r=1/0,o=-1/0;const n=[];for(const s of e){j.sub(n,s,t);const a=j.dot(n,i);r=Math.min(r,a),o=Math.max(o,a)}return[r,o]}function nx(e,t){let i=!0;for(let r=0;r<e.planes.length;r++){const o=e.planes[r];let n=0;for(let s=0;s<t.length;s++)n+=j.dot(o,t[s])+o[3]>=0;if(n===0)return 0;n!==t.length&&(i=!1)}return i?2:1}function sx(e,t){for(const i of e.projections){const r=ql(t,e.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function ax(e,t){let i=0;const r=[0,0,0,0];for(let o=0;o<e.length;o++)r[0]=e[o][0],r[1]=e[o][1],r[2]=e[o][2],r[3]=1,ei.dot(r,t)>=0&&i++;return i}class En{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=di.fromPoints(this.points),this.projections=[],this.frustumEdges=[j.sub([],this.points[2],this.points[3]),j.sub([],this.points[0],this.points[3]),j.sub([],this.points[4],this.points[0]),j.sub([],this.points[5],this.points[1]),j.sub([],this.points[6],this.points[2]),j.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const o=[0,-r[2],r[1]],n=[r[2],0,-r[0]];this.projections.push({axis:o,projection:ql(this.points,this.points[0],o)}),this.projections.push({axis:n,projection:ql(this.points,this.points[0],n)})}}static fromInvProjectionMatrix(t,i,r,o){const n=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(c=>{const u=ei.transformMat4([],c,t),p=1/u[3]/i*n;return ei.mul(u,u,[p,p,o?1/u[3]:p,p])}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(c=>{const u=j.sub([],s[c[0]],s[c[1]]),p=j.sub([],s[c[2]],s[c[1]]),f=j.normalize([],j.cross([],u,p)),g=-j.dot(f,s[c[1]]);return f.concat(g)}),l=[];for(let c=0;c<s.length;c++)l.push([s[c][0],s[c][1],s[c][2]]);return new En(l,a)}intersectsPrecise(t,i,r){for(let o=0;o<i.length;o++)if(!ax(t,i[o]))return 0;for(let o=0;o<this.planes.length;o++)if(!ax(t,this.planes[o]))return 0;for(const o of r)for(const n of this.frustumEdges){const s=j.cross([],o,n),a=j.length(s);if(a===0)continue;j.scale(s,s,1/a);const l=ql(this.points,this.points[0],s),c=ql(t,this.points[0],s);if(l[0]>c[1]||c[0]>l[1])return 0}return 1}}class di{static fromPoints(t){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const o of t)j.min(i,i,o),j.max(r,r,o);return new di(i,r)}static fromTileIdAndHeight(t,i,r){const o=1<<t.canonical.z,n=t.canonical.x,s=t.canonical.y;return new di([n/o,s/o,i],[(n+1)/o,(s+1)/o,r])}static applyTransform(t,i){const r=t.getCorners();for(let o=0;o<r.length;++o)j.transformMat4(r[o],r[o],i);return di.fromPoints(r)}static projectAabbCorners(t,i){const r=t.getCorners();for(let o=0;o<r.length;++o)j.transformMat4(r[o],r[o],i);return r}constructor(t,i){this.min=t,this.max=i,this.center=j.scale([],j.add([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],r=j.clone(this.min),o=j.clone(this.max);for(let n=0;n<i.length;n++)r[n]=i[n]?this.min[n]:this.center[n],o[n]=i[n]?this.center[n]:this.max[n];return o[2]=this.max[2],new di(r,o)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?nx(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?nx(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?sx(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?sx(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}jt(di,"Aabb");const $l=5,Kn=6,Ar=at/Math.PI/2,NS=16383,La=64,im=[La,32,16],Eo=-Ar,So=Ar,VS=[new di([Eo,Eo,Eo],[So,So,So]),new di([Eo,Eo,Eo],[0,0,So]),new di([0,Eo,Eo],[So,0,So]),new di([Eo,0,Eo],[0,So,So]),new di([0,0,Eo],[So,So,So])];function Gu(e){return e*Ar/Ba}function lx(e,t,i,r=!0){const o=j.scale([],e._camera.position,e.worldSize),n=[t,i,1,1];ei.transformMat4(n,n,e.pixelMatrixInverse),ei.scale(n,n,1/n[3]);const s=j.sub([],n,o),a=j.normalize([],s),l=e.globeMatrix,c=[l[12],l[13],l[14]],u=j.sub([],c,o),p=j.length(u),f=j.normalize([],u),g=e.worldSize/(2*Math.PI),_=j.dot(f,a),y=Math.asin(g/p);if(y<Math.acos(_)){if(!r)return null;const F=[],N=[];j.scale(F,a,p/_),j.normalize(N,j.sub(N,F,u)),j.normalize(a,j.add(a,u,j.scale(a,N,Math.tan(y)*p)))}const x=[];new Uu(o,a).closestPointOnSphere(c,g,x);const b=j.normalize([],ki(l,0)),T=j.normalize([],ki(l,1)),S=j.normalize([],ki(l,2)),M=j.dot(b,x),E=j.dot(T,x),A=j.dot(S,x),I=Te(Math.asin(-E/g));let z=Te(Math.atan2(M,A));z=e.center.lng+function(F,N){const U=(N-F+180)%360-180;return U<-180?U+360:U}(e.center.lng,z);const P=Ji(z),R=Ut(Qi(I),0,1);return new De(P,R)}class jS{constructor(t,i,r){this.a=j.sub([],t,r),this.b=j.sub([],i,r),this.center=r;const o=j.normalize([],this.a),n=j.normalize([],this.b);this.angle=Math.acos(j.dot(o,n))}}function rm(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(r,o,n,s){const a=Math.sin(n);return r*(Math.sin((1-s)*n)/a)+o*(Math.sin(s*n)/a)}(e.a[t],e.b[t],e.angle,Ut(i,0,1))+e.center[t]}function lo(e){if(e.z<=1)return VS[e.z+2*e.y+e.x];const t=nm(qu(e));return di.fromPoints(t)}function Sn(e,t,i){return j.scale(e,e,1-i),j.scaleAndAdd(e,e,t,i)}function cx(e,t){const i=ar(t.zoom);if(i===0)return lo(e);const r=qu(e),o=nm(r),n=Ji(r.getWest())*t.worldSize,s=Ji(r.getEast())*t.worldSize,a=Qi(r.getNorth())*t.worldSize,l=Qi(r.getSouth())*t.worldSize,c=[n,a,0],u=[s,a,0],p=[n,l,0],f=[s,l,0],g=Q.invert([],t.globeMatrix);return j.transformMat4(c,c,g),j.transformMat4(u,u,g),j.transformMat4(p,p,g),j.transformMat4(f,f,g),o[0]=Sn(o[0],p,i),o[1]=Sn(o[1],f,i),o[2]=Sn(o[2],u,i),o[3]=Sn(o[3],c,i),di.fromPoints(o)}function ux(e,t,i){for(const r of e)j.transformMat4(r,r,t),j.scale(r,r,i)}function om(e,t,i,r){const o=t/e.worldSize,n=e.globeMatrix;if(i.z<=1){const P=lo(i).getCorners();return ux(P,n,o),di.fromPoints(P)}const s=qu(i,r),a=nm(s);ux(a,n,o);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const F of a)j.min(u,u,F),j.max(c,c,F);c[2]=0;const P=e.point,R=[P.x*o,P.y*o,0];return j.min(u,u,R),j.max(c,c,R),new di(u,c)}const p=[n[12]*o,n[13]*o,n[14]*o],f=s.getCenter(),g=Ut(e.center.lat,-Oi,Oi),_=Ut(f.lat,-Oi,Oi),y=Ji(e.center.lng),x=Qi(g);let b=y-Ji(f.lng);const T=x-Qi(_);b>.5?b-=1:b<-.5&&(b+=1);let S=0;if(Math.abs(b)>Math.abs(T))S=b>=0?1:3;else{S=T>=0?0:2;const P=[n[4]*o,n[5]*o,n[6]*o],R=-Math.sin(Ft(T>=0?s.getSouth():s.getNorth()))*Ar;j.scaleAndAdd(p,p,P,R)}const M=a[S],E=a[(S+1)%4],A=new jS(M,E,p),I=[rm(A,0)||M[0],rm(A,1)||M[1],rm(A,2)||M[2]],z=ar(e.zoom);if(z>0){const P=function({x:F,y:N,z:U},O,Z,W,K){const $=1/(1<<U);let H=F*$,it=H+$,ot=N*$,rt=ot+$,lt=0;const ut=(H+it)/2-W;return ut>.5?lt=-1:ut<-.5&&(lt=1),H=((H+lt)*O-(W*=O))*Z+W,it=((it+lt)*O-W)*Z+W,ot=(ot*O-(K*=O))*Z+K,rt=(rt*O-K)*Z+K,[[H,rt,0],[it,rt,0],[it,ot,0],[H,ot,0]]}(i,t,e._pixelsPerMercatorPixel,y,x);for(let F=0;F<a.length;F++)Sn(a[F],P[F],z);const R=j.add([],P[S],P[(S+1)%4]);j.scale(R,R,.5),Sn(I,R,z)}for(const P of a)j.min(u,u,P),j.max(c,c,P);return u[2]=Math.min(M[2],E[2]),j.min(u,u,I),j.max(c,c,I),new di(u,c)}function qu({x:e,y:t,z:i},r=!1){const o=1/(1<<i),n=new se(Xr(e*o),t===(1<<i)-1&&r?-90:Hi((t+1)*o)),s=new se(Xr((e+1)*o),t===0&&r?90:Hi(t*o));return new Wr(n,s)}function nm(e){const t=Ft(e.getNorth()),i=Ft(e.getSouth()),r=Math.cos(t),o=Math.cos(i),n=Math.sin(t),s=Math.sin(i),a=e.getWest(),l=e.getEast();return[Oa(o,s,a),Oa(o,s,l),Oa(r,n,l),Oa(r,n,a)]}function Oa(e,t,i,r=Ar){return i=Ft(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function Or(e,t,i){return Oa(Math.cos(Ft(e)),Math.sin(Ft(e)),t,i)}function Zl(e,t,i,r){const o=1<<i.z,n=(e/at+i.x)/o;return Or(Hi((t/at+i.y)/o),Xr(n),r)}function $u({min:e,max:t}){return NS/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const hx=new Float64Array(16);function Qn(e){const t=$u(e),i=Q.fromScaling(hx,[t,t,t]);return Q.translate(i,i,j.negate([],e.min))}function sm(e){const t=Q.fromTranslation(hx,e.min),i=1/$u(e);return Q.scale(t,t,[i,i,i])}function am(e){const t=at/(2*Math.PI);return e/(2*Math.PI)/t}function dx(e,t){return at/(512*Math.pow(2,e))*$u(lo(t))}function px(e,t,i,r,o){const n=am(i),s=[e,t,-i/(2*Math.PI)],a=Q.identity(new Float64Array(16));return Q.translate(a,a,s),Q.scale(a,a,[n,n,n]),Q.rotateX(a,a,Ft(-o)),Q.rotateY(a,a,Ft(-r)),a}function fx(e){const t=e.pixelsPerMeter,i=t/ni(1,e.center.lat),r=Q.identity(new Float64Array(16));return Q.translate(r,r,[e.point.x,e.point.y,0]),Q.scale(r,r,[i,i,t]),Float32Array.from(r)}function ar(e){return oo($l,Kn,e)}function mx(e,t,i){const r=Q.identity(new Float64Array(16)),o=(t/(1<<e)-.5)*Math.PI*2;return Q.rotateY(r,i.globeMatrix,o),Float32Array.from(r)}function gx(e,t,i){const r=ar(i.zoom),o=e.style.map._antialias,n=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return r===0&&!o&&!n}function _x(e,t,i,r){const o=t.getNorth(),n=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=o-n,p=c/La,f=-u/im[i],g=[0,p,0,f,0,0,o,s,0];if(e.z>0){const _=180/r;Lr.multiply(g,g,[_/c+1,0,0,0,_/u+1,0,-.5*_/p,.5*_/f,1])}return g[2]=l,g[5]=e.x,g[8]=e.y,g}function US(e){const t=Oi-5;e=Ut(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Ft(e))),3);return Math.round(i*(im.length-1))}function yx(e){const t=[0,0,0],i=Q.identity(new Float64Array(16));return Q.multiply(i,e.pixelMatrix,e.globeMatrix),j.transformMat4(t,t,i),new B(t[0],t[1])}function xx(e,t){const i=Or(t.lat,t.lng),r=function(n){const s=Or(n._center.lat,n._center.lng),a=j.fromValues(0,1,0);let l=j.cross([],a,s);const c=Q.fromRotation([],-n.angle,s);l=j.transformMat4(l,l,c),Q.fromRotation(c,-n._pitch,l);const u=j.normalize([],s);return j.scale(u,u,Gu(n.cameraToCenterDistance/n.pixelsPerMeter)),j.transformMat4(u,u,c),j.add([],s,u)}(e),o=j.subtract([],r,i);return j.angle(o,i)}function Zu(e,t){return xx(e,t)>Math.PI/2*1.01}const vx=Ft(85),GS=Math.cos(vx),qS=Math.sin(vx);class $S{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,i){const r=new Zr,o=new Zi,n=[],s=t+1+2,a=i[0]+1,l=i[0]+1+(1+i.length),c=(u,p,f)=>{let g=u===s-1?u-2:u===0?u:u-1;return g+=f?24575:0,[g,p]};for(let u=0;u<s;++u)r.emplaceBack(...c(u,0,!0));for(let u=0;u<a;++u)for(let p=0;p<s;++p)r.emplaceBack(...c(p,u,(p===0||p===s-1)&&!0));for(let u=0;u<i.length;++u){const p=i[u];for(let f=0;f<s;++f)r.emplaceBack(...c(f,p,!0))}for(let u=0;u<i.length;++u){const p=o.length,f=i[u]+1+2,g=new Zi;for(let x=0;x<f-1;x++){const b=x===f-2,T=b?s*(l-i.length+u-x):s;for(let S=0;S<s-1;S++){const M=x*s+S;x===0||b||S===0||S===s-2?(g.emplaceBack(M+1,M,M+T),g.emplaceBack(M+T,M+T+1,M+1)):(o.emplaceBack(M+1,M,M+T),o.emplaceBack(M+T,M+T+1,M+1))}}const _=ti.simpleSegment(0,p,r.length,o.length-p);for(let x=0;x<g.uint16.length;x+=3)o.emplaceBack(g.uint16[x],g.uint16[x+1],g.uint16[x+2]);const y=ti.simpleSegment(0,p,r.length,o.length-p);n.push({withoutSkirts:_,withSkirts:y})}return{vertices:r,indices:o,segments:n}}_createGrid(t){const i=this._fillGridMeshWithLods(La,im);this._gridSegments=i.segments,this._gridBuffer=t.createVertexBuffer(i.vertices,Jn.members),this._gridIndexBuffer=t.createIndexBuffer(i.indices,!0)}_createPoles(t){const i=new Zi;for(let a=0;a<=La;a++)i.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(i,!0);const r=new Rs,o=new Rs,n=new Rs,s=new Rs;this._poleSegments=[];for(let a=0,l=0;a<$l;a++){const c=360/(1<<a);r.emplaceBack(0,-Ar,0,.5,0),o.emplaceBack(0,-Ar,0,.5,1),n.emplaceBack(0,-Ar,0,.5,.5),s.emplaceBack(0,-Ar,0,.5,.5);for(let u=0;u<=La;u++){let p=u/La,f=0;const g=ne(0,c,p),[_,y,x]=Oa(GS,qS,g,Ar);r.emplaceBack(_,y,x,p,f),o.emplaceBack(_,y,x,p,1-f);const b=Ft(g);p=.5+.5*Math.sin(b),f=.5+.5*Math.cos(b),n.emplaceBack(_,y,x,p,f),s.emplaceBack(_,y,x,p,1-f)}this._poleSegments.push(ti.simpleSegment(l,0,66,64)),l+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,ju,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,ju,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(n,ju,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(s,ju,!1)}getGridBuffers(t,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const Ba=63710088e-1,lm=2*Math.PI*Ba;class ts{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ts(Nr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,r=this.lat*i,o=t.lat*i,n=Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos((t.lng-this.lng)*i);return Ba*Math.acos(Math.min(n,1))}toBounds(t=0){const i=360*t/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Wr(new ts(this.lng-r,this.lat-i),new ts(this.lng+r,this.lat+i))}toEcef(t){const i=Gu(t);return Or(this.lat,this.lng,Ar+i)}static convert(t){if(t instanceof ts)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ts(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ts(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var se=ts;const ZS=0,HS=25.5;function Hu(e){return lm*Math.cos(e*Math.PI/180)}function Ji(e){return(180+e)/360}function Qi(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ni(e,t){return e/Hu(t)}function Xr(e){return 360*e-180}function Hi(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function bx(e,t){return e*Hu(Hi(t))}const Oi=85.051129;function wx(e){return Math.cos(Ft(Ut(e,-Oi,Oi)))}function es(e,t){const i=Ut(t,ZS,HS),r=Math.pow(2,i);return wx(e)*lm/(512*r)}function cm(e){return 1/Math.cos(e*Math.PI/180)}function Hl(e,t=0){const i=Math.exp(Math.PI*(1-(e.y+t/at)/(1<<e.z)*2));return 80150034*i/(i*i+1)/at/(1<<e.z)}class De{constructor(t,i,r=0){this.x=+t,this.y=+i,this.z=+r}static fromLngLat(t,i=0){const r=se.convert(t);return new De(Ji(r.lng),Qi(r.lat),ni(i,r.lat))}toLngLat(){return new se(Xr(this.x),Hi(this.y))}toAltitude(){return bx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lm*cm(Hi(this.y))}}function um(e,t,i,r,o,n,s,a,l){const c=(t+r)/2,u=(i+o)/2,p=new B(c,u);a(p),function(f,g,_,y,x,b){const T=_-x,S=y-b;return Math.abs((y-g)*T-(_-f)*S)/Math.hypot(T,S)}(p.x,p.y,n.x,n.y,s.x,s.y)>=l?(um(e,t,i,c,u,n,p,a,l),um(e,c,u,r,o,p,s,a,l)):e.push(s)}function Tx(e,t,i){let r=e[0],o=r.x,n=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),um(s,o,n,c,u,r,l,t,i),o=c,n=u,r=l}return s}function hm(e,t,i,r){if(r(t,i)){const o=t.add(i)._mult(.5);hm(e,t,o,r),hm(e,o,i,r)}else e.push(i)}function WS(e,t){let i=e[0];const r=[i];for(let o=1;o<e.length;o++){const n=e[o];hm(r,i,n,t),i=n}return r}const dm=Math.pow(2,14)-1,Ex=-dm-1;function XS(e,t){const i=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=Ut(i,Ex,dm),e.y=Ut(r,Ex,dm),(i<e.x||i>e.x+1||r<e.y||r>e.y+1)&&Y("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ko(e,t,i){const r=e.loadGeometry(),o=e.extent,n=at/o;if(t&&i&&i.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:a,x:l,y:c,projection:u}=i,p=f=>{const g=Xr((t.x+f.x/o)/s),_=Hi((t.y+f.y/o)/s),y=u.project(g,_);f.x=(y.x*a-l)*o,f.y=(y.y*a-c)*o};for(let f=0;f<r.length;f++)if(e.type!==1)r[f]=Tx(r[f],p,1);else{const g=[];for(const _ of r[f])_.x<0||_.x>=o||_.y<0||_.y>=o||(p(_),g.push(_));r[f]=g}}for(const s of r)for(const a of s)XS(a,n);return r}function is(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ko(e):[]}}function Wu(e,t,i,r,o){e.emplaceBack(2*t+(r+1)/2,2*i+(o+1)/2)}function Xu(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class pm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Zr,this.indexArray=new Zi,this.segments=new ti,this.programConfigurations=new Xn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,r,o){const n=this.layers[0],s=[];let a=null;n.type==="circle"&&(a=n.layout.get("circle-sort-key"));for(const{feature:c,id:u,index:p,sourceLayerIndex:f}of t){const g=this.layers[0]._featureFilter.needGeometry,_=is(c,g);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),_,r))continue;const y=a?a.evaluate(_,{},r):void 0,x={id:u,properties:c.properties,type:c.type,sourceLayerIndex:f,index:p,geometry:g?_.geometry:Ko(c,r,o),patterns:{},sortKey:y};s.push(x)}a&&s.sort((c,u)=>c.sortKey-u.sortKey);let l=null;o.projection.name==="globe"&&(this.globeExtVertexArray=new Pu,l=o.projection);for(const c of s){const{geometry:u,index:p,sourceLayerIndex:f}=c,g=t[p].feature;this.addFeature(c,u,p,i.availableImages,r,l,i.brightness),i.featureIndex.insert(g,u,p,f,this.index)}}update(t,i,r,o,n){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,s?this.stateDependentLayers:this.layers,r,o,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,sS.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,r,o,n,s,a){for(const l of i)for(const c of l){const u=c.x,p=c.y;if(u<0||u>=at||p<0||p>=at)continue;if(s){const _=s.projectTilePoint(u,p,n),y=s.upVector(n,u,p),x=this.globeExtVertexArray;Xu(x,_,y),Xu(x,_,y),Xu(x,_,y),Xu(x,_,y)}const f=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),g=f.vertexLength;Wu(this.layoutVertexArray,u,p,-1,-1),Wu(this.layoutVertexArray,u,p,1,-1),Wu(this.layoutVertexArray,u,p,1,1),Wu(this.layoutVertexArray,u,p,-1,1),this.indexArray.emplaceBack(g,g+1,g+2),this.indexArray.emplaceBack(g,g+2,g+3),f.vertexLength+=4,f.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},o,n,a)}}function Sx(e,t){for(let i=0;i<e.length;i++)if(rs(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(rs(e,t[i]))return!0;return!!fm(e,t)}function YS(e,t,i){return!!rs(e,t)||!!mm(t,e,i)}function Mx(e,t){if(e.length===1)return Cx(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let o=0;o<r.length;o++)if(rs(e,r[o]))return!0}for(let i=0;i<e.length;i++)if(Cx(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(fm(e,t[i]))return!0;return!1}function JS(e,t,i){if(e.length>1){if(fm(e,t))return!0;for(let r=0;r<t.length;r++)if(mm(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(mm(e[r],t,i))return!0;return!1}function fm(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],o=e[i+1];for(let n=0;n<t.length-1;n++)if(KS(r,o,t[n],t[n+1]))return!0}return!1}function KS(e,t,i,r){return _t(e,i,r)!==_t(t,i,r)&&_t(e,t,i)!==_t(e,t,r)}function mm(e,t,i){const r=i*i;if(t.length===1)return e.distSqr(t[0])<r;for(let o=1;o<t.length;o++)if(Ax(e,t[o-1],t[o])<r)return!0;return!1}function Ax(e,t,i){const r=t.distSqr(i);if(r===0)return e.distSqr(t);const o=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(o<0?t:o>1?i:i.sub(t)._mult(o)._add(t))}function Cx(e,t){let i,r,o,n=!1;for(let s=0;s<e.length;s++){i=e[s];for(let a=0,l=i.length-1;a<i.length;l=a++)r=i[a],o=i[l],r.y>t.y!=o.y>t.y&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(n=!n)}return n}function rs(e,t){let i=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){const n=e[r],s=e[o];n.y>t.y!=s.y>t.y&&t.x<(s.x-n.x)*(t.y-n.y)/(s.y-n.y)+n.x&&(i=!i)}return i}function Ix(e,t,i,r,o){for(const s of e)if(t<=s.x&&i<=s.y&&r>=s.x&&o>=s.y)return!0;const n=[new B(t,i),new B(t,o),new B(r,o),new B(r,i)];if(e.length>2){for(const s of n)if(rs(e,s))return!0}for(let s=0;s<e.length-1;s++)if(QS(e[s],e[s+1],n))return!0;return!1}function QS(e,t,i){const r=i[0],o=i[2];if(e.x<r.x&&t.x<r.x||e.x>o.x&&t.x>o.x||e.y<r.y&&t.y<r.y||e.y>o.y&&t.y>o.y)return!1;const n=_t(e,t,i[0]);return n!==_t(e,t,i[1])||n!==_t(e,t,i[2])||n!==_t(e,t,i[3])}function Fa(e,t,i,r,o,n){let s=t.y-e.y,a=e.x-t.x;if(n=n||0){const l=s*s+a*a;if(l===0)return!0;const c=Math.sqrt(l);s/=c,a/=c}return!((i.x-e.x)*s+(i.y-e.y)*a-n<0||(r.x-e.x)*s+(r.y-e.y)*a-n<0||(o.x-e.x)*s+(o.y-e.y)*a-n<0)}function gm(e,t,i,r,o,n,s){return!(Fa(e,t,r,o,n,s)||Fa(t,i,r,o,n,s)||Fa(i,e,r,o,n,s)||Fa(r,o,e,t,i,s)||Fa(o,n,e,t,i,s)||Fa(n,r,e,t,i,s))}function Na(e,t,i){const r=t.paint.get(e).value;return r.kind==="constant"?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Yu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function kx(e,t,i,r,o){if(!t[0]&&!t[1])return e;const n=B.convert(t)._mult(o);i==="viewport"&&n._rotate(-r);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(n));return s}function Dx(e,t,i,r){const o=B.convert(e)._mult(r);return t==="viewport"&&o._rotate(-i),o}jt(pm,"CircleBucket",{omit:["layers"]});const tM=new Pi({"circle-sort-key":new Yt(tt.layout_circle["circle-sort-key"]),visibility:new bt(tt.layout_circle.visibility)});var eM={paint:new Pi({"circle-radius":new Yt(tt.paint_circle["circle-radius"]),"circle-color":new Yt(tt.paint_circle["circle-color"]),"circle-blur":new Yt(tt.paint_circle["circle-blur"]),"circle-opacity":new Yt(tt.paint_circle["circle-opacity"]),"circle-translate":new bt(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(tt.paint_circle["circle-emissive-strength"])}),layout:tM};const iM=Q.create(),rM=(e,t,i,r,o,n)=>{const s=e.transform,a=s.projection.name==="globe";let l;if(n.paint.get("circle-pitch-alignment")==="map")if(a){const u=dx(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([u,0,0,u])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ce.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:iM,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:n.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=o,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=ar(s.zoom);const u=o[0]*at,p=o[1]*at;c.u_up_dir=s.projection.upVector(new To(0,0,0),u,p)}return c},zx=e=>{const t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Px(e,t,i,r,o,n,s,a,l){if(n&&e.queryGeometry.isAboveHorizon)return!1;n&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const p of t)for(const f of p){const g=f.add(a),_=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(g.x,g.y,!0):0,y=i.projection.projectTilePoint(g.x,g.y,c);if(_>0){const S=i.projection.upVector(c,g.x,g.y);y.x+=S[0]*u*_,y.y+=S[1]*u*_,y.z+=S[2]*u*_}const x=n?g:oM(y.x,y.y,y.z,r),b=n?e.tilespaceRays.map(S=>sM(S,_)):e.queryGeometry.screenGeometry,T=ei.transformMat4([],[y.x,y.y,y.z,1],r);if(!s&&n?l*=T[3]/i.cameraToCenterDistance:s&&!n&&(l*=i.cameraToCenterDistance/T[3]),n){const S=Hi((f.y/at+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(S,1)/ni(1,S)}if(YS(b,x,l))return!0}return!1}function oM(e,t,i,r){const o=ei.transformMat4([],[e,t,i,1],r);return new B(o[0]/o[3],o[1]/o[3])}const Rx=j.fromValues(0,0,0),nM=j.fromValues(0,0,1);function sM(e,t){const i=j.create();return Rx[2]=t,e.intersectsPlane(Rx,nM,i),new B(i[0],i[1])}class Lx extends pm{}function Ox(e,{width:t,height:i},r,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==t*i*r)throw new RangeError("mismatched image size")}else o=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=o,e}function Bx(e,t,i){const{width:r,height:o}=t;r===e.width&&o===e.height||(_m(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,o)},i),e.width=r,e.height=o,e.data=t.data)}function _m(e,t,i,r,o,n){if(o.width===0||o.height===0)return t;if(o.width>e.width||o.height>e.height||i.x>e.width-o.width||i.y>e.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>t.width||o.height>t.height||r.x>t.width-o.width||r.y>t.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<o.height;l++){const c=((i.y+l)*e.width+i.x)*n,u=((r.y+l)*t.width+r.x)*n;for(let p=0;p<o.width*n;p++)a[u+p]=s[c+p]}return t}jt(Lx,"HeatmapBucket",{omit:["layers"]});class Mn{constructor(t,i){Ox(this,t,1,i)}resize(t){Bx(this,new Mn(t),1)}clone(){return new Mn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,r,o,n){_m(t,i,r,o,n,1)}}class Ui{constructor(t,i){Ox(this,t,4,i)}resize(t){Bx(this,new Ui(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,r,o,n){_m(t,i,r,o,n,4)}}class Fx{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}jt(Mn,"AlphaImage"),jt(Ui,"RGBAImage");const aM=new Pi({visibility:new bt(tt.layout_heatmap.visibility)});var lM={paint:new Pi({"heatmap-radius":new Yt(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bl(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(tt.paint_heatmap["heatmap-opacity"])}),layout:aM};function Ju(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,o=e.image||new Ui({width:i,height:r}),n=(s,a,l)=>{t[e.evaluationKey]=l;const c=e.expression.evaluate(t);c&&(o.data[s+a+0]=Math.floor(255*c.r/c.a),o.data[s+a+1]=Math.floor(255*c.g/c.a),o.data[s+a+2]=Math.floor(255*c.b/c.a),o.data[s+a+3]=Math.floor(255*c.a))};if(e.clips)for(let s=0,a=0;s<r;++s,a+=4*i)for(let l=0,c=0;l<i;l++,c+=4){const u=l/(i-1),{start:p,end:f}=e.clips[s];n(a,c,p*(1-u)+f*u)}else for(let s=0,a=0;s<i;s++,a+=4)n(0,a,s/(i-1));return o}const cM=new Pi({visibility:new bt(tt.layout_hillshade.visibility)});var uM={paint:new Pi({"hillshade-illumination-direction":new bt(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(tt.paint_hillshade["hillshade-emissive-strength"])}),layout:cM};const hM=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:dM}=hM;var ym={exports:{}};function Ku(e,t,i){i=i||2;var r,o,n,s,a,l,c,u=t&&t.length,p=u?t[0]*i:e.length,f=Nx(e,0,p,i,!0),g=[];if(!f||f.next===f.prev)return g;if(u&&(f=function(y,x,b,T){var S,M,E,A=[];for(S=0,M=x.length;S<M;S++)(E=Nx(y,x[S]*T,S<M-1?x[S+1]*T:y.length,T,!1))===E.next&&(E.steiner=!0),A.push(vM(E));for(A.sort(_M),S=0;S<A.length;S++)b=yM(A[S],b);return b}(e,t,f,i)),e.length>80*i){r=n=e[0],o=s=e[1];for(var _=i;_<p;_+=i)(a=e[_])<r&&(r=a),(l=e[_+1])<o&&(o=l),a>n&&(n=a),l>s&&(s=l);c=(c=Math.max(n-r,s-o))!==0?32767/c:0}return Wl(f,g,i,r,o,c,0),g}function Nx(e,t,i,r,o){var n,s;if(o===bm(e,t,i,r)>0)for(n=t;n<i;n+=r)s=Ux(n,e[n],e[n+1],s);else for(n=i-r;n>=t;n-=r)s=Ux(n,e[n],e[n+1],s);return s&&Qu(s,s.next)&&(Yl(s),s=s.next),s}function Ns(e,t){if(!e)return e;t||(t=e);var i,r=e;do if(i=!1,r.steiner||!Qu(r,r.next)&&Ki(r.prev,r,r.next)!==0)r=r.next;else{if(Yl(r),(r=t=r.prev)===r.next)break;i=!0}while(i||r!==t);return t}function Wl(e,t,i,r,o,n,s){if(e){!s&&n&&function(u,p,f,g){var _=u;do _.z===0&&(_.z=xm(_.x,_.y,p,f,g)),_.prevZ=_.prev,_.nextZ=_.next,_=_.next;while(_!==u);_.prevZ.nextZ=null,_.prevZ=null,function(y){var x,b,T,S,M,E,A,I,z=1;do{for(b=y,y=null,M=null,E=0;b;){for(E++,T=b,A=0,x=0;x<z&&(A++,T=T.nextZ);x++);for(I=z;A>0||I>0&&T;)A!==0&&(I===0||!T||b.z<=T.z)?(S=b,b=b.nextZ,A--):(S=T,T=T.nextZ,I--),M?M.nextZ=S:y=S,S.prevZ=M,M=S;b=T}M.nextZ=null,z*=2}while(E>1)}(_)}(e,r,o,n);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,n?fM(e,r,o,n):pM(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Yl(e),e=l.next,c=l.next;else if((e=l)===c){s?s===1?Wl(e=mM(Ns(e),t,i),t,i,r,o,n,2):s===2&&gM(e,t,i,r,o,n):Wl(Ns(e),t,i,r,o,n,1);break}}}function pM(e){var t=e.prev,i=e,r=e.next;if(Ki(t,i,r)>=0)return!1;for(var o=t.x,n=i.x,s=r.x,a=t.y,l=i.y,c=r.y,u=o<n?o<s?o:s:n<s?n:s,p=a<l?a<c?a:c:l<c?l:c,f=o>n?o>s?o:s:n>s?n:s,g=a>l?a>c?a:c:l>c?l:c,_=r.next;_!==t;){if(_.x>=u&&_.x<=f&&_.y>=p&&_.y<=g&&Va(o,a,n,l,s,c,_.x,_.y)&&Ki(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function fM(e,t,i,r){var o=e.prev,n=e,s=e.next;if(Ki(o,n,s)>=0)return!1;for(var a=o.x,l=n.x,c=s.x,u=o.y,p=n.y,f=s.y,g=a<l?a<c?a:c:l<c?l:c,_=u<p?u<f?u:f:p<f?p:f,y=a>l?a>c?a:c:l>c?l:c,x=u>p?u>f?u:f:p>f?p:f,b=xm(g,_,t,i,r),T=xm(y,x,t,i,r),S=e.prevZ,M=e.nextZ;S&&S.z>=b&&M&&M.z<=T;){if(S.x>=g&&S.x<=y&&S.y>=_&&S.y<=x&&S!==o&&S!==s&&Va(a,u,l,p,c,f,S.x,S.y)&&Ki(S.prev,S,S.next)>=0||(S=S.prevZ,M.x>=g&&M.x<=y&&M.y>=_&&M.y<=x&&M!==o&&M!==s&&Va(a,u,l,p,c,f,M.x,M.y)&&Ki(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;S&&S.z>=b;){if(S.x>=g&&S.x<=y&&S.y>=_&&S.y<=x&&S!==o&&S!==s&&Va(a,u,l,p,c,f,S.x,S.y)&&Ki(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;M&&M.z<=T;){if(M.x>=g&&M.x<=y&&M.y>=_&&M.y<=x&&M!==o&&M!==s&&Va(a,u,l,p,c,f,M.x,M.y)&&Ki(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function mM(e,t,i){var r=e;do{var o=r.prev,n=r.next.next;!Qu(o,n)&&Vx(o,r,r.next,n)&&Xl(o,n)&&Xl(n,o)&&(t.push(o.i/i|0),t.push(r.i/i|0),t.push(n.i/i|0),Yl(r),Yl(r.next),r=e=n),r=r.next}while(r!==e);return Ns(r)}function gM(e,t,i,r,o,n){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&bM(s,a)){var l=jx(s,a);return s=Ns(s,s.next),l=Ns(l,l.next),Wl(s,t,i,r,o,n,0),void Wl(l,t,i,r,o,n,0)}a=a.next}s=s.next}while(s!==e)}function _M(e,t){return e.x-t.x}function yM(e,t){var i=function(o,n){var s,a=n,l=o.x,c=o.y,u=-1/0;do{if(c<=a.y&&c>=a.next.y&&a.next.y!==a.y){var p=a.x+(c-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(p<=l&&p>u&&(u=p,s=a.x<a.next.x?a:a.next,p===l))return s}a=a.next}while(a!==n);if(!s)return null;var f,g=s,_=s.x,y=s.y,x=1/0;a=s;do l>=a.x&&a.x>=_&&l!==a.x&&Va(c<y?l:u,c,_,y,c<y?u:l,c,a.x,a.y)&&(f=Math.abs(c-a.y)/(l-a.x),Xl(a,o)&&(f<x||f===x&&(a.x>s.x||a.x===s.x&&xM(s,a)))&&(s=a,x=f)),a=a.next;while(a!==g);return s}(e,t);if(!i)return t;var r=jx(i,e);return Ns(r,r.next),Ns(i,i.next)}function xM(e,t){return Ki(e.prev,e,t.prev)<0&&Ki(t.next,e,e.next)<0}function xm(e,t,i,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function vM(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Va(e,t,i,r,o,n,s,a){return(o-s)*(t-a)>=(e-s)*(n-a)&&(e-s)*(r-a)>=(i-s)*(t-a)&&(i-s)*(n-a)>=(o-s)*(r-a)}function bM(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,r){var o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==r.i&&o.next.i!==r.i&&Vx(o,o.next,i,r))return!0;o=o.next}while(o!==i);return!1}(e,t)&&(Xl(e,t)&&Xl(t,e)&&function(i,r){var o=i,n=!1,s=(i.x+r.x)/2,a=(i.y+r.y)/2;do o.y>a!=o.next.y>a&&o.next.y!==o.y&&s<(o.next.x-o.x)*(a-o.y)/(o.next.y-o.y)+o.x&&(n=!n),o=o.next;while(o!==i);return n}(e,t)&&(Ki(e.prev,e,t.prev)||Ki(e,t.prev,t))||Qu(e,t)&&Ki(e.prev,e,e.next)>0&&Ki(t.prev,t,t.next)>0)}function Ki(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Qu(e,t){return e.x===t.x&&e.y===t.y}function Vx(e,t,i,r){var o=eh(Ki(e,t,i)),n=eh(Ki(e,t,r)),s=eh(Ki(i,r,e)),a=eh(Ki(i,r,t));return o!==n&&s!==a||!(o!==0||!th(e,i,t))||!(n!==0||!th(e,r,t))||!(s!==0||!th(i,e,r))||!(a!==0||!th(i,t,r))}function th(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function eh(e){return e>0?1:e<0?-1:0}function Xl(e,t){return Ki(e.prev,e,e.next)<0?Ki(e,t,e.next)>=0&&Ki(e,e.prev,t)>=0:Ki(e,t,e.prev)<0||Ki(e,e.next,t)<0}function jx(e,t){var i=new vm(e.i,e.x,e.y),r=new vm(t.i,t.x,t.y),o=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=o,o.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function Ux(e,t,i,r){var o=new vm(e,t,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Yl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vm(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bm(e,t,i,r){for(var o=0,n=t,s=i-r;n<i;n+=r)o+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return o}ym.exports=Ku,ym.exports.default=Ku,Ku.deviation=function(e,t,i,r){var o=t&&t.length,n=Math.abs(bm(e,0,o?t[0]*i:e.length,i));if(o)for(var s=0,a=t.length;s<a;s++)n-=Math.abs(bm(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,p=r[s+2]*i;l+=Math.abs((e[c]-e[p])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[p+1]-e[c+1]))}return n===0&&l===0?0:Math.abs((l-n)/n)},Ku.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var n=0;n<e[o].length;n++)for(var s=0;s<t;s++)i.vertices.push(e[o][n][s]);o>0&&i.holes.push(r+=e[o-1].length)}return i};var ih=ke(ym.exports);function wm(e,t){const i=e.length;if(i<=1)return[e];const r=[];let o,n;for(let s=0;s<i;s++){const a=xt(e[s]);a!==0&&(e[s].area=Math.abs(a),n===void 0&&(n=a<0),n===a<0?(o&&r.push(o),o=[e[s]]):o.push(e[s]))}if(o&&r.push(o),t>1)for(let s=0;s<r.length;s++)r[s].length<=t||(o3(r[s],t,1,r[s].length-1,wM),r[s]=r[s].slice(0,t));return r}function wM(e,t){return t.area-e.area}function Tm(e,t,i){const r=i.patternDependencies;let o=!1;for(const n of t){const s=n.paint.get(`${e}-pattern`);s.isConstant()||(o=!0);const a=s.constantOr(null);a&&(o=!0,r[a]=!0)}return o}function Em(e,t,i,r,o){const n=o.patternDependencies;for(const s of t){const a=s.paint.get(`${e}-pattern`).value;if(a.kind!=="constant"){let l=a.evaluate({zoom:r},i,{},o.availableImages);l=l&&l.name?l.name:l,n[l]=!0,i.patterns[s.id]=l}}return i}class rh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zr,this.indexArray=new Zi,this.indexArray2=new Hn,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new ti,this.segments2=new ti,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,r,o){this.hasPattern=Tm("fill",this.layers,i);const n=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:a,id:l,index:c,sourceLayerIndex:u}of t){const p=this.layers[0]._featureFilter.needGeometry,f=is(a,p);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),f,r))continue;const g=n?n.evaluate(f,{},r,i.availableImages):void 0,_={id:l,properties:a.properties,type:a.type,sourceLayerIndex:u,index:c,geometry:p?f.geometry:Ko(a,r,o),patterns:{},sortKey:g};s.push(_)}n&&s.sort((a,l)=>a.sortKey-l.sortKey);for(const a of s){const{geometry:l,index:c,sourceLayerIndex:u}=a;if(this.hasPattern){const p=Em("fill",this.layers,a,this.zoom,i);this.patternFeatures.push(p)}else this.addFeature(a,l,c,r,{},i.availableImages,i.brightness);i.featureIndex.insert(t[c].feature,l,c,u,this.index)}}update(t,i,r,o,n){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,s?this.stateDependentLayers:this.layers,r,o,n)}addFeatures(t,i,r,o,n,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,i,r,o,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dM),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,r,o,n,s=[],a){for(const l of wm(i,500)){let c=0;for(const y of l)c+=y.length;const u=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray),p=u.vertexLength,f=[],g=[];for(const y of l){if(y.length===0)continue;y!==l[0]&&g.push(f.length/2);const x=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),b=x.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(b+y.length-1,b),f.push(y[0].x),f.push(y[0].y);for(let T=1;T<y.length;T++)this.layoutVertexArray.emplaceBack(y[T].x,y[T].y),this.indexArray2.emplaceBack(b+T-1,b+T),f.push(y[T].x),f.push(y[T].y);x.vertexLength+=y.length,x.primitiveLength+=y.length}const _=ih(f,g);for(let y=0;y<_.length;y+=3)this.indexArray.emplaceBack(p+_[y],p+_[y+1],p+_[y+2]);u.vertexLength+=c,u.primitiveLength+=_.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,s,o,a)}}jt(rh,"FillBucket",{omit:["layers","patternFeatures"]});const TM=new Pi({"fill-sort-key":new Yt(tt.layout_fill["fill-sort-key"]),visibility:new bt(tt.layout_fill.visibility)});var EM={paint:new Pi({"fill-antialias":new bt(tt.paint_fill["fill-antialias"]),"fill-opacity":new Yt(tt.paint_fill["fill-opacity"]),"fill-color":new Yt(tt.paint_fill["fill-color"]),"fill-outline-color":new Yt(tt.paint_fill["fill-outline-color"]),"fill-translate":new bt(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yt(tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new bt(tt.paint_fill["fill-emissive-strength"])}),layout:TM};const SM=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),MM=He([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AM=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),CM=He([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),IM=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:kM}=SM;var oh={},DM=yi,Gx=ja;function ja(e,t,i,r,o){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=o,e.readFields(zM,this,t)}function zM(e,t,i){e==1?t.id=i.readVarint():e==2?function(r,o){for(var n=r.readVarint()+r.pos;r.pos<n;){var s=o._keys[r.readVarint()],a=o._values[r.readVarint()];o.properties[s]=a}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function PM(e){for(var t,i,r=0,o=0,n=e.length,s=n-1;o<n;s=o++)r+=((i=e[s]).x-(t=e[o]).x)*(t.y+i.y);return r}ja.types=["Unknown","Point","LineString","Polygon"],ja.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,o=0,n=0,s=0,a=[];e.pos<i;){if(o<=0){var l=e.readVarint();r=7&l,o=l>>3}if(o--,r===1||r===2)n+=e.readSVarint(),s+=e.readSVarint(),r===1&&(t&&a.push(t),t=[]),t.push(new DM(n,s));else{if(r!==7)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&a.push(t),a},ja.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,o=0,n=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,i===1||i===2)(o+=e.readSVarint())<s&&(s=o),o>a&&(a=o),(n+=e.readSVarint())<l&&(l=n),n>c&&(c=n);else if(i!==7)throw new Error("unknown command "+i)}return[s,l,a,c]},ja.prototype.toGeoJSON=function(e,t,i){var r,o,n=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=ja.types[this.type];function u(g){for(var _=0;_<g.length;_++){var y=g[_];g[_]=[360*(y.x+s)/n-180,360/Math.PI*Math.atan(Math.exp((180-360*(y.y+a)/n)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<l.length;r++)p[r]=l[r][0];u(l=p);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(g){var _=g.length;if(_<=1)return[g];for(var y,x,b=[],T=0;T<_;T++){var S=PM(g[T]);S!==0&&(x===void 0&&(x=S<0),x===S<0?(y&&b.push(y),y=[g[T]]):y.push(g[T]))}return y&&b.push(y),b}(l),r=0;r<l.length;r++)for(o=0;o<l[r].length;o++)u(l[r][o])}l.length===1?l=l[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var RM=Gx,qx=$x;function $x(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(LM,this,t),this.length=this._features.length}function LM(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(r){for(var o=null,n=r.readVarint()+r.pos;r.pos<n;){var s=r.readVarint()>>3;o=s===1?r.readString():s===2?r.readFloat():s===3?r.readDouble():s===4?r.readVarint64():s===5?r.readVarint():s===6?r.readSVarint():s===7?r.readBoolean():null}return o}(i))}$x.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new RM(this._pbf,t,this.extent,this._keys,this._values)};var OM=qx;function BM(e,t,i){if(e===3){var r=new OM(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}var Sm=oh.VectorTile=function(e,t){this.layers=e.readFields(BM,{},t)},nh=oh.VectorTileFeature=Gx;function sh(e,t,i,r){const o=[],n=r===0?(s,a,l,c,u,p)=>{s.push(new B(p,l+(p-a)/(c-a)*(u-l)))}:(s,a,l,c,u,p)=>{s.push(new B(a+(p-l)/(u-l)*(c-a),p))};for(const s of e){const a=[];for(const l of s){if(l.length<=2)continue;const c=[];for(let f=0;f<l.length-1;f++){const g=l[f].x,_=l[f].y,y=l[f+1].x,x=l[f+1].y,b=r===0?g:_,T=r===0?y:x;b<t?T>t&&n(c,g,_,y,x,t):b>i?T<i&&n(c,g,_,y,x,i):c.push(l[f]),T<t&&b>=t&&n(c,g,_,y,x,t),T>i&&b<=i&&n(c,g,_,y,x,i)}let u=l[l.length-1];const p=r===0?u.x:u.y;p>=t&&p<=i&&c.push(u),c.length&&(u=c[c.length-1],c[0].x===u.x&&c[0].y===u.y||c.push(c[0]),a.push(c))}a.length&&o.push(a)}return o}oh.VectorTileLayer=qx;class Zx{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const r=t[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var FM={read:function(e,t,i,r,o){var n,s,a=8*o-r-1,l=(1<<a)-1,c=l>>1,u=-7,p=i?o-1:0,f=i?-1:1,g=e[t+p];for(p+=f,n=g&(1<<-u)-1,g>>=-u,u+=a;u>0;n=256*n+e[t+p],p+=f,u-=8);for(s=n&(1<<-u)-1,n>>=-u,u+=r;u>0;s=256*s+e[t+p],p+=f,u-=8);if(n===0)n=1-c;else{if(n===l)return s?NaN:1/0*(g?-1:1);s+=Math.pow(2,r),n-=c}return(g?-1:1)*s*Math.pow(2,n-r)},write:function(e,t,i,r,o,n){var s,a,l,c=8*n-o-1,u=(1<<c)-1,p=u>>1,f=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=r?0:n-1,_=r?1:-1,y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+p>=1?f/l:f*Math.pow(2,1-p))*l>=2&&(s++,l/=2),s+p>=u?(a=0,s=u):s+p>=1?(a=(t*l-1)*Math.pow(2,o),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,o),s=0));o>=8;e[i+g]=255&a,g+=_,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[i+g]=255&s,g+=_,s/=256,c-=8);e[i+g-_]|=128*y}},Hx=xi,ah=FM;function xi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}xi.Varint=0,xi.Fixed64=1,xi.Bytes=2,xi.Fixed32=5;var Mm=4294967296,Wx=1/Mm,Xx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function An(e){return e.type===xi.Bytes?e.readVarint()+e.pos:e.pos+1}function NM(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Yx(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var o=i.pos-1;o>=e;o--)i.buf[o+r]=i.buf[o]}function VM(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function jM(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function UM(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function GM(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function qM(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function $M(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function ZM(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function HM(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function WM(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function lh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Ua(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Jx(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}xi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),o=r>>3,n=this.pos;this.type=7&r,e(o,t,this),this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Jx(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lh(this.buf,this.pos)+lh(this.buf,this.pos+4)*Mm;return this.pos+=8,e},readSFixed64:function(){var e=lh(this.buf,this.pos)+Jx(this.buf,this.pos+4)*Mm;return this.pos+=8,e},readFloat:function(){var e=ah.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ah.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(o,n,s){var a,l,c=s.buf;if(a=(112&(l=c[s.pos++]))>>4,l<128||(a|=(127&(l=c[s.pos++]))<<3,l<128)||(a|=(127&(l=c[s.pos++]))<<10,l<128)||(a|=(127&(l=c[s.pos++]))<<17,l<128)||(a|=(127&(l=c[s.pos++]))<<24,l<128)||(a|=(1&(l=c[s.pos++]))<<31,l<128))return NM(o,a,n);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Xx?function(i,r,o){return Xx.decode(i.subarray(r,o))}(this.buf,t,e):function(i,r,o){for(var n="",s=r;s<o;){var a,l,c,u=i[s],p=null,f=u>239?4:u>223?3:u>191?2:1;if(s+f>o)break;f===1?u<128&&(p=u):f===2?(192&(a=i[s+1]))==128&&(p=(31&u)<<6|63&a)<=127&&(p=null):f===3?(l=i[s+2],(192&(a=i[s+1]))==128&&(192&l)==128&&((p=(15&u)<<12|(63&a)<<6|63&l)<=2047||p>=55296&&p<=57343)&&(p=null)):f===4&&(l=i[s+2],c=i[s+3],(192&(a=i[s+1]))==128&&(192&l)==128&&(192&c)==128&&((p=(15&u)<<18|(63&a)<<12|(63&l)<<6|63&c)<=65535||p>=1114112)&&(p=null)),p===null?(p=65533,f=1):p>65535&&(p-=65536,n+=String.fromCharCode(p>>>10&1023|55296),p=56320|1023&p),n+=String.fromCharCode(p),s+=f}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==xi.Bytes)return e.push(this.readVarint(t));var i=An(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==xi.Bytes)return e.push(this.readSVarint());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==xi.Bytes)return e.push(this.readBoolean());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==xi.Bytes)return e.push(this.readFloat());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==xi.Bytes)return e.push(this.readDouble());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==xi.Bytes)return e.push(this.readFixed32());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==xi.Bytes)return e.push(this.readSFixed32());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==xi.Bytes)return e.push(this.readFixed64());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==xi.Bytes)return e.push(this.readSFixed64());var t=An(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===xi.Varint)for(;this.buf[this.pos++]>127;);else if(t===xi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===xi.Fixed32)this.pos+=4;else{if(t!==xi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ua(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ua(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ua(this.buf,-1&e,this.pos),Ua(this.buf,Math.floor(e*Wx),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ua(this.buf,-1&e,this.pos),Ua(this.buf,Math.floor(e*Wx),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var r,o;if(t>=0?(r=t%4294967296|0,o=t/4294967296|0):(o=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,o=o+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(n,s,a){a.buf[a.pos++]=127&n|128,n>>>=7,a.buf[a.pos++]=127&n|128,n>>>=7,a.buf[a.pos++]=127&n|128,n>>>=7,a.buf[a.pos++]=127&n|128,a.buf[a.pos]=127&(n>>>=7)}(r,0,i),function(n,s){var a=(7&n)<<4;s.buf[s.pos++]|=a|((n>>>=3)?128:0),n&&(s.buf[s.pos++]=127&n|((n>>>=7)?128:0),n&&(s.buf[s.pos++]=127&n|((n>>>=7)?128:0),n&&(s.buf[s.pos++]=127&n|((n>>>=7)?128:0),n&&(s.buf[s.pos++]=127&n|((n>>>=7)?128:0),n&&(s.buf[s.pos++]=127&n)))))}(o,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(r,o,n){for(var s,a,l=0;l<o.length;l++){if((s=o.charCodeAt(l))>55295&&s<57344){if(!a){s>56319||l+1===o.length?(r[n++]=239,r[n++]=191,r[n++]=189):a=s;continue}if(s<56320){r[n++]=239,r[n++]=191,r[n++]=189,a=s;continue}s=a-55296<<10|s-56320|65536,a=null}else a&&(r[n++]=239,r[n++]=191,r[n++]=189,a=null);s<128?r[n++]=s:(s<2048?r[n++]=s>>6|192:(s<65536?r[n++]=s>>12|224:(r[n++]=s>>18|240,r[n++]=s>>12&63|128),r[n++]=s>>6&63|128),r[n++]=63&s|128)}return n}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Yx(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),ah.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ah.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&Yx(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,xi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,VM,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,jM,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,qM,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,UM,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,GM,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,$M,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,ZM,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,HM,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,WM,t)},writeBytesField:function(e,t){this.writeTag(e,xi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,xi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,xi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,xi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,xi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,xi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,xi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,xi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,xi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,xi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var ch=ke(Hx);const XM=["tile","layer","source","sourceLayer","state"];class Kx{constructor(t,i,r,o,n){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=r,this._y=o,this.properties=t.properties,this.id=n}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of XM)this[i]!==void 0&&(t[i]=this[i]);return t}}class YM{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,r){const o=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][o]=this.stateChanges[t][o]||{},Vt(this.stateChanges[t][o],r),this.deletedStates[t]===null){this.deletedStates[t]={};for(const n in this.state[t])n!==o&&(this.deletedStates[t][n]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][o]===null){this.deletedStates[t][o]={};for(const n in this.state[t][o])r[n]||(this.deletedStates[t][o][n]=null)}else for(const n in r)this.deletedStates[t]&&this.deletedStates[t][o]&&this.deletedStates[t][o][n]===null&&delete this.deletedStates[t][o][n]}removeFeatureState(t,i,r){if(this.deletedStates[t]===null)return;const o=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&i!==void 0)this.deletedStates[t][o]!==null&&(this.deletedStates[t][o]=this.deletedStates[t][o]||{},this.deletedStates[t][o][r]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][o])for(r in this.deletedStates[t][o]={},this.stateChanges[t][o])this.deletedStates[t][o][r]=null;else this.deletedStates[t][o]=null;else this.deletedStates[t]=null}getState(t,i){const r=String(i),o=Vt({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const n=this.deletedStates[t][i];if(n===null)return{};for(const s in n)delete o[s]}return o}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const r={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const n={};for(const s in this.stateChanges[o])this.state[o][s]||(this.state[o][s]={}),Vt(this.state[o][s],this.stateChanges[o][s]),n[s]=this.state[o][s];r[o]=n}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const n={};if(this.deletedStates[o]===null)for(const s in this.state[o])n[s]={},this.state[o][s]={};else for(const s in this.deletedStates[o]){if(this.deletedStates[o][s]===null)this.state[o][s]={};else if(this.state[o][s])for(const a of Object.keys(this.deletedStates[o][s]))delete this.state[o][s][a];n[s]=this.state[o][s]}r[o]=r[o]||{},Vt(r[o],n)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const o in t)t[o].setFeatureState(r,i)}}class Qx{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const r=this.toIdx(t,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function tv(e,t,i,r){let o=0,n=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<e[s]||i[s]>t[s])return null}else{const a=1/r[s];let l=(e[s]-i[s])*a,c=(t[s]-i[s])*a;if(l>c){const u=l;l=c,c=u}if(l>o&&(o=l),c<n&&(n=c),o>n)return null}return o}function ev(e,t,i,r,o,n,s,a,l,c,u){const p=r-e,f=o-t,g=n-i,_=s-e,y=a-t,x=l-i,b=u[1]*x-u[2]*y,T=u[2]*_-u[0]*x,S=u[0]*y-u[1]*_,M=p*b+f*T+g*S;if(Math.abs(M)<1e-15)return null;const E=1/M,A=c[0]-e,I=c[1]-t,z=c[2]-i,P=(A*b+I*T+z*S)*E;if(P<0||P>1)return null;const R=I*g-z*f,F=z*p-A*g,N=A*f-I*p,U=(u[0]*R+u[1]*F+u[2]*N)*E;return U<0||P+U>1?null:(_*R+y*F+x*N)*E}function iv(e,t,i){return(e-t)/(i-t)}function rv(e,t,i,r,o,n,s,a,l){const c=1<<i,u=n-r,p=s-o,f=(e+1)/c*u+r,g=(t+0)/c*p+o,_=(t+1)/c*p+o;a[0]=(e+0)/c*u+r,a[1]=g,l[0]=f,l[1]=_}class ov{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(n){const s=Math.ceil(Math.log2(n.dim/8)),a=[];let l=Math.ceil(Math.pow(2,s));const c=1/l,u=(g,_,y,x,b)=>{const T=x?1:0,S=(g+1)*y-T,M=_*y,E=(_+1)*y-T;b[0]=g*y,b[1]=M,b[2]=S,b[3]=E};let p=new Qx(l);const f=[];for(let g=0;g<l*l;g++){u(g%l,Math.floor(g/l),c,!1,f);const _=os(f[0],f[1],n),y=os(f[2],f[1],n),x=os(f[2],f[3],n),b=os(f[0],f[3],n);p.minimums.push(Math.min(_,y,x,b)),p.maximums.push(Math.max(_,y,x,b)),p.leaves.push(1)}for(a.push(p),l/=2;l>=1;l/=2){const g=a[a.length-1];p=new Qx(l);for(let _=0;_<l*l;_++){u(_%l,Math.floor(_/l),2,!0,f);const y=g.getElevation(f[0],f[1]),x=g.getElevation(f[2],f[1]),b=g.getElevation(f[2],f[3]),T=g.getElevation(f[0],f[3]),S=g.isLeaf(f[0],f[1]),M=g.isLeaf(f[2],f[1]),E=g.isLeaf(f[2],f[3]),A=g.isLeaf(f[0],f[3]),I=Math.min(y.min,x.min,b.min,T.min),z=Math.max(y.max,x.max,b.max,T.max),P=S&&M&&E&&A;p.maximums.push(z),p.minimums.push(I),p.leaves.push(z-I<=5&&P?1:0)}a.push(p)}return a}(this.dem),r=i.length-1,o=i[r];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(t,i,r,o,n,s,a=1){return tv([t,i,-100],[r,o,this.maximums[0]*a],n,s)}raycast(t,i,r,o,n,s,a=1){if(!this.nodeCount)return null;const l=this.raycastRoot(t,i,r,o,n,s,a);if(l==null)return null;const c=[],u=[],p=[],f=[],g=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;g.length>0;){const{idx:_,t:y,nodex:x,nodey:b,depth:T}=g.pop();if(this.leaves[_]){rv(x,b,T,t,i,r,o,p,f);const M=1<<T,E=(x+0)/M,A=(x+1)/M,I=(b+0)/M,z=(b+1)/M,P=os(E,I,this.dem)*a,R=os(A,I,this.dem)*a,F=os(A,z,this.dem)*a,N=os(E,z,this.dem)*a,U=ev(p[0],p[1],P,f[0],p[1],R,f[0],f[1],F,n,s),O=ev(f[0],f[1],F,p[0],f[1],N,p[0],p[1],P,n,s),Z=Math.min(U!==null?U:Number.MAX_VALUE,O!==null?O:Number.MAX_VALUE);if(Z!==Number.MAX_VALUE)return Z;{const W=j.scaleAndAdd([],n,s,y);if(nv(P,R,N,F,iv(W[0],p[0],f[0]),iv(W[1],p[1],f[1]))>=W[2])return y}continue}let S=0;for(let M=0;M<this._siblingOffset.length;M++){rv((x<<1)+this._siblingOffset[M][0],(b<<1)+this._siblingOffset[M][1],T+1,t,i,r,o,p,f),p[2]=-100,f[2]=this.maximums[this.childOffsets[_]+M]*a;const E=tv(p,f,n,s);if(E!=null){const A=E;c[M]=A;let I=!1;for(let z=0;z<S&&!I;z++)A>=c[u[z]]&&(u.splice(z,0,M),I=!0);I||(u[S]=M),S++}}for(let M=0;M<S;M++){const E=u[M];g.push({idx:this.childOffsets[_]+E,t:c[E],nodex:(x<<1)+this._siblingOffset[E][0],nodey:(b<<1)+this._siblingOffset[E][1],depth:T+1})}}return null}_addNode(t,i,r){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,r,o,n){if(t[o].isLeaf(i,r)===1)return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const s=o-1,a=t[s];let l=0,c=0;for(let u=0;u<this._siblingOffset.length;u++){const p=2*i+this._siblingOffset[u][0],f=2*r+this._siblingOffset[u][1],g=a.getElevation(p,f),_=a.isLeaf(p,f),y=this._addNode(g.min,g.max,_);_&&(l|=1<<u),c||(c=y)}for(let u=0;u<this._siblingOffset.length;u++)l&1<<u||this._construct(t,2*i+this._siblingOffset[u][0],2*r+this._siblingOffset[u][1],s,c+u)}}function nv(e,t,i,r,o,n){return ne(ne(e,i,n),ne(t,r,n),o)}function os(e,t,i){const r=i.dim,o=Ut(e*r-.5,0,r-1),n=Ut(t*r-.5,0,r-1),s=Math.floor(o),a=Math.floor(n),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return nv(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),o-s,n-a)}const JM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function KM(e,t,i){return(256*e*256+256*t+i)/10-1e4}function QM(e,t,i){return 256*e+t+i/256-32768}class uh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,r,o=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Y(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const n=this.dim=i.height-2,s=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=o,this._modifiedForSources={},!o){for(let l=0;l<n;l++)s[this._idx(-1,l)]=s[this._idx(0,l)],s[this._idx(n,l)]=s[this._idx(n-1,l)],s[this._idx(l,-1)]=s[this._idx(l,0)],s[this._idx(l,n)]=s[this._idx(l,n-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(n,-1)]=s[this._idx(n-1,0)],s[this._idx(-1,n)]=s[this._idx(0,n-1)],s[this._idx(n,n)]=s[this._idx(n-1,n-1)]}const a=r==="terrarium"?QM:KM;for(let l=0;l<s.length;++l){const c=4*l;this.floatView[l]=a(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}this._timestamp=ce.now()}_buildQuadTree(){this._tree=new ov(this)}get(t,i,r=!1){r&&(t=Ut(t,-1,this.dim),i=Ut(i,-1,this.dim));const o=this._idx(t,i);return this.floatView[o]}set(t,i,r){const o=this._idx(t,i),n=this.floatView[o];return this.floatView[o]=r,r-n}static getUnpackVector(t){return JM[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const r=[0,0,0,0],o=uh.getUnpackVector(i);let n=Math.floor((t+o[3])/o[2]);return r[2]=n%256,n=Math.floor(n/256),r[1]=n%256,n=Math.floor(n/256),r[0]=n,r}getPixels(){return new Fx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let o=i*this.dim,n=i*this.dim+this.dim,s=r*this.dim,a=r*this.dim+this.dim;switch(i){case-1:o=n-1;break;case 1:n=o+1}switch(r){case-1:s=a-1;break;case 1:a=s+1}const l=-i*this.dim,c=-r*this.dim;for(let u=s;u<a;u++)for(let p=o;p<n;p++){const f=4*this._idx(p,u),g=4*this._idx(p+l,u+c);this.pixels[f+0]=t.pixels[g+0],this.pixels[f+1]=t.pixels[g+1],this.pixels[f+2]=t.pixels[g+2],this.pixels[f+3]=t.pixels[g+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}jt(uh,"DEMData"),jt(ov,"DemMinMaxQuadTree",{omit:["dem"]});class tA{isDataAvailableAtPoint(t){const i=this._source();if(this.isUsingMockSource()||!i||t.y<0||t.y>1)return!1;const r=i.getSource().maxzoom,o=1<<r,n=Math.floor(t.x),s=Math.floor((t.x-n)*o),a=Math.floor(t.y*o),l=this.findDEMTileFor(new Ue(r,n,r,s,a));return!(!l||!l.dem)}getAtPointOrZero(t,i=0){return this.getAtPoint(t,i)||0}getAtPoint(t,i,r=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const o=this._source();if(!o||t.y<0||t.y>1)return i;const n=o.getSource().maxzoom,s=1<<n,a=Math.floor(t.x),l=t.x-a,c=new Ue(n,a,n,Math.floor(l*s),Math.floor(t.y*s)),u=this.findDEMTileFor(c);if(!u||!u.dem)return i;const p=u.dem,f=1<<u.tileID.canonical.z,g=(l*f-u.tileID.canonical.x)*p.dim,_=(t.y*f-u.tileID.canonical.y)*p.dim,y=Math.floor(g),x=Math.floor(_);return(r?this.exaggeration():1)*ne(ne(p.get(y,x),p.get(y,x+1),_-x),ne(p.get(y+1,x),p.get(y+1,x+1),_-x),g-y)}getAtTileOffset(t,i,r){const o=1<<t.canonical.z;return this.getAtPointOrZero(new De(t.wrap+(t.canonical.x+i/at)/o,(t.canonical.y+r/at)/o))}getAtTileOffsetFunc(t,i,r,o){return n=>{const s=this.getAtTileOffset(t,n.x,n.y),a=o.upVector(t.canonical,n.x,n.y),l=o.upVectorScale(t.canonical,i,r).metersToTile;return j.scale(a,a,s*l),a}}getForTilePoints(t,i,r,o){if(this.isUsingMockSource())return!1;const n=Ga.create(this,t,o);return!!n&&(i.forEach(s=>{s[2]=this.exaggeration()*n.getElevationAt(s[0],s[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(t);if(!i||!i.dem)return null;const r=i.dem.tree,o=i.tileID,n=1<<t.canonical.z-o.canonical.z;let s=t.canonical.x/n-o.canonical.x,a=t.canonical.y/n-o.canonical.y,l=0;for(let c=0;c<t.canonical.z-o.canonical.z&&!r.leaves[l];c++){s*=2,a*=2;const u=2*Math.floor(a)+Math.floor(s);l=r.childOffsets[l]+u,s%=1,a%=1}return{min:this.exaggeration()*r.minimums[l],max:this.exaggeration()*r.maximums[l]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,i,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let i=!1,r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const n of t){const s=this.getMinMaxForTile(n.tileID);s&&(r=Math.min(r,s.min),o=Math.max(o,s.max),i=!0)}return i?{min:r,max:o}:null}}class Ga{constructor(t,i,r){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(t,i,r){const o=r||t.findDEMTileFor(i);if(!o||!o.dem)return;const n=o.dem,s=o.tileID,a=1<<i.canonical.z-s.canonical.z;return new Ga(o,n.dim/at/a,[(i.canonical.x/a-s.canonical.x)*n.dim,(i.canonical.y/a-s.canonical.y)*n.dim])}tileCoordToPixel(t,i){const r=i*this._scale+this._offset[1],o=Math.floor(t*this._scale+this._offset[0]),n=Math.floor(r);return new B(o,n)}getElevationAt(t,i,r,o){const n=t*this._scale+this._offset[0],s=i*this._scale+this._offset[1],a=Math.floor(n),l=Math.floor(s),c=this._dem;return o=!!o,r?ne(ne(c.get(a,l,o),c.get(a,l+1,o),s-l),ne(c.get(a+1,l,o),c.get(a+1,l+1,o),s-l),n-a):c.get(a,l,o)}getElevationAtPixel(t,i,r){return this._dem.get(t,i,!!r)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ni(1,t)*this._dem.stride}}class Am{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ca(at,16,0),this.featureIndexArray=new Ly,this.promoteId=i}insert(t,i,r,o,n,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,o,n,s);const l=this.grid;for(let c=0;c<i.length;c++){const u=i[c],p=[1/0,1/0,-1/0,-1/0];for(let f=0;f<u.length;f++){const g=u[f];p[0]=Math.min(p[0],g.x),p[1]=Math.min(p[1],g.y),p[2]=Math.max(p[2],g.x),p[3]=Math.max(p[3],g.y)}p[0]<at&&p[1]<at&&p[2]>=0&&p[3]>=0&&l.insert(a,p[0],p[1],p[2],p[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sm(new ch(this.rawTileData)).layers,this.sourceLayerCoder=new Zx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,r,o){this.loadVTLayers();const n=t.params||{},s=wu(n.filter),a=t.tileResult,l=t.transform,c=a.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(_,y,x,b)=>Ix(a.bufferedTilespaceGeometry,_,y,x,b));u.sort(eA);let p=null;l.elevation&&u.length>0&&(p=Ga.create(l.elevation,this.tileID));const f={};let g;for(let _=0;_<u.length;_++){const y=u[_];if(y===g)continue;g=y;const x=this.featureIndexArray.get(y);let b=null;this.loadMatchingFeature(f,x,s,n.layers,n.availableImages,i,r,o,(T,S,M,E=0)=>(b||(b=Ko(T,this.tileID.canonical,t.tileTransform)),S.queryIntersectsFeature(a,T,M,b,this.z,t.transform,t.pixelPosMatrix,p,E)))}return f}loadMatchingFeature(t,i,r,o,n,s,a,l,c){const{featureIndex:u,bucketIndex:p,sourceLayerIndex:f,layoutVertexArrayOffset:g}=i,_=this.bucketLayerIDs[p];if(o&&!function(T,S){for(let M=0;M<T.length;M++)if(S.indexOf(T[M])>=0)return!0;return!1}(o,_))return;const y=this.sourceLayerCoder.decode(f),x=this.vtLayers[y].feature(u);if(r.needGeometry){const T=is(x,!0);if(!r.filter(new Ti(this.tileID.overscaledZ),T,this.tileID.canonical))return}else if(!r.filter(new Ti(this.tileID.overscaledZ),x))return;const b=this.getId(x,y);for(let T=0;T<_.length;T++){const S=_[T];if(o&&o.indexOf(S)<0)continue;const M=s[S];if(!M)continue;let E={};b!==void 0&&l&&(E=l.getState(M.sourceLayer||"_geojsonTileLayer",b));const A=Vt({},a[S]);A.paint=sv(A.paint,M.paint,x,E,n),A.layout=sv(A.layout,M.layout,x,E,n);const I=!c||c(x,M,E,g);if(!I)continue;const z=new Kx(x,this.z,this.x,this.y,b);z.layer=A;let P=t[S];P===void 0&&(P=t[S]=[]),P.push({featureIndex:u,feature:z,intersectionZ:I})}}lookupSymbolFeatures(t,i,r,o,n,s,a,l){const c={};this.loadVTLayers();const u=wu(n);for(const p of t)this.loadMatchingFeature(c,{bucketIndex:r,sourceLayerIndex:o,featureIndex:p,layoutVertexArrayOffset:0},u,s,a,l,i);return c}loadFeature(t){const{featureIndex:i,sourceLayerIndex:r}=t;this.loadVTLayers();const o=this.sourceLayerCoder.decode(r),n=this.vtFeatures[o];if(n[i])return n[i];const s=this.vtLayers[o].feature(i);return n[i]=s,s}hasLayer(t){for(const i of this.bucketLayerIDs)for(const r of i)if(t===r)return!0;return!1}getId(t,i){let r=t.id;if(this.promoteId){const o=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];o!=null&&(r=t.properties[o]),typeof r=="boolean"&&(r=Number(r))}return r}}function sv(e,t,i,r,o){return ha(e,(n,s)=>{const a=t instanceof Ol?t.get(s):null;return a&&a.evaluate?a.evaluate(i,r,o):a})}function eA(e,t){return t-e}jt(Am,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const iA=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rA=He([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),oA=He([{name:"a_projected_pos",components:4,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nA=He([{name:"a_z_offset",components:1,type:"Float32"}],4),sA=He([{name:"a_texb",components:2,type:"Uint16"}]),aA=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lA=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const av=He([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cA=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),He([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var lr=24;const Bo=128;function Cm(e,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ti(e+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:o}=i;let n=0;for(;n<r.length&&r[n]<=e;)n++;n=Math.max(0,n-1);let s=n;for(;s<r.length&&r[s]<e+1;)s++;s=Math.min(r.length-1,s);const a=r[n],l=r[s];return i.kind==="composite"?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:o}:{kind:"camera",minZoom:a,maxZoom:l,minSize:i.evaluate(new Ti(a)),maxSize:i.evaluate(new Ti(l)),interpolationType:o}}}function Jl(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:o}){return e.kind==="source"?r/Bo:e.kind==="composite"?ne(r/Bo,o/Bo,i):t}function Qo(e,t){let i=0,r=0;if(e.kind==="constant")r=e.layoutSize;else if(e.kind!=="source"){const{interpolationType:o,minZoom:n,maxZoom:s}=e,a=o?Ut(Wo.interpolationFactor(o,t,n,s),0,1):0;e.kind==="camera"?r=ne(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:r}}var uA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Bo,evaluateSizeForFeature:Jl,evaluateSizeForZoom:Qo,getSizeData:Cm});function hA(e,t,i){return e.sections.forEach(r=>{r.text=function(o,n,s){const a=n.layout.get("text-transform").evaluate(s,{});return a==="uppercase"?o=o.toLocaleUpperCase():a==="lowercase"&&(o=o.toLocaleLowerCase()),bo.applyArabicShaping&&(o=bo.applyArabicShaping(o)),o}(r.text,t,i)}),e}const Kl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dA(e){return e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""}function pA(e){return e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""}const Im=3;function fA(e,t,i){t.glyphs=[],e===1&&i.readMessage(mA,t)}function mA(e,t,i){if(e===3){const{id:r,bitmap:o,width:n,height:s,left:a,top:l,advance:c}=i.readMessage(gA,{});t.glyphs.push({id:r,bitmap:new Mn({width:n+2*Im,height:s+2*Im},o),metrics:{width:n,height:s,left:a,top:l,advance:c}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function gA(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}const lv=Im,vi={horizontal:1,vertical:2,horizontalOnly:3},cv=-17;class Ql{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const r=new Ql;return r.scale=t||1,r.fontStack=i,r}static forImage(t){const i=new Ql;return i.imageName=t,i}}class qa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const r=new qa;for(let o=0;o<t.sections.length;o++){const n=t.sections[o];n.image?r.addImageSection(n):r.addTextSection(n,i)}return r}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,r){let o="";for(let n=0;n<i.length;n++){const s=i.charCodeAt(n+1)||null,a=i.charCodeAt(n-1)||null;o+=!r&&(s&&yy(s)&&!Kl[i[n+1]]||a&&yy(a)&&!Kl[i[n-1]])||!Kl[i[n]]?i[n]:Kl[i[n]]}return o}(this.text,t)}trim(){let t=0;for(let r=0;r<this.text.length&&hh[this.text.charCodeAt(r)];r++)t++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=t&&hh[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const r=new qa;return r.text=this.text.substring(t,i),r.sectionIndex=this.sectionIndex.slice(t,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Ql.forText(t.scale,t.fontStack||i));const r=this.sections.length-1;for(let o=0;o<t.text.length;++o)this.sectionIndex.push(r)}addImageSection(t){const i=t.image?t.image.namePrimary:"";if(i.length===0)return void Y("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(Ql.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Y("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function km(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_){const y=qa.fromFeature(e,o);p===vi.vertical&&y.verticalizePunctuation(f);let x=[];const b=function(A,I,z,P,R,F){if(!A)return[];const N=[],U=function(K,$,H,it,ot,rt){let lt=0;for(let ut=0;ut<K.length();ut++){const pt=K.getSection(ut);lt+=uv(K.getCodePoint(ut),pt,it,ot,$,rt)}return lt/Math.max(1,Math.ceil(lt/H))}(A,I,z,P,R,F),O=A.text.indexOf("")>=0;let Z=0;for(let K=0;K<A.length();K++){const $=A.getSection(K),H=A.getCodePoint(K);if(hh[H]||(Z+=uv(H,$,P,R,I,F)),K<A.length()-1){const it=!((W=H)<11904||!(qt["Bopomofo Extended"](W)||qt.Bopomofo(W)||qt["CJK Compatibility Forms"](W)||qt["CJK Compatibility Ideographs"](W)||qt["CJK Compatibility"](W)||qt["CJK Radicals Supplement"](W)||qt["CJK Strokes"](W)||qt["CJK Symbols and Punctuation"](W)||qt["CJK Unified Ideographs Extension A"](W)||qt["CJK Unified Ideographs"](W)||qt["Enclosed CJK Letters and Months"](W)||qt["Halfwidth and Fullwidth Forms"](W)||qt.Hiragana(W)||qt["Ideographic Description Characters"](W)||qt["Kangxi Radicals"](W)||qt["Katakana Phonetic Extensions"](W)||qt.Katakana(W)||qt["Vertical Forms"](W)||qt["Yi Radicals"](W)||qt["Yi Syllables"](W)));(_A[H]||it||$.imageName)&&N.push(dv(K+1,Z,U,N,yA(H,A.getCodePoint(K+1),it&&O),!1))}}var W;return pv(dv(A.length(),Z,U,N,0,!0))}(y,c,n,t,r,g),{processBidirectionalText:T,processStyledBidirectionalText:S}=bo;if(T&&y.sections.length===1){const A=T(y.toString(),b);for(const I of A){const z=new qa;z.text=I,z.sections=y.sections;for(let P=0;P<I.length;P++)z.sectionIndex.push(0);x.push(z)}}else if(S){const A=S(y.text,y.sectionIndex,b);for(const I of A){const z=new qa;z.text=I[0],z.sectionIndex=I[1],z.sections=y.sections,x.push(z)}}else x=function(A,I){const z=[],P=A.text;let R=0;for(const F of I)z.push(A.substring(R,F)),R=F;return R<P.length&&z.push(A.substring(R,P.length)),z}(y,b);const M=[],E={positionedLines:M,text:y.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:p,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(A,I,z,P,R,F,N,U,O,Z,W,K){let $=0,H=0,it=0;const ot=U==="right"?1:U==="left"?0:.5;let rt=!1;for(const It of R){const kt=It.getSections();for(const Rt of kt){if(Rt.imageName)continue;const Ot=I[Rt.fontStack];if(Ot&&(rt=Ot.ascender!==void 0&&Ot.descender!==void 0,!rt))break}if(!rt)break}let lt=0;for(const It of R){It.trim();const kt=It.getMaxScale(),Rt=(kt-1)*lr,Ot={positionedGlyphs:[],lineOffset:0};A.positionedLines[lt]=Ot;const oe=Ot.positionedGlyphs;let $t=0;if(!It.length()){H+=F,++lt;continue}let Fe=0,Ae=0;for(let te=0;te<It.length();te++){const Xt=It.getSection(te),Ie=It.getSectionIndex(te),Re=It.getCodePoint(te);let ye=Xt.scale,si=null,Bi=null,ii=null,pi=lr,ji=0;const Fi=!(O===vi.horizontal||!W&&!uf(Re)||W&&(hh[Re]||(ut=Re,qt.Arabic(ut)||qt["Arabic Supplement"](ut)||qt["Arabic Extended-A"](ut)||qt["Arabic Presentation Forms-A"](ut)||qt["Arabic Presentation Forms-B"](ut))));if(Xt.imageName){const _i=P[Xt.imageName];if(!_i)continue;ii=Xt.imageName,A.iconsInText=A.iconsInText||!0,Bi=_i.paddedRect;const Je=_i.displaySize;ye=ye*lr/K,si={width:Je[0],height:Je[1],left:0,top:-lv,advance:Fi?Je[1]:Je[0],localGlyph:!1},ji=rt?-si.height*ye:cv+kt*lr-Je[1]*ye,pi=si.advance;const hr=(Fi?Je[0]:Je[1])*ye-lr*kt;hr>0&&hr>$t&&($t=hr)}else{const _i=z[Xt.fontStack];if(!_i)continue;_i[Re]&&(Bi=_i[Re]);const Je=I[Xt.fontStack];if(!Je)continue;const hr=Je.glyphs[Re];if(!hr)continue;if(si=hr.metrics,pi=Re!==8203?lr:0,rt){const sn=Je.ascender!==void 0?Math.abs(Je.ascender):0,In=Je.descender!==void 0?Math.abs(Je.descender):0,kn=(sn+In)*ye;Fe<kn&&(Fe=kn,Ae=(sn-In)/2*ye),ji=-sn*ye}else ji=cv+(kt-ye)*lr}Fi?(A.verticalizable=!0,oe.push({glyph:Re,imageName:ii,x:$,y:H+ji,vertical:Fi,scale:ye,localGlyph:si.localGlyph,fontStack:Xt.fontStack,sectionIndex:Ie,metrics:si,rect:Bi}),$+=pi*ye+Z):(oe.push({glyph:Re,imageName:ii,x:$,y:H+ji,vertical:Fi,scale:ye,localGlyph:si.localGlyph,fontStack:Xt.fontStack,sectionIndex:Ie,metrics:si,rect:Bi}),$+=si.advance*ye+Z)}oe.length!==0&&(it=Math.max($-Z,it),rt?fv(oe,ot,$t,Ae,F*kt/2):fv(oe,ot,$t,0,F/2)),$=0;const ie=F*kt+$t;Ot.lineOffset=Math.max($t,Rt),H+=ie,++lt}var ut;const pt=H,{horizontalAlign:nt,verticalAlign:mt}=dh(N);(function(It,kt,Rt,Ot,oe,$t){const Fe=(kt-Rt)*oe,Ae=-$t*Ot;for(const ie of It)for(const te of ie.positionedGlyphs)te.x+=Fe,te.y+=Ae})(A.positionedLines,ot,nt,mt,it,pt),A.top+=-mt*pt,A.bottom=A.top+pt,A.left+=-nt*it,A.right=A.left+it,A.hasBaseline=rt}(E,t,i,r,x,s,a,l,p,c,f,_),!function(A){for(const I of A)if(I.positionedGlyphs.length!==0)return!1;return!0}(M)&&E}const hh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_A={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function uv(e,t,i,r,o,n){if(t.imageName){const s=r[t.imageName];return s?s.displaySize[0]*t.scale*lr/n+o:0}{const s=i[t.fontStack],a=s&&s.glyphs[e];return a?a.metrics.advance*t.scale+o:0}}function hv(e,t,i,r){const o=Math.pow(e-t,2);return r?e<t?o/2:2*o:o+Math.abs(i)*i}function yA(e,t,i){let r=0;return e===10&&(r-=1e4),i&&(r+=150),e!==40&&e!==65288||(r+=50),t!==41&&t!==65289||(r+=50),r}function dv(e,t,i,r,o,n){let s=null,a=hv(t,i,o,n);for(const l of r){const c=hv(t-l.x,i,o,n)+l.badness;c<=a&&(s=l,a=c)}return{index:e,x:t,priorBreak:s,badness:a}}function pv(e){return e?pv(e.priorBreak).concat(e.index):[]}function dh(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function fv(e,t,i,r,o){if(!(t||i||r||o))return;const n=e.length-1,s=e[n],a=(s.x+s.metrics.advance*s.scale)*t;for(let l=0;l<=n;l++)e[l].x-=a,e[l].y+=i+r+o}function xA(e,t,i,r){const{horizontalAlign:o,verticalAlign:n}=dh(r),s=i[0]-e.displaySize[0]*o,a=i[1]-e.displaySize[1]*n;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function mv(e,t,i,r,o,n){const s=e.imagePrimary;let a;if(s.content){const x=s.content,b=s.pixelRatio||1;a=[x[0]/b,x[1]/b,s.displaySize[0]-x[2]/b,s.displaySize[1]-x[3]/b]}const l=t.left*n,c=t.right*n;let u,p,f,g;i==="width"||i==="both"?(g=o[0]+l-r[3],p=o[0]+c+r[1]):(g=o[0]+(l+c-s.displaySize[0])/2,p=g+s.displaySize[0]);const _=t.top*n,y=t.bottom*n;return i==="height"||i==="both"?(u=o[1]+_-r[0],f=o[1]+y+r[2]):(u=o[1]+(_+y-s.displaySize[1])/2,f=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:p,bottom:f,left:g,collisionPadding:a}}class Cn extends B{constructor(t,i,r,o,n){super(t,i),this.angle=o,this.z=r,n!==void 0&&(this.segment=n)}clone(){return new Cn(this.x,this.y,this.z,this.angle,this.segment)}}function gv(e,t,i,r,o){if(t.segment===void 0)return!0;let n=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(n),n=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const u=e[s],p=e[s+1];if(!p)return!1;let f=e[s-1].angleTo(u)-u.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:f}),c+=f;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>o)return!1;s++,a+=u.dist(p)}return!0}function _v(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function yv(e,t,i){return e?.6*t*i:0}function xv(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function vA(e,t,i,r,o,n){const s=yv(i,o,n),a=xv(i,r)*n;let l=0;const c=_v(e)/2;for(let u=0;u<e.length-1;u++){const p=e[u],f=e[u+1],g=p.dist(f);if(l+g>c){const _=(c-l)/g,y=ne(p.x,f.x,_),x=ne(p.y,f.y,_),b=new Cn(y,x,0,f.angleTo(p),u);return!s||gv(e,b,a,s,t)?b:void 0}l+=g}}function bA(e,t,i,r,o,n,s,a,l){const c=yv(r,n,s),u=xv(r,o),p=u*s,f=e[0].x===0||e[0].x===l||e[0].y===0||e[0].y===l;return t-p<t/4&&(t=p+t/4),vv(e,f?t/2*a%t:(u/2+2*n)*s*a%t,t,c,i,p,f,!1,l)}function vv(e,t,i,r,o,n,s,a,l){const c=n/2,u=_v(e);let p=0,f=t-i,g=[];for(let _=0;_<e.length-1;_++){const y=e[_],x=e[_+1],b=y.dist(x),T=x.angleTo(y);for(;f+i<p+b;){f+=i;const S=(f-p)/b,M=ne(y.x,x.x,S),E=ne(y.y,x.y,S);if(M>=0&&M<l&&E>=0&&E<l&&f-c>=0&&f+c<=u){const A=new Cn(M,E,0,T,_);r&&!gv(e,A,n,r,o)||g.push(A)}}p+=b}return a||g.length||s||(g=vv(e,p/2,i,r,o,n,s,!0,l)),g}function bv(e,t,i,r,o){const n=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let c=0;c<a.length-1;c++){let u=a[c],p=a[c+1];u.x<t&&p.x<t||(u.x<t?u=new B(t,u.y+(t-u.x)/(p.x-u.x)*(p.y-u.y))._round():p.x<t&&(p=new B(t,u.y+(t-u.x)/(p.x-u.x)*(p.y-u.y))._round()),u.y<i&&p.y<i||(u.y<i?u=new B(u.x+(i-u.y)/(p.y-u.y)*(p.x-u.x),i)._round():p.y<i&&(p=new B(u.x+(i-u.y)/(p.y-u.y)*(p.x-u.x),i)._round()),u.x>=r&&p.x>=r||(u.x>=r?u=new B(r,u.y+(r-u.x)/(p.x-u.x)*(p.y-u.y))._round():p.x>=r&&(p=new B(r,u.y+(r-u.x)/(p.x-u.x)*(p.y-u.y))._round()),u.y>=o&&p.y>=o||(u.y>=o?u=new B(u.x+(o-u.y)/(p.y-u.y)*(p.x-u.x),o)._round():p.y>=o&&(p=new B(u.x+(o-u.y)/(p.y-u.y)*(p.x-u.x),o)._round()),l&&u.equals(l[l.length-1])||(l=[u],n.push(l)),l.push(p)))))}}return n}function Dm(e){let t=0,i=0;for(const s of e)t+=s.w*s.h,i=Math.max(i,s.w);e.sort((s,a)=>a.h-s.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let o=0,n=0;for(const s of e)for(let a=r.length-1;a>=0;a--){const l=r[a];if(!(s.w>l.w||s.h>l.h)){if(s.x=l.x,s.y=l.y,n=Math.max(n,s.y+s.h),o=Math.max(o,s.x+s.w),s.w===l.w&&s.h===l.h){const c=r.pop();a<r.length&&(r[a]=c)}else s.h===l.h?(l.x+=s.w,l.w-=s.w):s.w===l.w?(l.y+=s.h,l.h-=s.h):(r.push({x:l.x+s.w,y:l.y,w:l.w-s.w,h:s.h}),l.y+=s.h,l.h-=s.h);break}}return{w:o,h:n,fill:t/(o*n)||0}}jt(Cn,"Anchor");const Yr=1;class zm{constructor(t,{pixelRatio:i,version:r,stretchX:o,stretchY:n,content:s}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=o,this.stretchY=n,this.content=s,this.version=r}get tl(){return[this.paddedRect.x+Yr,this.paddedRect.y+Yr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Yr,this.paddedRect.y+this.paddedRect.h-Yr]}get displaySize(){return[(this.paddedRect.w-2*Yr)/this.pixelRatio,(this.paddedRect.h-2*Yr)/this.pixelRatio]}}class wv{constructor(t,i){const r={},o={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,r,n),this.addImages(i,o,n);const{w:s,h:a}=Dm(n),l=new Ui({width:s||1,height:a||1});for(const c in t){const u=t[c],p=r[c].paddedRect;Ui.copy(u.data,l,{x:0,y:0},{x:p.x+Yr,y:p.y+Yr},u.data)}for(const c in i){const u=i[c],p=o[c].paddedRect,f=p.x+Yr,g=p.y+Yr,_=u.data.width,y=u.data.height;Ui.copy(u.data,l,{x:0,y:0},{x:f,y:g},u.data),Ui.copy(u.data,l,{x:0,y:y-1},{x:f,y:g-1},{width:_,height:1}),Ui.copy(u.data,l,{x:0,y:0},{x:f,y:g+y},{width:_,height:1}),Ui.copy(u.data,l,{x:_-1,y:0},{x:f-1,y:g},{width:1,height:y}),Ui.copy(u.data,l,{x:0,y:0},{x:f+_,y:g},{width:1,height:y})}this.image=l,this.iconPositions=r,this.patternPositions=o}addImages(t,i,r){for(const o in t){const n=t[o],s={x:0,y:0,w:n.data.width+2*Yr,h:n.data.height+2*Yr};r.push(s),i[o]=new zm(s,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(t,i,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>t.hasImage(o,r)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const o in t.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[o],t.getImage(o,r),i),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o,r),i)}patchUpdatedImage(t,i,r){if(!t||!i||t.version===i.version)return;t.version=i.version;const[o,n]=t.tl;r.update(i.data,void 0,{x:o,y:n})}}jt(zm,"ImagePosition"),jt(wv,"ImageAtlas");const tc=1e20;function Tv(e,t,i,r,o,n,s,a,l){for(let c=t;c<t+r;c++)Ev(e,i*n+c,n,o,s,a,l);for(let c=i;c<i+o;c++)Ev(e,c*n+t,1,r,s,a,l)}function Ev(e,t,i,r,o,n,s){n[0]=0,s[0]=-tc,s[1]=tc,o[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){o[a]=e[t+a*i];const u=a*a;do{const p=n[l];c=(o[a]-o[p]+u-p*p)/(a-p)/2}while(c<=s[l]&&--l>-1);l++,n[l]=a,s[l]=c,s[l+1]=tc}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const c=n[l],u=a-c;e[t+a*i]=o[c]+u*u}}const Fo=2;class $a{constructor(t,i,r){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,r){const o=[],n=this.urls[i]||X.GLYPHS_URL;for(const s in t)for(const a of t[s])o.push({stack:s,id:a});Do(o,({stack:s,id:a},l)=>{let c=this.entries[s];c||(c=this.entries[s]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let u=c.glyphs[a];if(u!==void 0)return void l(null,{stack:s,id:a,glyph:u});if(u=this._tinySDF(c,s,a),u)return c.glyphs[a]=u,void l(null,{stack:s,id:a,glyph:u});const p=Math.floor(a/256);if(256*p>65535)return void l(new Error("glyphs > 65535 not supported"));if(c.ranges[p])return void l(null,{stack:s,id:a,glyph:u});let f=c.requests[p];f||(f=c.requests[p]=[],$a.loadGlyphRange(s,p,n,this.requestManager,(g,_)=>{if(_){c.ascender=_.ascender,c.descender=_.descender;for(const y in _.glyphs)this._doesCharSupportLocalGlyph(+y)||(c.glyphs[+y]=_.glyphs[+y]);c.ranges[p]=!0}for(const y of f)y(g,_);delete c.requests[p]})),f.push((g,_)=>{g?l(g):_&&l(null,{stack:s,id:a,glyph:_.glyphs[a]||null})})},(s,a)=>{if(s)r(s);else if(a){const l={};for(const{stack:c,id:u,glyph:p}of a)l[c]===void 0&&(l[c]={}),l[c].glyphs===void 0&&(l[c].glyphs={}),l[c].glyphs[u]=p&&{id:p.id,bitmap:p.bitmap.clone(),metrics:p.metrics},l[c].ascender=this.entries[c].ascender,l[c].descender=this.entries[c].descender;r(null,l)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(qt["CJK Unified Ideographs"](t)||qt["Hangul Syllables"](t)||qt.Hiragana(t)||qt.Katakana(t)||qt["CJK Symbols and Punctuation"](t)||qt["CJK Unified Ideographs Extension A"](t)||qt["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,r){const o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(r))return;let n=t.tinySDF;if(!n){let y="400";/bold/i.test(i)?y="900":/medium/i.test(i)?y="500":/light/i.test(i)&&(y="200"),n=t.tinySDF=new $a.TinySDF({fontFamily:o,fontWeight:y,fontSize:24*Fo,buffer:3*Fo,radius:8*Fo}),n.fontWeight=y}if(this.localGlyphs[n.fontWeight][r])return this.localGlyphs[n.fontWeight][r];const s=String.fromCodePoint(r),{data:a,width:l,height:c,glyphWidth:u,glyphHeight:p,glyphLeft:f,glyphTop:g,glyphAdvance:_}=n.draw(s);return this.localGlyphs[n.fontWeight][r]={id:r,bitmap:new Mn({width:l,height:c},a),metrics:{width:u/Fo,height:p/Fo,left:f/Fo,top:g/Fo-27,advance:_/Fo,localGlyph:!0}}}}$a.loadGlyphRange=function(e,t,i,r,o){const n=256*t,s=n+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${n}-${s}`),ht.Glyphs);Dt(a,(l,c)=>{if(l)o(l);else if(c){const u={},p=function(f){return new ch(f).readFields(fA,{})}(c);for(const f of p.glyphs)u[f.id]=f;o(null,{glyphs:u,ascender:p.ascender,descender:p.descender})}})},$a.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:o="sans-serif",fontWeight:n="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${n} ${e}px ${o}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:o,actualBoundingBoxRight:n}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(n-o))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,p=Math.max(c*u,0),f=new Uint8ClampedArray(p),g={data:f,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(a===0||l===0)return g;const{ctx:_,buffer:y,gridInner:x,gridOuter:b}=this;_.clearRect(y,y,a,l),_.fillText(e,y,y+s);const T=_.getImageData(y,y,a,l);b.fill(tc,0,p),x.fill(0,0,p);for(let S=0;S<l;S++)for(let M=0;M<a;M++){const E=T.data[4*(S*a+M)+3]/255;if(E===0)continue;const A=(S+y)*c+M+y;if(E===1)b[A]=0,x[A]=tc;else{const I=.5-E;b[A]=I>0?I*I:0,x[A]=I<0?I*I:0}}Tv(b,0,0,c,u,c,this.f,this.v,this.z),Tv(x,y,y,a,l,c,this.f,this.v,this.z);for(let S=0;S<p;S++){const M=Math.sqrt(b[S])-Math.sqrt(x[S]);f[S]=Math.round(255-255*(M/this.radius+this.cutoff))}return g}};const ns=Yr;function Sv(e,t,i,r){const o=[],n=e.imagePrimary,s=n.pixelRatio,a=n.paddedRect.w-2*ns,l=n.paddedRect.h-2*ns,c=e.right-e.left,u=e.bottom-e.top,p=n.stretchX||[[0,a]],f=n.stretchY||[[0,l]],g=(F,N)=>F+N[1]-N[0],_=p.reduce(g,0),y=f.reduce(g,0),x=a-_,b=l-y;let T=0,S=_,M=0,E=y,A=0,I=x,z=0,P=b;if(n.content&&r){const F=n.content;T=ph(p,0,F[0]),M=ph(f,0,F[1]),S=ph(p,F[0],F[2]),E=ph(f,F[1],F[3]),A=F[0]-T,z=F[1]-M,I=F[2]-F[0]-S,P=F[3]-F[1]-E}const R=(F,N,U,O)=>{const Z=fh(F.stretch-T,S,c,e.left),W=mh(F.fixed-A,I,F.stretch,_),K=fh(N.stretch-M,E,u,e.top),$=mh(N.fixed-z,P,N.stretch,y),H=fh(U.stretch-T,S,c,e.left),it=mh(U.fixed-A,I,U.stretch,_),ot=fh(O.stretch-M,E,u,e.top),rt=mh(O.fixed-z,P,O.stretch,y),lt=new B(Z,K),ut=new B(H,K),pt=new B(H,ot),nt=new B(Z,ot),mt=new B(W/s,$/s),It=new B(it/s,rt/s),kt=t*Math.PI/180;if(kt){const Ae=Math.sin(kt),ie=Math.cos(kt),te=[ie,-Ae,Ae,ie];lt._matMult(te),ut._matMult(te),nt._matMult(te),pt._matMult(te)}const Rt=F.stretch+F.fixed,Ot=U.stretch+U.fixed,oe=N.stretch+N.fixed,$t=O.stretch+O.fixed,Fe=e.imageSecondary;return{tl:lt,tr:ut,bl:nt,br:pt,texPrimary:{x:n.paddedRect.x+ns+Rt,y:n.paddedRect.y+ns+oe,w:Ot-Rt,h:$t-oe},texSecondary:Fe?{x:Fe.paddedRect.x+ns+Rt,y:Fe.paddedRect.y+ns+oe,w:Ot-Rt,h:$t-oe}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mt,pixelOffsetBR:It,minFontScaleX:I/s/c,minFontScaleY:P/s/u,isSDF:i}};if(r&&(n.stretchX||n.stretchY)){const F=Mv(p,x,_),N=Mv(f,b,y);for(let U=0;U<F.length-1;U++){const O=F[U],Z=F[U+1];for(let W=0;W<N.length-1;W++)o.push(R(O,N[W],Z,N[W+1]))}}else o.push(R({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return o}function ph(e,t,i){let r=0;for(const o of e)r+=Math.max(t,Math.min(i,o[1]))-Math.max(t,Math.min(i,o[0]));return r}function Mv(e,t,i){const r=[{fixed:-ns,stretch:0}];for(const[o,n]of e){const s=r[r.length-1];r.push({fixed:o-s.stretch,stretch:s.stretch}),r.push({fixed:o-s.stretch,stretch:s.stretch+(n-o)})}return r.push({fixed:t+ns,stretch:i}),r}function fh(e,t,i,r){return e/t*i+r}function mh(e,t,i,r){return e-t*i/r}function wA(e,t,i,r){const o=t+e.positionedLines[r].lineOffset;return r===0?i+o/2:i+(o+(t+e.positionedLines[r-1].lineOffset))/2}function TA(e,t=1,i=!1){let r=1/0,o=1/0,n=-1/0,s=-1/0;const a=e[0];for(let g=0;g<a.length;g++){const _=a[g];(!g||_.x<r)&&(r=_.x),(!g||_.y<o)&&(o=_.y),(!g||_.x>n)&&(n=_.x),(!g||_.y>s)&&(s=_.y)}const l=Math.min(n-r,s-o);let c=l/2;const u=new Tp([],EA);if(l===0)return new B(r,o);for(let g=r;g<n;g+=l)for(let _=o;_<s;_+=l)u.push(new Za(g+c,_+c,c,e));let p=function(g){let _=0,y=0,x=0;const b=g[0];for(let T=0,S=b.length,M=S-1;T<S;M=T++){const E=b[T],A=b[M],I=E.x*A.y-A.x*E.y;y+=(E.x+A.x)*I,x+=(E.y+A.y)*I,_+=3*I}return new Za(y/_,x/_,0,g)}(e),f=u.length;for(;u.length;){const g=u.pop();(g.d>p.d||!p.d)&&(p=g,i&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,f)),g.max-p.d<=t||(c=g.h/2,u.push(new Za(g.p.x-c,g.p.y-c,c,e)),u.push(new Za(g.p.x+c,g.p.y-c,c,e)),u.push(new Za(g.p.x-c,g.p.y+c,c,e)),u.push(new Za(g.p.x+c,g.p.y+c,c,e)),f+=4)}return i&&(console.log(`num probes: ${f}`),console.log(`best distance: ${p.d}`)),p.p}function EA(e,t){return t.max-e.max}class Za{constructor(t,i,r,o){this.p=new B(t,i),this.h=r,this.d=function(n,s){let a=!1,l=1/0;for(let c=0;c<s.length;c++){const u=s[c];for(let p=0,f=u.length,g=f-1;p<f;g=p++){const _=u[p],y=u[g];_.y>n.y!=y.y>n.y&&n.x<(y.x-_.x)*(n.y-_.y)/(y.y-_.y)+_.x&&(a=!a),l=Math.min(l,Ax(n,_,y))}}return(a?1:-1)*Math.sqrt(l)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}}const Ha=7,Pm=Number.POSITIVE_INFINITY,SA=Math.sqrt(2);function Rm(e,[t,i]){let r=0,o=0;if(i===Pm){t<0&&(t=0);const n=t/SA;switch(e){case"top-right":case"top-left":o=n-Ha;break;case"bottom-right":case"bottom-left":o=-n+Ha;break;case"bottom":o=-t+Ha;break;case"top":o=t-Ha}switch(e){case"top-right":case"bottom-right":r=-n;break;case"top-left":case"bottom-left":r=n;break;case"left":r=t;break;case"right":r=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-Ha;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+Ha}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}}return[r,o]}function MA(e,t,i,r,o,n,s,a,l,c,u){e.createArrays(),e.tilePixelRatio=at/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const p=e.layers[0].layout,f=e.layers[0]._unevaluatedLayout._values,g={};if(e.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=e.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ti(b),a),f["text-size"].possiblyEvaluate(new Ti(T),a)]}if(e.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=e.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ti(b),a),f["icon-size"].possiblyEvaluate(new Ti(T),a)]}g.layoutTextSize=f["text-size"].possiblyEvaluate(new Ti(l+1),a),g.layoutIconSize=f["icon-size"].possiblyEvaluate(new Ti(l+1),a),g.textMaxSize=f["text-size"].possiblyEvaluate(new Ti(18),a);const _=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point",y=p.get("text-size");let x=!1;for(const b of e.features)if(b.icon&&b.icon.nameSecondary){x=!0;break}for(const b of e.features){const T=p.get("text-font").evaluate(b,{},a).join(","),S=y.evaluate(b,{},a),M=g.layoutTextSize.evaluate(b,{},a),E=(g.layoutIconSize.evaluate(b,{},a),{horizontal:{},vertical:void 0}),A=b.text;let I,z=[0,0];if(A){const F=A.toString(),N=p.get("text-letter-spacing").evaluate(b,{},a)*lr,U=p.get("text-line-height").evaluate(b,{},a)*lr,O=K3(F)?N:0,Z=p.get("text-anchor").evaluate(b,{},a),W=p.get("text-variable-anchor");if(!W){const ot=p.get("text-radial-offset").evaluate(b,{},a);z=ot?Rm(Z,[ot*lr,Pm]):p.get("text-offset").evaluate(b,{},a).map(rt=>rt*lr)}let K=_?"center":p.get("text-justify").evaluate(b,{},a);const $=p.get("symbol-placement")==="point",H=$?p.get("text-max-width").evaluate(b,{},a)*lr:1/0,it=ot=>{e.allowVerticalPlacement&&cf(F)&&(E.vertical=km(A,t,i,o,T,H,U,Z,ot,O,z,vi.vertical,!0,M,S))};if(!_&&W){const ot=K==="auto"?W.map(lt=>Lm(lt)):[K];let rt=!1;for(let lt=0;lt<ot.length;lt++){const ut=ot[lt];if(!E.horizontal[ut])if(rt)E.horizontal[ut]=E.horizontal[0];else{const pt=km(A,t,i,o,T,H,U,"center",ut,O,z,vi.horizontal,!1,M,S);pt&&(E.horizontal[ut]=pt,rt=pt.positionedLines.length===1)}}it("left")}else{if(K==="auto"&&(K=Lm(Z)),$||p.get("text-writing-mode").indexOf("horizontal")>=0||!cf(F)){const ot=km(A,t,i,o,T,H,U,Z,K,O,z,vi.horizontal,!1,M,S);ot&&(E.horizontal[K]=ot)}it($?"left":K)}}let P=!1;if(b.icon&&b.icon.namePrimary){const F=r[b.icon.namePrimary];F&&(I=xA(o[b.icon.namePrimary],b.icon.nameSecondary?o[b.icon.nameSecondary]:void 0,p.get("icon-offset").evaluate(b,{},a),p.get("icon-anchor").evaluate(b,{},a)),P=F.sdf,e.sdfIcons===void 0?e.sdfIcons=F.sdf:e.sdfIcons!==F.sdf&&Y("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==e.pixelRatio||p.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}const R=Cv(E.horizontal)||E.vertical;e.iconsInText||(e.iconsInText=!!R&&R.iconsInText),(R||I)&&AA(e,b,E,I,r,g,M,0,z,P,s,a,c,u,x)}n&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Lm(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function AA(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_){let y=n.textMaxSize.evaluate(t,{},p);y===void 0&&(y=s);const x=e.layers[0].layout,b=x.get("icon-offset").evaluate(t,{},p),T=Cv(i.horizontal)||i.vertical,S=f.name==="globe",M=lr,E=s/M,A=e.tilePixelRatio*y/M,I=(Z=e.overscaling,e.zoom>18&&Z>2&&(Z>>=1),Math.max(at/(512*Z),1)*x.get("symbol-spacing")),z=x.get("text-padding")*e.tilePixelRatio,P=x.get("icon-padding")*e.tilePixelRatio,R=Ft(x.get("text-max-angle")),F=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",N=x.get("icon-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",U=x.get("symbol-placement"),O=I/2;var Z;const W=x.get("icon-text-fit").evaluate(t,{},p),K=x.get("icon-text-fit-padding").evaluate(t,{},p),$=W!=="none";let H;e.hasAnyIconTextFit===!1&&$&&(e.hasAnyIconTextFit=!0),r&&$&&(e.allowVerticalPlacement&&i.vertical&&(H=mv(r,i.vertical,W,K,b,E)),T&&(r=mv(r,T,W,K,b,E)));const it=(ot,rt,lt)=>{if(rt.x<0||rt.x>=at||rt.y<0||rt.y>=at)return;let ut=null;if(S){const{x:pt,y:nt,z:mt}=f.projectTilePoint(rt.x,rt.y,lt);ut={anchor:new Cn(pt,nt,mt,0,void 0),up:f.upVector(lt,rt.x,rt.y)}}(function(pt,nt,mt,It,kt,Rt,Ot,oe,$t,Fe,Ae,ie,te,Xt,Ie,Re,ye,si,Bi,ii,pi,ji,Fi,_i,Je,hr,sn){const In=pt.addToLineVertexArray(nt,It);let kn,wc,Tc,ud,R2,L2,O2,B2=0,F2=0,N2=0,V2=0,Lg=-1,Og=-1;const an={};let j2=Rf("");const Ws=mt?mt.anchor:nt,Bg=$t.layout.get("icon-text-fit").evaluate(pi,{},Je)!=="none";let Fg=0,Ng=0;if($t._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fg,Ng]=$t.layout.get("text-offset").evaluate(pi,{},Je).map(Kr=>Kr*lr):(Fg=$t.layout.get("text-radial-offset").evaluate(pi,{},Je)*lr,Ng=Pm),pt.allowVerticalPlacement&&kt.vertical){const Kr=kt.vertical;if(Ie)L2=Om(Kr),oe&&(O2=Om(oe));else{const Qr=$t.layout.get("text-rotate").evaluate(pi,{},Je)+90;Tc=gh(Fe,Ws,nt,Ae,ie,te,Kr,Xt,Qr,Re),oe&&(ud=gh(Fe,Ws,nt,Ae,ie,te,oe,si,Qr))}}if(Rt){const Kr=$t.layout.get("icon-rotate").evaluate(pi,{},Je),Qr=Sv(Rt,Kr,Fi,Bg),ol=oe?Sv(oe,Kr,Fi,Bg):void 0;wc=gh(Fe,Ws,nt,Ae,ie,te,Rt,si,Kr),B2=4*Qr.length;const U2=pt.iconSizeData;let Xs=null;U2.kind==="source"?(Xs=[Bo*$t.layout.get("icon-size").evaluate(pi,{},Je)],Xs[0]>ss&&Y(`${pt.layerIds[0]}: Value for "icon-size" is >= ${ec}. Reduce your "icon-size".`)):U2.kind==="composite"&&(Xs=[Bo*ji.compositeIconSizes[0].evaluate(pi,{},Je),Bo*ji.compositeIconSizes[1].evaluate(pi,{},Je)],(Xs[0]>ss||Xs[1]>ss)&&Y(`${pt.layerIds[0]}: Value for "icon-size" is >= ${ec}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Qr,Xs,ii,Bi,pi,!1,mt,nt,In.lineStartIndex,In.lineLength,-1,_i,Je,hr,sn),Lg=pt.icon.placedSymbolArray.length-1,ol&&(F2=4*ol.length,pt.addSymbols(pt.icon,ol,Xs,ii,Bi,pi,vi.vertical,mt,nt,In.lineStartIndex,In.lineLength,-1,_i,Je,hr,sn),Og=pt.icon.placedSymbolArray.length-1)}for(const Kr in kt.horizontal){const Qr=kt.horizontal[Kr];kn||(j2=Rf(Qr.text),Ie?R2=Om(Qr):kn=gh(Fe,Ws,nt,Ae,ie,te,Qr,Xt,$t.layout.get("text-rotate").evaluate(pi,{},Je),Re));const ol=Qr.positionedLines.length===1;if(N2+=Av(pt,mt,nt,Qr,Ot,$t,Ie,pi,Re,In,kt.vertical?vi.horizontal:vi.horizontalOnly,ol?Object.keys(kt.horizontal):[Kr],an,Lg,ji,_i,Je,hr),ol)break}kt.vertical&&(V2+=Av(pt,mt,nt,kt.vertical,Ot,$t,Ie,pi,Re,In,vi.vertical,["vertical"],an,Og,ji,_i,Je,hr));let fs=-1;const Vg=(Kr,Qr)=>Kr?Math.max(Kr,Qr):Qr;fs=Vg(R2,fs),fs=Vg(L2,fs),fs=Vg(O2,fs);const h5=fs>-1?1:0;pt.glyphOffsetArray.length>=sc.MAX_GLYPHS&&Y("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pi.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,pi.sortKey),pt.symbolInstances.emplaceBack(nt.x,nt.y,Ws.x,Ws.y,Ws.z,an.right>=0?an.right:-1,an.center>=0?an.center:-1,an.left>=0?an.left:-1,an.vertical>=0?an.vertical:-1,Lg,Og,j2,kn!==void 0?kn:pt.collisionBoxArray.length,kn!==void 0?kn+1:pt.collisionBoxArray.length,Tc!==void 0?Tc:pt.collisionBoxArray.length,Tc!==void 0?Tc+1:pt.collisionBoxArray.length,wc!==void 0?wc:pt.collisionBoxArray.length,wc!==void 0?wc+1:pt.collisionBoxArray.length,ud||pt.collisionBoxArray.length,ud?ud+1:pt.collisionBoxArray.length,Ae,N2,V2,B2,F2,h5,0,Fg,Ng,fs,0,Bg?1:0)})(e,rt,ut,ot,i,r,o,H,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,z,F,l,0,P,N,b,t,n,c,u,p,g,_)};if(U==="line")for(const ot of bv(t.geometry,0,0,at,at)){const rt=bA(ot,I,R,i.vertical||T,r,M,A,e.overscaling,at);for(const lt of rt)T&&CA(e,T.text,O,lt)||it(ot,lt,p)}else if(U==="line-center"){for(const ot of t.geometry)if(ot.length>1){const rt=vA(ot,R,i.vertical||T,r,M,A);rt&&it(ot,rt,p)}}else if(t.type==="Polygon")for(const ot of wm(t.geometry,0)){const rt=TA(ot,16);it(ot[0],new Cn(rt.x,rt.y,0,0,void 0),p)}else if(t.type==="LineString")for(const ot of t.geometry)it(ot,new Cn(ot[0].x,ot[0].y,0,0,void 0),p);else if(t.type==="Point")for(const ot of t.geometry)for(const rt of ot)it([rt],new Cn(rt.x,rt.y,0,0,void 0),p)}const ec=255,ss=ec*Bo;function Av(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b){const T=function(E,A,I,z,P,R,F,N){const U=[];if(A.positionedLines.length===0)return U;const O=z.layout.get("text-rotate").evaluate(R,{})*Math.PI/180,Z=function(it){const ot=it[0],rt=it[1],lt=ot*rt;return lt>0?[ot,-rt]:lt<0?[-ot,rt]:ot===0?[rt,ot]:[rt,-ot]}(I);let W=Math.abs(A.top-A.bottom);for(const it of A.positionedLines)W-=it.lineOffset;const K=A.positionedLines.length,$=W/K;let H=A.top-I[1];for(let it=0;it<K;++it){const ot=A.positionedLines[it];H=wA(A,$,H,it);for(const rt of ot.positionedGlyphs){if(!rt.rect)continue;const lt=rt.rect||{};let ut=lv+1,pt=!0,nt=1,mt=0;if(rt.imageName){const ii=F[rt.imageName];if(!ii)continue;if(ii.sdf){Y("SDF images are not supported in formatted text and will be ignored.");continue}pt=!1,nt=ii.pixelRatio,ut=Yr/nt}const It=(P||N)&&rt.vertical,kt=rt.metrics.advance*rt.scale/2,Rt=rt.metrics,Ot=rt.rect;if(Ot===null)continue;N&&A.verticalizable&&(mt=rt.imageName?kt-rt.metrics.width*rt.scale/2:0);const oe=P?[rt.x+kt,rt.y]:[0,0];let $t=[0,0],Fe=[0,0],Ae=!1;P||(It?(Fe=[rt.x+kt+Z[0],rt.y+Z[1]-mt],Ae=!0):$t=[rt.x+kt+I[0],rt.y+I[1]-mt]);const ie=Ot.w*rt.scale/(nt*(rt.localGlyph?Fo:1)),te=Ot.h*rt.scale/(nt*(rt.localGlyph?Fo:1));let Xt,Ie,Re,ye;if(It){const ii=rt.y-H,pi=new B(-kt,kt-ii),ji=-Math.PI/2,Fi=new B(...Fe);Xt=new B(-kt+$t[0],$t[1]),Xt._rotateAround(ji,pi)._add(Fi),Xt.x+=-ii+kt,Xt.y-=(Rt.left-ut)*rt.scale;const _i=rt.imageName?Rt.advance*rt.scale:lr*rt.scale,Je=String.fromCodePoint(rt.glyph);dA(Je)?Xt.x+=(1-ut)*rt.scale:pA(Je)?Xt.x+=_i-Rt.height*rt.scale+(-ut-1)*rt.scale:Xt.x+=rt.imageName||Rt.width+2*ut===Ot.w&&Rt.height+2*ut===Ot.h?(_i-te)/2:(_i-(Rt.height+2*ut)*rt.scale)/2,Ie=new B(Xt.x,Xt.y-ie),Re=new B(Xt.x+te,Xt.y),ye=new B(Xt.x+te,Xt.y-ie)}else{const ii=(Rt.left-ut)*rt.scale-kt+$t[0],pi=(-Rt.top-ut)*rt.scale+$t[1],ji=ii+ie,Fi=pi+te;Xt=new B(ii,pi),Ie=new B(ji,pi),Re=new B(ii,Fi),ye=new B(ji,Fi)}if(O){let ii;ii=P?new B(0,0):Ae?new B(Z[0],Z[1]):new B(I[0],I[1]),Xt._rotateAround(O,ii),Ie._rotateAround(O,ii),Re._rotateAround(O,ii),ye._rotateAround(O,ii)}const si=new B(0,0),Bi=new B(0,0);U.push({tl:Xt,tr:Ie,bl:Re,br:ye,texPrimary:lt,texSecondary:void 0,writingMode:A.writingMode,glyphOffset:oe,sectionIndex:rt.sectionIndex,isSDF:pt,pixelOffsetTL:si,pixelOffsetBR:Bi,minFontScaleX:0,minFontScaleY:0})}}return U}(0,r,l,n,s,a,o,e.allowVerticalPlacement),S=e.textSizeData;let M=null;S.kind==="source"?(M=[Bo*n.layout.get("text-size").evaluate(a,{},x)],M[0]>ss&&Y(`${e.layerIds[0]}: Value for "text-size" is >= ${ec}. Reduce your "text-size".`)):S.kind==="composite"&&(M=[Bo*_.compositeTextSizes[0].evaluate(a,{},x),Bo*_.compositeTextSizes[1].evaluate(a,{},x)],(M[0]>ss||M[1]>ss)&&Y(`${e.layerIds[0]}: Value for "text-size" is >= ${ec}. Reduce your "text-size".`)),e.addSymbols(e.text,T,M,l,s,a,u,t,i,c.lineStartIndex,c.lineLength,g,y,x,b,!1);for(const E of p)f[E]=e.text.placedSymbolArray.length-1;return 4*T.length}function Cv(e){for(const t in e)return e[t];return null}function gh(e,t,i,r,o,n,s,a,l,c){let u=s.top,p=s.bottom,f=s.left,g=s.right;const _=s.collisionPadding;if(_&&(f-=_[0],u-=_[1],g+=_[2],p+=_[3]),l){const y=new B(f,u),x=new B(g,u),b=new B(f,p),T=new B(g,p),S=Ft(l);let M=new B(0,0);c&&(M=new B(c[0],c[1])),y._rotateAround(S,M),x._rotateAround(S,M),b._rotateAround(S,M),T._rotateAround(S,M),f=Math.min(y.x,x.x,b.x,T.x),g=Math.max(y.x,x.x,b.x,T.x),u=Math.min(y.y,x.y,b.y,T.y),p=Math.max(y.y,x.y,b.y,T.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,f,u,g,p,a,r,o,n),e.length-1}function Om(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function CA(e,t,i,r){const o=e.compareText;if(t in o){const n=o[t];for(let s=n.length-1;s>=0;s--)if(r.dist(n[s])<i)return!0}else o[t]=[];return o[t].push(r),!1}function Iv(e,t){const i=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,o=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),n=Math.sin(i)*o/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),s=Math.sin(e._pitch)*n+o;return Math.min(1.01*s,o*(1/e._horizonShift))}function Vs(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),r=e.x*i,o=(e.x+1)*i,n=e.y*i,s=(e.y+1)*i,a=Xr(r),l=Xr(o),c=Hi(n),u=Hi(s),p=t.project(a,c),f=t.project(l,c),g=t.project(l,u),_=t.project(a,u);let y=Math.min(p.x,f.x,g.x,_.x),x=Math.min(p.y,f.y,g.y,_.y),b=Math.max(p.x,f.x,g.x,_.x),T=Math.max(p.y,f.y,g.y,_.y);const S=i/16;function M(A,I,z,P,R,F){const N=(z+R)/2,U=(P+F)/2,O=t.project(Xr(N),Hi(U)),Z=Math.max(0,y-O.x,x-O.y,O.x-b,O.y-T);y=Math.min(y,O.x),b=Math.max(b,O.x),x=Math.min(x,O.y),T=Math.max(T,O.y),Z>S&&(M(A,O,z,P,N,U),M(O,I,N,U,R,F))}M(p,f,r,n,o,n),M(f,g,o,n,o,s),M(g,_,o,s,r,s),M(_,p,r,s,r,n),y-=S,x-=S,b+=S,T+=S;const E=1/Math.max(b-y,T-x);return{scale:E,x:y*E,y:x*E,x2:b*E,y2:T*E,projection:t}}function kv(e,t,i,r,o,n,s,a,l){if(l.name==="globe")return om(e,t,new To(i,r,o),!1);const c=Vs({z:i,x:r,y:o},l);return new di([(n+c.x/c.scale)*t,t*(c.y/c.scale),s],[(n+c.x2/c.scale)*t,t*(c.y2/c.scale),a])}function Dv(e,{x:t,y:i},r=0){return new B(((t-r)*e.scale-e.x)*at,(i*e.scale-e.y)*at)}function zv(e,t,i=0){return j.fromValues(((t.x-i)*e.scale-e.x)*at,(t.y*e.scale-e.y)*at,bx(t.z,t.y))}const IA=Q.identity(new Float32Array(16));class as{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new se(0,0)}projectTilePoint(t,i,r){return{x:t,y:i,z:0}}locationPoint(t,i,r=!0){return t._coordinatePoint(t.locationCoordinate(i),r)}pixelsPerMeter(t,i){return ni(1,t)*i}pixelSpaceConversion(t,i,r){return 1}farthestPixelDistance(t){return Iv(t,t.pixelsPerMeter)}pointCoordinate(t,i,r,o){const n=t.horizonLineFromTop(!1),s=new B(i,Math.max(n,r));return t.rayIntersectionCoordinate(t.pointRayIntersection(s,o))}pointCoordinate3D(t,i,r){const o=new B(i,r);if(t.elevation)return t.elevation.pointCoordinate(o);{const n=this.pointCoordinate(t,o.x,o.y,0);return[n.x,n.y,n.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const r=t.horizonLineFromTop();return i.y<r}createInversionMatrix(t,i){return IA}createTileMatrix(t,i,r){let o,n,s;const a=r.canonical,l=Q.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Vs(a,this);o=1,n=c.x+r.wrap*c.scale,s=c.y,Q.scale(l,l,[o/c.scale,o/c.scale,t.pixelsPerMeter/i])}else o=i/t.zoomScale(a.z),n=(a.x+Math.pow(2,a.z)*r.wrap)*o,s=a.y*o;return Q.translate(l,l,[n,s,0]),Q.scale(l,l,[o/at,o/at,1]),l}upVector(t,i,r){return[0,0,1]}upVectorScale(t,i,r){return{metersToTile:1}}}class kA extends as{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,r]=this.parallels=t.parallels||[29.5,45.5],o=Math.sin(Ft(i));this.n=(o+Math.sin(Ft(r)))/2,this.c=1+o*(2*this.n-o),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:r,c:o,r0:n}=this,s=Ft(t-this.center[0]),a=Ft(i),l=Math.sqrt(o-2*r*Math.sin(a))/r;return{x:l*Math.sin(s*r),y:l*Math.cos(s*r)-n,z:0}}unproject(t,i){const{n:r,c:o,r0:n}=this,s=n+i;let a=Math.atan2(t,Math.abs(s))*Math.sign(s);s*r<0&&(a-=Math.PI*Math.sign(t)*Math.sign(s));const l=Ft(this.center[0])*r;a=Nr(a,-Math.PI-l,Math.PI-l);const c=Ut(Te(a/r)+this.center[0],-180,180),u=Math.asin(Ut((o-(t*t+s*s)*r*r)/(2*r),-1,1)),p=Ut(Te(u),-Oi,Oi);return new se(c,p)}}const ic=1.340264,rc=-.081106,oc=893e-6,nc=.003796,_h=Math.sqrt(3)/2;class DA extends as{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(_h*Math.sin(i)),o=r*r,n=o*o*o;return{x:.5*(t*Math.cos(r)/(_h*(ic+3*rc*o+n*(7*oc+9*nc*o)))/Math.PI+.5),y:1-.5*(r*(ic+rc*o+n*(oc+nc*o))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,o=r*r,n=o*o*o;for(let u,p,f,g=0;g<12&&(p=r*(ic+rc*o+n*(oc+nc*o))-i,f=ic+3*rc*o+n*(7*oc+9*nc*o),u=p/f,r=Ut(r-u,-Math.PI/3,Math.PI/3),o=r*r,n=o*o*o,!(Math.abs(u)<1e-12));++g);const s=_h*t*(ic+3*rc*o+n*(7*oc+9*nc*o))/Math.cos(r),a=Math.asin(Math.sin(r)/_h),l=Ut(180*s/Math.PI,-180,180),c=Ut(180*a/Math.PI,-Oi,Oi);return new se(l,c)}}class zA extends as{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const r=360*(t-.5),o=Ut(360*(.5-i),-Oi,Oi);return new se(r,o)}}const Wa=Math.PI/2;function yh(e){return Math.tan((Wa+e)/2)}class PA extends as{constructor(t){super(t),this.center=t.center||[0,30];const[i,r]=this.parallels=t.parallels||[30,30];let o=Ft(i),n=Ft(r);this.southernCenter=o+n<0,this.southernCenter&&(o=-o,n=-n);const s=Math.cos(o),a=yh(o);this.n=o===n?Math.sin(o):Math.log(s/Math.cos(n))/Math.log(yh(n)/a),this.f=s*Math.pow(yh(o),this.n)/this.n}project(t,i){i=Ft(i),this.southernCenter&&(i=-i),t=Ft(t-this.center[0]);const r=1e-6,{n:o,f:n}=this;n>0?i<-Wa+r&&(i=-Wa+r):i>Wa-r&&(i=Wa-r);const s=n/Math.pow(yh(i),o);let a=s*Math.sin(o*t),l=n-s*Math.cos(o*t);return a=.5*(a/Math.PI+.5),l=.5*(l/Math.PI+.5),{x:a,y:this.southernCenter?l:1-l,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:o}=this,n=o-i,s=Math.sign(n),a=Math.sign(r)*Math.sqrt(t*t+n*n);let l=Math.atan2(t,Math.abs(n))*s;n*r<0&&(l-=Math.PI*Math.sign(t)*s);const c=Ut(Te(l/r)+this.center[0],-180,180),u=Ut(Te(2*Math.atan(Math.pow(o/a,1/r))-Wa),-Oi,Oi);return new se(c,this.southernCenter?-u:u)}}class Pv extends as{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Ji(t),y:Qi(i),z:0}}unproject(t,i){const r=Xr(t),o=Hi(i);return new se(r,o)}}const Rv=Ft(Oi);class RA extends as{project(t,i){const r=(i=Ft(i))*i,o=r*r;return{x:.5*((t=Ft(t))*(.8707-.131979*r+o*(o*(.003971*r-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+o*(.028874*r-.044475-.005916*o)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,o=25,n=0,s=r*r;do{s=r*r;const c=s*s;n=(r*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))-i)/(1.007226+s*(.045255+c*(.259866*s-.311325-.005916*11*c))),r=Ut(r-n,-Rv,Rv)}while(Math.abs(n)>1e-6&&--o>0);s=r*r;const a=Ut(Te(t/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),l=Te(r);return new se(a,l)}}const Lv=Ft(Oi);class LA extends as{project(t,i){i=Ft(i),t=Ft(t);const r=Math.cos(i),o=2/Math.PI,n=Math.acos(r*Math.cos(t/2)),s=Math.sin(n)/n,a=.5*(t*o+2*r*Math.sin(t/2)/s)||0,l=.5*(i+Math.sin(i)/s)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(l/Math.PI+1),z:0}}unproject(t,i){let r=t=(2*t-.5)*Math.PI,o=i=(2*(1-i)-1)*Math.PI,n=25;const s=1e-6;let a=0,l=0;do{const c=Math.cos(o),u=Math.sin(o),p=2*u*c,f=u*u,g=c*c,_=Math.cos(r/2),y=Math.sin(r/2),x=2*_*y,b=y*y,T=1-g*_*_,S=T?1/T:0,M=T?Math.acos(c*_)*Math.sqrt(1/T):0,E=.5*(2*M*c*y+2*r/Math.PI)-t,A=.5*(M*u+o)-i,I=.5*S*(g*b+M*c*_*f)+1/Math.PI,z=S*(x*p/4-M*u*y),P=.125*S*(p*y-M*u*g*x),R=.5*S*(f*_+M*b*c)+.5,F=z*P-R*I;a=(A*z-E*R)/F,l=(E*P-A*I)/F,r=Ut(r-a,-Math.PI,Math.PI),o=Ut(o-l,-Lv,Lv)}while((Math.abs(a)>s||Math.abs(l)>s)&&--n>0);return new se(Te(r),Te(o))}}class Ov extends as{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:r,cosPhi:o}=this;return{x:Ft(t)*o*r+.5,y:-Math.sin(Ft(i))/o*r+.5,z:0}}unproject(t,i){const{scale:r,cosPhi:o}=this,n=-(i-.5)/r,s=Ut(Te((t-.5)/r)/o,-180,180),a=Math.asin(Ut(n*o,-1,1)),l=Ut(Te(a),-Oi,Oi);return new se(s,l)}}class OA extends Pv{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,r){const o=Zl(t,i,r),n=Qn(lo(r));return j.transformMat4(o,o,n),{x:o[0],y:o[1],z:o[2]}}locationPoint(t,i){const r=Or(i.lat,i.lng),o=j.normalize([],r),n=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,s=ni(1,0)*at*n;j.scaleAndAdd(r,r,o,s);const a=Q.identity(new Float64Array(16));return Q.multiply(a,t.pixelMatrix,t.globeMatrix),j.transformMat4(r,r,a),new B(r[0],r[1])}pixelsPerMeter(t,i){return ni(1,0)*i}pixelSpaceConversion(t,i,r){const o=ni(1,t)*i,n=ne(ni(1,45)*i,o,r);return this.pixelsPerMeter(t,i)/n}createTileMatrix(t,i,r){const o=sm(lo(r.canonical));return Q.multiply(new Float64Array(16),t.globeMatrix,o)}createInversionMatrix(t,i){const{center:r}=t,o=Qn(lo(i));return Q.rotateY(o,o,Ft(r.lng)),Q.rotateX(o,o,Ft(r.lat)),Q.scale(o,o,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(o)}pointCoordinate(t,i,r,o){return lx(t,i,r,!0)||new De(0,0)}pointCoordinate3D(t,i,r){const o=this.pointCoordinate(t,i,r,0);return[o.x,o.y,o.z]}isPointAboveHorizon(t,i){return!lx(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(o,n){const s=o.cameraToCenterDistance,a=o._centerAltitude*n,l=o._camera,c=o._camera.forward(),u=j.add([],j.scale([],c,-s),[0,0,a]),p=o.worldSize/(2*Math.PI),f=[0,0,-p],g=o.width/o.height,_=Math.tan(o.fovAboveCenter),y=j.scale([],l.up(),_),x=j.scale([],l.right(),_*g),b=j.normalize([],j.add([],j.add([],c,y),x)),T=[];let S;if(new Uu(u,b).closestPointOnSphere(f,p,T)){const M=j.add([],T,f),E=j.sub([],M,u);S=Math.cos(o.fovAboveCenter)*j.length(E)}else{const M=j.sub([],u,f),E=j.sub([],f,u);j.normalize(E,E);const A=j.length(M)-p;S=Math.sqrt(A*(A+2*p));const I=Math.acos(S/(p+A))-Math.acos(j.dot(c,E));S*=Math.cos(I)}return 1.01*S}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=ar(t.zoom);if(r>0){const o=Iv(t,ni(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),s=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ne(i,o+n*(1-Math.cos(s)),Math.pow(r,10))}return i}upVector(t,i,r){return Zl(i,r,t,1)}upVectorScale(t){return{metersToTile:Gu($u(lo(t)))}}}function xh(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Pv(e);case"equirectangular":return new zA(e);case"naturalEarth":return new RA(e);case"equalEarth":return new DA(e);case"winkelTripel":return new LA(e);case"albers":return i?new Ov(e):new kA(e);case"lambertConformalConic":return i?new Ov(e):new PA(e);case"globe":return new OA(e)}throw new Error(`Invalid projection name: ${e.name}`)}const BA=new Pi({"symbol-placement":new bt(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(tt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new bt(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(tt.layout_symbol["icon-size"]),"icon-text-fit":new Yt(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(tt.layout_symbol["icon-image"]),"icon-rotate":new Yt(tt.layout_symbol["icon-rotate"]),"icon-padding":new bt(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(tt.layout_symbol["icon-offset"]),"icon-anchor":new Yt(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(tt.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(tt.layout_symbol["text-field"]),"text-font":new Yt(tt.layout_symbol["text-font"]),"text-size":new Yt(tt.layout_symbol["text-size"]),"text-max-width":new Yt(tt.layout_symbol["text-max-width"]),"text-line-height":new Yt(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(tt.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(tt.layout_symbol["text-justify"]),"text-radial-offset":new Yt(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new Yt(tt.layout_symbol["text-anchor"]),"text-max-angle":new bt(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(tt.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(tt.layout_symbol["text-rotate"]),"text-padding":new bt(tt.layout_symbol["text-padding"]),"text-keep-upright":new bt(tt.layout_symbol["text-keep-upright"]),"text-transform":new Yt(tt.layout_symbol["text-transform"]),"text-offset":new Yt(tt.layout_symbol["text-offset"]),"text-allow-overlap":new bt(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(tt.layout_symbol["text-ignore-placement"]),"text-optional":new bt(tt.layout_symbol["text-optional"]),visibility:new bt(tt.layout_symbol.visibility)});var Bm={paint:new Pi({"icon-opacity":new Yt(tt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Yt(tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Yt(tt.paint_symbol["text-emissive-strength"]),"icon-color":new Yt(tt.paint_symbol["icon-color"]),"icon-halo-color":new Yt(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Yt(tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Yt(tt.paint_symbol["text-opacity"]),"text-color":new Yt(tt.paint_symbol["text-color"],{runtimeType:yo,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Yt(tt.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(tt.paint_symbol["text-halo-blur"]),"text-translate":new bt(tt.paint_symbol["text-translate"]),"text-translate-anchor":new bt(tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(tt.paint_symbol["icon-color-saturation"])}),layout:BA};class Bv{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ga,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(Bv,"FormatSectionOverride",{omit:["defaultValue"]});class vh extends no{constructor(t,i){super(t,Bm,i)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const o=[];for(const n of r)o.indexOf(n)<0&&o.push(n);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,r,o){const n=this.layout.get(t).evaluate(i,{},r,o),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||yu(s.value)||!n?n:function(a,l){return l.replace(/{([^{}]+)}/g,(c,u)=>u in a?String(a[u]):"")}(i.properties,n)}createBucket(t){return new sc(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Bm.paint.overridableProperties){if(!vh.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),r=new Bv(i),o=new ef(r,i.property.specification);let n=null;n=i.value.kind==="constant"||i.value.kind==="source"?new rf("source",o):new Gn("composite",o,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new Da(i.property,n,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&vh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const r=t.get("text-field"),o=Bm.paint.properties[i];let n=!1;const s=a=>{for(const l of a)if(o.overrides&&o.overrides.hasOverride(l))return void(n=!0)};if(r.value.kind==="constant"&&r.value.value instanceof qr)s(r.value.value.sections);else if(r.value.kind==="source"){const a=c=>{n||(c instanceof Tl&&or(c.value)===yl?s(c.value.sections):c instanceof El?s(c.sections):c.eachChild(a))},l=r.value;l._styleExpression&&a(l._styleExpression.expression)}return n}getProgramIds(){const t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,r=[];return t&&r.push("symbolIcon"),i&&r.push("symbolSDF"),r}getDefaultProgramParams(t,i){return{config:new Os(this,i),overrideFog:!1}}}const FA=nh.types,NA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bh(e,t,i,r,o,n,s,a,l,c,u,p,f){const g=a?Math.min(ss,Math.round(a[0])):0,_=a?Math.min(ss,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*o),n,s,(g<<1)+(l?1:0),_,16*c,16*u,256*p,256*f)}function wh(e,t,i){e.emplaceBack(t,i)}function Th(e,t,i,r,o,n,s){e.emplaceBack(t,i,r,o,n,s)}function Eh(e,t,i,r,o){const n=5*t+2;e.float32[n+0]=i,e.float32[n+1]=r,e.float32[n+2]=o}function Xa(e,t,i,r,o){e.emplaceBack(t,i,r,o),e.emplaceBack(t,i,r,o),e.emplaceBack(t,i,r,o),e.emplaceBack(t,i,r,o)}function VA(e){for(const t of e.sections)if(eS(t.text))return!0;return!1}class Fm{constructor(t){this.layoutVertexArray=new bf,this.indexArray=new Zi,this.programConfigurations=t,this.segments=new ti,this.dynamicLayoutVertexArray=new _n,this.opacityVertexArray=new Tf,this.placedSymbolArray=new Iy,this.iconTransitioningVertexArray=new Hn,this.globeExtVertexArray=new wf,this.zOffsetVertexArray=new Fl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,r,o,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,oA.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,NA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,sA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,rA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,nA.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||o)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}jt(Fm,"SymbolBuffers");class Nm{constructor(t,i,r){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new r,this.segments=new ti,this.collisionVertexArray=new Mf,this.collisionVertexArrayExt=new _n}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,aA.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,lA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(Nm,"CollisionBuffers");class Sh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Q.identity([]),this.placementViewportMatrix=Q.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cm(this.zoom,i["text-size"]),this.iconSizeData=Cm(this.zoom,i["icon-size"]);const r=this.layers[0].layout,o=r.get("symbol-sort-key"),n=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=n!=="viewport-y"&&o.constantOr(1)!==void 0,this.sortFeaturesByY=(n==="viewport-y"||n==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(s=>vi[s]),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new Fm(new Xn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Fm(new Xn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new zy,this.lineVertexArray=new Py,this.symbolInstances=new Dy}calculateGlyphDependencies(t,i,r,o,n){for(let s=0;s<t.length;s++){const a=t.codePointAt(s);if(a===void 0)break;if(i[a]=!0,o&&n&&a<=65535){const l=Kl[t.charAt(s)];l&&(i[l.charCodeAt(0)]=!0)}}}populate(t,i,r,o){const n=this.layers[0],s=n.layout,a=this.projection.name==="globe",l=s.get("text-font"),c=s.get("text-field"),u=s.get("icon-image"),p=(c.value.kind!=="constant"||c.value.value instanceof qr&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&(l.value.kind!=="constant"||l.value.value.length>0),f=u.value.kind!=="constant"||!!u.value.value||Object.keys(u.parameters).length>0,g=s.get("symbol-sort-key");if(this.features=[],!p&&!f)return;const _=i.iconDependencies,y=i.glyphDependencies,x=i.availableImages,b=new Ti(this.zoom);for(const{feature:T,id:S,index:M,sourceLayerIndex:E}of t){const A=n._featureFilter.needGeometry,I=is(T,A);if(!n._featureFilter.filter(b,I,r))continue;if(A||(I.geometry=Ko(T,r,o)),a&&T.type!==1&&r.z<=5){const F=I.geometry,N=.98078528056,U=(O,Z)=>{const W=Zl(O.x,O.y,r,1),K=Zl(Z.x,Z.y,r,1);return j.dot(W,K)<N};for(let O=0;O<F.length;O++)F[O]=WS(F[O],U)}let z,P;if(p){const F=n.getValueAndResolveTokens("text-field",I,r,x),N=qr.factory(F);VA(N)&&(this.hasRTLText=!0),(!this.hasRTLText||_f()==="unavailable"||this.hasRTLText&&bo.isParsed())&&(z=hA(N,n,I))}if(f){const F=n.getValueAndResolveTokens("icon-image",I,r,x);P=F instanceof xo?F:xo.fromString(F)}if(!z&&!P)continue;const R=this.sortFeaturesByKey?g.evaluate(I,{},r):void 0;if(this.features.push({id:S,text:z,icon:P,index:M,sourceLayerIndex:E,geometry:I.geometry,properties:T.properties,type:FA[T.type],sortKey:R}),P&&(_[P.namePrimary]=!0,P.nameSecondary&&(_[P.nameSecondary]=!0)),z){const F=l.evaluate(I,{},r).join(","),N=s.get("text-rotation-alignment")==="map"&&s.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vi.vertical)>=0;for(const U of z.sections)if(U.image)_[U.image.namePrimary]=!0;else{const O=cf(z.toString()),Z=U.fontStack||F,W=y[Z]=y[Z]||{};this.calculateGlyphDependencies(U.text,W,N,this.allowVerticalPlacement,O)}}}s.get("symbol-placement")==="line"&&(this.features=function(T){const S={},M={},E=[];let A=0;function I(F){E.push(T[F]),A++}function z(F,N,U){const O=M[F];return delete M[F],M[N]=O,E[O].geometry[0].pop(),E[O].geometry[0]=E[O].geometry[0].concat(U[0]),O}function P(F,N,U){const O=S[N];return delete S[N],S[F]=O,E[O].geometry[0].shift(),E[O].geometry[0]=U[0].concat(E[O].geometry[0]),O}function R(F,N,U){const O=U?N[0][N[0].length-1]:N[0][0];return`${F}:${O.x}:${O.y}`}for(let F=0;F<T.length;F++){const N=T[F],U=N.geometry,O=N.text?N.text.toString():null;if(!O){I(F);continue}const Z=R(O,U),W=R(O,U,!0);if(Z in M&&W in S&&M[Z]!==S[W]){const K=P(Z,W,U),$=z(Z,W,E[K].geometry);delete S[Z],delete M[W],M[R(O,E[$].geometry,!0)]=$,E[K].geometry=null}else Z in M?z(Z,W,U):W in S?P(Z,W,U):(I(F),S[Z]=A-1,M[W]=A-1)}return E.filter(F=>F.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((T,S)=>T.sortKey-S.sortKey)}update(t,i,r,o,n){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const a=s?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,a,r,o,n),this.icon.programConfigurations.updatePaintArrays(t,i,a,r,o,n)}updateZOffset(){const t=(n,s,a)=>{r+=s,r>n.length&&n.resize(r);for(let l=-s;l<0;l++)n.emplace(l+r,a)},i=(n,s,a)=>{o+=s,o>n.length&&n.resize(o);for(let l=-s;l<0;l++)n.emplace(l+o,a)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,o=0;for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,numIconVertices:c}=s,u=s.zOffset,p=c>0;if((a>0||l>0)&&(t(this.text.zOffsetVertexArray,a,u),t(this.text.zOffsetVertexArray,l,u)),p){const{placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:g}=s;f>=0&&i(this.icon.zOffsetVertexArray,c,u),g>=0&&i(this.icon.zOffsetVertexArray,s.numVerticalIconVertices,u)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xh(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const r=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:o,y:n}of i)this.lineVertexArray.emplaceBack(o,n);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x){const b=t.indexArray,T=t.layoutVertexArray,S=t.globeExtVertexArray,M=t.segments.prepareSegment(4*i.length,T,b,this.canOverlap?s.sortKey:void 0),E=this.glyphOffsetArray.length,A=M.vertexLength,I=this.allowVerticalPlacement&&a===vi.vertical?Math.PI/2:0,z=s.text&&s.text.sections;for(let R=0;R<i.length;R++){const{tl:F,tr:N,bl:U,br:O,texPrimary:Z,texSecondary:W,pixelOffsetTL:K,pixelOffsetBR:$,minFontScaleX:H,minFontScaleY:it,glyphOffset:ot,isSDF:rt,sectionIndex:lt}=i[R],ut=M.vertexLength,pt=ot[1];if(bh(T,c.x,c.y,F.x,pt+F.y,Z.x,Z.y,r,rt,K.x,K.y,H,it),bh(T,c.x,c.y,N.x,pt+N.y,Z.x+Z.w,Z.y,r,rt,$.x,K.y,H,it),bh(T,c.x,c.y,U.x,pt+U.y,Z.x,Z.y+Z.h,r,rt,K.x,$.y,H,it),bh(T,c.x,c.y,O.x,pt+O.y,Z.x+Z.w,Z.y+Z.h,r,rt,$.x,$.y,H,it),l){const{x:nt,y:mt,z:It}=l.anchor,[kt,Rt,Ot]=l.up;Th(S,nt,mt,It,kt,Rt,Ot),Th(S,nt,mt,It,kt,Rt,Ot),Th(S,nt,mt,It,kt,Rt,Ot),Th(S,nt,mt,It,kt,Rt,Ot),Xa(t.dynamicLayoutVertexArray,nt,mt,It,I)}else Xa(t.dynamicLayoutVertexArray,c.x,c.y,c.z,I);if(x){const nt=W||Z;wh(t.iconTransitioningVertexArray,nt.x,nt.y),wh(t.iconTransitioningVertexArray,nt.x+nt.w,nt.y),wh(t.iconTransitioningVertexArray,nt.x,nt.y+nt.h),wh(t.iconTransitioningVertexArray,nt.x+nt.w,nt.y+nt.h)}b.emplaceBack(ut,ut+1,ut+2),b.emplaceBack(ut+1,ut+2,ut+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),R!==i.length-1&&lt===i[R+1].sectionIndex||t.programConfigurations.populatePaintArrays(T.length,s,s.index,{},g,_,y,z&&z[lt])}const P=l?l.anchor:c;t.placedSymbolArray.emplaceBack(P.x,P.y,P.z,c.x,c.y,E,this.glyphOffsetArray.length-E,A,u,p,c.segment,r?r[0]:0,r?r[1]:0,o[0],o[1],a,0,!1,0,f,0)}_commitLayoutVertex(t,i,r,o,n,s,a){t.emplaceBack(i,r,o,n,s,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(t,i,r,o,n,s,a){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=l.vertexLength,u=a.tileAnchorX,p=a.tileAnchorY;for(let g=0;g<4;g++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,t.padding,a.zOffset),this._commitLayoutVertex(r.layoutVertexArray,o,n,s,u,p,new B(t.x1,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,n,s,u,p,new B(t.x2,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,n,s,u,p,new B(t.x2,t.y2)),this._commitLayoutVertex(r.layoutVertexArray,o,n,s,u,p,new B(t.x1,t.y2)),l.vertexLength+=4;const f=r.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,r,o,n,s){for(let a=o;a<n;a++){const l=r.get(a),c=this.getSymbolInstanceTextSize(t,s,i,a);this._addCollisionDebugVertices(l,c,this.textCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(t,i,r,o,n,s){for(let a=o;a<n;a++){const l=r.get(a),c=this.getSymbolInstanceIconSize(t,i,s.placedIconSymbolIndex);this._addCollisionDebugVertices(l,c,this.iconCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,s)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nm(Ru,av.members,Hn),this.iconCollisionBox=new Nm(Ru,av.members,Hn);const r=Qo(this.iconSizeData,t),o=Qo(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(o,t,i,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(o,t,i,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,t,i,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,t,i,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(t,i,r,o){const n=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:o),s=Jl(this.textSizeData,t,n)/lr;return this.tilePixelRatio*s}getSymbolInstanceIconSize(t,i,r){const o=this.icon.placedSymbolArray.get(r),n=Jl(this.iconSizeData,t,o);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(t,i,r,o){t.emplaceBack(i,-r,-r,o),t.emplaceBack(i,r,-r,o),t.emplaceBack(i,r,r,o),t.emplaceBack(i,-r,r,o)}_updateTextDebugCollisionBoxes(t,i,r,o,n,s){for(let a=o;a<n;a++){const l=r.get(a),c=this.getSymbolInstanceTextSize(t,s,i,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,c,l.padding,s.zOffset)}}_updateIconDebugCollisionBoxes(t,i,r,o,n,s){for(let a=o;a<n;a++){const l=r.get(a),c=this.getSymbolInstanceIconSize(t,i,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,c,l.padding,s.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Qo(this.iconSizeData,t),o=Qo(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(o,t,i,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(o,t,i,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,t,i,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,t,i,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,r,o,n,s,a,l,c){const u={};if(i<r){const{x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M,featureIndex:E}=t.get(i);u.textBox={x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M},u.textFeatureIndex=E}if(o<n){const{x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M,featureIndex:E}=t.get(o);u.verticalTextBox={x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M},u.verticalTextFeatureIndex=E}if(s<a){const{x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M,featureIndex:E}=t.get(s);u.iconBox={x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M},u.iconFeatureIndex=E}if(l<c){const{x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M,featureIndex:E}=t.get(l);u.verticalIconBox={x1:p,y1:f,x2:g,y2:_,padding:y,projectedAnchorX:x,projectedAnchorY:b,projectedAnchorZ:T,tileAnchorX:S,tileAnchorY:M},u.verticalIconFeatureIndex=E}return u}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){const r=t.placedSymbolArray.get(i),o=r.vertexStartIndex+4*r.numGlyphs;for(let n=r.vertexStartIndex;n<o;n+=4)t.indexArray.emplaceBack(n,n+1,n+2),t.indexArray.emplaceBack(n+1,n+2,n+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),r=Math.cos(t),o=[],n=[],s=[];for(let a=0;a<this.symbolInstances.length;++a){s.push(a);const l=this.symbolInstances.get(a);o.push(0|Math.round(i*l.tileAnchorX+r*l.tileAnchorY)),n.push(l.featureIndex)}return s.sort((a,l)=>o[a]-o[l]||n[l]-n[a]),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:l,verticalPlacedIconSymbolIndex:c}=r;o>=0&&this.addIndicesForPlacedSymbol(this.text,o),n>=0&&n!==o&&this.addIndicesForPlacedSymbol(this.text,n),s>=0&&s!==n&&s!==o&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&this.addIndicesForPlacedSymbol(this.icon,l),c>=0&&this.addIndicesForPlacedSymbol(this.icon,c)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}jt(Sh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sh.MAX_GLYPHS=65535,Sh.addDynamicAttributes=Xa;var sc=Sh;const jA=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:UA}=jA,GA=He([{name:"a_packed",components:4,type:"Float32"}]),{members:qA}=GA,$A=nh.types,ZA=Math.cos(Math.PI/180*37.5);class Mh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new vf,this.layoutVertexArray2=new _n,this.indexArray=new Zi,this.programConfigurations=new Xn(t.layers,t.zoom),this.segments=new ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,r,o){this.hasPattern=Tm("line",this.layers,i);const n=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:u,id:p,index:f,sourceLayerIndex:g}of t){const _=this.layers[0]._featureFilter.needGeometry,y=is(u,_);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),y,r))continue;const x=n?n.evaluate(y,{},r):void 0,b={id:p,properties:u.properties,type:u.type,sourceLayerIndex:g,index:f,geometry:_?y.geometry:Ko(u,r,o),patterns:{},sortKey:x};s.push(b)}n&&s.sort((u,p)=>u.sortKey-p.sortKey);const{lineAtlas:a,featureIndex:l}=i,c=this.addConstantDashes(a);for(const u of s){const{geometry:p,index:f,sourceLayerIndex:g}=u;if(c&&this.addFeatureDashes(u,a),this.hasPattern){const _=Em("line",this.layers,u,this.zoom,i);this.patternFeatures.push(_)}else this.addFeature(u,p,f,r,a.positions,i.availableImages,i.brightness);l.insert(t[f].feature,p,f,g,this.index)}}addConstantDashes(t){let i=!1;for(const r of this.layers){const o=r.paint.get("line-dasharray").value,n=r.layout.get("line-cap").value;if(o.kind!=="constant"||n.kind!=="constant")i=!0;else{const s=n.value,a=o.value;if(!a)continue;t.addDash(a,s)}}return i}addFeatureDashes(t,i){const r=this.zoom;for(const o of this.layers){const n=o.paint.get("line-dasharray").value,s=o.layout.get("line-cap").value;if(n.kind==="constant"&&s.kind==="constant")continue;let a,l;if(n.kind==="constant"){if(a=n.value,!a)continue}else a=n.evaluate({zoom:r},t);l=s.kind==="constant"?s.value:s.evaluate({zoom:r},t),i.addDash(a,l),t.patterns[o.id]=i.getKey(a,l)}}update(t,i,r,o,n){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,s?this.stateDependentLayers:this.layers,r,o,n)}addFeatures(t,i,r,o,n,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,i,r,o,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qA)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,UA),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,r,o,n,s,a){const l=this.layers[0].layout,c=l.get("line-join").evaluate(t,{}),u=l.get("line-cap").evaluate(t,{}),p=l.get("line-miter-limit"),f=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const g of i)this.addLine(g,t,c,u,p,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,s,o,a)}addLine(t,i,r,o,n,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let b=0;b<t.length-1;b++)this.totalDistance+=t[b].dist(t[b+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a=$A[i.type]==="Polygon";let l=t.length;for(;l>=2&&t[l-1].equals(t[l-2]);)l--;let c=0;for(;c<l-1&&t[c].equals(t[c+1]);)c++;if(l<(a?3:2))return;r==="bevel"&&(n=1.05);const u=this.overscaling<=16?15*at/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let f,g,_,y,x;this.e1=this.e2=-1,a&&(f=t[l-2],x=t[c].sub(f)._unit()._perp());for(let b=c;b<l;b++){if(_=b===l-1?a?t[c+1]:void 0:t[b+1],_&&t[b].equals(_))continue;x&&(y=x),f&&(g=f),f=t[b],x=_?_.sub(f)._unit()._perp():y,y=y||x;let T=y.add(x);T.x===0&&T.y===0||T._unit();const S=y.x*x.x+y.y*x.y,M=T.x*x.x+T.y*x.y,E=M!==0?1/M:1/0,A=2*Math.sqrt(2-2*M),I=M<ZA&&g&&_,z=y.x*x.y-y.y*x.x>0;if(I&&b>c){const F=f.dist(g);if(F>2*u){const N=f.sub(f.sub(g)._mult(u/F)._round());this.updateDistance(g,N),this.addCurrentVertex(N,y,0,0,p),g=N}}const P=g&&_;let R=P?r:a?"butt":o;if(P&&R==="round"&&(E<s?R="miter":E<=2&&(R="fakeround")),R==="miter"&&E>n&&(R="bevel"),R==="bevel"&&(E>2&&(R="flipbevel"),E<n&&(R="miter")),g&&this.updateDistance(g,f),R==="miter")T._mult(E),this.addCurrentVertex(f,T,0,0,p);else if(R==="flipbevel"){if(E>100)T=x.mult(-1);else{const F=E*y.add(x).mag()/y.sub(x).mag();T._perp()._mult(F*(z?-1:1))}this.addCurrentVertex(f,T,0,0,p),this.addCurrentVertex(f,T.mult(-1),0,0,p)}else if(R==="bevel"||R==="fakeround"){const F=-Math.sqrt(E*E-1),N=z?F:0,U=z?0:F;if(g&&this.addCurrentVertex(f,y,N,U,p),R==="fakeround"){const O=Math.round(180*A/Math.PI/20);for(let Z=1;Z<O;Z++){let W=Z/O;if(W!==.5){const $=W-.5;W+=W*$*(W-1)*((1.0904+S*(S*(3.55645-1.43519*S)-3.2452))*$*$+(.848013+S*(.215638*S-1.06021)))}const K=x.sub(y)._mult(W)._add(y)._unit()._mult(z?-1:1);this.addHalfVertex(f,K.x,K.y,!1,z,0,p)}}_&&this.addCurrentVertex(f,x,-N,-U,p)}else if(R==="butt")this.addCurrentVertex(f,T,0,0,p);else if(R==="square"){const F=g?1:-1;g||this.addCurrentVertex(f,T,F,F,p),this.addCurrentVertex(f,T,0,0,p),g&&this.addCurrentVertex(f,T,F,F,p)}else R==="round"&&(g&&(this.addCurrentVertex(f,y,0,0,p),this.addCurrentVertex(f,y,1,1,p,!0)),_&&(this.addCurrentVertex(f,x,-1,-1,p,!0),this.addCurrentVertex(f,x,0,0,p)));if(I&&b<l-1){const F=f.dist(_);if(F>2*u){const N=f.add(_.sub(f)._mult(u/F)._round());this.updateDistance(f,N),this.addCurrentVertex(N,x,0,0,p),f=N}}}}addCurrentVertex(t,i,r,o,n,s=!1){const a=i.y*o-i.x,l=-i.y-i.x*o;this.addHalfVertex(t,i.x+i.y*r,i.y-i.x*r,s,!1,r,n),this.addHalfVertex(t,a,l,s,!0,-o,n)}addHalfVertex({x:t,y:i},r,o,n,s,a,l){this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(i<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*o)+128,1+(a===0?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),l.primitiveLength++),s?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}jt(Mh,"LineBucket",{omit:["layers","patternFeatures"]});class Mi{constructor(t,i,r,o){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(i,o)}update(t,i,r){const{width:o,height:n}=t,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:p,ImageBitmap:f}=k;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===o&&this.size[1]===n){const{x:g,y:_}=r||{x:0,y:0};if(t instanceof l||t instanceof c||t instanceof u||t instanceof p||f&&t instanceof f)a.texSubImage2D(a.TEXTURE_2D,0,g,_,a.RGBA,a.UNSIGNED_BYTE,t);else{let y=this.format,x=a.UNSIGNED_BYTE;this.format===a.R32F&&(y=a.RED,x=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,g,_,o,n,y,x,t.data)}}else if(this.size=[o,n],t instanceof l||t instanceof c||t instanceof u||t instanceof p||f&&t instanceof f){let g=this.format;this.format===a.R8&&(g=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,g,a.UNSIGNED_BYTE,t)}else{let g=this.format,_=this.format,y=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(g=a.DEPTH_COMPONENT16,y=a.UNSIGNED_SHORT),this.format===a.R32F&&(y=a.FLOAT,_=a.RED),a.texImage2D(a.TEXTURE_2D,0,g,o,n,0,_,y,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,r,o){const{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_2D,this.texture),i!==this.magFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?t===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),r!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,r),this.wrapS=r),o!==this.wrapT&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,o),this.wrapT=o)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ah{constructor(t,i){this.context=t,this.texture=i}bind(t,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapS=i)}}const Mo=32,tn=33,ls=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,r=0,o=0,n=0,s=0,a=0;for(1&t?o=n=s=Mo:i=r=a=Mo;(t>>=1)>1;){const c=i+o>>1,u=r+n>>1;1&t?(o=i,n=r,i=s,r=a):(i=o,r=n,o=s,n=a),s=c,a=u}const l=4*e;ls[l+0]=i,ls[l+1]=r,ls[l+2]=o,ls[l+3]=n}const en=new Uint16Array(2178),cs=new Uint8Array(1089),Ch=new Uint16Array(1089);function Fv(e){return e===0?-.03125:e===32?.03125:0}var Vm=He([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Nv={type:2,extent:at,loadGeometry:()=>[[new B(0,0),new B(at+1,0),new B(at+1,at+1),new B(0,at+1),new B(0,0)]]};class ac{constructor(t,i,r,o,n){this.tileID=t,this.uid=ca(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,o&&o.style&&(this._lastUpdatedBrightness=o.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",o&&o.transform&&(this.projection=o.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<ce.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Vs(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(o,n){const s={};if(!n)return s;for(const a of o){const l=a.layerIds.map(c=>n.getLayer(c)).filter(Boolean);if(l.length!==0){a.layers=l,a.stateDependentLayerIds&&(a.stateDependentLayers=a.stateDependentLayerIds.map(c=>l.filter(u=>u.id===c)[0]));for(const c of l)s[c.fqid]=a}}return s}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const n=this.buckets[o];if(n instanceof sc){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const n=this.buckets[o];if(n instanceof sc&&n.hasRTLText){this.hasRTLText=!0,bo.isLoading()||bo.isLoaded()||_f()!=="deferred"||by();break}}this.queryPadding=0;for(const o in this.buckets){const n=this.buckets[o],s=i.style.getOwnLayer(o);if(!s)continue;const a=s.queryRadius(n);this.queryPadding=Math.max(this.queryPadding,a)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new Pf}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const r in this.buckets){const o=this.buckets[r];o.uploadPending()&&o.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mi(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mi(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mi(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,i,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,r),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const o=i.style.getBrightness();(this._lastUpdatedBrightness||o)&&(this._lastUpdatedBrightness&&o&&Math.abs(this._lastUpdatedBrightness-o)<.001||(this._lastUpdatedBrightness=o,this.updateBuckets(void 0,i)))}queryRenderedFeatures(t,i,r,o,n,s,a,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:o,pixelPosMatrix:a,transform:s,params:n,tileTransform:this.tileTransform},t,i,r):{}}querySourceFeatures(t,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const o=r.loadVTLayers(),n=i?i.sourceLayer:"",s=o._geojsonTileLayer||o[n];if(!s)return;const a=wu(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,p={z:l,x:c,y:u};for(let f=0;f<s.length;f++){const g=s.feature(f);if(a.needGeometry){const x=is(g,!0);if(!a.filter(new Ti(this.tileID.overscaledZ),x,this.tileID.canonical))continue}else if(!a.filter(new Ti(this.tileID.overscaledZ),g))continue;const _=r.getId(g,n),y=new Kx(g,l,c,u,_);y.tile=p,t.push(y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const r=Wt(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const r=Date.now();let o=!1;if(this.expirationTime>r)o=!1;else if(i)if(this.expirationTime<i)o=!0;else{const n=this.expirationTime-i;n?this.expirationTime=r+Math.max(n,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&i&&this.updateBuckets(t,i)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),o=i.style.listImages(),n=i.style.getBrightness();for(const s in this.buckets){if(!i.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0].sourceLayer||"_geojsonTileLayer",c=r[l];let u={};if(t&&(u=t[l],!c||!u||Object.keys(u).length===0))continue;if(a.update(u,c,o,this.imageAtlas&&this.imageAtlas.patternPositions||{},n),a instanceof Mh||a instanceof rh){const f=i.style.getOwnSourceCache(a.layers[0].source);i._terrain&&i._terrain.enabled&&f&&a.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(f.id,this.tileID)}const p=i&&i.style&&i.style.getOwnLayer(s);p&&(this.queryPadding=Math.max(this.queryPadding,p.queryRadius(a)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ce.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ce.now()+t}setTexture(t,i){const r=i.context,o=r.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof Mi?this.texture.update(t,{useMipmap:!0}):(this.texture=new Mi(r,t,o.RGBA,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE))}setDependencies(t,i){const r={};for(const o of i)r[o]=!0;this.dependencies[t]=r}hasDependency(t,i){for(const r of t){const o=this.dependencies[r];if(o){for(const n of i)if(o[n])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=Ko(Nv,this.tileID.canonical,this.tileTransform)[0],o=new Zr,n=new Nl;for(let s=0;s<r.length;s++){const{x:a,y:l}=r[s];o.emplaceBack(a,l),n.emplaceBack(s)}n.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(n),this._tileDebugBuffer=t.createVertexBuffer(o,Jn.members),this._tileDebugSegments=ti.simpleSegment(0,0,o.length,n.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=Ko(Nv,this.tileID.canonical,this.tileTransform)[0];let o,n;if(this.isRaster){const s=function(a,l){const c=Vs(a,l),u=Math.pow(2,a.z);for(let x=0;x<tn;x++)for(let b=0;b<tn;b++){const T=Xr((a.x+(b+Fv(b))/Mo)/u),S=Hi((a.y+(x+Fv(x))/Mo)/u),M=l.project(T,S),E=x*tn+b;en[2*E+0]=Math.round((M.x*c.scale-c.x)*at),en[2*E+1]=Math.round((M.y*c.scale-c.y)*at)}cs.fill(0),Ch.fill(0);for(let x=2045;x>=0;x--){const b=4*x,T=ls[b+0],S=ls[b+1],M=ls[b+2],E=ls[b+3],A=T+M>>1,I=S+E>>1,z=A+I-S,P=I+T-A,R=S*tn+T,F=E*tn+M,N=I*tn+A,U=Math.hypot((en[2*R+0]+en[2*F+0])/2-en[2*N+0],(en[2*R+1]+en[2*F+1])/2-en[2*N+1])>=16;cs[N]=cs[N]||(U?1:0),x<1022&&(cs[N]=cs[N]||cs[(S+P>>1)*tn+(T+z>>1)]||cs[(E+P>>1)*tn+(M+z>>1)])}const p=new Ps,f=new Zi;let g=0;function _(x,b){const T=b*tn+x;return Ch[T]===0&&(p.emplaceBack(en[2*T+0],en[2*T+1],x*at/Mo,b*at/Mo),Ch[T]=++g),Ch[T]-1}function y(x,b,T,S,M,E){const A=x+T>>1,I=b+S>>1;if(Math.abs(x-M)+Math.abs(b-E)>1&&cs[I*tn+A])y(M,E,x,b,A,I),y(T,S,M,E,A,I);else{const z=_(x,b),P=_(T,S),R=_(M,E);f.emplaceBack(z,P,R)}}return y(0,0,Mo,Mo,Mo,0),y(Mo,Mo,0,0,0,Mo),{vertices:p,indices:f}}(this.tileID.canonical,i);o=s.vertices,n=s.indices}else{o=new Ps,n=new Zi;for(const{x:a,y:l}of r)o.emplaceBack(a,l,0,0);const s=ih(o.int16,void 0,4);for(let a=0;a<s.length;a+=3)n.emplaceBack(s[a],s[a+1],s[a+2])}this._tileBoundsBuffer=t.createVertexBuffer(o,Vm.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(n),this._tileBoundsSegments=ti.simpleSegment(0,0,o.length,n.length)}_makeGlobeTileDebugBuffers(t,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const o=this.tileID.canonical,n=Qn(cx(o,i)),s=ar(i.zoom);let a;s>0&&(a=Q.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,o,i,n,a,s),this._makeGlobeTileDebugTextBuffer(t,o,i,n,a,s)}_globePoint(t,i,r,o,n,s,a){let l=Zl(t,i,r);if(s){const c=1<<r.z,u=Ji(o.center.lng),p=Qi(o.center.lat),f=(r.x+.5)/c-u;let g=0;f>.5?g=-1:f<-.5&&(g=1);let _=(t/at+r.x)/c+g,y=(i/at+r.y)/c;_=(_-u)*o._pixelsPerMercatorPixel+u,y=(y-p)*o._pixelsPerMercatorPixel+p;const x=[_*o.worldSize,y*o.worldSize,0];j.transformMat4(x,x,s),l=Sn(l,x,a)}return j.transformMat4(l,l,n)}_makeGlobeTileDebugBorderBuffer(t,i,r,o,n,s){const a=new Zr,l=new Nl,c=new Du,u=(f,g,_,y,x)=>{const b=(_-f)/(x-1),T=(y-g)/(x-1),S=a.length;for(let M=0;M<x;M++){const E=f+M*b,A=g+M*T;a.emplaceBack(E,A);const I=this._globePoint(E,A,i,r,o,n,s);c.emplaceBack(I[0],I[1],I[2]),l.emplaceBack(S+M)}},p=at;u(0,0,p,0,16),u(p,0,p,p,16),u(p,p,0,p,16),u(0,p,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,Jn.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,ix.members),this._tileDebugSegments=ti.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,i,r,o,n,s){const a=at/4,l=new Zr,c=new Zi,u=new Du,p=25;c.reserve(32),l.reserve(p),u.reserve(p);const f=(g,_)=>p*g+_;for(let g=0;g<p;g++){const _=g*a;for(let y=0;y<p;y++){const x=y*a;l.emplaceBack(x,_);const b=this._globePoint(x,_,i,r,o,n,s);u.emplaceBack(b[0],b[1],b[2])}}for(let g=0;g<4;g++)for(let _=0;_<4;_++){const y=f(g,_),x=f(g,_+1),b=f(g+1,_),T=f(g+1,_+1);c.emplaceBack(y,x,b),c.emplaceBack(b,x,T)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,Jn.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,ix.members),this._tileDebugTextSegments=ti.simpleSegment(0,0,p,32)}destroy(t=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Mi&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class HA{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,r){const o=t.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const n={value:i,timeout:void 0};if(r!==void 0&&(n.timeout=setTimeout(()=>{this.remove(t,n)},r)),this.data[o].push(n),this.order.push(o),this.order.length>this.max){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const r=t.wrapped().key,o=i===void 0?0:this.data[r].indexOf(i),n=this.data[r][o];return this.data[r].splice(o,1),n.timeout&&clearTimeout(n.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const r in this.data)for(const o of this.data[r])t(o.value)||i.push(o);for(const r of i)this.remove(r.value.tileID,r)}}class us{constructor(t,i,r,o){this.id=us.uniqueIdxCounter,us.uniqueIdxCounter++,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||o||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=us.uniqueIdxCounter,us.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}us.uniqueIdxCounter=0;const WA={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class XA{constructor(t,i,r,o,n,s){this.length=i.length,this.attributes=r,this.itemSize=i.bytesPerElement,this.dynamicDraw=o,this.instanceCount=s,this.context=t;const a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||n||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let r=0;r<this.attributes.length;r++){const o=i.attributes[this.attributes[r].name];o!==void 0&&t.enableVertexAttribArray(o)}}setVertexAttribPointers(t,i,r){for(let o=0;o<this.attributes.length;o++){const n=this.attributes[o],s=i.attributes[n.name];s!==void 0&&t.vertexAttribPointer(s,n.components,t[WA[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(t,i,r){for(let o=0;o<this.attributes.length;o++){const n=i.attributes[this.attributes[o].name];n!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(n,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class YA extends gi{getDefault(){return xe.transparent}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class JA extends gi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class KA extends gi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class QA extends gi{getDefault(){return[!0,!0,!0,!0]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tC extends gi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class eC extends gi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class iC extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class rC extends gi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class oC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class nC extends gi{getDefault(){return[0,1]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class sC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class aC extends gi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class lC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class cC extends gi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uC extends gi{getDefault(){return xe.transparent}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hC extends gi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class dC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class pC extends gi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class fC extends gi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let mC=class extends gi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class gC extends gi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _C extends gi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yC extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xC extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vC extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bC extends gi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wC extends gi{getDefault(){return null}set(t){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class TC extends gi{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class EC extends gi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class SC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class MC extends gi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class jm extends gi{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class AC extends jm{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Vv extends jm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class CC extends jm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class IC extends Vv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class kC{constructor(t,i,r,o,n){this.context=t,this.width=i,this.height=r;const s=this.framebuffer=t.gl.createFramebuffer();o&&(this.colorAttachment=new AC(t,s)),n&&(this.depthAttachmentType=n,this.depthAttachment=n==="renderbuffer"?new Vv(t,s):new CC(t,s))}destroy(){const t=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class ee{constructor(t,i,r){this.func=t,this.mask=i,this.range=r}}ee.ReadOnly=!1,ee.ReadWrite=!0,ee.disabled=new ee(519,ee.ReadOnly,[0,1]);const Um=7680;class ve{constructor(t,i,r,o,n,s){this.test=t,this.ref=i,this.mask=r,this.fail=o,this.depthFail=n,this.pass=s}}ve.disabled=new ve({func:519,mask:0},0,0,Um,Um,Um);const Ih=771;class Ve{constructor(t,i,r,o){this.blendFunction=t,this.blendColor=i,this.mask=r,this.blendEquation=o}}Ve.Replace=[1,0,1,0],Ve.disabled=new Ve(Ve.Replace,xe.transparent,[!1,!1,!1,!1]),Ve.unblended=new Ve(Ve.Replace,xe.transparent,[!0,!0,!0,!0]),Ve.alphaBlended=new Ve([1,Ih,1,Ih],xe.transparent,[!0,!0,!0,!0]),Ve.multiply=new Ve([774,0,774,0],xe.transparent,[!0,!0,!0,!0]);const Gm=1029,qm=2305;class we{constructor(t,i,r){this.enable=t,this.mode=i,this.frontFace=r}}we.disabled=new we(!1,Gm,qm),we.backCCW=new we(!0,Gm,qm),we.backCW=new we(!0,Gm,2304),we.frontCW=new we(!0,1028,2304),we.frontCCW=new we(!0,1028,qm);class DC{constructor(t,i){this.gl=t,this.clearColor=new YA(this),this.clearDepth=new JA(this),this.clearStencil=new KA(this),this.colorMask=new QA(this),this.depthMask=new tC(this),this.stencilMask=new eC(this),this.stencilFunc=new iC(this),this.stencilOp=new rC(this),this.stencilTest=new oC(this),this.depthRange=new nC(this),this.depthTest=new sC(this),this.depthFunc=new aC(this),this.blend=new lC(this),this.blendFunc=new cC(this),this.blendColor=new uC(this),this.blendEquation=new hC(this),this.cullFace=new dC(this),this.cullFaceSide=new pC(this),this.frontFace=new fC(this),this.program=new mC(this),this.activeTexture=new gC(this),this.viewport=new _C(this),this.bindFramebuffer=new yC(this),this.bindRenderbuffer=new xC(this),this.bindTexture=new vC(this),this.bindVertexBuffer=new bC(this),this.bindElementBuffer=new wC(this),this.bindVertexArrayOES=new TC(this),this.pixelStoreUnpack=new EC(this),this.pixelStoreUnpackPremultiplyAlpha=new SC(this),this.pixelStoreUnpackFlipY=new MC(this),this.options=i?{...i}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,r){return new us(this,t,i,r)}createVertexBuffer(t,i,r,o,n){return new XA(this,t,i,r,o,n)}createRenderbuffer(t,i,r){const o=this.gl,n=o.createRenderbuffer();return this.bindRenderbuffer.set(n),o.renderbufferStorage(o.RENDERBUFFER,t,i,r),this.bindRenderbuffer.set(null),n}createFramebuffer(t,i,r,o){return new kC(this,t,i,r,o)}clear({color:t,depth:i,stencil:r,colorMask:o}){const n=this.gl;let s=0;t&&(s|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(o||[!0,!0,!0,!0])),i!==void 0&&(s|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),r!==void 0&&(s|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),n.clear(s)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){st(t.blendFunction,Ve.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class No extends qi{constructor(t,i,r){super(),this.id=t,this._onlySymbols=r,i.on("data",o=>{o.dataType==="source"&&o.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&o.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new HA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new YM,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(t),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ws(this._tiles).map(t=>t.tileID).sort(jv).map(t=>t.key)}getRenderableIds(t,i){const r=[];for(const o in this._tiles)this._isIdRenderable(+o,t,i)&&r.push(this._tiles[o]);return t?r.sort((o,n)=>{const s=o.tileID,a=n.tileID,l=new B(s.canonical.x,s.canonical.y)._rotate(this.transform.angle),c=new B(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return s.overscaledZ-a.overscaledZ||c.y-l.y||c.x-l.x}).map(o=>o.tileID.key):r.map(o=>o.tileID).sort(jv).map(o=>o.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(r||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const r=this._tiles[t];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,t,i)))}_tileLoaded(t,i,r,o){if(o)if(t.state="errored",o.status!==404)this._source.fire(new ae(o,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Tt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const n=this.map.painter.terrain;this.update(this.transform,n.getScaledDemTileSize(),!0),n.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ce.now(),r==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Tt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let o=0;o<i.length;o++){const n=i[o];if(t.neighboringTiles&&t.neighboringTiles[n]){const s=this.getTileByID(n);r(t,s),r(s,t)}}function r(o,n){if(!o.dem||o.dem.borderReady)return;o.needsHillshadePrepare=!0,o.needsDEMTextureUpload=!0;let s=n.tileID.canonical.x-o.tileID.canonical.x;const a=n.tileID.canonical.y-o.tileID.canonical.y,l=Math.pow(2,o.tileID.canonical.z),c=n.tileID.key;s===0&&a===0||Math.abs(a)>1||(Math.abs(s)>1&&(Math.abs(s+l)===1?s+=l:Math.abs(s-l)===1&&(s-=l)),n.dem&&o.dem&&(o.dem.backfillBorder(n.dem,s,a),o.neighboringTiles&&o.neighboringTiles[c]&&(o.neighboringTiles[c].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,r,o){for(const n in this._tiles){let s=this._tiles[n];if(o[n]||!s.hasData()||s.tileID.overscaledZ<=i||s.tileID.overscaledZ>r)continue;let a=s.tileID;for(;s&&s.tileID.overscaledZ>i+1;){const c=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[c.key],s&&s.hasData()&&(a=c)}let l=a;for(;l.overscaledZ>i;)if(l=l.scaledTo(l.overscaledZ-1),t[l.key]){o[a.key]=a;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=t.overscaledZ-1;r>=i;r--){const o=t.scaledTo(r),n=this._getLoadedTile(o);if(n)return n}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const r=Math.ceil(t.width/i)+1,o=Math.ceil(t.height/i)+1,n=Math.floor(r*o*5),s=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,n):n,a=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(a)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const r={};for(const o in this._tiles){const n=this._tiles[o];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+i),r[n.tileID.key]=n}this._tiles=r;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(+o,this._tiles[o])}}update(t,i,r,o){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let n;if(this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(l=>new Ue(l.canonical.z,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y)):(n=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter(l=>this._source.hasTile(l)))):n=[],n.length>0&&this.castsShadows&&o&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!$m(this._source.type)){const l=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),c=Math.min(l,this._source.maxzoom),u=t.extendTileCoverForShadows(n,o,c);for(const p of u)this._shadowCasterTiles[p.key]=!0,n.push(p)}const s=this._updateRetainedTiles(n);if($m(this._source.type)&&n.length!==0){const l={},c={},u=Object.keys(s);for(const f of u){const g=s[f],_=this._tiles[f];if(!_||_.fadeEndTime&&_.fadeEndTime<=ce.now())continue;const y=this.findLoadedParent(g,Math.max(g.overscaledZ-No.maxOverzooming,this._source.minzoom));y&&(this._addTile(y.tileID),l[y.tileID.key]=y.tileID),c[f]=g}const p=n[n.length-1].overscaledZ;for(const f in this._tiles){const g=this._tiles[f];if(s[f]||!g.hasData())continue;let _=g.tileID;for(;_.overscaledZ>p;){_=_.scaledTo(_.overscaledZ-1);const y=this._tiles[_.key];if(y&&y.hasData()&&c[_.key]){s[f]=g.tileID;break}}}for(const f in l)s[f]||(this._coveredTiles[f]=!0,s[f]=l[f])}for(const l in s)this._tiles[l].clearFadeHold();const a=function(l,c){const u=[];for(const p in l)p in c||u.push(p);return u}(this._tiles,s);for(const l of a){const c=this._tiles[l];c.hasSymbolBuckets&&!c.holdingForFade()?c.setHoldDuration(this.map._fadeDuration):c.hasSymbolBuckets&&!c.symbolFadeFinished()||this._removeTile(+l)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const r={},o=t.reduce((c,u)=>Math.min(c,u.overscaledZ),1/0),n=t[0].overscaledZ,s=Math.max(n-No.maxOverzooming,this._source.minzoom),a=Math.max(n+No.maxUnderzooming,this._source.minzoom),l={};for(const c of t){const u=this._addTile(c);i[c.key]=c,u.hasData()||o<this._source.maxzoom&&(l[c.key]=c)}this._retainLoadedChildren(l,o,a,i);for(const c of t){let u=this._tiles[c.key];if(u.hasData())continue;if(c.canonical.z>=this._source.maxzoom){const f=c.children(this._source.maxzoom)[0],g=this.getTile(f);if(g&&g.hasData()){i[f.key]=f;continue}}else{const f=c.children(this._source.maxzoom);if(i[f[0].key]&&i[f[1].key]&&i[f[2].key]&&i[f[3].key])continue}let p=u.wasRequested();for(let f=c.overscaledZ-1;f>=s;--f){const g=c.scaledTo(f);if(r[g.key]||(r[g.key]=!0,u=this.getTile(g),!u&&p&&(u=this._addTile(g)),u&&(i[g.key]=g,p=u.wasRequested(),u.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let r,o=this._tiles[t].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){r=this._loadedParentTiles[o.key];break}i.push(o.key);const n=o.scaledTo(o.overscaledZ-1);if(r=this._getLoadedTile(n),r)break;o=n}for(const n of i)this._loadedParentTiles[n]=r}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const r=!!i;if(!r){const o=this.map?this.map.painter:null;i=new ac(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,o,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,r||this._source.fire(new Tt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const r=i.getExpiryTimeout();r&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},r))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,r){const o=[],n=this.transform;if(!n)return o;const s=n.projection.name==="globe",a=Ji(n.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(r&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const p=c.tileID.canonical;if(p.z===0){const f=[Math.abs(Ut(a,...lc(p,-1))-a),Math.abs(Ut(a,...lc(p,1))-a)];u=[0,2*f.indexOf(Math.min(...f))-1]}else{const f=[Math.abs(Ut(a,...lc(p,-1))-a),Math.abs(Ut(a,...lc(p,0))-a),Math.abs(Ut(a,...lc(p,1))-a)];u=[f.indexOf(Math.min(...f))-1]}}else u=[0];for(const p of u){const f=t.containsTile(c,n,i,p);f&&o.push(f)}}return o}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){const r=this.getRenderableIds(t,i).map(n=>this._tiles[n].tileID),o=this.transform.projection.name==="globe";for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped()),n.expandedProjMatrix=o?this.transform.calculateProjMatrix(n.toUnwrapped(),!1,!0):n.projMatrix;return r}sortCoordinatesByDistance(t){const i=t.slice(),r=this.transform._camera.position,o=this.transform._camera.forward(),n={};for(const s of i){const a=1/(1<<s.canonical.z);n[s.key]=((s.canonical.x+.5)*a+s.wrap-r[0])*o[0]+((s.canonical.y+.5)*a-r[1])*o[1]-r[2]*o[2]}return i.sort((s,a)=>n[s.key]-n[a.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if($m(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ce.now())return!0}return!1}setFeatureState(t,i,r){this._state.updateState(t=t||"_geojsonTileLayer",i,r)}removeFeatureState(t,i,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,r)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,r){const o=this._tiles[t];o&&o.setDependencies(i,r)}reloadTilesForDependencies(t,i){for(const r in this._tiles)this._tiles[r].hasDependency(t,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const a=()=>{this._sourceLoaded&&(this._source.off("data",a),this._preloadTiles(t,i))};return void this._source.on("data",a)}const r=new Map,o=Array.isArray(t)?t:[t],n=this.map.painter.terrain,s=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const a of o){const l=a.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const c of l)r.set(c.key,c);this.usedForTerrain&&a.updateElevation(!1)}Do(Array.from(r.values()),(a,l)=>{const c=new ac(a,this._source.tileSize*a.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(c,u=>{this._source.type==="raster-dem"&&c.dem&&this._backfillDEM(c),l(u,c)})},i)}}function jv(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function $m(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function lc(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}No.maxOverzooming=10,No.maxUnderzooming=3;const zC=He([{name:"a_pos_3f",components:3,type:"Float32"}]),PC=He([{name:"a_color_3f",components:3,type:"Float32"}]),RC=He([{name:"a_color_4f",components:4,type:"Float32"}]),LC=He([{name:"a_uv_2f",components:2,type:"Float32"}]),OC=He([{name:"a_normal_3f",components:3,type:"Float32"}]),BC=He([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),FC=He([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Zm{constructor(t=0,i=0,r=0,o=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=r,this.right=o}interpolate(t,i,r){return i.top!=null&&t.top!=null&&(this.top=ne(t.top,i.top,r)),i.bottom!=null&&t.bottom!=null&&(this.bottom=ne(t.bottom,i.bottom,r)),i.left!=null&&t.left!=null&&(this.left=ne(t.left,i.left,r)),i.right!=null&&t.right!=null&&(this.right=ne(t.right,i.right,r)),this}getCenter(t,i){const r=Ut((this.left+t-this.right)/2,0,t),o=Ut((this.top+i-this.bottom)/2,0,i);return new B(r,o)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Uv(e,t){const i=ki(e,3);Q.fromQuat(e,t),cr(e,3,i)}function Hm(e,t){const i=fr.identity([]);return fr.rotateZ(i,i,-t),fr.rotateX(i,i,-e),i}function Gv(e,t){const i=[e[0],e[1],0],r=[t[0],t[1],0];if(j.length(i)>=1e-15){const s=j.normalize([],i);j.scale(r,s,j.dot(r,s)),t[0]=r[0],t[1]=r[1]}const o=j.cross([],t,e);if(j.len(o)<1e-15)return null;const n=Math.atan2(-o[1],o[0]);return Hm(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),n)}class qv{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){const i=t instanceof De?t:new De(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=Nr(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this.position,o=this._elevation?this._elevation.getAtPointOrZero(De.fromLngLat(t)):0,n=De.fromLngLat(t,o),s=[n.x-r.x,n.y-r.y,n.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Gv(s,i)}setPitchBearing(t,i){this.orientation=Hm(Ft(t),Ft(-i))}}class kh{constructor(t,i){this._transform=Q.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new De(t[0],t[1],t[2])}get position(){const t=ki(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&cr(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||fr.identity([]),t&&Uv(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=Hm(t,i),Uv(this._transform,this._orientation)}forward(){const t=ki(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=ki(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=ki(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return Q.invert(r,this.getWorldToCamera(t,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,r){const o=this.position;j.scale(o,o,-t);const n=new Float64Array(16);return Q.fromScaling(n,[r,r,r]),Q.translate(n,n,o),n[10]*=i,n}getWorldToCamera(t,i){const r=new Float64Array(16),o=new Float64Array(4),n=this.position;return fr.conjugate(o,this._orientation),j.scale(n,n,-t),Q.fromQuat(r,o),Q.translate(r,r,n),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,o){const n=new Float64Array(16);return Q.perspective(n,t,i,r,o),n}getCameraToClipOrthographic(t,i,r,o,n,s){const a=new Float64Array(16);return Q.ortho(a,t,i,r,o,n,s),a}getDistanceToElevation(t,i=!1){const r=t===0?0:ni(t,i?Hi(this.position[1]):this.position[1]),o=this.forward();return(r-this.position[2])/o[2]}clone(){return new kh([...this.position],[...this.orientation])}}function $v(e,t){const i=cc(e.projection,e.zoom,e.width,e.height),r=function(n,s,a,l,c){const u=new se(a.lng-180*hs,a.lat),p=new se(a.lng+180*hs,a.lat),f=n.project(u.lng,u.lat),g=n.project(p.lng,p.lat),_=-Math.atan2(g.y-f.y,g.x-f.x),y=De.fromLngLat(a);y.y=Ut(y.y,-1+hs,1-hs);const x=y.toLngLat(),b=n.project(x.lng,x.lat),T=De.fromLngLat(x);T.x+=hs;const S=T.toLngLat(),M=n.project(S.lng,S.lat),E=Wv(M.x-b.x,M.y-b.y,_),A=De.fromLngLat(x);A.y+=hs;const I=A.toLngLat(),z=n.project(I.lng,I.lat),P=Wv(z.x-b.x,z.y-b.y,_),R=Math.abs(E.x)/Math.abs(P.y),F=Q.identity([]);Q.rotateZ(F,F,-_*(1-(c?0:l)));const N=Q.identity([]);return Q.scale(N,N,[1,1-(1-R)*l,1]),N[4]=-P.x/P.y*l,Q.rotateZ(N,N,_),Q.multiply(N,F,N),N}(e.projection,0,e.center,i,t),o=Zv(e);return Q.scale(r,r,[o,o,1]),r}function Zv(e){const t=e.projection,i=cc(e.projection,e.zoom,e.width,e.height),r=Hv(t,e.center),o=Hv(t,se.convert(t.center));return Math.pow(2,r*i+(1-i)*o)}function cc(e,t,i,r,o=1/0){const n=e.range;if(!n)return 0;const s=Math.min(o,Math.max(i,r)),a=Math.log(s/1024)/Math.LN2;return oo(n[0]+a,n[1]+a,t)}const hs=1/4e4;function Hv(e,t){const i=Ut(t.lat,-Oi,Oi),r=new se(t.lng-180*hs,i),o=new se(t.lng+180*hs,i),n=e.project(r.lng,i),s=e.project(o.lng,i),a=De.fromLngLat(r),l=De.fromLngLat(o),c=s.x-n.x,u=s.y-n.y,p=l.x-a.x,f=l.y-a.y,g=Math.sqrt((p*p+f*f)/(c*c+u*u));return Math.log(g)/Math.LN2}function Wv(e,t,i){const r=Math.cos(i),o=Math.sin(i);return{x:e*r-t*o,y:e*o+t*r}}function js(e,t,i){return t*(at/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}const Ya={unknown:0,flipRequired:1,flipNotRequired:2},NC=Math.tan(85*Math.PI/180);function Dh(e,t,i,r,o,n,s){const a=Q.create();if(i)if(n.name==="globe"){const l=function(c,u){const{x:p,y:f}=c.point,g=px(p,f,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Q.multiply(g,g,sm(lo(u)))}(o,t);Q.multiply(a,a,l)}else{const l=Ra.invert([],s);a[0]=l[0],a[1]=l[1],a[4]=l[2],a[5]=l[3],r||Q.rotateZ(a,a,o.angle)}else Q.multiply(a,o.labelPlaneMatrix,e);return a}function Xv(e,t,i,r,o,n,s){const a=Dh(e,t,i,r,o,n,s);return n.name==="globe"&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function Yv(e,t,i,r,o,n,s){if(i){if(n.name==="globe"){const a=Dh(e,t,i,r,o,n,s);return Q.invert(a,a),Q.multiply(a,e,a),a}{const a=Q.clone(e),l=Q.identity([]);return l[0]=s[0],l[1]=s[1],l[4]=s[2],l[5]=s[3],Q.multiply(a,a,l),r||Q.rotateZ(a,a,-o.angle),a}}return o.glCoordMatrix}function Vo(e,t,i,r){const o=[e,t,i,1];i?ei.transformMat4(o,o,r):rb(o,o,r);const n=o[3];return o[0]/=n,o[1]/=n,o[2]/=n,o}function Jv(e,t){return Math.min(.5+e/t*.5,1.5)}function VC(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function jC(e,t,i,r,o,n,s,a,l,c){const u=i.transform,p=r?e.textSizeData:e.iconSizeData,f=Qo(p,i.transform.zoom),g=u.projection.name==="globe",_=[256/i.width*2+1,256/i.height*2+1],y=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;y.clear();let x=null;g&&(x=r?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const b=e.lineVertexArray,T=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,S=i.transform.width/i.transform.height;let M,E=!1;for(let A=0;A<T.length;A++){const I=T.get(A),{numGlyphs:z,writingMode:P}=I;if(P!==vi.vertical||E||M===vi.horizontal||(E=!0),M=P,(I.hidden||P===vi.vertical)&&!E){Ja(z,y);continue}E=!1;const R=new B(I.tileAnchorX,I.tileAnchorY);let{x:F,y:N,z:U}=u.projection.projectTilePoint(R.x,R.y,c.canonical);if(l){const[lt,ut,pt]=l(R);F+=lt,N+=ut,U+=pt}const O=[F,N,U,1];if(ei.transformMat4(O,O,t),!VC(O,_)){Ja(z,y);continue}const Z=O[3],W=Jv(i.transform.getCameraToCenterDistance(u.projection),Z),K=Jl(p,f,I),$=s?K/W:K*W,H=Vo(F,N,U,o);if(H[3]<=0){Ja(z,y);continue}let it={};const ot=s?null:l,rt=tb(I,$,!1,a,t,o,n,e.glyphOffsetArray,b,y,x,H,R,it,S,ot,u.projection,c,s);E=rt.useVertical,ot&&rt.needsFlipping&&(it={}),(rt.notEnoughRoom||E||rt.needsFlipping&&tb(I,$,!0,a,t,o,n,e.glyphOffsetArray,b,y,x,H,R,it,S,ot,u.projection,c,s).notEnoughRoom)&&Ja(z,y)}r?(e.text.dynamicLayoutVertexBuffer.updateData(y),x&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(x)):(e.icon.dynamicLayoutVertexBuffer.updateData(y),x&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(x))}function Kv(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y){const{lineStartIndex:x,glyphStartIndex:b,segment:T}=a,S=b+a.numGlyphs,M=x+a.lineLength,E=t.getoffsetX(b),A=t.getoffsetX(S-1),I=zh(e*E,i,r,o,n,s,T,x,M,l,c,u,p,f,!0,g,_,y);if(!I)return null;const z=zh(e*A,i,r,o,n,s,T,x,M,l,c,u,p,f,!0,g,_,y);return z?{first:I,last:z}:null}function Qv(e,t,i,r){return e===vi.horizontal&&Math.abs(r)>Math.abs(i)?{useVertical:!0}:e===vi.vertical?r>0?{needsFlipping:!0}:null:t!==Ya.unknown&&function(o,n){return o===0||Math.abs(n/o)>NC}(i,r)?t===Ya.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function tb(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T){const S=t/24,M=e.lineOffsetX*S,E=e.lineOffsetY*S,{lineStartIndex:A,glyphStartIndex:I,numGlyphs:z,segment:P,writingMode:R,flipState:F}=e,N=A+e.lineLength,U=O=>{if(u){const[$,H,it]=O.up,ot=c.length;Eh(u,ot+0,$,H,it),Eh(u,ot+1,$,H,it),Eh(u,ot+2,$,H,it),Eh(u,ot+3,$,H,it)}const[Z,W,K]=O.point;Xa(c,Z,W,K,O.angle)};if(z>1){const O=Kv(S,a,M,E,i,p,f,e,l,n,g,y,!1,x,b,T);if(!O)return{notEnoughRoom:!0};if(r&&!i){let[Z,W,K]=O.first.point,[$,H,it]=O.last.point;[Z,W]=Vo(Z,W,K,s),[$,H]=Vo($,H,it,s);const ot=Qv(R,F,($-Z)*_,H-W);if(e.flipState=ot&&ot.needsFlipping?Ya.flipRequired:Ya.flipNotRequired,ot)return ot}U(O.first);for(let Z=I+1;Z<I+z-1;Z++){const W=zh(S*a.getoffsetX(Z),M,E,i,p,f,P,A,N,l,n,g,y,!1,!1,x,b,T);if(!W)return c.length-=4*(Z-I),{notEnoughRoom:!0};U(W)}U(O.last)}else{if(r&&!i){const Z=Vo(f.x,f.y,0,o),W=A+P+1,K=new B(l.getx(W),l.gety(W)),$=Vo(K.x,K.y,0,o),H=$[3]>0?$:ib(f,K,Z,1,o,void 0,x,b.canonical),it=Qv(R,F,(H[0]-Z[0])*_,H[1]-Z[1]);if(e.flipState=it&&it.needsFlipping?Ya.flipRequired:Ya.flipNotRequired,it)return it}const O=zh(S*a.getoffsetX(I),M,E,i,p,f,P,A,N,l,n,g,y,!1,!1,x,b,T);if(!O)return{notEnoughRoom:!0};U(O)}return{}}function eb(e,t,i,r,o){const{x:n,y:s,z:a}=r.projectTilePoint(e.x,e.y,t);if(!o)return Vo(n,s,a,i);const[l,c,u]=o(e);return Vo(n+l,s+c,a+u,i)}function ib(e,t,i,r,o,n,s,a){const l=eb(e.sub(t)._unit()._add(e),a,o,s,n);return j.sub(l,i,l),j.normalize(l,l),j.scaleAndAdd(l,i,l,r)}function zh(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b){const T=r?e-t:e+t;let S=T>0?1:-1,M=0;r&&(S*=-1,M=Math.PI),S<0&&(M+=Math.PI);let E=a+s+(S>0?0:1)|0,A=o,I=o,z=0,P=0;const R=Math.abs(T),F=[],N=[];let U=n,O=U;const Z=()=>ib(O,U,I,R-z+1,u,f,y,x.canonical);for(;z+P<=R;){if(E+=S,E<a||E>=l)return null;if(I=A,O=U,F.push(I),g&&N.push(O),U=new B(c.getx(E),c.gety(E)),A=p[E],!A){const ut=eb(U,x.canonical,u,y,f);A=ut[3]>0?p[E]=ut:Z()}z+=P,P=j.distance(I,A)}_&&f&&(p[E]&&(A=Z(),P=j.distance(I,A)),p[E]=A);const W=(R-z)/P,K=U.sub(O)._mult(W)._add(O),$=j.sub([],A,I),H=j.scaleAndAdd([],I,$,W);let it=[0,0,1],ot=$[0],rt=$[1];if(b&&(it=y.upVector(x.canonical,K.x,K.y),it[0]!==0||it[1]!==0||it[2]!==1)){const ut=[it[2],0,-it[0]],pt=j.cross([],it,ut);j.normalize(ut,ut),j.normalize(pt,pt),ot=j.dot($,ut),rt=j.dot($,pt)}if(i){const ut=j.cross([],it,$);j.normalize(ut,ut),j.scaleAndAdd(H,H,ut,i*S)}const lt=M+Math.atan2(rt,ot);return F.push(H),g&&N.push(K),{point:H,angle:lt,path:F,tilePath:N,up:it}}function Ja(e,t){const i=t.length,r=i+4*e;t.resize(r),t.float32.fill(-1/0,4*i,4*r)}function rb(e,t,i){const r=t[0],o=t[1];return e[0]=i[0]*r+i[4]*o+i[12],e[1]=i[1]*r+i[5]*o+i[13],e[3]=i[3]*r+i[7]*o+i[15],e}const ob=(e,t,i)=>(1-i)*e+i*t,nb=e=>e*e*e*e*e;class Wm{constructor(t,i,r,o,n,s,a){this.tileSize=512,this._renderWorldCopies=n===void 0||n,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=r??0,this._maxPitch=o??60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new se(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new kh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Wm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||r)&&this._updateCameraOnTerrain(),(t||r)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return Vr(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=xh(this.projectionOptions);const r=!st(i,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=xh({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return ni(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new B(this.width,this.height)}get bearing(){return Nr(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=Ra.create(),Ra.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=Ut(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=Ft(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let o=0,n=0;for(let s=0;s<i.length;s++){const a=new B(i[s][0]*this.width,r+i[s][1]*(this.height-r)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);o+=l[3]*c,n+=c}return n===0?NaN:o/n}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*i,o=this._mercatorZfromZoom(t),n=this._mercatorZfromZoom(this._maxZoom),s=Math.max(o-r,n);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const o=j.length(j.sub([],this._camera.position,r));return Ut(this._zoomFromMercatorZ(o),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!fr.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];j.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new qv;return i.position=new De(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!fr.length(t))return!1;fr.normalize(t,t);const i=j.transformQuat([],[0,0,-1],t),r=j.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const o=Gv(i,r);return!!o&&(this._camera.orientation=o,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,o=this.cameraToCenterDistance;t[2]=Ut(t[2],o/r,o/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,r){this._unmodified=!1,this._edgeInsets.interpolate(t,i,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){const i=[new tm(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new B(0,0)),o=this.pointCoordinate(new B(this.width,0)),n=this.pointCoordinate(new B(this.width,this.height)),s=this.pointCoordinate(new B(0,this.height)),a=Math.floor(Math.min(r.x,o.x,n.x,s.x)),l=Math.floor(Math.max(r.x,o.x,n.x,s.x)),c=1;for(let u=a-c;u<=l+c;u++)u!==0&&i.push(new tm(u,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,r){let o=[];if(i[0]===0&&i[1]===0)return o;for(const s of t){const a=s.canonical,l=s.overscaledZ,c=s.wrap,u=1<<a.z,p=a.x+1<u,f=a.x>0,g=a.y+1<u,_=a.y>0,y=s.wrap-(f?0:1),x=s.wrap+(p?0:1),b=f?a.x-1:u-1,T=p?a.x+1:0;i[0]<0?(o.push(new Ue(l,x,a.z,T,a.y)),i[1]<0&&g&&(o.push(new Ue(l,c,a.z,a.x,a.y+1)),o.push(new Ue(l,x,a.z,T,a.y+1))),i[1]>0&&_&&(o.push(new Ue(l,c,a.z,a.x,a.y-1)),o.push(new Ue(l,x,a.z,T,a.y-1)))):i[0]>0?(o.push(new Ue(l,y,a.z,b,a.y)),i[1]<0&&g&&(o.push(new Ue(l,c,a.z,a.x,a.y+1)),o.push(new Ue(l,y,a.z,b,a.y+1))),i[1]>0&&_&&(o.push(new Ue(l,c,a.z,a.x,a.y-1)),o.push(new Ue(l,y,a.z,b,a.y-1)))):i[1]<0&&g?o.push(new Ue(l,c,a.z,a.x,a.y+1)):_&&o.push(new Ue(l,c,a.z,a.x,a.y-1))}if(o.length>1){o.sort((l,c)=>l.overscaledZ-c.overscaledZ||l.wrap-c.wrap||l.canonical.z-c.canonical.z||l.canonical.x-c.canonical.x||l.canonical.y-c.canonical.y);let s=0,a=0;for(;a<o.length;)o[a].equals(o[s])?++a:o[++s]=o[a++];o.length=s+1}const n=[];for(const s of o)o.some(a=>s.isChildOf(a))||n.push(s);return o=n.filter(s=>!t.some(a=>!!(s.overscaledZ<r&&a.isChildOf(s))||s.equals(a)||s.isChildOf(a))),o}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,o=this.elevation&&this.elevation.exaggeration(),n=o&&!t.isTerrainDEM,s=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],p=this.projection.name==="globe",f=!p,g=En.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,f),_=p?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),y=c*ni(1,this.center.lat),x=this._camera.position[2]/ni(1,this.center.lat),b=[c*_.x,c*_.y,x*(f?1:y)],T=p||o,S=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),M=this.isLODDisabled(!0)?i:0;let E;if(this._elevation&&t.isTerrainDEM)E=1e4*this._elevation.exaggeration();else if(this._elevation){const $=this._elevation.getMinMaxForVisibleTiles();E=$?$.max:this._centerAltitude}else E=this._centerAltitude;const A=t.isTerrainDEM?-E:this._elevation?this._elevation.getMinElevationBelowMSL():0,I=this.projection.isReprojectedInTileSpace?Zv(this):1,z=$=>{const H=new De($.x+25e-6,$.y,$.z),it=new De($.x,$.y+25e-6,$.z),ot=$.toLngLat(),rt=H.toLngLat(),lt=it.toLngLat(),ut=this.locationCoordinate(ot),pt=this.locationCoordinate(rt),nt=this.locationCoordinate(lt),mt=Math.hypot(pt.x-ut.x,pt.y-ut.y),It=Math.hypot(nt.x-ut.x,nt.y-ut.y);return Math.sqrt(mt*It)*I/25e-6},P=$=>{const H=E,it=A;return{aabb:kv(this,c,0,0,0,$,it,H,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:H,wrap:$,fullyVisible:!1}},R=[];let F=[];const N=i,U=t.reparseOverscaled?r:i,O=$=>$*$,Z=O((x-this._centerAltitude)*y),W=$=>{if(!this._elevation||!$.tileID||!s)return;const H=this._elevation.getMinMaxForTile($.tileID),it=$.aabb;H?(it.min[2]=H.min,it.max[2]=H.max,it.center[2]=(it.min[2]+it.max[2])/2):($.shouldSplit=K($),$.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},K=$=>{if($.zoom<M)return!0;if($.zoom===N)return!1;if($.shouldSplit!=null)return $.shouldSplit;const H=$.aabb.distanceX(b),it=$.aabb.distanceY(b);let ot=Z,rt=1;if(p){ot=O($.aabb.distanceZ(b));const pt=Math.pow(2,$.zoom),nt=Hi(($.y+1)/pt),mt=Hi($.y/pt),It=Math.min(Math.max(l,nt),mt),kt=Hu(It)/Hu(l);if(rt=It===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,kt/this._mercatorScaleRatio),this.zoom<=$l&&$.zoom===N-1&&kt>=.9)return!0}else if(n&&(ot=O($.aabb.distanceZ(b)*y)),this.projection.isReprojectedInTileSpace&&r<=5){const pt=Math.pow(2,$.zoom),nt=z(new De(($.x+.5)/pt,($.y+.5)/pt));rt=nt>.85?1:nt}const lt=H*H+it*it+ot,ut=O((1<<N-$.zoom)*S*rt*((pt,nt)=>{if(nt*O(.707)<pt)return 1;const mt=Math.sqrt(nt/pt);return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,Z),lt));return lt<ut};if(this.renderWorldCopies)for(let $=1;$<=3;$++)R.push(P(-$)),R.push(P($));for(R.push(P(0));R.length>0;){const $=R.pop(),H=$.x,it=$.y;let ot=$.fullyVisible;const rt=()=>this.projection.name==="globe"&&($.y===0||$.y===(1<<$.zoom)-1);if(!ot){let lt=T?$.aabb.intersects(g):$.aabb.intersectsFlat(g);if(lt===0&&rt()){const ut=new To($.zoom,H,it);lt=om(this,c,ut,!0).intersects(g)}if(lt===0)continue;ot=lt===2}if($.zoom!==N&&K($))for(let lt=0;lt<4;lt++){const ut=(H<<1)+lt%2,pt=(it<<1)+(lt>>1),nt={aabb:s?$.aabb.quadrant(lt):kv(this,c,$.zoom+1,ut,pt,$.wrap,$.minZ,$.maxZ,this.projection),zoom:$.zoom+1,x:ut,y:pt,wrap:$.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:$.minZ,maxZ:$.maxZ};n&&!p&&(nt.tileID=new Ue($.zoom+1===N?U:$.zoom+1,$.wrap,$.zoom+1,ut,pt),W(nt)),R.push(nt)}else{const lt=$.zoom===N?U:$.zoom;if(t.minzoom&&t.minzoom>lt)continue;if(!ot){let mt=T?$.aabb.intersectsPrecise(g):$.aabb.intersectsPreciseFlat(g);if(mt===0&&rt()){const It=new To($.zoom,H,it);mt=om(this,c,It,!0).intersectsPrecise(g)}if(mt===0)continue}const ut=u[0]-(.5+H+($.wrap<<$.zoom))*(1<<i-$.zoom),pt=u[1]-.5-it,nt=$.tileID?$.tileID:new Ue(lt,$.wrap,$.zoom,H,it);F.push({tileID:nt,distanceSq:ut*ut+pt*pt})}}if(this.fogCullDistSq){const $=this.fogCullDistSq,H=this.horizonLineFromTop();F=F.filter(it=>{const ot=[0,0,0,1],rt=[at,at,0,1],lt=this.calculateFogTileMatrix(it.tileID.toUnwrapped());ei.transformMat4(ot,ot,lt),ei.transformMat4(rt,rt,lt);const ut=function(mt,It,kt){let Rt=0;for(let Ot=0;Ot<2;++Ot)mt[Ot]>0&&(Rt+=(mt[Ot]-0)*(mt[Ot]-0)),It[Ot]<0&&(Rt+=(0-It[Ot])*(0-It[Ot]));return Rt}(ei.min([],ot,rt),ei.max([],ot,rt));if(ut===0)return!0;let pt=!1;const nt=this._elevation;if(nt&&ut>$&&H!==0){const mt=this.calculateProjMatrix(it.tileID.toUnwrapped());let It;t.isTerrainDEM||(It=nt.getMinMaxForTile(it.tileID)),It||(It={min:A,max:E});const kt=function(Ot){const oe=Math.round((Ot+45+360)%360/90)%4;return ai[oe]}(this.rotation),Rt=[kt[0]*at,kt[1]*at,It.max];j.transformMat4(Rt,Rt,mt),pt=(1-Rt[1])*this.height*.5<H}return ut<$||pt})}return F.sort(($,H)=>$.distanceSq-H.distanceSq).map($=>$.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const i=Ut(t.lat,-Oi,Oi),r=this.projection.project(t.lng,i);return new B(r.x*this.worldSize,r.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/ni(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let r,o;const n=this.centerPoint;if(this.projection.name==="globe"){const a=this.worldSize;r=(i.x-n.x)/a,o=(i.y-n.y)/a}else{const a=this.pointCoordinate(i),l=this.pointCoordinate(n);r=a.x-l.x,o=a.y-l.y}const s=this.locationCoordinate(t);this.setLocation(new De(s.x-r,s.y-o))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,i){const r=i?ni(i,t.lat):void 0,o=this.projection.project(t.lng,t.lat);return new De(o.x,o.y,r)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){const r=i??this._centerAltitude,o=[t.x,t.y,0,1],n=[t.x,t.y,1,1];ei.transformMat4(o,o,this.pixelMatrixInverse),ei.transformMat4(n,n,this.pixelMatrixInverse);const s=n[3];ei.scale(o,o,1/o[3]),ei.scale(n,n,1/s);const a=o[2],l=n[2];return{p0:o,p1:n,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return ei.transformMat4(i,i,this.pixelMatrixInverse),ei.transformMat4(r,r,this.pixelMatrixInverse),ei.scale(i,i,1/i[3]),ei.scale(r,r,1/r[3]),i[2]=ni(i[2],this._center.lat)*this.worldSize,r[2]=ni(r[2],this._center.lat)*this.worldSize,ei.scale(i,i,1/this.worldSize),ei.scale(r,r,1/this.worldSize),new Uu([i[0],i[1],i[2]],j.normalize([],j.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:o}=t,n=ni(i[2],this._center.lat),s=ni(r[2],this._center.lat);return new De(ne(i[0],r[0],o)/this.worldSize,ne(i[1],r[1],o)/this.worldSize,ne(n,s,o))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new De(i[0],i[1],i[2]);let r=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t);const n=.02*o,s=t.clone();for(let a=0;a<10&&o-r>n;a++){s.y=ne(r,o,.66);const l=this.projection.pointCoordinate3D(this,s.x,s.y);l?(o=s.y,i=l):r=s.y}return i?new De(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Kn)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,o=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return ei.transformMat4(o,o,this.pixelMatrix),o[3]>0?new B(o[0]/o[3],o[1]/o[3]):new B(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,n=this.pointLocation3D(new B(i,t)),s=this.pointLocation3D(new B(o,t)),a=this.pointLocation3D(new B(o,r)),l=this.pointLocation3D(new B(i,r));let c=Math.min(n.lng,s.lng,a.lng,l.lng),u=Math.max(n.lng,s.lng,a.lng,l.lng),p=Math.min(n.lat,s.lat,a.lat,l.lat),f=Math.max(n.lat,s.lat,a.lat,l.lat);const g=Math.pow(2,-this.zoom)/16*270,_=this.projection.name==="globe"?1:4,y=(x,b,T,S,M)=>{const E=(x+T)/2,A=(b+S)/2,I=new B(E,A),{lng:z,lat:P}=this.pointLocation3D(I),R=Math.max(0,c-z,p-P,z-u,P-f);c=Math.min(c,z),u=Math.max(u,z),p=Math.min(p,P),f=Math.max(f,P),(M<_||R>g)&&(y(x,b,E,A,M+1),y(E,A,T,S,M+1))};if(y(i,t,o,t,1),y(o,t,o,r,1),y(o,r,i,r,1),y(i,r,i,t,1),this.projection.name==="globe"){const[x,b]=function(T){const S=Q.identity(new Float64Array(16));Q.multiply(S,T.pixelMatrix,T.globeMatrix);const M=[0,Eo,0],E=[0,So,0];return j.transformMat4(M,M,S),j.transformMat4(E,E,S),[M[0]>0&&M[0]<=T.width&&M[1]>0&&M[1]<=T.height&&!Zu(T,new se(T.center.lat,90)),E[0]>0&&E[0]<=T.width&&E[1]>0&&E[1]<=T.height&&!Zu(T,new se(T.center.lat,-90))]}(this);x?(f=90,u=180,c=-180):b&&(p=-90,u=180,c=-180)}return new Wr(new se(c,p),new se(u,f))}_getBoundsRectangular(t,i){const{top:r,left:o}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new B(o,r),l=new B(s,r),c=new B(s,n),u=new B(o,n);let p=this.pointCoordinate(a,t),f=this.pointCoordinate(l,t);const g=this.pointCoordinate(c,i),_=this.pointCoordinate(u,i),y=(x,b)=>(b.y-x.y)/(b.x-x.x);return p.y>1&&f.y>=0?p=new De((1-_.y)/y(_,p)+_.x,1):p.y<0&&f.y<=1&&(p=new De(-_.y/y(_,p)+_.x,0)),f.y>1&&p.y>=0?f=new De((1-g.y)/y(g,f)+g.x,1):f.y<0&&p.y<=1&&(f=new De(-g.y/y(g,f)+g.x,0)),new Wr().extend(this.coordinateLocation(p)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(g))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=t.visibleDemTiles.reduce((r,o)=>{if(o.dem){const n=o.dem.tree;r.min=Math.min(r.min,n.minimums[0]),r.max=Math.max(r.max,n.maximums[0])}return r},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Oi,this.maxLat=Oi,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Ji(this.minLng)*this.tileSize,this.worldMaxX=Ji(this.maxLng)*this.tileSize,this.worldMinY=Qi(this.maxLat)*this.tileSize,this.worldMaxY=Qi(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const o=t.canonical,n=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(o.z),l=(o.x+Math.pow(2,o.z)*t.wrap)*a,c=o.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const p=this.angle,f=Math.sin(-p),g=-Math.cos(-p);return r[i]={bearing:[f,g],center:[(u.x-l)*n,(u.y-c)*n],scale:a/at*n},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const o=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return Q.multiply(o,this.worldToFogMatrix,o),r[i]=new Float32Array(o),r[i]}calculateProjMatrix(t,i=!1,r=!1){const o=t.key;let n;if(n=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,n[o])return n[o];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,Q.multiply(s,a,s),n[o]=new Float32Array(s),n[o]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const o=function(n,s){const{scale:a}=n.tileTransform,l=a*at/(n.tileSize*Math.pow(2,s.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return Ra.scale(new Float32Array(4),s.inverseAdjustmentMatrix,[l,l])}(t,this);return r[i]=o,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,i=Q.fromScaling([],[t,t,t]);return Q.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const i=ni(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),o=this._camera.forward(),n=ni(1,this._center.lat);r[2]/=n,o[2]/=n,j.normalize(o,o);const s=t.raycast(r,o,t.exaggeration());if(s){const a=j.scaleAndAdd([],r,o,s),l=new De(a[0],a[1],ni(a[2],Hi(a[1]))),c=(l.z+j.length([l.x-r[0],l.y-r[1],l.z-r[2]*n]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(c),this._centerAltitude=l.toAltitude(),this._center=this.coordinateLocation(l),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,r=ni(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(r),n=i.getAtPointOrZero(new De(...o)),s=this.pixelsPerMeter/this.worldSize*n,a=this._minimumHeightOverTerrain(),l=o[2]-s;if(l<=a)if(l<0||t){const c=this.locationCoordinate(this._center,this._centerAltitude),u=[o[0],o[1],c.z-o[2]],p=j.length(u);u[2]-=(a-l)/this._pixelsPerMercatorPixel;const f=j.length(u);if(f===0)return;j.scale(u,u,p/f*this._pixelsPerMercatorPixel),this._camera.position=[o[0],o[1],c.z*this._pixelsPerMercatorPixel-u[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const f=this.center;return f.lat=Ut(f.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(f.lng=Ut(f.lng,this.minLng,this.maxLng)),this.center=f,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:o}=this.point;let n=0,s=r,a=o;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,p=this.worldMaxY*this.scale;if(o-c<u&&(a=u+c),o+c>p&&(a=p-c),p-u<this.height&&(n=Math.max(n,this.height/(p-u)),a=(p+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const f=this.worldMinX*this.scale,g=this.worldMaxX*this.scale,_=this.worldSize/2-(f+g)/2;s=(r+_+this.worldSize)%this.worldSize-_,s-l<f&&(s=f+l),s+l>g&&(s=g-l),g-f<this.width&&(n=Math.max(n,this.width/(g-f)),s=(g+f)/2)}s===r&&a===o||(this.center=this.unproject(new B(s,a))),n&&(this.zoom+=this.scaleZoom(n)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.projection.name==="globe",r=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=ni(1,this.center.lat)/ni(1,45));const o=cc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,o),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const n=this.projection.zAxisUnit==="meters"?r:1,s=this._camera.getWorldToCamera(this.worldSize,n);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let P=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),R=P*this.aspect,F=-R,N=-P;R-=t.x,F-=t.x,P+=t.y,N+=t.y,a=this._camera.getCameraToClipOrthographic(F,R,N,P,this._nearZ,this._farZ),((U,O,Z,W)=>{for(let K=0;K<16;K++)U[K]=ob(O[K],Z[K],W)})(a,a,l,nb(this.pitch>=15?1:this.pitch/15))}else a=l;const c=Q.mul([],l,s);let u=Q.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const P=this.locationCoordinate(this.center),R=Q.identity([]);Q.translate(R,R,[P.x*this.worldSize,P.y*this.worldSize,0]),Q.multiply(R,R,$v(this)),Q.translate(R,R,[-P.x*this.worldSize,-P.y*this.worldSize,0]),Q.multiply(u,u,R),Q.multiply(c,c,R),this.inverseAdjustmentMatrix=function(F){const N=$v(F,!0);return Ra.invert([],[N[0],N[1],N[4],N[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=Q.scale([],u,[this.worldSize,this.worldSize,this.worldSize/n,1]),this.projMatrix=u,this.invProjMatrix=Q.invert(new Float64Array(16),this.projMatrix),i){const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.expandedFarZProjMatrix=Q.mul([],P,s)}else this.expandedFarZProjMatrix=this.projMatrix;const p=Q.invert([],a);this.frustumCorners=em.fromInvProjectionMatrix(p,this.horizonLineFromTop(),this.height),this.cameraFrustum=En.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const f=new Float32Array(16);Q.identity(f),Q.scale(f,f,[1,-1,1]),Q.rotateX(f,f,this._pitch),Q.rotateZ(f,f,this.angle);const g=Q.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=Q.clone(g);const _=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;g[8]=2*-t.x/this.width,g[9]=2*(t.y+_)/this.height,this.skyboxMatrix=Q.multiply(f,g,f);const y=this.point,x=y.x,b=y.y,T=this.width%2/2,S=this.height%2/2,M=Math.cos(this.angle),E=Math.sin(this.angle),A=x-Math.round(x)+M*T+E*S,I=b-Math.round(b)+M*S+E*T,z=new Float64Array(u);if(Q.translate(z,z,[A>.5?A-1:A,I>.5?I-1:I,0]),this.alignedProjMatrix=z,u=Q.create(),Q.scale(u,u,[this.width/2,-this.height/2,1]),Q.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=Q.create(),Q.scale(u,u,[1,-1,1]),Q.translate(u,u,[-1,-1,0]),Q.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=Q.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=Q.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(R){const{x:F,y:N}=R.point,{lng:U,lat:O}=R._center;return px(F,N,R.worldSize,U,O)}(this);const P=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=j.transformMat4(P,P,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,o=1/this.height/this._pixelsPerMercatorPixel,n=[t,t,i];j.scale(n,n,o),j.scale(r,r,-1),j.multiply(r,r,n);const s=Q.create();Q.translate(s,s,r),Q.scale(s,s,n),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,o)}_computeCameraPosition(t){const i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),o=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[o.x/this.worldSize-r[0]*n,o.y/this.worldSize-r[1]*n,t/this.worldSize*this._centerAltitude-r[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],o=t[2];let n=1;this.projection.wrap&&(this.center=this.center.wrap()),o>0&&(n=Math.min((i-r)/o,1)),this._camera.position=j.scaleAndAdd([],this._camera.position,t,n),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:o}=this._camera.getPitchBearing(),n=ni(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Ft(this._maxPitch)),a=Math.max((t[2]-n)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);j.scaleAndAdd(t,t,i,a),this._pitch=Ut(r,Ft(this.minPitch),Ft(this.maxPitch)),this.angle=Nr(o,-Math.PI,Math.PI),this._setZoom(Ut(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new De(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,r=Kn,o=0,n=1/0;for(;r-i>1e-6&&r>i;){const s=i+.5*(r-i),a=this.tileSize*Math.pow(2,s),l=this.getCameraToCenterDistance(this.projection,s,a),c=this.scaleZoom(l/(t*this.tileSize)),u=Math.abs(s-c);u<n&&(n=u,o=s),s<c?i=s:r=s}return o}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Y("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),o=Math.max(t.x,i.x),n=Math.min(t.y,i.y),s=Math.max(t.y,i.y);if(n<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const a=[new B(r,n),new B(o,s),new B(r,s),new B(o,n)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const u of a){const p=this.pointRayIntersection(u);if(p.t<0)return!0;const f=this.rayIntersectionCoordinate(p);if(f.x<l||f.y<0||f.x>c||f.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+Te(this.fovAboveCenter)>88||this.anyCornerOffEdge(new B(0,0),new B(this.width,this.height))}zoomDeltaToMovement(t,i){const r=j.length(j.sub([],this._camera.position,t)),o=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(o)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([i,r,o],n){const s=[i,r,o,1];ei.transformMat4(s,s,n);const a=s[3]=Math.max(s[3],1e-6);return s[0]/=a,s[1]/=a,s[2]/=a,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new B(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new B(0,t))}}getCameraToCenterDistance(t,i=this.zoom,r=this.worldSize){const o=cc(t,i,this.width,this.height,1024),n=t.pixelSpaceConversion(this.center.lat,r,o);let s=.5/Math.tan(.5*this._fov)*this.height*n;return this.isOrthographic&&(s=ob(1,s,nb(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&Q.multiply(t,t,this.globeMatrix),t}getFrustum(t){return En.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}function sb(e,t,i){Q.identity(e),Q.rotateZ(e,e,Ft(t[2])),Q.rotateX(e,e,Ft(t[0])),Q.rotateY(e,e,Ft(t[1])),Q.scale(e,e,i),Q.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ph(e,t,i,r,o,n,s,a){const l=[i[0]-t[0],i[1]-t[1],0],c=[r[0]-t[0],r[1]-t[1],0];if(j.length(l)<1e-12||j.length(c)<1e-12)return fr.identity(e);const u=j.cross([],l,c);j.normalize(u,u),j.subtract(c,r,t),l[2]=(n-o)*a,c[2]=(s-o)*a;const p=l;return j.cross(p,l,c),j.normalize(p,p),fr.rotationTo(e,u,p)}function ab(e,t,i=!1){const r=ar(t.zoom),o=function(n,s,a){const l=s.worldSize,c=[n[12],n[13],n[14]],u=Hi(c[1]/l),p=Xr(c[0]/l),f=Q.identity([]),g=ni(1,u)*l,_=ni(1,0)*l*es(u,s.zoom),y=1/am(l);let x=_*y;if(a){const M=cc(s.projection,s.zoom,s.width,s.height,1024);x=y*s.projection.pixelSpaceConversion(s.center.lat,l,M)}const b=Or(u,p);j.add(b,b,j.scale([],j.normalize([],b),g*x*c[2]));const T=function(M){const E=[M[0],M[1],M[2]];let A=[0,1,0];const I=j.cross([],A,E);return j.cross(A,E,I),j.squaredLength(A)===0&&(A=[0,1,0],j.cross(I,E,A)),j.normalize(I,I),j.normalize(A,A),j.normalize(E,E),[I[0],I[1],I[2],0,A[0],A[1],A[2],0,E[0],E[1],E[2],0,M[0],M[1],M[2],1]}(b);Q.scale(f,f,[x,x,x*g]),Q.translate(f,f,[-c[0],-c[1],-c[2]]);const S=Q.multiply([],s.globeMatrix,T);return Q.multiply(S,S,f),Q.multiply(S,S,n),S}(e,t,i);if(r>0){const n=function(s,a){const l=a.worldSize,c=ni(1,0)*l*es(a.center.lat,a.zoom)/am(l),u=ni(1,a.center.lat)*l,p=Q.identity([]);return Q.rotateY(p,p,Ft(a.center.lng)),Q.rotateX(p,p,Ft(a.center.lat)),Q.translate(p,p,[0,0,Ar]),Q.scale(p,p,[c,c,c*u]),Q.translate(p,p,[a.point.x-.5*l,a.point.y-.5*l,0]),Q.multiply(p,p,s),Q.multiply(p,a.globeMatrix,p)}(e,t);return function(s,a,l){const c=(_,y,x)=>{const b=j.length(_),T=j.length(y),S=Sn(_,y,x);return j.scale(S,S,1/j.length(S)*ne(b,T,x))},u=c([s[0],s[1],s[2]],[a[0],a[1],a[2]],l),p=c([s[4],s[5],s[6]],[a[4],a[5],a[6]],l),f=c([s[8],s[9],s[10]],[a[8],a[9],a[10]],l),g=Sn([s[12],s[13],s[14]],[a[12],a[13],a[14]],l);return[u[0],u[1],u[2],0,p[0],p[1],p[2],0,f[0],f[1],f[2],0,g[0],g[1],g[2],1]}(o,n,r)}return o}const Us=64,UC=[1,1,1];class lb{constructor(t,i,r,o){this.id=t,this.position=i!=null?new se(i[0],i[1]):new se(0,0),this.orientation=r??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(Q.multiply(t.matrix,i,t.matrix),t.meshes)for(const r of t.meshes){const o=di.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=Q.identity([]);for(const i of this.nodes)this._applyTransformations(i,t)}_positionModelOnTerrain(t,i){const r=t.elevation;if(!r)return 0;const o=di.projectAabbCorners(this.aabb,this.matrix),n=ni(1,this.position.lat)*t.worldSize,s=function(b,T){const S=[0,0,1],M=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const E of M){const A=b[E.corners[0]],I=b[E.corners[1]],z=b[E.corners[2]],P=[I[0]-A[0],I[1]-A[1],T*(I[2]-A[2])],R=j.cross(P,P,[z[0]-A[0],z[1]-A[1],T*(z[2]-A[2])]);j.normalize(R,R),E.dotProductWithUp=j.dot(R,S)}return M.sort((E,A)=>E.dotProductWithUp-A.dotProductWithUp),M[0].corners}(o,n),a=o[s[0]],l=o[s[1]],c=o[s[2]],u=o[s[3]],p=r.getAtPointOrZero(new De(a[0]/t.worldSize,a[1]/t.worldSize),0),f=r.getAtPointOrZero(new De(l[0]/t.worldSize,l[1]/t.worldSize),0),g=r.getAtPointOrZero(new De(c[0]/t.worldSize,c[1]/t.worldSize),0),_=r.getAtPointOrZero(new De(u[0]/t.worldSize,u[1]/t.worldSize),0),y=(p+_)/2,x=(f+g)/2;return y>x?f<g?Ph(i,l,u,a,f,_,p,n):Ph(i,c,a,u,g,p,_,n):p<_?Ph(i,a,l,c,p,f,g,n):Ph(i,u,c,l,_,g,f,n),Math.max(y,x)}computeModelMatrix(t,i,r,o,n,s,a=!1){const l=t.transform,c=l.zoom,u=l.project(this.position),p=es(this.position.lat,c),f=1/p;Q.identity(this.matrix),Q.translate(this.matrix,this.matrix,[u.x+o[0]*f,u.y+o[1]*f,o[2]]);let g=1,_=1;const y=l.worldSize;if(a){if(l.projection.name==="mercator"){let S=0;l.elevation&&(S=l.elevation.getAtPointOrZero(new De(u.x/y,u.y/y),0));const M=ei.transformMat4([],[u.x,u.y,S,1],l.projMatrix)[3]/l.cameraToCenterDistance;g=M,_=M*es(l.center.lat,c)}else if(l.projection.name==="globe"){const S=ab(this.matrix,l),M=Q.multiply([],l.projMatrix,S),E=[0,0,0,1];ei.transformMat4(E,E,M);const A=E[3]/l.cameraToCenterDistance,I=ar(c),z=l.projection.pixelsPerMeter(this.position.lat,y)*es(this.position.lat,c),P=l.projection.pixelsPerMeter(l.center.lat,y)*es(l.center.lat,c);g=A/ne(z,wx(l.center.lat),I),_=A*p/z,g*=P,_*=P}}else g=f;Q.scale(this.matrix,this.matrix,[g,g,_]);const x=[...this.matrix],b=this.orientation,T=[];if(sb(T,[b[0]+i[0],b[1]+i[1],b[2]+i[2]],r),Q.multiply(this.matrix,x,T),n&&l.elevation){let S=0;const M=[];if(s&&l.elevation){S=this._positionModelOnTerrain(l,M);const E=Q.fromQuat([],M),A=Q.multiply([],E,T);Q.multiply(this.matrix,x,A)}else S=l.elevation.getAtPointOrZero(new De(u.x/y,u.y/y),0);S!==0&&(this.matrix[14]+=S)}}upload(t){if(!this.uploaded){for(const i of this.nodes)Xm(i,t);for(const i of this.nodes)Rh(i);this.uploaded=!0}}destroy(){for(const t of this.nodes)Lh(t)}}function uc(e,t,i=!1){e.uploaded||(e.gfxTexture=new Mi(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function GC(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,zC.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,OC.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,LC.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?PC:RC).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,FC.members,!0)),e.segments=ti.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&uc(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&uc(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&uc(r.normalTexture,t),r.occlusionTexture&&uc(r.occlusionTexture,t,i),r.emissionTexture&&uc(r.emissionTexture,t)}function Xm(e,t,i){if(e.meshes)for(const r of e.meshes)GC(r,t,i);if(e.children)for(const r of e.children)Xm(r,t,i)}function Rh(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Rh(t)}function Lh(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const i of e.children)Lh(i)}class cb{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ub{constructor(){this.instancedDataArray=new Df,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class hb{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,r,o){this.tileToMeter=Hl(r);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const u=is(s,n);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),u,r))continue;const p={id:a,sourceLayerIndex:c,index:l,geometry:n?u.geometry:Ko(s,r,o),properties:s.properties,type:s.type,patterns:{}},f=this.addFeature(p,p.geometry,u);f&&i.featureIndex.insert(s,p.geometry,l,c,this.index,this.instancesPerModel[f].instancedDataArray.length)}this.lookup=null}update(t,i,r,o){for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];for(const a in t)s.idToFeaturesIndex.hasOwnProperty(a)&&this.evaluate(s.features[s.idToFeaturesIndex[a]],t[a],s,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const o of r.features){const n=this.layers[0],s=o.feature,a=this.canonical,l=n.paint.get("model-rotation").evaluate(s,{},a),c=n.paint.get("model-scale").evaluate(s,{},a),u=n.paint.get("model-translation").evaluate(s,{},a);j.exactEquals(o.rotation,l)&&j.exactEquals(o.scale,c)&&j.exactEquals(o.translation,u)||(this.evaluate(o,o.featureStates,r,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=t.createVertexBuffer(r.instancedDataArray,BC.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,r){const o=this.layers[0],n=o.layout.get("model-id").evaluate(r,{},this.canonical);if(!n)return Y(`modelId is not evaluated for layer ${o.id} and it is not going to get rendered.`),n;this.instancesPerModel[n]||(this.instancesPerModel[n]=new ub);const s=this.instancesPerModel[n],a=s.instancedDataArray,l=new cb(r,a.length);for(const c of i)for(const u of c){if(u.x<0||u.x>=at||u.y<0||u.y>=at)continue;const p=(this.lookupDim-1)/at,f=this.lookupDim*(u.y*p|0)+u.x*p|0;if(this.lookup){if(this.lookup[f]!==0)continue;this.lookup[f]=1}this.instanceCount++;const g=a.length;a.resize(g+1),s.instancesEvaluatedElevation.push(0),a.float32[16*g]=u.x,a.float32[16*g+1]=u.y}return l.instancedDataCount=s.instancedDataArray.length-l.instancedDataOffset,l.instancedDataCount>0&&(t.id&&(s.idToFeaturesIndex[t.id]=s.features.length),s.features.push(l),this.evaluate(l,{},s,!1)),n}evaluate(t,i,r,o){const n=this.layers[0],s=t.feature,a=this.canonical,l=t.rotation=n.paint.get("model-rotation").evaluate(s,i,a),c=t.scale=n.paint.get("model-scale").evaluate(s,i,a),u=t.translation=n.paint.get("model-translation").evaluate(s,i,a),p=n.paint.get("model-color").evaluate(s,i,a);p.a=n.paint.get("model-color-mix-intensity").evaluate(s,i,a);const f=[];this.maxVerticalOffset<u[2]&&(this.maxVerticalOffset=u[2]),this.maxScale=Math.max(Math.max(this.maxScale,c[0]),Math.max(c[1],c[2])),sb(f,l,c);const g=Math.round(100*p.a)+p.b/1.05;for(let _=0;_<t.instancedDataCount;++_){const y=t.instancedDataOffset+_,x=16*y,b=r.instancedDataArray.float32;let T=0;o&&(T=b[x+6]-r.instancesEvaluatedElevation[y]);const S=0|b[x+1];b[x]=(0|b[x])+p.r/1.05,b[x+1]=S+p.g/1.05,b[x+2]=g,b[x+3]=1/(a.z>10?this.tileToMeter:Hl(a,S)),b[x+4]=u[0],b[x+5]=u[1],b[x+6]=u[2]+T,b[x+7]=f[0],b[x+8]=f[1],b[x+9]=f[2],b[x+10]=f[4],b[x+11]=f[5],b[x+12]=f[6],b[x+13]=f[8],b[x+14]=f[9],b[x+15]=f[10],r.instancesEvaluatedElevation[y]=u[2]}}}jt(hb,"ModelBucket",{omit:["layers"]}),jt(ub,"PerModelAttributes"),jt(cb,"ModelFeature");const qC=new Pi({visibility:new bt(tt.layout_model.visibility),"model-id":new Yt(tt.layout_model["model-id"])});var $C={paint:new Pi({"model-opacity":new bt(tt.paint_model["model-opacity"]),"model-rotation":new Yt(tt.paint_model["model-rotation"]),"model-scale":new Yt(tt.paint_model["model-scale"]),"model-translation":new Yt(tt.paint_model["model-translation"]),"model-color":new Yt(tt.paint_model["model-color"]),"model-color-mix-intensity":new Yt(tt.paint_model["model-color-mix-intensity"]),"model-type":new bt(tt.paint_model["model-type"]),"model-cast-shadows":new bt(tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Yt(tt.paint_model["model-emissive-strength"]),"model-roughness":new Yt(tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Yt(tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(tt.paint_model["model-cutoff-fade-range"])}),layout:qC};const Ym=new Float32Array(262144),Gs=new Uint8Array(262144);function db(e){let t=0;if(e.meshes)for(const i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(const i of e.children)t=Math.max(t,db(i));return t}const pb=["","wall","door","roof","window","lamp","logo"];class fb{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:db(t)}}}}class mb{constructor(t,i,r,o){this.nodes=t,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=o,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const r of i){const o=r.node;this.uploaded?this.updatePbrBuffer(o):Xm(o,t,!0)}for(const r of i)Rh(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(const r of t.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(t,i,r){const o=t.transform.projectionOptions,n=t.style.getBrightness(),s=this.brightness!==n;return!!(!this.uploaded||this.dirty||o.name!==this.projection.name||hc(r.paint.get("model-color").value,s)||hc(r.paint.get("model-color-mix-intensity").value,s)||hc(r.paint.get("model-roughness").value,s)||hc(r.paint.get("model-emissive-strength").value,s)||hc(r.paint.get("model-height-based-emissive-strength-multiplier").value,s))&&(this.projection=o,this.brightness=n,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const r=this.getNodesInfo(),o=this.id.canonical;for(const n of r){const s=n.feature;n.evaluatedScale=i.paint.get("model-scale").evaluate(s,{},o)}}evaluate(t){const i=this.getNodesInfo();for(const r of i){if(!r.node.meshes)continue;const o=r.feature,n=r.node.meshes&&r.node.meshes[0].featureData,s=r.evaluatedColor[2],a=r.evaluatedRMEA[2],l=this.id.canonical;if(r.hasTranslucentParts=!1,n){for(let c=0;c<pb.length;c++){const u=pb[c];u.length&&(o.properties.part=u);const p=t.paint.get("model-color").evaluate(o,{},l),f=t.paint.get("model-color-mix-intensity").evaluate(o,{},l);r.evaluatedColor[c]=[p.r,p.g,p.b,f],r.evaluatedRMEA[c][0]=t.paint.get("model-roughness").evaluate(o,{},l),r.evaluatedRMEA[c][2]=t.paint.get("model-emissive-strength").evaluate(o,{},l),r.evaluatedRMEA[c][3]=p.a,r.emissionHeightBasedParams[c]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(o,{},l),!r.hasTranslucentParts&&p.a<1&&(r.hasTranslucentParts=!0)}delete o.properties.part,HC(r,s!==r.evaluatedColor[2]||a!==r.evaluatedRMEA[2])}r.evaluatedScale=t.paint.get("model-scale").evaluate(o,{},l),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,r,o){const n=t.findDEMTileFor(r);if(n&&(n.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const s=Ga.create(t,r,n);if(!s)return;4&this.modelTraits&&this.updateDEM(t,s,r,o);for(const a of this.getNodesInfo()){const l=a.node;if(!l.footprint||!l.footprint.vertices||!l.footprint.vertices.length)continue;const c=l.footprint.vertices;let u=s.getElevationAt(c[0].x,c[0].y,!0,!0);for(let p=1;p<c.length;p++)u=Math.min(u,s.getElevationAt(c[p].x,c[p].y,!0,!0));l.elevation=u}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,r,o){let n=i._dem._modifiedForSources[o];if(n===void 0&&(i._dem._modifiedForSources[o]=[],n=i._dem._modifiedForSources[o]),n.includes(r.canonical))return;const s=i._dem.dim;n.push(r.canonical);let a=!1;for(const l of this.getNodesInfo()){const c=l.node;if(!c.footprint||!c.footprint.grid)continue;const u=c.footprint.grid,p=i.tileCoordToPixel(u.min.x,u.min.y),f=i.tileCoordToPixel(u.max.x,u.max.y),g=Math.min(Math.min(s-f.y,p.x),Math.min(p.y,s-f.x));if(g<0)continue;const _=Ut(g,2,5);let y=Math.max(0,p.x-_),x=Math.max(0,p.y-_),b=Math.min(f.x+_,s-1),T=Math.min(f.y+_,s-1);for(let A=x;A<=T;++A)for(let I=y;I<=b;++I)Gs[A*s+I]=255;let S=0,M=0;for(let A=0;A<u.cellsY;++A)for(let I=0;I<u.cellsX;++I){if(!u.cells[A*u.cellsX+I])continue;const z=i.tileCoordToPixel(u.min.x+I/u.xScale,u.min.y+A/u.yScale),P=i.tileCoordToPixel(u.min.x+(I+1)/u.xScale,u.min.y+(A+1)/u.yScale);for(let R=z.y;R<=Math.min(P.y+1,s-1);++R)for(let F=z.x;F<=Math.min(P.x+1,s-1);++F)Gs[R*s+F]===255&&(Gs[R*s+F]=0,S+=i.getElevationAtPixel(F,R),M++)}const E=S/M;y=Math.max(1,p.x-_),x=Math.max(1,p.y-_),b=Math.min(f.x+_,s-2),T=Math.min(f.y+_,s-2),a=!0;for(let A=x;A<=T;++A)for(let I=y;I<=b;++I)Gs[A*s+I]===0&&(Ym[A*s+I]=i._dem.set(I,A,E));for(let A=1;A<_;++A){y=Math.max(1,p.x-A),x=Math.max(1,p.y-A),b=Math.min(f.x+A,s-2),T=Math.min(f.y+A,s-2);for(let I=x;I<=T;++I)for(let z=y;z<=b;++z){const P=I*s+z;if(Gs[P]===255){let R=0,F=0,N=-1,U=-1;for(let O=-1;O<=1;++O)for(let Z=-1;Z<=1;++Z){const W=(I+O)*s+z+Z;if(Gs[W]>=A)continue;const K=Ym[W],$=Math.abs(K);$>F&&(R=K,F=$,N=Z,U=O)}if(F>.1){const O=1-(A+.5*Math.abs(N*U))/_;let Z=i._dem.get(z,I)+R*O;const W=i._dem.get(z+N,I+U),K=i._dem.get(z-N,I-U,!0);(Z-W)*(Z-K)>0&&(Z=(W+K)/2),Ym[P]=i._dem.set(z,I,Z),Gs[P]=A}}}}}a&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ce.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new fb(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Lh(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const i of t)Rh(i.node),Lh(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(t.toUnwrapped()),o=this.getNodesInfo();for(let n=0;n<this.nodesInfo.length;n++){const s=o[n].node;o[n].hiddenByReplacement=!!s.footprint&&!r.find(a=>a.footprint===s.footprint)}}getHeightAtTileCoord(t,i){const r=this.getNodesInfo(),o=[];for(let n=0;n<this.nodesInfo.length;n++){const s=r[n],a=s.node.meshes[0];if(t<a.aabb.min[0]||i<a.aabb.min[1]||t>a.aabb.max[0]||i>a.aabb.max[1])continue;const l=(t-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*Us|0,c=Math.min(63,(i-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*Us|0)*Us+Math.min(63,l);if(!(a.heightmap[c]<0&&s.node.footprint))return s.hiddenByReplacement?void 0:{height:a.heightmap[c],maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]};if(s.node.footprint.grid.query(new B(t,i),new B(t,i),o),o.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function hc(e,t){return!e.isLightConstant&&t}function ZC(e,t,i,r,o,n,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;i[3]>0&&(l=ne(l,255*i[0],i[3]),c=ne(c,255*i[1],i[3]),u=ne(u,255*i[2],i[3]));const p=l<<8|c,f=u<<8|Math.floor(255*r[3]),g=function(A){const I=Ut(A,0,2);return Math.min(Math.round(.5*I*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],_=Ut(o[0],0,1),y=Ut(o[1],0,1),x=Ut(o[2],0,1),b=Ut(o[3],0,1);let T,S,M,E;if(_!==y&&s!==n&&y!==_){const A=s-n;S=1/(A*(y-_)),M=-(n+A*_)/(A*(y-_));const I=Ut(o[4],-1,1);E=Math.pow(10,I),T=255*x<<8|255*b}else T=65535,S=0,M=1,E=1;if(e.emplaceBack(p,f,g,T,S,M,E),a){const A=a.length;a.clear();for(let I=0;I<A;I++)a.emplaceBack(p,f,g,T,S,M,E)}}function HC(e,t){const i=e.node;let r=0;for(const o of i.meshes){if(i.lights&&i.lightMeshIndex===r||!o.featureData)continue;o.featureArray=new Lu,o.featureArray.reserve(o.featureData.length);let n=t;for(const s of o.featureData){let a;const l=65535&s,c=(15&l)<8?15&l:0,u=s>>16&65535,p=e.evaluatedRMEA[c],f=e.evaluatedColor[c],g=e.emissionHeightBasedParams[c];if(n&&c===2&&i.lights&&(a=new Lu,a.resize(10*i.lights.length)),ZC(o.featureArray,u,f,p,g,o.aabb.min[2],o.aabb.max[2],a),a&&n){n=!1;const _=i.meshes[i.lightMeshIndex];_.featureArray=a,_.featureArray._trim()}}o.featureArray._trim(),r++}}jt(mb,"Tiled3dModelBucket",{omit:["layers"]}),jt(fb,"Tiled3dModelFeature");class WC{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const i=yb(new B(0,0),new B(at,at),t),r=[];for(const o of this._activeRegions){if(o.hiddenByOverlap||!_b(i,o))continue;const n=XC(o.min,o.max,t);r.push({min:n.min,max:n.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return r}setSources(t){this._setSources(t.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const r=[];for(const o of i.cache.getVisibleCoordinates()){const n=i.cache.getTile(o).buckets[i.layer];if(n)for(const s of n.getNodesInfo()){const a=s.node;a.footprint&&r.push({footprint:a.footprint,id:o.toUnwrapped()})}}return r}})))}_addSource(t){const i=t.getFootprints();if(i.length!==0){for(const r of i){if(!r.footprint)continue;const o=yb(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,r)=>i.priority-r.priority||Oh(i.min,r.min)||Oh(i.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let i=0,r=0;for(;!t&&i!==this._activeRegions.length;){const o=this._activeRegions[i],n=this._prevRegions[r];t=o.priority!==n.priority||!gb(o,n),++i,++r}}if(t){++this._updateTime;const i=r=>{const o=this._activeRegions;if(r>=o.length)return r;const n=o[r].priority;for(;r<o.length&&o[r].priority===n;)++r;return r};if(this._sourceIds.length>1){let r=0,o=i(r);for(;r!==o;){let n=r;const s=r;for(;n!==o;){const a=this._activeRegions[n];a.hiddenByOverlap=!1;for(let l=0;l<s;l++){const c=this._activeRegions[l];if(!c.hiddenByOverlap&&_b(a,c)&&(a.hiddenByOverlap=vb(a.footprint,a.tileId,c.footprint,c.tileId),a.hiddenByOverlap))break}++n}r=o,o=i(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=t.length-1;i>=0;i--)this._addSource(t[i]);this._computeReplacement()}}function Oh(e,t){return e.x-t.x||e.y-t.y}function gb(e,t){return Oh(e.min,t.min)===0&&Oh(e.max,t.max)===0}function _b(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function yb(e,t,i){const r=1/at,o=1/(1<<i.canonical.z),n=(t.x*r+i.canonical.x)*o+i.wrap,s=(t.y*r+i.canonical.y)*o;return{min:new B((e.x*r+i.canonical.x)*o+i.wrap,(e.y*r+i.canonical.y)*o),max:new B(n,s)}}function XC(e,t,i){const r=1<<i.canonical.z,o=((t.x-i.wrap)*r-i.canonical.x)*at,n=(t.y*r-i.canonical.y)*at;return{min:new B(((e.x-i.wrap)*r-i.canonical.x)*at,(e.y*r-i.canonical.y)*at),max:new B(o,n)}}function xb(e,t,i,r,o,n,s){const a=e.indices,l=e.vertices,c=[];for(let u=r;u<r+o;u+=3){const p=t[i[u+0]+n],f=t[i[u+1]+n],g=t[i[u+2]+n],_=Math.min(p.x,f.x,g.x),y=Math.max(p.x,f.x,g.x),x=Math.min(p.y,f.y,g.y),b=Math.max(p.y,f.y,g.y);c.length=0,e.grid.query(new B(_,x),new B(y,b),c);for(let T=0;T<c.length;T++){const S=c[T];if(gm(l[a[3*S+0]],l[a[3*S+1]],l[a[3*S+2]],p,f,g,s))return!0}}return!1}function vb(e,t,i,r){if(!e||!i)return!1;let o=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(i.vertices.length<e.vertices.length)return vb(i,r,e,t);const n=t.canonical,s=r.canonical,a=Math.pow(2,s.z-n.z);o=e.vertices.map(l=>new B(l.x*n.x*at*a-s.x*at,l.y*n.y*at*a-s.y*at))}return xb(i,o,e.indices,0,e.indices.length,0,0)}const YC=nh.types,JC=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],KC=["fill-extrusion-flood-light-ground-radius"],QC=Math.pow(2,13),tI=Math.pow(2,15)-1,bb=new B(0,1),rn=2147483648;function dc(e,t,i,r,o,n,s,a){e.emplaceBack((t<<1)+s,(i<<1)+n,(Math.floor(r*QC)<<1)+o,Math.round(a))}function Bh(e,t,i,r,o,n){e.emplaceBack(t.x,t.y,(i.x<<1)+r,(i.y<<1)+o,n)}function pc(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class wb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Tb{constructor(){this.centroidXY=new B(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new B(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new B(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new B(this.max.x-this.min.x,this.max.y-this.min.y)}}class Eb{constructor(){this.acc=new B(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,r){this.accCount++,this.acc._add(i);let o=!!this.borders;i.x<t.min.x?(t.min.x=i.x,o=!0):i.x>t.max.x&&(t.max.x=i.x,o=!0),i.y<t.min.y?(t.min.y=i.y,o=!0):i.y>t.max.y&&(t.max.y=i.y,o=!0),((i.x===0||i.x===at)&&i.x===r.x)!=((i.y===0||i.y===at)&&i.y===r.y)&&this.processBorderOverlap(i,r),o&&this.checkBorderIntersection(i,r)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,ne(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>at!=t.x>at&&this.addBorderIntersection(1,ne(i.y,t.y,(at-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,ne(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>at!=t.y>at&&this.addBorderIntersection(3,ne(i.x,t.x,(at-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[t];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const r=t.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,t.y)}else{const r=t.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,t.x)}}centroid(){return this.accCount===0?new B(0,0):new B(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function Sb(e,t){const i=e.add(t)._unit(),r=Ut(e.x*i.x+e.y*i.y,-1,1);var o,n,s;return o=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(o)))/4*tI*((n=e).x*(s=t).y-n.y*s.x<0?-1:1)}const eI=[e=>e.x<0,e=>e.x>at,e=>e.y<0,e=>e.y>at];function iI(e,t,i,r){const o=[4];if(r===0)return o;i._mult(r);const n=e.sub(i),s=t.sub(i),a=[e,t,n,s];for(let l=0;l<4;l++)for(const c of a)if(eI[l](c)){o.push(l);break}return o}class Mb{constructor(t){this.vertexArray=new xf,this.indexArray=new Zi,this.programConfigurations=new Xn(t.layers,t.zoom,i=>KC.includes(i)),this._segments=new ti,this.hiddenByLandmarkVertexArray=new zf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ti}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,r,o=!1){const n=t.length;if(n>2){let s=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let l;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const c=t[0],u=t[1];l=Sb(c.sub(t[n-1])._perp()._unit(),u.sub(c)._perp()._unit())}for(let c=0;c<n;c++){const u=c===n-1?0:c+1,p=t[c],f=t[u],g=t[u===n-1?0:u+1],_=f.sub(p)._perp()._unit(),y=Sb(_,g.sub(f)._perp()._unit()),x=l,b=y;if(Jm(p,f,i)||o&&Ib(p,i)&&Ib(f,i)){l=y;continue}const T=a.vertexLength;Bh(this.vertexArray,p,f,1,1,x),Bh(this.vertexArray,p,f,1,0,x),Bh(this.vertexArray,p,f,0,1,b),Bh(this.vertexArray,p,f,0,0,b),a.vertexLength+=4;const S=iI(p,f,_,r);for(const M of S)this._segmentToGroundQuads[s].push({id:T,region:M}),this._segmentToRegionTriCounts[s][M]+=2,a.primitiveLength+=2;l=y}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),i=t.length;for(let r=0;r<i;r++)this._segmentToGroundQuads[r].sort((o,n)=>o.region-n.region);for(let r=0;r<i;r++){const o=this._segmentToGroundQuads[r],n=t[r],s=this._segmentToRegionTriCounts[r];s.reduce((l,c)=>l+c,0);let a=0;for(let l=0;l<=4;l++){const c=s[l];if(c!==0){let u=this.regionSegments[l];u||(u=this.regionSegments[l]=new ti);const p={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+a,vertexLength:n.vertexLength,primitiveLength:c};u.get().push(p)}a+=c}for(let l=0;l<o.length;l++){const c=o[l].id;this.indexArray.emplaceBack(c,c+1,c+3),this.indexArray.emplaceBack(c,c+3,c+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,r,o,n,s){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,r,o,n,s)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,MM.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,r,o,n,s){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,r,o,n,s)}updateHiddenByLandmark(t){if(!this.hasData())return;const i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const r=t.flags&rn?1:0;for(let o=t.groundVertexArrayOffset;o<i;++o)this.hiddenByLandmarkVertexArray.emplace(o,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,CM.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const i=this.regionSegments[t];i&&i.destroy()}}}}class fc{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Zi,this.footprintVertices=new Zr,this.footprintSegments=[],this.layoutVertexArray=new Ps,this.centroidVertexArray=new Oy,this.indexArray=new Zi,this.programConfigurations=new Xn(t.layers,t.zoom,i=>JC.includes(i)),this.segments=new ti,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Mb(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,r,o){this.features=[],this.hasPattern=Tm("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Hl(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:s,index:a,sourceLayerIndex:l}of t){const c=this.layers[0]._featureFilter.needGeometry,u=is(n,c);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),u,r))continue;const p={id:s,sourceLayerIndex:l,index:a,geometry:c?u.geometry:Ko(n,r,o),properties:n.properties,type:n.type,patterns:{}},f=this.layoutVertexArray.length;this.hasPattern?this.features.push(Em("fill-extrusion",this.layers,p,this.zoom,i)):this.addFeature(p,p.geometry,a,r,{},i.availableImages,o,i.brightness),i.featureIndex.insert(n,p.geometry,a,l,this.index,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,r,o,n,s){for(const a of this.features){const{geometry:l}=a;this.addFeature(a,l,a.index,i,r,o,n,s)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,r,o,n){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const a=s?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,a,r,o,n),this.groundEffect.update(t,i,a,r,o,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kM),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,IM.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,AM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,r,o,n,s,a,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new B(0,0),new B(at,at)],p=a.projection,f=p.name==="globe",g=YC[t.type]==="Polygon",_=new Eb;_.centroidDataIndex=this.centroidData.length;const y=new Tb,x=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},o)<=0,b=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},o);y.height=b,y.vertexArrayOffset=this.layoutVertexArray.length,y.groundVertexArrayOffset=this.groundEffect.vertexArray.length,f&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pu);const T=wm(i,500);for(let z=T.length-1;z>=0;z--){const P=T[z];(P.length===0||(S=P[0]).every(R=>R.x<=0)||S.every(R=>R.x>=at)||S.every(R=>R.y<=0)||S.every(R=>R.y>=at))&&T.splice(z,1)}var S;let M;if(f)M=Pb(T,u,o);else{M=[];for(const z of T)M.push({polygon:z,bounds:u})}const E=g?this.edgeRadius:0,A=E>0&&this.zoom<17,I=(z,P)=>{if(z.length===0)return!1;const R=z[z.length-1];return P.x===R.x&&P.y===R.y};for(const{polygon:z,bounds:P}of M){let R=0,F=0;for(const Z of z)g&&!Z[0].equals(Z[Z.length-1])&&Z.push(Z[0]),F+=g?Z.length-1:Z.length;const N=this.segments.prepareSegment((g?5:4)*F,this.layoutVertexArray,this.indexArray);y.footprintSegIdx<0&&(y.footprintSegIdx=this.footprintSegments.length),y.polygonSegIdx<0&&(y.polygonSegIdx=this.polygonSegments.length);const U={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},O=new wb;if(O.vertexOffset=this.footprintVertices.length,O.indexOffset=3*this.footprintIndices.length,O.ringIndices=[],g){const Z=[],W=[];R=N.vertexLength;for(let $=0;$<z.length;$++){const H=z[$];H.length&&$!==0&&W.push(Z.length/2);const it=[];let ot,rt;ot=H[1].sub(H[0])._perp()._unit(),O.ringIndices.push(H.length-1);for(let lt=1;lt<H.length;lt++){const ut=H[lt],pt=H[lt===H.length-1?1:lt+1],nt=ut.clone();if(E){rt=pt.sub(ut)._perp()._unit();const mt=ot.add(rt)._unit(),It=E*Math.min(4,1/(ot.x*mt.x+ot.y*mt.y));nt.x+=It*mt.x,nt.y+=It*mt.y,nt.x=Math.round(nt.x),nt.y=Math.round(nt.y),ot=rt}!x||E!==0&&!A||I(it,nt)||it.push(nt),dc(this.layoutVertexArray,nt.x,nt.y,0,0,1,1,0),N.vertexLength++,this.footprintVertices.emplaceBack(ut.x,ut.y),Z.push(ut.x,ut.y),f&&pc(this.layoutVertexExtArray,p.projectTilePoint(nt.x,nt.y,o),p.upVector(o,nt.x,nt.y))}x&&(E===0||A)&&(it.length!==0&&I(it,it[0])&&it.pop(),this.groundEffect.addData(it,P,c))}const K=ih(Z,W);for(let $=0;$<K.length;$+=3)this.footprintIndices.emplaceBack(O.vertexOffset+K[$+0],O.vertexOffset+K[$+1],O.vertexOffset+K[$+2]),this.indexArray.emplaceBack(R+K[$],R+K[$+2],R+K[$+1]),N.primitiveLength++;O.indexCount+=K.length,O.vertexCount+=this.footprintVertices.length-O.vertexOffset}for(let Z=0;Z<z.length;Z++){const W=z[Z];_.startRing(y,W[0]);let K=W.length>4&&kb(W[W.length-2],W[0],W[1]),$=E?rI(W[W.length-2],W[0],W[1],E):0;const H=[];let it,ot,rt;ot=W[1].sub(W[0])._perp()._unit();let lt=!0;for(let ut=1,pt=0;ut<W.length;ut++){let nt=W[ut-1],mt=W[ut];const It=W[ut===W.length-1?1:ut+1];if(_.appendEdge(y,mt,nt),Jm(mt,nt,P)){E&&(ot=It.sub(mt)._perp()._unit(),lt=!lt);continue}const kt=mt.sub(nt)._perp(),Rt=kt.x/(Math.abs(kt.x)+Math.abs(kt.y)),Ot=kt.y>0?1:0,oe=nt.dist(mt);if(pt+oe>32768&&(pt=0),E){rt=It.sub(mt)._perp()._unit();let ie=Cb(nt,mt,It,Ab(ot,rt),E);isNaN(ie)&&(ie=0);const te=mt.sub(nt)._unit();nt=nt.add(te.mult($))._round(),mt=mt.add(te.mult(-ie))._round(),$=ie,ot=rt,x&&this.zoom>=17&&(I(H,nt)||H.push(nt),I(H,mt)||H.push(mt))}const $t=N.vertexLength,Fe=W.length>4&&kb(nt,mt,It);let Ae=Db(pt,K,lt);if(dc(this.layoutVertexArray,nt.x,nt.y,Rt,Ot,0,0,Ae),dc(this.layoutVertexArray,nt.x,nt.y,Rt,Ot,0,1,Ae),pt+=oe,Ae=Db(pt,Fe,!lt),K=Fe,dc(this.layoutVertexArray,mt.x,mt.y,Rt,Ot,0,0,Ae),dc(this.layoutVertexArray,mt.x,mt.y,Rt,Ot,0,1,Ae),N.vertexLength+=4,this.indexArray.emplaceBack($t+0,$t+1,$t+2),this.indexArray.emplaceBack($t+1,$t+3,$t+2),N.primitiveLength+=2,E){const ie=R+(ut===1?W.length-2:ut-2),te=ut===1?R:ie+1;if(this.indexArray.emplaceBack($t+1,ie,$t+3),this.indexArray.emplaceBack(ie,te,$t+3),N.primitiveLength+=2,it===void 0&&(it=$t),!Jm(It,W[ut],P)){const Xt=ut===W.length-1?it:N.vertexLength;this.indexArray.emplaceBack($t+2,$t+3,Xt),this.indexArray.emplaceBack($t+3,Xt+1,Xt),this.indexArray.emplaceBack($t+3,te,Xt+1),N.primitiveLength+=3}lt=!lt}if(f){const ie=this.layoutVertexExtArray,te=p.projectTilePoint(nt.x,nt.y,o),Xt=p.projectTilePoint(mt.x,mt.y,o),Ie=p.upVector(o,nt.x,nt.y),Re=p.upVector(o,mt.x,mt.y);pc(ie,te,Ie),pc(ie,te,Ie),pc(ie,Xt,Re),pc(ie,Xt,Re)}}g&&(R+=W.length-1),x&&E&&this.zoom>=17&&(H.length!==0&&I(H,H[0])&&H.pop(),this.groundEffect.addData(H,P,c,E>0))}this.footprintSegments.push(O),U.triangleCount=this.indexArray.length-U.triangleArrayOffset,this.polygonSegments.push(U),++y.footprintSegLen,++y.polygonSegLen}if(y.vertexCount=this.layoutVertexArray.length-y.vertexArrayOffset,y.groundVertexCount=this.groundEffect.vertexArray.length-y.groundVertexArrayOffset,y.vertexCount!==0){if(y.centroidXY=_.borders?bb:this.encodeCentroid(_,y),this.centroidData.push(y),_.borders){this.featuresOnBorder.push(_);const z=this.featuresOnBorder.length-1;for(let P=0;P<_.borders.length;P++)_.borders[P][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[P].push(z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n,s,o,l),this.groundEffect.addPaintPropertiesData(t,r,n,s,o,l),this.maxHeight=Math.max(this.maxHeight,b)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,r)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[r].borders[t][0])}splitToSubtiles(){const t=[];for(let a=0;a<this.centroidData.length;a++){const l=this.centroidData[a],c=+(l.min.y+l.max.y>at),u=2*c+(+(l.min.x+l.max.x>at)^c);for(let p=0;p<l.polygonSegLen;p++){const f=l.polygonSegIdx+p;t.push({centroidIdx:a,subtile:u,polygonSegmentIdx:f,triangleSegmentIdx:this.polygonSegments[f].triangleSegIdx})}}const i=new Zi;t.sort((a,l)=>a.triangleSegmentIdx===l.triangleSegmentIdx?a.subtile-l.subtile:a.triangleSegmentIdx-l.triangleSegmentIdx);let r=0,o=0,n=0;for(const a of t){if(a.triangleSegmentIdx!==r)break;n++}const s=t.length;for(;o!==t.length;){r=t[o].triangleSegmentIdx;let a=0,l=o,c=o;for(let u=l;u<n&&t[u].subtile===a;u++)c++;for(;l!==n;){const u=t[l];a=u.subtile;const p=this.centroidData[u.centroidIdx].min.clone(),f=this.centroidData[u.centroidIdx].max.clone(),g={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let _=l;_<c;_++){const y=t[_],x=this.polygonSegments[y.polygonSegmentIdx],b=this.centroidData[y.centroidIdx].min,T=this.centroidData[y.centroidIdx].max,S=this.indexArray.uint16;for(let M=x.triangleArrayOffset;M<x.triangleArrayOffset+x.triangleCount;M++)i.emplaceBack(S[3*M],S[3*M+1],S[3*M+2]);g.primitiveLength+=x.triangleCount,p.x=Math.min(p.x,b.x),p.y=Math.min(p.y,b.y),f.x=Math.max(f.x,T.x),f.y=Math.max(f.y,T.y)}g.primitiveLength>0&&this.triangleSubSegments.push({segment:g,min:p,max:f}),l=c;for(let _=l;_<n&&t[_].subtile===t[l].subtile;_++)c++}o=n;for(let u=o;u<s&&t[u].triangleSegmentIdx===t[o].triangleSegmentIdx;u++)n++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,r){let o=0,n=0;const s=1<<t.canonical.z;if(i){const y=i.getMinMaxForTile(t);y&&(o=y.min,n=y.max)}n+=this.maxHeight;const a=t.toUnwrapped();let l;const c=[a.canonical.x/s+a.wrap,a.canonical.y/s],u=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],p=new ti,f=(y,x,b)=>[y[0]*(1-b[0])+x[0]*b[0],y[1]*(1-b[1])+x[1]*b[1]],g=[],_=[];for(const y of this.triangleSubSegments){g[0]=y.min.x/at,g[1]=y.min.y/at,_[0]=y.max.x/at,_[1]=y.max.y/at;const x=f(c,u,g),b=f(c,u,_);if(new di([x[0],x[1],o],[b[0],b[1],n]).intersectsPrecise(r)===0){l&&(p.segments.push(l),l=void 0);continue}const T=y.segment;l&&l.vertexOffset!==T.vertexOffset&&(p.segments.push(l),l=void 0),l?(l.vertexLength+=T.vertexLength,l.primitiveLength+=T.primitiveLength):l={vertexOffset:T.vertexOffset,primitiveLength:T.primitiveLength,vertexLength:T.vertexLength,primitiveOffset:T.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&p.segments.push(l),p}encodeCentroid(t,i){const r=t.centroid(),o=i.span(),n=Math.min(7,Math.round(o.x*this.tileToMeter/10)),s=Math.min(7,Math.round(o.y*this.tileToMeter/10));return new B(Ut(r.x,1,at-1)<<3|n,Ut(r.y,1,at-1)<<3|s)}showCentroid(t){const i=this.centroidData[t.centroidDataIndex];i.flags&=rn,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const i=t.vertexArrayOffset,r=t.vertexCount+t.vertexArrayOffset,o=t.flags&rn?bb:t.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==o.y||n!==o.x){for(let s=i;s<r;++s)this.centroidVertexArray.emplace(s,o.x,o.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const r=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(n,s){if(n.length!==s.length)return!1;for(let a=0;a<n.length;a++)if(n[a].sourceId!==s[a].sourceId||!gb(n[a],s[a]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const n of this.centroidData)n.flags&=2147483647;const o=[];for(const n of this.activeReplacements){const s=Math.pow(2,n.footprintTileId.canonical.z-t.canonical.z);for(const a of this.centroidData)if(!(a.flags&rn||n.min.x>a.max.x||a.min.x>n.max.x||n.min.y>a.max.y||a.min.y>n.max.y))for(let l=0;l<a.footprintSegLen;l++){const c=this.footprintSegments[a.footprintSegIdx+l];if(o.length=0,oI(this.footprintVertices,c.vertexOffset,c.vertexCount,n.footprintTileId.canonical,t.canonical,o),xb(n.footprint,o,this.footprintIndices.uint16,c.indexOffset,c.indexCount,-c.vertexOffset,-s)){a.flags|=rn;break}}}for(const n of this.centroidData)this.writeCentroidToBuffer(n);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,r){let o=!1;for(let n=0;n<r.footprintSegLen;n++){const s=this.footprintSegments[r.footprintSegIdx+n];let a=0;for(const l of s.ringIndices){for(let c=a,u=l+a-1;c<l+a;u=c++){const p=this.footprintVertices.int16[2*(c+s.vertexOffset)+0],f=this.footprintVertices.int16[2*(c+s.vertexOffset)+1],g=this.footprintVertices.int16[2*(u+s.vertexOffset)+1];f>i!=g>i&&t<(this.footprintVertices.int16[2*(u+s.vertexOffset)+0]-p)*(i-f)/(g-f)+p&&(o=!o)}a=l}}return o}getHeightAtTileCoord(t,i){let r=Number.NEGATIVE_INFINITY,o=!0;const n=4*(t+at)*at+(i+at);if(this.partLookup.hasOwnProperty(n)){const s=this.partLookup[n];return s?{height:s.height,hidden:!!(s.flags&rn)}:void 0}for(const s of this.centroidData)t>s.max.x||s.min.x>t||i>s.max.y||s.min.y>i||this.footprintContainsPoint(t,i,s)&&s&&s.height>r&&(r=s.height,this.partLookup[n]=s,o=!!(s.flags&rn));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:o};this.partLookup[n]=void 0}}function Ab(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function rI(e,t,i,r){const o=t.sub(e)._perp()._unit(),n=i.sub(t)._perp()._unit();return Cb(e,t,i,Ab(o,n),r)}function Cb(e,t,i,r,o){const n=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(i)/3,o*n/r)}function Jm(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Ib(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function kb(e,t,i){if(e.x<0||e.x>=at||t.x<0||t.x>=at||i.x<0||i.x>=at)return!1;const r=i.sub(t),o=r.perp(),n=e.sub(t);return(r.x*n.x+r.y*n.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(n.x*n.x+n.y*n.y))>-.866&&o.x*n.x+o.y*n.y<0}function Db(e,t,i){const r=t?2|e:-3&e;return i?1|r:-2&r}function zb(){const e=Math.PI/32,t=Math.tan(e),i=Ba;return i*Math.sqrt(1+2*t*t)-i}function Pb(e,t,i){const r=1<<i.z,o=Xr(i.x/r),n=Xr((i.x+1)/r),s=Hi(i.y/r),a=Hi((i.y+1)/r);return function(l,c,u,p,f=0,g){const _=[];if(!l.length||!u||!p)return _;const y=(A,I)=>{for(const z of A)_.push({polygon:z,bounds:I})},x=Math.ceil(Math.log2(u)),b=Math.ceil(Math.log2(p)),T=x-b,S=[];for(let A=0;A<Math.abs(T);A++)S.push(T>0?0:1);for(let A=0;A<Math.min(x,b);A++)S.push(0),S.push(1);let M=l;if(M=sh(M,c[0].y-f,c[1].y+f,1),M=sh(M,c[0].x-f,c[1].x+f,0),!M.length)return _;const E=[];for(S.length?E.push({polygons:M,bounds:c,depth:0}):y(M,c);E.length;){const A=E.pop(),I=A.depth,z=S[I],P=A.bounds[0],R=A.bounds[1],F=z===0?P.x:P.y,N=z===0?R.x:R.y,U=g?g(z,F,N):.5*(F+N),O=sh(A.polygons,F-f,U+f,z),Z=sh(A.polygons,U-f,N+f,z);if(O.length){const W=[P,new B(z===0?U:R.x,z===1?U:R.y)];S.length>I+1?E.push({polygons:O,bounds:W,depth:I+1}):y(O,W)}if(Z.length){const W=[new B(z===0?U:P.x,z===1?U:P.y),R];S.length>I+1?E.push({polygons:Z,bounds:W,depth:I+1}):y(Z,W)}}return _}(e,t,Math.ceil((n-o)/11.25),Math.ceil((s-a)/11.25),1,(l,c,u)=>{if(l===0)return .5*(c+u);{const p=Hi((i.y+c/at)/r);return(Qi(.5*(Hi((i.y+u/at)/r)+p))*r-i.y)*at}})}function oI(e,t,i,r,o,n){const s=Math.pow(2,r.z-o.z);for(let a=0;a<i;a++){let l=e.int16[2*(a+t)+0],c=e.int16[2*(a+t)+1];l=(l+o.x*at)*s-r.x*at,c=(c+o.y*at)*s-r.y*at,n.push(new B(l,c))}}jt(fc,"FillExtrusionBucket",{omit:["layers","features"]}),jt(Tb,"PartData"),jt(wb,"FootprintSegment"),jt(Eb,"BorderCentroidData"),jt(Mb,"GroundEffect");const nI=new Pi({visibility:new bt(tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var sI={paint:new Pi({"fill-extrusion-opacity":new bt(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Yt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new bt(tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:nI};class Ka extends B{constructor(t,i,r){super(t,i),this.z=r}}function mc(e,t){return e.x*t.x+e.y*t.y}function Rb(e,t){if(e.length===1){let i=0;const r=t[i++];let o;for(;!o||r.equals(o);)if(o=t[i++],!o)return 1/0;for(;i<t.length;i++){const n=t[i],s=e[0],a=o.sub(r),l=n.sub(r),c=s.sub(r),u=mc(a,a),p=mc(a,l),f=mc(l,l),g=mc(c,a),_=mc(c,l),y=u*f-p*p,x=(f*g-p*_)/y,b=(u*_-p*g)/y,T=r.z*(1-x-b)+o.z*x+n.z*b;if(isFinite(T))return T}return 1/0}{let i=1/0;for(const r of t)i=Math.min(i,r.z);return i}}function Lb(e,t,i,r,o,n,s,a){const l=s*o.getElevationAt(e,t,!0,!0),c=n[0]!==0,u=c?n[1]===0?s*(n[0]/7-450):s*function(p,f,g){const _=Math.floor(f[0]/8),y=Math.floor(f[1]/8),x=10*(f[0]-8*_),b=10*(f[1]-8*y),T=p.getElevationAt(_,y,!0,!0),S=p.getMeterToDEM(g),M=Math.floor(.5*(x*S-1)),E=Math.floor(.5*(b*S-1)),A=p.tileCoordToPixel(_,y),I=2*M+1,z=2*E+1,P=function(Z,W,K,$,H){return[Z.getElevationAtPixel(W,K,!0),Z.getElevationAtPixel(W+H,K,!0),Z.getElevationAtPixel(W,K+H,!0),Z.getElevationAtPixel(W+$,K+H,!0)]}(p,A.x-M,A.y-E,I,z),R=Math.abs(P[0]-P[1]),F=Math.abs(P[2]-P[3]),N=Math.abs(P[0]-P[2])+Math.abs(P[1]-P[3]),U=Math.min(.25,.5*S*(R+F)/I),O=Math.min(.25,.5*S*N/z);return T+Math.max(U*x,O*b)}(o,n,a):l;return{base:l+(i===0)?-1:i,top:c?Math.max(u+r,l+i+2):l+r}}const aI=new Pi({"line-cap":new Yt(tt.layout_line["line-cap"]),"line-join":new Yt(tt.layout_line["line-join"]),"line-miter-limit":new bt(tt.layout_line["line-miter-limit"]),"line-round-limit":new bt(tt.layout_line["line-round-limit"]),"line-sort-key":new Yt(tt.layout_line["line-sort-key"]),visibility:new bt(tt.layout_line.visibility)});var Ob={paint:new Pi({"line-opacity":new Yt(tt.paint_line["line-opacity"]),"line-color":new Yt(tt.paint_line["line-color"]),"line-translate":new bt(tt.paint_line["line-translate"]),"line-translate-anchor":new bt(tt.paint_line["line-translate-anchor"]),"line-width":new Yt(tt.paint_line["line-width"]),"line-gap-width":new Yt(tt.paint_line["line-gap-width"]),"line-offset":new Yt(tt.paint_line["line-offset"]),"line-blur":new Yt(tt.paint_line["line-blur"]),"line-dasharray":new Yt(tt.paint_line["line-dasharray"]),"line-pattern":new Yt(tt.paint_line["line-pattern"]),"line-gradient":new Bl(tt.paint_line["line-gradient"]),"line-trim-offset":new bt(tt.paint_line["line-trim-offset"]),"line-emissive-strength":new bt(tt.paint_line["line-emissive-strength"]),"line-border-width":new Yt(tt.paint_line["line-border-width"]),"line-border-color":new Yt(tt.paint_line["line-border-color"])}),layout:aI};const lI=(e,t,i,r,o,n,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Fb(e,t,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:n,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:Vb(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Bb(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:i.paint.get("line-emissive-strength")}},cI=(e,t,i,r,o)=>{const n=e.transform;return{u_matrix:Fb(e,t,i,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:n.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:o,u_image:0,u_tile_units_to_pixels:Bb(t,n),u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Bb(e,t){return 1/js(e,1,t.tileZoom)}function Fb(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Nb=e=>{const t=[];Vb(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function Vb(e){const t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const jb=new class extends Yt{possiblyEvaluate(e,t){return t=new Ti(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=Vt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}(Ob.paint.properties["line-width"].specification);function Ub(e,t){return t>0?t+2*e:e}jb.useIntegerZoom=!0;const uI=new Pi({visibility:new bt(tt.layout_background.visibility)});var hI={paint:new Pi({"background-color":new bt(tt.paint_background["background-color"]),"background-pattern":new bt(tt.paint_background["background-pattern"]),"background-opacity":new bt(tt.paint_background["background-opacity"]),"background-emissive-strength":new bt(tt.paint_background["background-emissive-strength"])}),layout:uI};const dI=new Pi({visibility:new bt(tt.layout_raster.visibility)});var pI={paint:new Pi({"raster-opacity":new bt(tt.paint_raster["raster-opacity"]),"raster-color":new Bl(tt.paint_raster["raster-color"]),"raster-color-mix":new bt(tt.paint_raster["raster-color-mix"]),"raster-color-range":new bt(tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(tt.paint_raster["raster-saturation"]),"raster-contrast":new bt(tt.paint_raster["raster-contrast"]),"raster-resampling":new bt(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(tt.paint_raster["raster-array-band"]),"raster-elevation":new bt(tt.paint_raster["raster-elevation"])}),layout:dI};function Gb(e,t,i,r,o,n,s,a){const l=[e,i,o,t,r,n,1,1,1],c=[s,a,1],u=Lr.adjoint([],l),[p,f,g]=j.transformMat3(c,c,Lr.transpose(u,u));return Lr.multiply(l,[p,0,0,0,f,0,0,0,g],l)}class Ao extends qi{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(o),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new Tt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=_e(this.map._requestManager.transformRequest(this.url,ht.Image),(r,o)=>{if(this._imageRequest=null,this._loaded=!0,r)this.fire(new ae(r));else if(o){const{HTMLImageElement:n}=k;this.image=o instanceof n?ce.getImageData(o):o,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Ah(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Ah||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],r=t[0][1];for(const n of t)n[1]>r&&(r=n[1]),n[1]<i&&(i=n[1]);const o=(r+i)/2;if(o>Oi?this.onNorthPole=!0:o<-Oi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const n=t.map(De.fromLngLat);this.tileID=function(s){let a=1/0,l=1/0,c=-1/0,u=-1/0;for(const _ of s)a=Math.min(a,_.x),l=Math.min(l,_.y),c=Math.max(c,_.x),u=Math.max(u,_.y);const p=Math.max(c-a,u-l),f=Math.max(0,Math.floor(-Math.log(p)/Math.LN2)),g=Math.pow(2,f);return new To(f,Math.floor((a+c)/2*g),Math.floor((l+u)/2*g))}(n),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const l in this.tiles){const c=this.tiles[l];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture)}if(this._boundsArray)return;const i=Vs(this.tileID,this.map.transform.projection),[r,o,n,s]=this.coordinates.map(l=>{const c=i.projection.project(l[0],l[1]);return Dv(i,c)._round()});this.perspectiveTransform=function(l,c,u,p,f,g,_,y,x,b){const T=Gb(0,0,l,0,0,c,l,c),S=Gb(u,p,f,g,_,y,x,b);return Lr.multiply(S,Lr.adjoint(T,T),S),[S[6]/S[8]*l/at,S[7]/S[8]*c/at]}(this.width,this.height,r.x,r.y,o.x,o.y,s.x,s.y,n.x,n.y);const a=this._boundsArray=new Ps;a.emplaceBack(r.x,r.y,0,0),a.emplaceBack(o.x,o.y,at,0),a.emplaceBack(s.x,s.y,0,at),a.emplaceBack(n.x,n.y,at,at),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(a,Vm.members),this.boundsSegments=ti.simpleSegment(0,0,4,2)}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof Ah||(this.texture?this.texture.update(this.image):(this.texture=new Mi(i,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class fI extends no{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const mI=new Pi({visibility:new bt(tt.layout_sky.visibility)});var gI={paint:new Pi({"sky-type":new bt(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Bl(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(tt.paint_sky["sky-opacity"])}),layout:mI};function Km(e,t,i){const r=[0,0,1],o=fr.identity([]);return fr.rotateY(o,o,i?-Ft(e)+Math.PI:Ft(e)),fr.rotateX(o,o,-Ft(t)),j.transformQuat(r,r,o),j.normalize(r,r)}var _I={paint:new Pi({})};const yI={circle:class extends no{constructor(e,t){super(e,eM,t)}createBucket(e){return new pm(e)}queryRadius(e){const t=e;return Na("circle-radius",this,t)+Na("circle-stroke-width",this,t)+Yu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,o,n,s,a){const l=Dx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),n.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Px(e,r,n,s,a,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const i=zx(this);return{config:new Os(this,t),defines:i,overrideFog:!1}}},heatmap:class extends no{createBucket(e){return new Lx(e)}constructor(e,t){super(e,lM,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Na("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,o,n,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,i);return Px(e,r,n,s,a,!0,!0,new B(0,0),l)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new Os(this,t),overrideFog:!1}:{}}},hillshade:class extends no{constructor(e,t){super(e,uM,t)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends no{constructor(e,t){super(e,EM,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new Os(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new rh(e)}queryRadius(){return Yu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,o,n){return!e.queryGeometry.isAboveHorizon&&Mx(kx(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends no{constructor(e,t){super(e,sI,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new fc(e)}queryRadius(){return Yu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,r,o,n,s,a,l){const c=Dx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),n.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,i),p=this.paint.get("fill-extrusion-base").evaluate(t,i),f=[0,0],g=a&&n.elevation,_=n.elevation?n.elevation.exaggeration():1,y=e.tile.getBucket(this);if(g&&y instanceof fc){const M=y.centroidVertexArray,E=l+1;E<M.length&&(f[0]=M.geta_centroid_pos0(E),f[1]=M.geta_centroid_pos1(E))}if(f[0]===0&&f[1]===1)return!1;n.projection.name==="globe"&&(r=Pb([r],[new B(0,0),new B(at,at)],e.tileID.canonical).map(M=>M.polygon).flat());const x=g?a:null,[b,T]=function(M,E,A,I,z,P,R,F,N,U,O){return M.projection.name==="globe"?function(Z,W,K,$,H,it,ot,rt,lt,ut,pt){const nt=[],mt=[],It=Z.projection.upVectorScale(pt,Z.center.lat,Z.worldSize).metersToTile,kt=[0,0,0,1],Rt=[0,0,0,1],Ot=($t,Fe,Ae,ie)=>{$t[0]=Fe,$t[1]=Ae,$t[2]=ie,$t[3]=1},oe=zb();K>0&&(K+=oe),$+=oe;for(const $t of W){const Fe=[],Ae=[];for(const ie of $t){const te=ie.x+H.x,Xt=ie.y+H.y,Ie=Z.projection.projectTilePoint(te,Xt,pt),Re=Z.projection.upVector(pt,ie.x,ie.y);let ye=K,si=$;if(ot){const Bi=Lb(te,Xt,K,$,ot,rt,lt,ut);ye+=Bi.base,si+=Bi.top}K!==0?Ot(kt,Ie.x+Re[0]*It*ye,Ie.y+Re[1]*It*ye,Ie.z+Re[2]*It*ye):Ot(kt,Ie.x,Ie.y,Ie.z),Ot(Rt,Ie.x+Re[0]*It*si,Ie.y+Re[1]*It*si,Ie.z+Re[2]*It*si),j.transformMat4(kt,kt,it),j.transformMat4(Rt,Rt,it),Fe.push(new Ka(kt[0],kt[1],kt[2])),Ae.push(new Ka(Rt[0],Rt[1],Rt[2]))}nt.push(Fe),mt.push(Ae)}return[nt,mt]}(M,E,A,I,z,P,R,F,N,U,O):R?function(Z,W,K,$,H,it,ot,rt,lt){const ut=[],pt=[],nt=[0,0,0,1];for(const mt of Z){const It=[],kt=[];for(const Rt of mt){const Ot=Rt.x+$.x,oe=Rt.y+$.y,$t=Lb(Ot,oe,W,K,it,ot,rt,lt);nt[0]=Ot,nt[1]=oe,nt[2]=$t.base,nt[3]=1,ei.transformMat4(nt,nt,H),nt[3]=Math.max(nt[3],1e-5);const Fe=new Ka(nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]);nt[0]=Ot,nt[1]=oe,nt[2]=$t.top,nt[3]=1,ei.transformMat4(nt,nt,H),nt[3]=Math.max(nt[3],1e-5);const Ae=new Ka(nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]);It.push(Fe),kt.push(Ae)}ut.push(It),pt.push(kt)}return[ut,pt]}(E,A,I,z,P,R,F,N,U):function(Z,W,K,$,H){const it=[],ot=[],rt=H[8]*W,lt=H[9]*W,ut=H[10]*W,pt=H[11]*W,nt=H[8]*K,mt=H[9]*K,It=H[10]*K,kt=H[11]*K;for(const Rt of Z){const Ot=[],oe=[];for(const $t of Rt){const Fe=$t.x+$.x,Ae=$t.y+$.y,ie=H[0]*Fe+H[4]*Ae+H[12],te=H[1]*Fe+H[5]*Ae+H[13],Xt=H[2]*Fe+H[6]*Ae+H[14],Ie=H[3]*Fe+H[7]*Ae+H[15],Re=ie+rt,ye=te+lt,si=Xt+ut,Bi=Math.max(Ie+pt,1e-5),ii=ie+nt,pi=te+mt,ji=Xt+It,Fi=Math.max(Ie+kt,1e-5);Ot.push(new Ka(Re/Bi,ye/Bi,si/Bi)),oe.push(new Ka(ii/Fi,pi/Fi,ji/Fi))}it.push(Ot),ot.push(oe)}return[it,ot]}(E,A,I,z,P)}(n,r,p,u,c,s,x,f,_,n.center.lat,e.tileID.canonical),S=e.queryGeometry;return function(M,E,A){let I=1/0;Mx(A,E)&&(I=Rb(A,E[0]));for(let z=0;z<E.length;z++){const P=E[z],R=M[z];for(let F=0;F<P.length-1;F++){const N=P[F],U=[N,P[F+1],R[F+1],R[F],N];Sx(A,U)&&(I=Math.min(I,Rb(A,U)))}}return I!==1/0&&I}(b,T,S.isPointQuery()?S.screenBounds:S.screenGeometry)}},line:class extends no{constructor(e,t){super(e,Ob,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Bp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=jb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Mh(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const i=Nb(this);return{config:new Os(this,t),defines:i,overrideFog:!1}}queryRadius(e){const t=e,i=Ub(Na("line-width",this,t),Na("line-gap-width",this,t)),r=Na("line-offset",this,t);return i/2+Math.abs(r)+Yu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,o,n){if(e.queryGeometry.isAboveHorizon)return!1;const s=kx(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Ub(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(r=function(c,u){const p=[],f=new B(0,0);for(let g=0;g<c.length;g++){const _=c[g],y=[];for(let x=0;x<_.length;x++){const b=_[x],T=_[x+1],S=x===0?f:b.sub(_[x-1])._unit()._perp(),M=x===_.length-1?f:T.sub(b)._unit()._perp(),E=S._add(M)._unit();E._mult(1/(E.x*M.x+E.y*M.y)),y.push(E._mult(u)._add(b))}p.push(y)}return p}(r,l*e.pixelToTileUnitsFactor)),function(c,u,p){for(let f=0;f<u.length;f++){const g=u[f];if(c.length>=3){for(let _=0;_<g.length;_++)if(rs(c,g[_]))return!0}if(JS(c,g,p))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:vh,background:class extends no{constructor(e,t){super(e,hI,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends no{constructor(e,t){super(e,pI,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof Ao)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Ju({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends no{constructor(e,t){super(e,gI,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ju({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),o=!r,n=e.style.light,s=n.properties.get("position");return o&&n.properties.get("anchor")==="viewport"&&Y("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?Km(s.azimuthal,90-s.polar,t):Km(r[0],90-r[1],t)}const i=this.paint.get("sky-gradient-center");return Km(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends no{constructor(e,t){super(e,_I)}},model:class extends no{constructor(e,t){super(e,$C,t)}createBucket(e){return new hb(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Gn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Fh(e,t){return e.type==="custom"?new fI(e):new yI[e.type](e,t)}function xI(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class vI extends qi{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Ui({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,i){if(this.loaded[i]!==t&&(this.loaded[i]=t,t)){for(const{ids:r,callback:o}of this.requestors)this._notify(r,i,o);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images[i][t]}addImage(t,i,r){this._validate(t,r)&&(this.images[i][t]=r)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new ae(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new ae(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new ae(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(t,i){if(!t)return!0;let r=0;for(const o of t){if(o[0]<r||o[1]<o[0]||i<o[1])return!1;r=o[1]}return!0}_validateContent(t,i){return!(t&&(t.length!==4||t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,i,r){r.version=this.images[i][t].version+1,this.images[i][t]=r,this.updatedImages[i][t]=!0}removeImage(t,i){const r=this.images[i][t];delete this.images[i][t],delete this.patterns[i][t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,i,r){let o=!0;const n=!!this.loaded[i];if(!n)for(const s of t)this.images[i][s]||(o=!1);n||o?this._notify(t,i,r):this.requestors.push({ids:t,scope:i,callback:r})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,i,r){const o={};for(const n of t){this.images[i][n]||this.fire(new Tt("styleimagemissing",{id:n}));const s=this.images[i][n];s?o[n]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:Y(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,o)}getPixelSize(t){const{width:i,height:r}=this.atlasImage[t];return{width:i,height:r}}getPattern(t,i){const r=this.patterns[i][t],o=this.getImage(t,i);if(!o)return null;if(r&&r.position.version===o.version)return r.position;if(r)r.position.version=o.version;else{const n={w:o.data.width+2,h:o.data.height+2,x:0,y:0},s=new zm(n,o);this.patterns[i][t]={bin:n,position:s}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){const r=t.gl;let o=this.atlasTexture[i];o?this.dirty&&(o.update(this.atlasImage[i]),this.dirty=!1):(o=new Mi(t,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=o),o.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const i=[];for(const s in this.patterns[t])i.push(this.patterns[t][s].bin);const{w:r,h:o}=Dm(i),n=this.atlasImage[t];n.resize({width:r||1,height:o||1});for(const s in this.patterns[t]){const{bin:a}=this.patterns[t][s],l=a.x+1,c=a.y+1,u=this.images[t][s].data,p=u.width,f=u.height;Ui.copy(u,n,{x:0,y:0},{x:l,y:c},{width:p,height:f}),Ui.copy(u,n,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),Ui.copy(u,n,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),Ui.copy(u,n,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),Ui.copy(u,n,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,i){for(const r of t){if(this.callbackDispatchedThisFrame[i][r])continue;this.callbackDispatchedThisFrame[i][r]=!0;const o=this.images[i][r];xI(o)&&this.updateImage(r,i,o)}}}const bI=new Pi({anchor:new bt(tt.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Bt(e.expression.evaluate(t))}interpolate(e,t,i){return{x:ne(e.x,t.x,i),y:ne(e.y,t.y,i),z:ne(e.z,t.z,i),azimuthal:ne(e.azimuthal,t.azimuthal,i),polar:ne(e.polar,t.polar,i)}}}(tt.light.position),color:new bt(tt.light.color),intensity:new bt(tt.light.intensity)});class qb extends qi{constructor(t,i="flat"){super(),this._transitionable=new Ll(bI),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,r={}){this._validate(G3,t,r)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,r){return(!r||r.validate!==!1)&&Su(this,t.call(Aa,Vt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:tt})))}}const wI=new Pi({source:new bt(tt.terrain.source),exaggeration:new bt(tt.terrain.exaggeration)});let TI=class extends qi{constructor(e,t,i,r){super(),this.scope=i,this._transitionable=new Ll(wI,r),this._transitionable.setTransitionOrValue(e,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new Ti(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Gn}};const $b=45,Zb=65,qs=.05;function Nh(e,t,i,r){const o=oo($b,Zb,i),[n,s]=Hb(e,r);let a=1-Math.min(1,Math.exp((t-n)/(s-n)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*o*e.alpha}function Hb(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function Wb(e,t,i,r,o){const n=j.transformMat4([],[t,i,r],o.mercatorFogMatrix);return Nh(e,j.length(n),o.pitch,o._fov)}function Xb(e,t,i,r,o,n,s){const a=[[i,r,0],[o,r,0],[o,n,0],[i,n,0]];let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const u of a){const p=j.transformMat4([],u,t),f=j.length(p);l=Math.min(l,f),c=Math.max(c,f)}return[Nh(e,l,s.pitch,s._fov),Nh(e,c,s.pitch,s._fov)]}const EI=new Pi({range:new bt(tt.fog.range),color:new bt(tt.fog.color),"high-color":new bt(tt.fog["high-color"]),"space-color":new bt(tt.fog["space-color"]),"horizon-blend":new bt(tt.fog["horizon-blend"]),"star-intensity":new bt(tt.fog["star-intensity"]),"vertical-range":new bt(tt.fog["vertical-range"])});class SI extends qi{constructor(t,i){super(),this._transitionable=new Ll(EI),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i=t.projection.name==="globe",r=ar(t.zoom),o=this.properties.get("range"),n=[.5,3];return{range:i?[ne(n[0],o[0],r),ne(n[1],o[1],r)]:o,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(this._validate(Z3,t,i))return;const r=Vt({},t);for(const o of Object.keys(tt.fog))r[o]===void 0&&(r[o]=tt.fog[o].default);this._transitionable.setTransitionOrValue(r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:oo($b,Zb,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(r,o,n){const s=De.fromLngLat(o),a=n.elevation?n.elevation.getAtPointOrZero(s):0;return Wb(r,s.x,s.y,a,n)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Xb(this.state,i,0,0,at,at,this._transform)}getOpacityForBounds(t,i,r,o,n){return this._transform.projection.supportsFog?Xb(this.state,t,i,r,o,n,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Hb(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const o=t.points[r];let n;if(o[2]>=0)n=o;else{const s=t.points[r-4];n=T0(s,o,s[2]/(s[2]-o[2]))}if(Wb(this.state,n[0],n[1],0,this._transform)>=qs)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,r){return(!r||r.validate!==!1)&&Su(this,t.call(Aa,Vt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:tt})))}}class MI{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class AI{constructor(){this.tasks={},this.taskQueue=[],ir(["process"],this),this.invoker=new MI(this.process),this.nextId=0}add(t,i){const r=this.nextId++,o=function({type:n,isSymbolTile:s,zoom:a}){return a=a||0,n==="message"?0:n!=="maybePrepare"||s?n!=="parseTile"||s?n==="parseTile"&&s?300-a:n==="maybePrepare"&&s?400-a:500:200-a:100-a}(i);if(o===0){vt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:t,metadata:i,priority:o,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){vt();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let o=0;o<this.taskQueue.length;o++){const n=this.tasks[this.taskQueue[o]];n.priority<i&&(i=n.priority,t=o)}if(t===null)return null;const r=this.taskQueue[t];return this.taskQueue.splice(t,1),r}remove(){this.invoker.remove()}}class Yb{constructor(t,i,r){this.target=t,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new AI}send(t,i,r,o,n=!1,s){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[a]=r);const l=new Set;return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:o,mustQueue:n,sourceMapId:this.mapId,data:Ia(i,l)},l),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(t){const i=t.data,r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const o=this.cancelCallbacks[r];delete this.cancelCallbacks[r],o&&o.cancel()}else if(i.mustQueue||vt()){const o=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,i),o&&o.metadata||{type:"message"})}else this.processTask(r,i)}processTask(t,i){if(i.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(i.error?r(ka(i.error)):r(null,ka(i.data)))}else{const r=new Set,o=i.hasCallback?(s,a)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:s?Ia(s):null,data:Ia(a,r)},r)}:s=>{},n=ka(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,n,o);else if(this.parent.getWorkerSource){const s=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,s[0],n.source,n.scope)[s[1]](n,o)}else o(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class $s{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=ca();const r=this.workerPool.acquire(this.id);for(let o=0;o<r.length;o++){const n=new $s.Actor(r[o],i,this.id);n.name=`Worker ${o}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,r){Do(this.actors,(o,n)=>{o.send(t,i,n)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}$s.Actor=Yb;class Jb extends qi{constructor(t,i,r,o){super(),this.scope=r,this._options=t,this.properties=new Ol(i),this._transitionable=new Ll(i,new Map(o)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const CI=new Pi({color:new bt(tt.properties_light_ambient.color),intensity:new bt(tt.properties_light_ambient.intensity)}),II=new Pi({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([i,r]){const o=Bt([1,i,r]);return{x:o.x,y:o.y,z:o.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:ne(e.x,t.x,i),y:ne(e.y,t.y,i),z:ne(e.z,t.z,i)}}}(tt.properties_light_directional.direction),color:new bt(tt.properties_light_directional.color),intensity:new bt(tt.properties_light_directional.intensity),"cast-shadows":new bt(tt.properties_light_directional["cast-shadows"]),"shadow-intensity":new bt(tt.properties_light_directional["shadow-intensity"])});class Qm{constructor(t,i,r,o){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,o)}static createFromScreenPoints(t,i){let r,o;if(t instanceof B||typeof t[0]=="number"){const n=B.convert(t);r=[n],o=i.isPointAboveHorizon(n)}else{const n=B.convert(t[0]),s=B.convert(t[1]);r=[n,s],o=Sr(n,s).every(a=>i.isPointAboveHorizon(a))}return new Qm(r,i.getCameraPoint(),o,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return Sr(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new B(1,1)):this.screenBounds[1],o=Sr(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?o.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?o[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(o[3]=this.cameraPoint)),function(n,s){const a=[];for(let l=0;l<n.length;l++){const c=Nr(l-1,-1,n.length-1),u=Nr(l+1,-1,n.length-1),p=n[l],f=n[u],g=n[c].sub(p).unit(),_=f.sub(p).unit(),y=_.angleWithSep(g.x,g.y),x=g.add(_).unit().mult(-1*s/Math.sin(y/2));a.push(p.add(x))}return a}(o,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new B(1,1)):this.screenBounds[1],o=Sr(i,r,t),n=this.cameraPoint.clone();switch(3*((n.y>i.y)+(n.y>r.y))+((n.x>i.x)+(n.x>r.x))){case 0:o[0]=n,o[4]=n.clone();break;case 1:o.splice(1,0,n);break;case 2:o[1]=n;break;case 3:o.splice(4,0,n);break;case 5:o.splice(2,0,n);break;case 6:o[3]=n;break;case 7:o.splice(3,0,n);break;case 8:o[2]=n}return o}containsTile(t,i,r,o=0){const n=t.queryPadding/i._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(n,i):this._bufferedScreenMercator(n,i);let a=t.tileID.wrap+(s.unwrapped?o:0);const l=s.polygon.map(x=>Dv(t.tileTransform,x,a));if(!Ix(l,0,0,at,at))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?o:0);const c=this.screenGeometryMercator.polygon.map(x=>zv(t.tileTransform,x,a)),u=c.map(x=>new B(x[0],x[1])),p=i.getFreeCameraOptions().position||new De(0,0,0),f=zv(t.tileTransform,p,a),g=c.map(x=>{const b=j.sub(x,x,f);return j.normalize(b,b),new Uu(f,b)}),_=js(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:g,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(y=Ai(l),y.min.x=Ut(y.min.x,0,at),y.min.y=Ut(y.min.y,0,at),y.max.x=Ut(y.max.x,0,at),y.max.y=Ut(y.max.y,0,at),y),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:_};var y}_bufferedScreenMercator(t,i){const r=Kb(t);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let o;return o=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(n=>i.pointCoordinate3D(n)),unwrapped:!0},this._screenRaycastCache[r]=o,o}}_bufferedCameraMercator(t,i){const r=Kb(t);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let o;return o=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(n=>i.pointCoordinate3D(n)),unwrapped:!0},this._cameraRaycastCache[r]=o,o}}_projectAndResample(t,i){const r=function(n,s){const a=Q.multiply([],s.pixelMatrix,s.globeMatrix),l=[0,-Ar,0,1],c=[0,Ar,0,1],u=[0,0,0,1];ei.transformMat4(l,l,a),ei.transformMat4(c,c,a),ei.transformMat4(u,u,a);const p=new B(l[0]/l[3],l[1]/l[3]),f=new B(c[0]/c[3],c[1]/c[3]),g=rs(n,p)&&l[3]<u[3],_=rs(n,f)&&c[3]<u[3];if(!g&&!_)return null;const y=function(I,z,P){for(let R=1;R<I.length;R++){const F=gc(z.pointCoordinate3D(I[R-1]).x),N=gc(z.pointCoordinate3D(I[R]).x);if(P<0){if(F<N)return{idx:R,t:-F/(N-1-F)}}else if(N<F)return{idx:R,t:(1-F)/(N+1-F)}}return null}(n,s,g?-1:1);if(!y)return null;const{idx:x,t:b}=y;let T=x>1?tg(n.slice(0,x),s):[],S=x<n.length?tg(n.slice(x),s):[];T=T.map(I=>new B(gc(I.x),I.y)),S=S.map(I=>new B(gc(I.x),I.y));const M=[...T];M.length===0&&M.push(S[S.length-1]);const E=ne(M[M.length-1].y,(S.length===0?T[0]:S[0]).y,b);let A;return A=g?[new B(0,E),new B(0,0),new B(1,0),new B(1,E)]:[new B(1,E),new B(1,1),new B(0,1),new B(0,E)],M.push(...A),S.length===0?M.push(T[0]):M.push(...S),{polygon:M.map(I=>new De(I.x,I.y)),unwrapped:!1}}(t,i);if(r)return r;const o=function(n,s){let a=!1,l=-1/0,c=0;for(let p=0;p<n.length-1;p++)n[p].x>l&&(l=n[p].x,c=p);for(let p=0;p<n.length-1;p++){const f=(c+p)%(n.length-1),g=n[f],_=n[f+1];Math.abs(g.x-_.x)>.5&&(g.x<_.x?(g.x+=1,f===0&&(n[n.length-1].x+=1)):(_.x+=1,f+1===n.length-1&&(n[0].x+=1)),a=!0)}const u=Ji(s.center.lng);return a&&u<Math.abs(u-1)&&n.forEach(p=>{p.x-=1}),{polygon:n,unwrapped:a}}(tg(t,i).map(n=>new B(gc(n.x),n.y)),i);return{polygon:o.polygon.map(n=>new De(n.x,n.y)),unwrapped:o.unwrapped}}}function tg(e,t){return Tx(e,i=>{const r=t.pointCoordinate3D(i);i.x=r.x,i.y=r.y},1/256)}function gc(e){return e<0?1+e%1:e%1}function Kb(e){return 100*e|0}function eg(e,t,i,r,o){const n=function(s,a){if(s)return o(s);if(a){e.url&&a.tiles&&e.tiles&&delete e.tiles;const l=Vr(Vt(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(l.vectorLayers=a.vector_layers,l.vectorLayerIds=l.vectorLayers.map(c=>c.id)),l.tiles=t.canonicalizeTileset(l,e.url),o(null,l)}};return e.url?Mt(t.transformRequest(t.normalizeSourceURL(e.url,null,i,r),ht.Source),n):ce.frame(()=>n(null,e))}class Vh{constructor(t,i,r){this.bounds=Wr.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(Ji(this.bounds.getWest())*i),o=Math.floor(Qi(this.bounds.getNorth())*i),n=Math.ceil(Ji(this.bounds.getEast())*i),s=Math.ceil(Qi(this.bounds.getSouth())*i);return t.x>=r&&t.x<n&&t.y>=o&&t.y<s}}class Qb{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Mn({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const r=this.getKey(t,i);return this.positions[r]}trim(){const t=this.width,i=this.height=Yc(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,r){const o=[];let n=t.length%2==1?-t[t.length-1]*r:0,s=t[0]*r,a=!0;o.push({left:n,right:s,isDash:a,zeroLength:t[0]===0});let l=t[0];for(let c=1;c<t.length;c++){a=!a;const u=t[c];n=l*r,l+=u,s=l*r,o.push({left:n,right:s,isDash:a,zeroLength:u===0})}return o}addRoundDash(t,i,r){const o=i/2;for(let n=-r;n<=r;n++){const s=this.width*(this.nextRow+r+n);let a=0,l=t[a];for(let c=0;c<this.width;c++){c/l.right>1&&(l=t[++a]);const u=Math.abs(c-l.left),p=Math.abs(c-l.right),f=Math.min(u,p);let g;const _=n/r*(o+1);if(l.isDash){const y=o-Math.abs(_);g=Math.sqrt(f*f+y*y)}else g=o-Math.sqrt(f*f+_*_);this.image.data[s+c]=Math.max(0,Math.min(255,g+128))}}}addRegularDash(t,i){for(let l=t.length-1;l>=0;--l){const c=t[l],u=t[l+1];c.zeroLength?t.splice(l,1):u&&u.isDash===c.isDash&&(u.left=c.left,t.splice(l,1))}const r=t[0],o=t[t.length-1];r.isDash===o.isDash&&(r.left=o.left-this.width,o.right=r.right+this.width);const n=this.width*this.nextRow;let s=0,a=t[s];for(let l=0;l<this.width;l++){l/a.right>1&&(a=t[++s]);const c=Math.abs(l-a.left),u=Math.abs(l-a.right),p=Math.min(c,u);this.image.data[n+l]=Math.max(0,Math.min(255,(a.isDash?p:-p)+i+128))}}addDash(t,i){const r=this.getKey(t,i);if(this.positions[r])return this.positions[r];const o=i==="round",n=o?7:0,s=2*n+1;if(this.nextRow+s>this.height)return Y("LineAtlas out of space"),null;t.length===0&&t.push(1);let a=0;for(let u=0;u<t.length;u++)t[u]<0&&(Y("Negative value is found in line dasharray, replacing values with 0"),t[u]=0),a+=t[u];if(a!==0){const u=this.width/a,p=this.getDashRanges(t,this.width,u);o?this.addRoundDash(p,u,n):this.addRegularDash(p,i==="square"?.5*u:0)}const l=this.nextRow+n;this.nextRow+=s;const c={tl:[l,n],br:[a,0]};return this.positions[r]=c,c}}jt(Qb,"LineAtlas");const tw=1*Fo;class ew{constructor(t){const i={},r=[];for(const a in t){const l=t[a],c=i[a]={};for(const u in l.glyphs){const p=l.glyphs[+u];if(!p||p.bitmap.width===0||p.bitmap.height===0)continue;const f=p.metrics.localGlyph?tw:1,g={x:0,y:0,w:p.bitmap.width+2*f,h:p.bitmap.height+2*f};r.push(g),c[u]=g}}const{w:o,h:n}=Dm(r),s=new Mn({width:o||1,height:n||1});for(const a in t){const l=t[a];for(const c in l.glyphs){const u=l.glyphs[+c];if(!u||u.bitmap.width===0||u.bitmap.height===0)continue;const p=i[a][c],f=u.metrics.localGlyph?tw:1;Mn.copy(u.bitmap,s,{x:0,y:0},{x:p.x+f,y:p.y+f},u.bitmap)}}this.image=s,this.positions=i}}jt(ew,"GlyphAtlas");class kI{constructor(t){this.tileID=new Ue(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Vs(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,r,o,n){this.status="parsing",this.data=t,this.collisionBoxArray=new Pf;const s=new Zx(Object.keys(t.layers).sort()),a=new Am(this.tileID,this.promoteId);a.bucketLayerIDs=[];const l={},c=new Qb(256,256),u={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:c,availableImages:r,brightness:this.brightness},p=i.familiesBySource[this.source];for(const T in p){const S=t.layers[T];if(!S)continue;let M=!1,E=!1,A=!1;for(const P of p[T])P[0].type==="symbol"?M=!0:E=!0,P[0].is3D()&&P[0].type!=="model"&&(A=!0);if(this.extraShadowCaster&&!A||this.isSymbolTile===!0&&!M||this.isSymbolTile===!1&&!E)continue;S.version===1&&Y(`Vector tile source "${this.source}" layer "${T}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const I=s.encode(T),z=[];for(let P=0;P<S.length;P++){const R=S.feature(P),F=a.getId(R,T);z.push({feature:R,id:F,index:P,sourceLayerIndex:I})}for(const P of p[T]){const R=P[0];(!this.extraShadowCaster||R.is3D()&&R.type!=="model")&&(this.isSymbolTile!==void 0&&R.type==="symbol"!==this.isSymbolTile||R.minzoom&&this.zoom<Math.floor(R.minzoom)||R.maxzoom&&this.zoom>=R.maxzoom||R.visibility!=="none"&&(ig(P,this.zoom,u.brightness,r),(l[R.id]=R.createBucket({index:a.bucketLayerIDs.length,layers:P,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:I,sourceID:this.source,projection:this.projection.spec})).populate(z,u,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(P.map(F=>F.id))))}}let f,g,_,y;c.trim();const x={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},b=()=>{if(f)return this.status="done",n(f);if(this.extraShadowCaster)this.status="done",n(null,{buckets:ws(l).filter(T=>!T.isEmpty()),featureIndex:a,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:u.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(g&&_&&y){const T=new ew(g),S=new wv(_,y);for(const M in l){const E=l[M];E instanceof sc?(ig(E.layers,this.zoom,u.brightness,r),MA(E,g,T.positions,_,S.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):E.hasPattern&&(E instanceof Mh||E instanceof rh||E instanceof fc)&&(ig(E.layers,this.zoom,u.brightness,r),E.addFeatures(u,this.tileID.canonical,S.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",n(null,{buckets:ws(l).filter(M=>!M.isEmpty()),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:T.image,lineAtlas:c,imageAtlas:S,brightness:u.brightness})}};if(!this.extraShadowCaster){const T=ha(u.glyphDependencies,E=>Object.keys(E).map(Number));Object.keys(T).length?o.send("getGlyphs",{uid:this.uid,stacks:T,scope:this.scope},(E,A)=>{f||(f=E,g=A,b())},void 0,!1,x):g={};const S=Object.keys(u.iconDependencies);S.length?o.send("getImages",{icons:S,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(E,A)=>{f||(f=E,_=A,b())},void 0,!1,x):_={};const M=Object.keys(u.patternDependencies);M.length?o.send("getImages",{icons:M,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(E,A)=>{f||(f=E,y=A,b())},void 0,!1,x):y={}}b()}}function ig(e,t,i,r){const o=new Ti(t,{brightness:i});for(const n of e)n.recalculate(o,r)}class iw{constructor(t){this.entries={},this.scheduler=t}request(t,i,r,o){const n=this.entries[t]=this.entries[t]||{callbacks:[]};if(n.result){const[s,a]=n.result;return this.scheduler?this.scheduler.add(()=>{o(s,a)},i):o(s,a),()=>{}}return n.callbacks.push(o),n.cancel||(n.cancel=r((s,a)=>{n.result=[s,a];for(const l of n.callbacks)this.scheduler?this.scheduler.add(()=>{l(s,a)},i):l(s,a);setTimeout(()=>delete this.entries[t],3e3)})),()=>{n.result||(n.callbacks=n.callbacks.filter(s=>s!==o),n.callbacks.length||(n.cancel(),delete this.entries[t]))}}}function rw(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},o=>{const n=Dt(e.request,(s,a,l,c)=>{s?o(s):a&&o(null,{vectorTile:i?void 0:new Sm(new ch(a)),rawData:a,cacheControl:l,expires:c})});return()=>{n.cancel(),o()}},t)}class ow extends qi{constructor(t,i,r,o){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Vt(this,Vr(i,["url","scheme","tileSize","promoteId"])),this._options=Vt({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o),this._tileWorkers={},this._deduped=new iw}load(t){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=eg(this._options,this.map._requestManager,i,r,(o,n)=>{this._tileJSONRequest=null,this._loaded=!0,o?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new ae(o))):n&&(Vt(this,n),n.bounds&&(this.tileBounds=new Vh(n.bounds,this.minzoom,this.maxzoom)),ep(n.tiles,this.map._requestManager._customAccessToken),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=br(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Vt({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(r,ht.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ce.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(o.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",o,n.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",o,n.bind(this),void 0,!0);else{const s=rw.call({deduped:this._deduped},o,(a,l)=>{a||!l?n.call(this,a):(o.data={cacheControl:l.cacheControl,expires:l.expires,rawData:l.rawData.slice(0)},t.actor&&t.actor.send("loadTile",o,n.bind(this),void 0,!0))},!0);t.request={cancel:s}}function n(s,a){return delete t.request,t.aborted?i(null):s&&s.status!==404?i(s):(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&a&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),pa(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rg extends qi{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Vt({type:"raster"},i),Vt(this,Vr(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"})),this._tileJSONRequest=eg(this._options,this.map._requestManager,null,null,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new ae(i)):r&&(Vt(this,r),r.bounds&&(this.tileBounds=new Vh(r.bounds,this.minzoom,this.maxzoom)),ep(r.tiles),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=br(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Vt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){const r=ce.devicePixelRatio>=2,o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=_e(this.map._requestManager.transformRequest(o,ht.Tile),(n,s,a,l)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):n?(t.state="errored",i(n)):s?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:l}),t.setTexture(s,this.map.painter),t.state="loaded",pa(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i()}unloadTile(t,i){t.texture&&t.texture instanceof Mi?(t.destroy(!0),t.texture&&t.texture instanceof Mi&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function DI(){return cd.workerClass!=null?new cd.workerClass:new k.Worker(cd.workerUrl)}const og="mapboxgl_preloaded_worker_pool";class Qa{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Qa.workerCount;)this.workers.push(new DI);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[og]}numActive(){return Object.keys(this.active).length}}let _c;function yc(){return _c||(_c=new Qa),_c}Qa.workerCount=2;let jh,ng,jo,sg=null;function nw(){return vt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:ng||X.DRACO_URL}const ag=5123,lg=5126,cg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[ag]:Uint16Array,5125:Uint32Array,[lg]:Float32Array},zI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[ag]:"DT_UINT16",5125:"DT_UINT32",[lg]:"DT_FLOAT32"},ug={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function sw(e,t,i){const r=i.json.bufferViews.length,o=i.buffers.length;t.bufferView=r,i.json.bufferViews[r]={buffer:o,byteLength:e.byteLength},i.buffers[o]=e}const hg="KHR_draco_mesh_compression";function PI(e,t){const i=e.extensions&&e.extensions[hg];if(!i)return;const r=new jo.Decoder,o=uw(t,i.bufferView),n=new jo.Mesh;if(!r.DecodeArrayToMesh(o,o.byteLength,n))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=cg[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=jo._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(n,l,c):r.GetTrianglesUInt32Array(n,l,c),sw(jo.memory.buffer.slice(c,c+l),s,t),jo._free(c);for(const u of Object.keys(i.attributes)){const p=r.GetAttributeByUniqueId(n,i.attributes[u]),f=t.json.accessors[e.attributes[u]],g=zI[f.componentType],_=f.count*ug[f.type]*cg[f.componentType].BYTES_PER_ELEMENT,y=jo._malloc(_);r.GetAttributeDataArrayForAllPoints(n,p,jo[g],_,y),sw(jo.memory.buffer.slice(y,y+_),f,t),jo._free(y)}r.destroy(),n.destroy(),delete e.extensions[hg]}const aw=1179937895,lw=new TextDecoder("utf8");function cw(e,t){return new URL(e,t).href}function RI(e,t,i,r){return fetch(cw(e.uri,r)).then(o=>o.arrayBuffer()).then(o=>{t.buffers[i]=o})}function uw(e,t){const i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function LI(e,t,i,r){if(e.uri){const o=cw(e.uri,r);return fetch(o).then(n=>n.blob()).then(n=>k.createImageBitmap(n)).then(n=>{t.images[i]=n})}if(e.bufferView!==void 0){const o=uw(t,e.bufferView),n=new k.Blob([o],{type:e.mimeType});return k.createImageBitmap(n).then(s=>{t.images[i]=s})}}function hw(e,t=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===aw){const c=new Uint32Array(e,t);let u=2;const p=(c[u++]>>2)-3,f=c[u++]>>2;if(u++,r.json=JSON.parse(lw.decode(c.subarray(u,u+f))),u+=f,u<p){const g=c[u++];u++;const _=t+(u<<2);r.buffers[0]=e.slice(_,_+g)}}else r.json=JSON.parse(lw.decode(new Uint8Array(e,t)));const{buffers:o,images:n,meshes:s,extensionsUsed:a}=r.json;let l=Promise.resolve();if(o){const c=[];for(let u=0;u<o.length;u++){const p=o[u];p.uri?c.push(RI(p,r,u,i)):r.buffers[u]||(r.buffers[u]=null)}l=Promise.all(c)}return l.then(()=>{const c=[],u=a&&a.includes(hg);if(u&&c.push(function(){if(!jo)return jh||(jh=function(p){let f,g=null;function _(){f=new Uint8Array(g.buffer)}function y(){throw new Error("Unexpected Draco error.")}const x={a:{a:y,d:function(b,T,S){return f.copyWithin(b,T,T+S)},c:function(b){const T=f.length,S=Math.max(b>>>0,Math.ceil(1.2*T)),M=Math.ceil((S-T)/65536);try{return g.grow(M),_(),!0}catch{return!1}},b:y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(p,x):p.then(b=>b.arrayBuffer()).then(b=>WebAssembly.instantiate(b,x))).then(b=>{const{Rb:T,Qb:S,P:M,T:E,X:A,Ja:I,La:z,Qa:P,Va:R,Wa:F,eb:N,jb:U,f:O,e:Z,yb:W,zb:K,Ab:$,Bb:H,Db:it,Gb:ot}=b.instance.exports;g=Z;const rt=(()=>{let lt=0,ut=0,pt=0,nt=0;return mt=>{pt&&(T(nt),T(lt),ut+=pt,pt=lt=0),lt||(ut+=128,lt=S(ut));const It=mt.length+7&-8;let kt=lt;It>=ut&&(pt=It,kt=nt=S(It));for(let Rt=0;Rt<mt.length;Rt++)f[kt+Rt]=mt[Rt];return kt}})();return _(),O(),{memory:Z,_free:T,_malloc:S,Mesh:class{constructor(){this.ptr=M()}destroy(){E(this.ptr)}},Decoder:class{constructor(){this.ptr=I()}destroy(){U(this.ptr)}DecodeArrayToMesh(lt,ut,pt){const nt=rt(lt),mt=z(this.ptr,nt,ut,pt.ptr);return!!A(mt)}GetAttributeByUniqueId(lt,ut){return{ptr:P(this.ptr,lt.ptr,ut)}}GetTrianglesUInt16Array(lt,ut,pt){R(this.ptr,lt.ptr,ut,pt)}GetTrianglesUInt32Array(lt,ut,pt){F(this.ptr,lt.ptr,ut,pt)}GetAttributeDataArrayForAllPoints(lt,ut,pt,nt,mt){N(this.ptr,lt.ptr,ut.ptr,pt,nt,mt)}},DT_INT8:W(),DT_UINT8:K(),DT_INT16:$(),DT_UINT16:H(),DT_UINT32:it(),DT_FLOAT32:ot()}})}(fetch(nw())),jh.then(p=>{jo=p,jh=void 0}))}()),n)for(let p=0;p<n.length;p++)c.push(LI(n[p],r,p,i));return(c.length?Promise.all(c):Promise.resolve()).then(()=>{if(u&&s)for(const{primitives:p}of s)for(const f of p)PI(f,r);return r})})}function dw(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>hw(t,0,e))}class pw{constructor(t,i,r){if(this.triangleCount=i.length/3,this.min=new B(0,0),this.max=new B(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||r===0)return;const o=t.map(u=>u.x),n=t.map(u=>u.y);this.min=new B(Math.min(...o),Math.min(...n)),this.max=new B(Math.max(...o),Math.max(...n));const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/r;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let u=0;u<this.triangleCount;u++){const p=t[i[3*u+0]].sub(this.min),f=t[i[3*u+1]].sub(this.min),g=t[i[3*u+2]].sub(this.min),_=ds(Math.floor(Math.min(p.x,f.x,g.x)),this.xScale,this.cellsX),y=ds(Math.floor(Math.max(p.x,f.x,g.x)),this.xScale,this.cellsX),x=ds(Math.floor(Math.min(p.y,f.y,g.y)),this.yScale,this.cellsY),b=ds(Math.floor(Math.max(p.y,f.y,g.y)),this.yScale,this.cellsY),T=new B(0,0),S=new B(0,0),M=new B(0,0),E=new B(0,0);for(let A=x;A<=b;++A){T.y=S.y=A*a,M.y=E.y=(A+1)*a;for(let I=_;I<=y;++I)T.x=M.x=I*a,S.x=E.x=(I+1)*a,(gm(p,f,g,T,S,E)||gm(p,f,g,T,E,M))&&l.push({cellIdx:A*this.cellsX+I,triIdx:u})}}if(l.length===0)return;l.sort((u,p)=>u.cellIdx-p.cellIdx||u.triIdx-p.triIdx);let c=0;for(;c<l.length;){const u=l[c].cellIdx,p={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===u;)++p.len,this.payload.push(l[c++].triIdx);this.cells[u]=p}}query(t,i,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let l=0;l<this.lookup.length;l++)this.lookup[l]=0;const o=ds(t.x-this.min.x,this.xScale,this.cellsX),n=ds(i.x-this.min.x,this.xScale,this.cellsX),s=ds(t.y-this.min.y,this.yScale,this.cellsY),a=ds(i.y-this.min.y,this.yScale,this.cellsY);for(let l=s;l<=a;l++)for(let c=o;c<=n;c++){const u=this.cells[l*this.cellsX+c];if(u)for(let p=0;p<u.len;p++){const f=this.payload[u.start+p],g=Math.floor(f/8),_=1<<f%8;if(!(this.lookup[g]&_)&&(this.lookup[g]|=_,r.push(f),r.length===this.triangleCount))return}}}}function ds(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function Zs(e,t){const i=e.json.bufferViews[t.bufferView];return new cg[t.componentType](e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*ug[t.type])}function OI(e,t,i){const r=e.indices,o=e.attributes,n={};n.indexArray=new Zi;const s=t.json.accessors[r],a=s.count/3;n.indexArray.reserve(a);const l=Zs(t,s);for(let f=0;f<a;f++)n.indexArray.emplaceBack(l[3*f],l[3*f+1],l[3*f+2]);n.indexArray._trim(),n.vertexArray=new Ls;const c=t.json.accessors[o.POSITION];n.vertexArray.reserve(c.count);const u=Zs(t,c);for(let f=0;f<c.count;f++)n.vertexArray.emplaceBack(u[3*f],u[3*f+1],u[3*f+2]);if(n.vertexArray._trim(),n.aabb=new di(c.min,c.max),n.centroid=function(f,g){const _=[0,0,0],y=f.length;if(y>0){for(let x=0;x<y;x++){const b=3*f[x];_[0]+=g[b],_[1]+=g[b+1],_[2]+=g[b+2]}_[0]/=y,_[1]/=y,_[2]/=y}return _}(l,u),o.COLOR_0!==void 0){const f=t.json.accessors[o.COLOR_0],g=ug[f.type];if(f.componentType===lg){n.colorArray=g===3?new Ls:new _n,n.colorArray.reserve(f.count);const _=Zs(t,f);if(g===3)for(let y=0;y<f.count;y++)n.colorArray.emplaceBack(_[3*y],_[3*y+1],_[3*y+2]);else for(let y=0;y<f.count;y++)n.colorArray.emplaceBack(_[4*y],_[4*y+1],_[4*y+2],_[4*y+3]);n.colorArray._trim()}else if(f.componentType===ag&&g===4){n.colorArray=new _n,n.colorArray.resize(f.count);const _=Zs(t,f),y=1/65535,x=n.colorArray.float32;for(let b=0;b<4*_.length;++b)x[b]=_[b]*y}else Y(`glTF color buffer parsing for accessor ${JSON.stringify(f)} is not supported`)}if(o.NORMAL!==void 0){n.normalArray=new Ls;const f=t.json.accessors[o.NORMAL];n.normalArray.reserve(f.count);const g=Zs(t,f);for(let _=0;_<f.count;_++)n.normalArray.emplaceBack(g[3*_],g[3*_+1],g[3*_+2]);n.normalArray._trim()}if(o.TEXCOORD_0!==void 0&&i.length>0){n.texcoordArray=new Vl;const f=t.json.accessors[o.TEXCOORD_0];n.texcoordArray.reserve(f.count);const g=Zs(t,f);for(let _=0;_<f.count;_++)n.texcoordArray.emplaceBack(g[2*_],g[2*_+1]);n.texcoordArray._trim()}const p=e.material;return n.material=function(f,g){const{emissiveFactor:_=[0,0,0],alphaMode:y="OPAQUE",alphaCutoff:x=.5,normalTexture:b,occlusionTexture:T,emissiveTexture:S,doubleSided:M}=f,{baseColorFactor:E=[1,1,1,1],metallicFactor:A=1,roughnessFactor:I=1,baseColorTexture:z,metallicRoughnessTexture:P}=f.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new xe(...E),metallicFactor:A,roughnessFactor:I,baseColorTexture:z?g[z.index]:void 0,metallicRoughnessTexture:P?g[P.index]:void 0},doubleSided:M,emissiveFactor:_,alphaMode:y,alphaCutoff:x,normalTexture:b?g[b.index]:void 0,occlusionTexture:T?g[T.index]:void 0,emissionTexture:S?g[S.index]:void 0,defined:f.defined===void 0}}(p!==void 0?t.json.materials[p]:{defined:!1},i),o._FEATURE_RGBA4444!==void 0&&(n.featureData=new Uint32Array(Zs(t,t.json.accessors[o._FEATURE_RGBA4444]).buffer)),n}function fw(e,t,i){const{matrix:r,rotation:o,translation:n,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=r||Q.fromRotationTranslationScale([],o||[0,0,0,1],n||[0,0,0],s||[1,1,1]),a!==void 0){u.meshes=i[a];const p=u.anchor=[0,0];for(const f of u.meshes){const{min:g,max:_}=f.aabb;p[0]+=g[0]+_[0],p[1]+=g[1]+_[1]}p[0]=Math.floor(p[0]/u.meshes.length/2),p[1]=Math.floor(p[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(p){if(!p.length)return[];const f=function(b){const T=atob(b),S=new Uint8Array(T.length);for(let M=0;M<T.length;M++)S[M]=T.codePointAt(M);return S}(p),g=[],_=f.length/24,y=new Uint16Array(f.buffer),x=new Float32Array(f.buffer);for(let b=0;b<_;b++){const T=y[2*b*6]/30,S=y[2*b*6+1]/30,M=y[2*b*6+10]/100,E=x[6*b+1],A=x[6*b+2],I=x[6*b+3],z=x[6*b+4],P=I-E,R=z-A,F=Math.hypot(P,R);g.push({pos:[E+.5*P,A+.5*R,S],normal:[R/F,-P/F,0],width:F,height:T,depth:M,points:[E,A,I,z]})}return g}(l.lights))),c){const p=[];for(const f of c)p.push(fw(t.json.nodes[f],t,i));u.children=p}return u}function BI(e){if(e.vertices.length===0||e.indices.length===0)return null;const[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let s=1;s<e.vertices.length;++s){const a=e.vertices[s];t.x=Math.min(t.x,a.x),t.y=Math.min(t.y,a.y),i.x=Math.max(i.x,a.x),i.y=Math.max(i.y,a.y)}const r=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),o=Math.max(8,r),n=new pw(e.vertices,e.indices,o);return{vertices:e.vertices,indices:e.indices,grid:n,min:t,max:i}}function FI(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;const r=[];for(const s of i){if(!Array.isArray(s)||s.length!==2)continue;const a=s[0],l=s[1];typeof a=="number"&&typeof l=="number"&&r.push(new B(a,l))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let o=0;for(let s=0;s<r.length;s++){const a=r[s],l=r[(s+1)%r.length],c=r[(s+2)%r.length];o+=(a.x-l.x)*(c.y-l.y)-(c.x-l.x)*(a.y-l.y)}o>0&&r.reverse();const n=ih(r.flatMap(s=>[s.x,s.y]),[]);return n.length===0?null:{vertices:r,indices:n}}function NI(e){const t=[],i=[];let r=0;for(const o of e){r=t.length;const n=o.vertexArray.float32,s=o.indexArray.uint16;for(let a=0;a<o.vertexArray.length;a++)t.push(new B(n[3*a+0],n[3*a+1]));for(let a=0;a<3*o.indexArray.length;a++)i.push(s[a]+r)}if(i.length%3!=0)return null;for(let o=0;o<i.length;o+=3){const n=t[i[o+0]],s=t[i[o+1]],a=t[i[o+2]];(n.x-s.x)*(a.y-s.y)-(a.x-s.x)*(n.y-s.y)>0&&([i[o+1],i[o+2]]=[i[o+2],i[o+1]])}return{vertices:t,indices:i}}function dg(e){const t=function(l,c){const u=[],p=k.WebGL2RenderingContext;if(l.json.textures)for(const f of l.json.textures){const g={magFilter:p.LINEAR,minFilter:p.NEAREST,wrapS:p.REPEAT,wrapT:p.REPEAT};f.sampler!==void 0&&Object.assign(g,l.json.samplers[f.sampler]),u.push({image:c[f.source],sampler:g,uploaded:!1})}return u}(e,e.images),i=function(l,c){const u=[];for(const p of l.json.meshes){const f=[];for(const g of p.primitives)f.push(OI(g,l,c));u.push(f)}return u}(e,t),{scenes:r,scene:o,nodes:n}=e.json,s=r?r[o||0].nodes:n,a=[];for(const l of s)a.push(fw(n[l],e,i));return function(l,c,u){const p={},f=new Set;for(let g=0;g<l.length;g++){const _=u[c[g]];if(!_.extras)continue;const y=_.extras["mapbox:footprint:version"],x=_.extras["mapbox:footprint:id"];(y||x)&&f.add(g),y==="1.0.0"&&x&&(p[x]=g)}for(let g=0;g<l.length;g++){if(f.has(g))continue;const _=l[g],y=u[c[g]];if(!y.extras)continue;let x=null;_.id in p&&(x=NI(l[p[_.id]].meshes)),x||(x=FI(y)),x&&(_.footprint=BI(x))}if(f.size>0){const g=Array.from(f.values()).sort((_,y)=>_-y);for(let _=g.length-1;_>=0;_--)l.splice(g[_],1)}}(a,s,e.json.nodes),a}function VI(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,i=e.aabb.min[0]-1,r=e.aabb.min[1]-1,o=Us/(e.aabb.max[0]-i+2),n=Us/(e.aabb.max[1]-r+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-i)*o|0,c=(t[s+1]-r)*n|0;a>e.heightmap[c*Us+l]&&(e.heightmap[c*Us+l]=a)}}function jI(e,t){const i={};i.indexArray=new Zi,i.indexArray.reserve(4*e.length),i.vertexArray=new Ls,i.vertexArray.reserve(10*e.length),i.colorArray=new _n,i.vertexArray.reserve(10*e.length);let r=0;for(const s of e){const a=Math.min(10,Math.max(4,1.3*s.height))*t,l=[-s.normal[1],s.normal[0],0],c=Math.min(.29,.1*s.width/s.depth),u=s.width-2*s.depth*t*(c+.01),p=j.scaleAndAdd([],s.pos,l,u/2),f=j.scaleAndAdd([],s.pos,l,-u/2),g=[p[0],p[1],p[2]+s.height],_=[f[0],f[1],f[2]+s.height],y=j.scaleAndAdd([],s.normal,l,c);j.scale(y,y,a);const x=j.scaleAndAdd([],s.normal,l,-c);j.scale(x,x,a),j.add(y,p,y),j.add(x,f,x),p[2]+=.1,f[2]+=.1,i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]),i.vertexArray.emplaceBack(g[0],g[1],g[2]),i.vertexArray.emplaceBack(_[0],_[1],_[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(f[0],f[1],f[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]);const b=u/a/2;i.colorArray.emplaceBack(-b-c,-1,b,.8),i.colorArray.emplaceBack(b+c,-1,b,.8),i.colorArray.emplaceBack(-b,0,b,1.3),i.colorArray.emplaceBack(b,0,b,1.3),i.colorArray.emplaceBack(b+c,-.8,b,.7),i.colorArray.emplaceBack(b+c,-.8,b,.7),i.colorArray.emplaceBack(0,0,b,1.3),i.colorArray.emplaceBack(0,0,b,1.3),i.colorArray.emplaceBack(b+c,-1.2,b,.8),i.colorArray.emplaceBack(b+c,-1.2,b,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const o={defined:!0,emissiveFactor:[0,0,0]},n={};return n.baseColorFactor=xe.white,o.pbrMetallicRoughness=n,i.material=o,i.aabb=new di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}jt(pw,"TriangleGridIndex");const pg={vector:ow,raster:rg,"raster-dem":class extends rg{constructor(e,t,i,r){super(e,t,i,r),this.type="raster-dem",this.maxzoom=22,this._options=Vt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(o,n){o&&(e.state="errored",t(o)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=_e(this.map._requestManager.transformRequest(i,ht.Tile),function(o,n,s,a){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(o)e.state="errored",t(o);else if(n){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const c=k.ImageBitmap&&n instanceof k.ImageBitmap&&Y_(),u=1-(n.width-((l=n.width)<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))))/2;u<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const p=c?n:ce.getImageData(n,u),f={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:p,encoding:this.encoding,padding:u};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",f,r.bind(this),void 0,!0))}var l}.bind(this))}_getNeighboringTiles(e){const t=e.canonical,i=Math.pow(2,t.z),r=(t.x-1+i)%i,o=t.x===0?e.wrap-1:e.wrap,n=(t.x+1+i)%i,s=t.x+1===i?e.wrap+1:e.wrap,a={};return a[new Ue(e.overscaledZ,o,t.z,r,t.y).key]={backfilled:!1},a[new Ue(e.overscaledZ,s,t.z,n,t.y).key]={backfilled:!1},t.y>0&&(a[new Ue(e.overscaledZ,o,t.z,r,t.y-1).key]={backfilled:!1},a[new Ue(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},a[new Ue(e.overscaledZ,s,t.z,n,t.y-1).key]={backfilled:!1}),t.y+1<i&&(a[new Ue(e.overscaledZ,o,t.z,r,t.y+1).key]={backfilled:!1},a[new Ue(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},a[new Ue(e.overscaledZ,s,t.z,n,t.y+1).key]={backfilled:!1}),a}},geojson:class extends qi{constructor(e,t,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=t.data,this._options=Vt({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const o=at/this.tileSize;this.workerOptions=Vt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*o,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*o,extent:at,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:at,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*o,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Tt("dataloading",{dataType:"source"})),this._loaded=!1;const e=Vt({},this.workerOptions);e.scope=this.scope;const t=this._data;typeof t=="string"?(e.request=this.map._requestManager.transformRequest(ce.resolveURL(t),ht.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new ae(i));else{const o={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(o.resourceTiming=r.resourceTiming[this.id]),this.fire(new Tt("data",o)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const i=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const r={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ce.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(i,r,(o,n)=>(delete e.request,e.destroy(),e.aborted?t(null):o?t(o):(e.loadVectorData(n,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Vt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ao{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,ht.Source).url);(function(t,i){const r=k.document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let o=0;o<t.length;o++){const n=k.document.createElement("source");Pt(t[o])||(r.crossOrigin="Anonymous"),n.src=t[o],r.appendChild(n)}})(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new ae(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new ae(new Nt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new Mi(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ao,model:class extends qi{constructor(e,t,i,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const i=this._options.models[t],r=dw(this.map._requestManager.transformRequest(i.uri,ht.Model).url).then(o=>{if(!o)return;const n=dg(o),s=new lb(t,i.position,i.orientation,n);s.computeBoundsAndApplyParent(),this.models.push(s)}).catch(o=>{this.fire(new ae(new Error(`Could not load model ${t} from ${i.uri}: ${o.message}`)))});e.push(r)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new ae(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends qi{constructor(e,t,i,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=eg(this._options,this.map._requestManager,t,i,(r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new ae(r))):o&&(Vt(this,o),o.bounds&&(this.tileBounds=new Vh(o.bounds,this.minzoom,this.maxzoom)),ep(o.tiles,this.map._requestManager._customAccessToken),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,ht.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&e.state!=="expired")if(e.state==="loading")e.reloadCallback=t;else{if(e.buckets){const n=Object.values(e.buckets);for(const s of n)s.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",r,o.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);function o(n,s){return e.aborted?t(null):n&&n.status!==404?t(n):(s&&(s.resourceTiming&&(e.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(s),e.buckets={...e.buckets,...s.buckets}),e.state="loaded",void t(null))}}serialize(){return Vt({},this._options)}},canvas:class extends Ao{constructor(e,t,i,r){super(e,t,i,r),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(o=>!Array.isArray(o)||o.length!==2||o.some(n=>typeof n!="number"))||this.fire(new ae(new Nt(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new ae(new Nt(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new ae(new Nt(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof k.HTMLCanvasElement||this.fire(new ae(new Nt(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new ae(new Nt(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof k.HTMLCanvasElement?this.options.canvas:k.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new ae(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof Ah||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Mi(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends qi{constructor(e,t,i,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new ae(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new ae(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vh(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Vt(this,Vr(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Vr(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:r,z:o}=e.tileID.canonical,n=new k.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:o},{signal:n.signal})).then(function(s){return delete e.request,e.aborted?(e.state="unloaded",t(null)):s===void 0?(e.state="errored",t(null)):s===null?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(a){return a instanceof k.ImageData||a instanceof k.HTMLCanvasElement||a instanceof k.ImageBitmap||a instanceof k.HTMLImageElement}(s)?(this.loadTileData(e,s),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(s=>{s.code!==20&&(e.state="errored",t(s))}),e.request.cancel=()=>n.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof Mi?(e.destroy(!0),e.texture&&e.texture instanceof Mi&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:i,y:r,z:o}=e.tileID.canonical;this._implementation.unloadTile({x:i,y:r,z:o})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=br(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))}}},fg=function(e,t,i,r){const o=new pg[t.type](e,t,i,r);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return ir(["load","abort","unload","serialize","prepare"],o),o};function UI(e,t){const i=Q.identity([]);return Q.scale(i,i,[.5*e.width,.5*-e.height,1]),Q.translate(i,i,[1,-1,0]),Q.multiply(i,i,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(i)}function GI(e,t,i,r,o,n,s,a=!1){const l=e.tilesIn(r,s,a);l.sort(mw);const c=[];for(const p of l)c.push({wrappedTileID:p.tile.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(t,i,e._state,p,o,n,UI(e.transform,p.tile.tileID),a)});const u=function(p){const f={},g={};for(const _ of p){const y=_.queryResults,x=_.wrappedTileID,b=g[x]=g[x]||{};for(const T in y){const S=y[T],M=b[T]=b[T]||{},E=f[T]=f[T]||[];for(const A of S)M[A.featureIndex]||(M[A.featureIndex]=!0,E.push(A))}}return f}(c);for(const p in u)u[p].forEach(f=>{const g=f.feature,_=g.layer;_&&_.type!=="background"&&_.type!=="sky"&&_.type!=="slot"&&(g.source=_.source,_["source-layer"]&&(g.sourceLayer=_["source-layer"]),g.state=g.id!==void 0?e.getFeatureState(_["source-layer"],g.id):{})});return u}function qI(e,t){const i=e.getRenderableIds().map(n=>e.getTileByID(n)),r=[],o={};for(let n=0;n<i.length;n++){const s=i[n],a=s.tileID.canonical.key;o[a]||(o[a]=!0,s.querySourceFeatures(r,t))}return r}function mw(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class $I{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const i=this.style._mergedLayers[t];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){const r=this.style.getLayerSource(i);r&&r.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(let o=0;o<this.layers.length;++o){const n=this.layers[o],s=this.style.getLayerSourceCache(n);let a=1;n.type==="fill-extrusion"&&(a=n.paint.get("fill-extrusion-opacity")>0?n.paint.get("fill-extrusion-vertical-scale"):0);let l=s?s.getTile(i):null;if(!l&&s&&i.canonical.z>s.getSource().minzoom){let c=i.scaledTo(Math.min(s.getSource().maxzoom,i.overscaledZ-1));for(;c.overscaledZ>=s.getSource().minzoom&&(l=s.getTile(c),!l&&c.overscaledZ!==0);)c=c.scaledTo(c.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:l?l.getBucket(n):null,tileID:l?l.tileID:i,verticalScale:a})}t.hasAnyZOffset=!1;let r=!1;for(let o=0;o<t.symbolInstances.length;o++){const n=t.symbolInstances.get(o),s=n.zOffset,a=this._getHeightAtTileOffset(i,n.tileAnchorX,n.tileAnchorY);n.zOffset=a!==-1?a:s,r||s===n.zOffset||(r=!0),t.hasAnyZOffset||n.zOffset===0||(t.hasAnyZOffset=!0)}r&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,r,o){let n=i,s=r;if(t.canonical.z!==o.canonical.z){const a=o.canonical,l=1/(1<<t.canonical.z-a.z);n=(i+t.canonical.x*at)*l-a.x*at|0,s=(r+t.canonical.y*at)*l-a.y*at|0}return{tileX:n,tileY:s}}_getHeightAtTileOffset(t,i,r){let o;for(let n=0;n<this.layers.length;++n){if(this.layers[n].type!=="fill-extrusion")continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[n];if(!s)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(t,i,r,a),p=s.getHeightAtTileCoord(c,u);if(p&&p.height!==void 0){if(!p.hidden)return p.height*l;o=p.height}}for(let n=0;n<this.layers.length;++n){if(this.layers[n].type!=="model")continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[n];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,i,r,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return u.height===void 0&&o!==void 0?Math.min(u.maxHeight,o)*u.verticalScale:(u.height||0)*u.verticalScale}return-1}}var gw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ZI(e,t){const i={};for(const r in e)r!=="ref"&&(i[r]=e[r]);return gw.forEach(r=>{r in t&&(i[r]=t[r])}),i}function _w(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=ZI(e[i],t[e[i].ref]));return e}const $e={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function yw(e,t,i){i.push({command:$e.addSource,args:[e,t[e]]})}function xw(e,t,i){t.push({command:$e.removeSource,args:[e]}),i[e]=!0}function HI(e,t,i,r){xw(e,i,r),yw(e,t,i)}function WI(e,t,i){let r;for(r in e[i])if(e[i].hasOwnProperty(r)&&r!=="data"&&!st(e[i][r],t[i][r]))return!1;for(r in t[i])if(t[i].hasOwnProperty(r)&&r!=="data"&&!st(e[i][r],t[i][r]))return!1;return!0}function Uh(e,t,i,r,o,n){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(st(e[s],t[s])||i.push({command:n,args:[r,s,t[s],o]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(st(e[s],t[s])||i.push({command:n,args:[r,s,t[s],o]}))}function Gh(e){return e.id}function qh(e,t){return e[t.id]=t,e}class XI{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=Ut(t,0,1);let i=1,r=this._distances[i];const o=t*this.paddedLength+this.padding;for(;r<o&&i<this._distances.length;)r=this._distances[++i];const n=i-1,s=this._distances[n],a=r-s,l=a>0?(o-s)/a:0;return this.points[n].mult(1-l).add(this.points[i].mult(l))}}class vw{constructor(t,i,r){const o=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(i/r);for(let s=0;s<this.xCellCount*this.yCellCount;s++)o.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,r,o,n){this._forEachCell(i,r,o,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(n)}insertCircle(t,i,r,o){this._forEachCell(i-o,r-o,i+o,r+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(r),this.circles.push(o)}_insertBoxCell(t,i,r,o,n,s){this.boxCells[n].push(s)}_insertCircleCell(t,i,r,o,n,s){this.circleCells[n].push(s)}_query(t,i,r,o,n,s){if(r<0||t>this.width||o<0||i>this.height)return!n&&[];const a=[];if(t<=0&&i<=0&&this.width<=r&&this.height<=o){if(n)return!0;for(let l=0;l<this.boxKeys.length;l++)a.push({key:this.boxKeys[l],x1:this.bboxes[4*l],y1:this.bboxes[4*l+1],x2:this.bboxes[4*l+2],y2:this.bboxes[4*l+3]});for(let l=0;l<this.circleKeys.length;l++){const c=this.circles[3*l],u=this.circles[3*l+1],p=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:c-p,y1:u-p,x2:c+p,y2:u+p})}return s?a.filter(s):a}return this._forEachCell(t,i,r,o,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},s),n?a.length>0:a}_queryCircle(t,i,r,o,n){const s=t-r,a=t+r,l=i-r,c=i+r;if(a<0||s>this.width||c<0||l>this.height)return!o&&[];const u=[];return this._forEachCell(s,l,a,c,this._queryCellCircle,u,{hitTest:o,circle:{x:t,y:i,radius:r},seenUids:{box:{},circle:{}}},n),o?u.length>0:u}query(t,i,r,o,n){return this._query(t,i,r,o,!1,n)}hitTest(t,i,r,o,n){return this._query(t,i,r,o,!0,n)}hitTestCircle(t,i,r,o){return this._queryCircle(t,i,r,!0,o)}_queryCell(t,i,r,o,n,s,a,l){const c=a.seenUids,u=this.boxCells[n];if(u!==null){const f=this.bboxes;for(const g of u)if(!c.box[g]){c.box[g]=!0;const _=4*g;if(t<=f[_+2]&&i<=f[_+3]&&r>=f[_+0]&&o>=f[_+1]&&(!l||l(this.boxKeys[g]))){if(a.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[g],x1:f[_],y1:f[_+1],x2:f[_+2],y2:f[_+3]})}}}const p=this.circleCells[n];if(p!==null){const f=this.circles;for(const g of p)if(!c.circle[g]){c.circle[g]=!0;const _=3*g;if(this._circleAndRectCollide(f[_],f[_+1],f[_+2],t,i,r,o)&&(!l||l(this.circleKeys[g]))){if(a.hitTest)return s.push(!0),!0;{const y=f[_],x=f[_+1],b=f[_+2];s.push({key:this.circleKeys[g],x1:y-b,y1:x-b,x2:y+b,y2:x+b})}}}}}_queryCellCircle(t,i,r,o,n,s,a,l){const c=a.circle,u=a.seenUids,p=this.boxCells[n];if(p!==null){const g=this.bboxes;for(const _ of p)if(!u.box[_]){u.box[_]=!0;const y=4*_;if(this._circleAndRectCollide(c.x,c.y,c.radius,g[y+0],g[y+1],g[y+2],g[y+3])&&(!l||l(this.boxKeys[_])))return s.push(!0),!0}}const f=this.circleCells[n];if(f!==null){const g=this.circles;for(const _ of f)if(!u.circle[_]){u.circle[_]=!0;const y=3*_;if(this._circlesCollide(g[y],g[y+1],g[y+2],c.x,c.y,c.radius)&&(!l||l(this.circleKeys[_])))return s.push(!0),!0}}}_forEachCell(t,i,r,o,n,s,a,l){const c=this._convertToXCellCoord(t),u=this._convertToYCellCoord(i),p=this._convertToXCellCoord(r),f=this._convertToYCellCoord(o);for(let g=c;g<=p;g++)for(let _=u;_<=f;_++)if(n.call(this,t,i,r,o,this.xCellCount*_+g,s,a,l))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,r,o,n,s){const a=o-t,l=n-i,c=r+s;return c*c>a*a+l*l}_circleAndRectCollide(t,i,r,o,n,s,a){const l=(s-o)/2,c=Math.abs(t-(o+l));if(c>l+r)return!1;const u=(a-n)/2,p=Math.abs(i-(n+u));if(p>u+r)return!1;if(c<=l||p<=u)return!0;const f=c-l,g=p-u;return f*f+g*g<=r*r}}const on=100;class YI{constructor(t,i,r=new vw(t.width+200,t.height+200,25),o=new vw(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+on,this.screenBottomBoundary=t.height+on,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,r,o,n,s,a,l){let c=r.projectedAnchorX,u=r.projectedAnchorY,p=r.projectedAnchorZ;const f=r.elevation,g=r.tileID,_=t.getProjection();if(f&&g){const[A,I,z]=_.upVector(g.canonical,r.tileAnchorX,r.tileAnchorY),P=_.upVectorScale(g.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;c+=A*f*P,u+=I*f*P,p+=z*f*P}const y=this.projectAndGetPerspectiveRatio(a,c,u,p,r.tileID,_.name==="globe"||!!f||this.transform.pitch>0,_),x=s*y.perspectiveRatio,b=(r.x1*i+o.x-r.padding)*x+y.point.x,T=(r.y1*i+o.y-r.padding)*x+y.point.y,S=(r.x2*i+o.x+r.padding)*x+y.point.x,M=(r.y2*i+o.y+r.padding)*x+y.point.y,E=y.perspectiveRatio<=.55||y.occluded;return!this.isInsideGrid(b,T,S,M)||!n&&this.grid.hitTest(b,T,S,M,l)||E?{box:[],offscreen:!1,occluded:y.occluded}:{box:[b,T,S,M],offscreen:this.isOffscreen(b,T,S,M),occluded:!1}}placeCollisionCircles(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y){const x=[],b=this.transform.elevation,T=t.getProjection(),S=b?b.getAtTileOffsetFunc(y,this.transform.center.lat,this.transform.worldSize,T):null,M=new B(r.tileAnchorX,r.tileAnchorY);let{x:E,y:A,z:I}=T.projectTilePoint(M.x,M.y,y.canonical);if(S){const[K,$,H]=S(M);E+=K,A+=$,I+=H}const z=T.name==="globe",P=this.projectAndGetPerspectiveRatio(a,E,A,I,y,z||!!b||this.transform.pitch>0,T),{perspectiveRatio:R}=P,F=(p?s/R:s*R)/lr,N=Vo(E,A,I,l),U=P.signedDistanceFromCamera>0?Kv(F,n,r.lineOffsetX*F,r.lineOffsetY*F,!1,N,M,r,o,l,{},b&&!p?S:null,p&&!!b,T,y,p):null;let O=!1,Z=!1,W=!0;if(U&&!P.occluded){const K=.5*g*R+_,$=new B(-100,-100),H=new B(this.screenRightBoundary,this.screenBottomBoundary),it=new XI,{first:ot,last:rt}=U,lt=ot.path.length;let ut=[];for(let mt=lt-1;mt>=1;mt--)ut.push(ot.path[mt]);for(let mt=1;mt<rt.path.length;mt++)ut.push(rt.path[mt]);const pt=2.5*K;c&&(ut=ut.map(([mt,It,kt],Rt)=>(S&&!z&&(kt=S(Rt<lt-1?ot.tilePath[lt-1-Rt]:rt.tilePath[Rt-lt+2])[2]),Vo(mt,It,kt,c))),ut.some(mt=>mt[3]<=0)&&(ut=[]));let nt=[];if(ut.length>0){let mt=1/0,It=-1/0,kt=1/0,Rt=-1/0;for(const Ot of ut)mt=Math.min(mt,Ot[0]),kt=Math.min(kt,Ot[1]),It=Math.max(It,Ot[0]),Rt=Math.max(Rt,Ot[1]);It>=$.x&&mt<=H.x&&Rt>=$.y&&kt<=H.y&&(nt=[ut.map(Ot=>new B(Ot[0],Ot[1]))],(mt<$.x||It>H.x||kt<$.y||Rt>H.y)&&(nt=bv(nt,$.x,$.y,H.x,H.y)))}for(const mt of nt){it.reset(mt,.25*K);let It=0;It=it.length<=.5*K?1:Math.ceil(it.paddedLength/pt)+1;for(let kt=0;kt<It;kt++){const Rt=kt/Math.max(It-1,1),Ot=it.lerp(Rt),oe=Ot.x+on,$t=Ot.y+on;x.push(oe,$t,K,0);const Fe=oe-K,Ae=$t-K,ie=oe+K,te=$t+K;if(W=W&&this.isOffscreen(Fe,Ae,ie,te),Z=Z||this.isInsideGrid(Fe,Ae,ie,te),!i&&this.grid.hitTestCircle(oe,$t,K,f)&&(O=!0,!u))return{circles:[],offscreen:!1,collisionDetected:O,occluded:!1}}}}return{circles:!u&&O||!Z?[]:x,offscreen:W,collisionDetected:O,occluded:P.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let r=1/0,o=1/0,n=-1/0,s=-1/0;for(const u of t){const p=new B(u.x+on,u.y+on);r=Math.min(r,p.x),o=Math.min(o,p.y),n=Math.max(n,p.x),s=Math.max(s,p.y),i.push(p)}const a=this.grid.query(r,o,n,s).concat(this.ignoredGrid.query(r,o,n,s)),l={},c={};for(const u of a){const p=u.key;l[p.bucketInstanceId]===void 0&&(l[p.bucketInstanceId]={}),l[p.bucketInstanceId][p.featureIndex]||Sx(i,[new B(u.x1,u.y1),new B(u.x2,u.y1),new B(u.x2,u.y2),new B(u.x1,u.y2)])&&(l[p.bucketInstanceId][p.featureIndex]=!0,c[p.bucketInstanceId]===void 0&&(c[p.bucketInstanceId]=[]),c[p.bucketInstanceId].push(p.featureIndex))}return c}insertCollisionBox(t,i,r,o,n){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:o,collisionGroupID:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,r,o,n){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:o,collisionGroupID:n};for(let l=0;l<t.length;l+=4)s.insertCircle(a,t[l],t[l+1],t[l+2])}projectAndGetPerspectiveRatio(t,i,r,o,n,s,a){const l=[i,r,o,1];let c=!1;o||this.transform.pitch>0?(ei.transformMat4(l,l,t),this.fogState&&n&&a.name!=="globe"&&(c=function(p,f,g,_,y,x){const b=x.calculateFogTileMatrix(y),T=[f,g,_];return j.transformMat4(T,T,b),Nh(p,j.length(T),x.pitch,x._fov)}(this.fogState,i,r,o,n.toUnwrapped(),this.transform)>.9)):rb(l,l,t);const u=l[3];return{point:new B((l[0]/u+1)/2*this.transform.width+on,(-l[1]/u+1)/2*this.transform.height+on),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(t,i,r,o){return r<on||t>=this.screenRightBoundary||o<on||i>this.screenBottomBoundary}isInsideGrid(t,i,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const t=Q.identity([]);return Q.translate(t,t,[-100,-100,0]),t}}function mg(e,t,i){const r=t.createTileMatrix(e,e.worldSize,i.toUnwrapped());return Q.multiply(new Float32Array(16),e.projMatrix,r)}function JI(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),mg(r,t.getProjection(),e)}function gg(e,t,i){return t.name===i.projection.name?e.projMatrix:mg(i,t,e)}class bw{constructor(t,i,r,o){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):o&&r?1:0,this.placed=r}isHidden(){return this.opacity===0&&!this.placed}}class xc{constructor(t,i,r,o,n,s=!1){this.text=new bw(t?t.text:null,i,r,n),this.icon=new bw(t?t.icon:null,i,o,n),this.clipped=s}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _g{constructor(t,i,r,o=!1){this.text=t,this.icon=i,this.skipFade=r,this.clipped=o}}class KI{constructor(){this.invProjMatrix=Q.create(),this.viewportMatrix=Q.create(),this.circles=[]}}class QI{constructor(t,i,r,o,n){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=r,this.bucketIndex=o,this.tileID=n}}class tk{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:r=>r.collisionGroupID===i}}return this.collisionGroups[t]}}function ww(e,t,i,r,o){const{horizontalAlign:n,verticalAlign:s}=dh(e),a=-(n-.5)*t,l=-(s-.5)*i,c=Rm(e,r);return new B(a+c[0]*o,l+c[1]*o)}function yg(e,t,i,r,o){const n=new B(e,t);return i&&n._rotate(r?o:-o),n}class ek{constructor(t,i,r,o,n,s){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new YI(this.transform,n),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new tk(r),this.collisionCircleArrays={},this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,o){const n=r.getBucket(i),s=r.latestFeatureIndex;if(!n||!s||i.fqid!==n.layerIds[0])return;const a=n.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/at,p=r.tileID.toUnwrapped();this.transform.setProjection(n.projection);const f=(g=r.tileID,_=n.getProjection(),y=this.transform,_.name===this.projection?y.calculateProjMatrix(g.toUnwrapped()):mg(y,_,g));var g,_,y;const x=a.get("text-pitch-alignment")==="map",b=a.get("text-rotation-alignment")==="map";i.compileFilter();const T=i.dynamicFilter(),S=i.dynamicFilterNeedsFeature(),M=this.transform.calculatePixelsToTileUnitsMatrix(r),E=Xv(f,r.tileID.canonical,x,b,this.transform,n.getProjection(),M);let A=null;if(x){const P=Yv(f,r.tileID.canonical,x,b,this.transform,n.getProjection(),M);A=Q.multiply([],this.transform.labelPlaneMatrix,P)}let I=null;T&&r.latestFeatureIndex&&(I={unwrappedTileID:p,dynamicFilter:T,dynamicFilterNeedsFeature:S,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[n.bucketInstanceId]=new QI(n.bucketInstanceId,s,n.sourceLayerIndex,n.index,r.tileID);const z={bucket:n,layout:a,posMatrix:f,textLabelPlaneMatrix:E,labelToScreenMatrix:A,clippingData:I,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:Qo(n.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Qo(n.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(n.sourceID)};if(o)for(const P of n.sortKeyRanges){const{sortKey:R,symbolInstanceStart:F,symbolInstanceEnd:N}=P;t.push({sortKey:R,symbolInstanceStart:F,symbolInstanceEnd:N,parameters:z})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:n.symbolInstances.length,parameters:z})}attemptAnchorPlacement(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T){const{textOffset0:S,textOffset1:M,crossTileID:E}=f,A=[S,M],I=ww(t,r,o,A,n),z=this.collisionIndex.placeCollisionBox(_,n,i,yg(I.x,I.y,s,a,this.transform.angle),p,l,c,u.predicate);if(x){const P=_.getSymbolInstanceIconSize(T,this.transform.zoom,f.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(_,P,x,yg(I.x,I.y,s,a,this.transform.angle),p,l,c,u.predicate).box.length===0)return}if(z.box.length>0){let P;return this.prevPlacement&&this.prevPlacement.variableOffsets[E]&&this.prevPlacement.placements[E]&&this.prevPlacement.placements[E].text&&(P=this.prevPlacement.variableOffsets[E].anchor),this.variableOffsets[E]={textOffset:A,width:r,height:o,anchor:t,textScale:n,prevAnchor:P},this.markUsedJustification(_,t,f,y),_.allowVerticalPlacement&&(this.markUsedOrientation(_,y,f),this.placedOrientations[E]=y),{shift:I,placedGlyphBoxes:z}}}placeLayerBucketPart(t,i,r,o){const{bucket:n,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:p,holdingForFade:f,collisionBoxArray:g,partiallyEvaluatedTextSize:_,partiallyEvaluatedIconSize:y,collisionGroup:x}=t.parameters,b=s.get("text-optional"),T=s.get("icon-optional"),S=s.get("text-allow-overlap"),M=s.get("icon-allow-overlap"),E=s.get("text-rotation-alignment")==="map",A=s.get("text-pitch-alignment")==="map",I=s.get("symbol-z-order")==="viewport-y",z=s.get("symbol-z-elevate");this.transform.setProjection(n.projection);let P=S&&(M||!n.hasIconData()||T),R=M&&(S||!n.hasTextData()||b);!n.collisionArrays&&g&&n.deserializeCollisionBoxes(g),r&&o&&n.updateCollisionDebugBuffers(this.transform.zoom,g);const F=(N,U,O)=>{const{crossTileID:Z,numVerticalGlyphVertices:W}=N;if(u){const ie={zoom:this.transform.zoom,pitch:this.transform.pitch};let te=null;if(u.dynamicFilterNeedsFeature){const Xt=this.retainedQueryData[n.bucketInstanceId];te=u.featureIndex.loadFeature({featureIndex:N.featureIndex,bucketIndex:Xt.bucketIndex,sourceLayerIndex:Xt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(ie,te,this.retainedQueryData[n.bucketInstanceId].tileID.canonical,new B(N.tileAnchorX,N.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[Z]=new _g(!1,!1,!1,!0),void i.add(Z)}if(i.has(Z))return;if(f)return void(this.placements[Z]=new _g(!1,!1,!1));let K=!1,$=!1,H=!0,it=!1,ot=!1,rt=null,lt={box:null,offscreen:null,occluded:null},ut={box:null,offscreen:null,occluded:null},pt=null,nt=null,mt=null,It=0,kt=0,Rt=0;O.textFeatureIndex?It=O.textFeatureIndex:N.useRuntimeCollisionCircles&&(It=N.featureIndex),O.verticalTextFeatureIndex&&(kt=O.verticalTextFeatureIndex);const Ot=ie=>{ie.tileID=this.retainedQueryData[n.bucketInstanceId].tileID;const te=this.transform.elevation;ie.elevation=N.zOffset+(te?te.getAtTileOffset(ie.tileID,ie.tileAnchorX,ie.tileAnchorY):0)},oe=O.textBox;if(oe){Ot(oe);const ie=Xt=>{let Ie=vi.horizontal;if(n.allowVerticalPlacement&&!Xt&&this.prevPlacement){const Re=this.prevPlacement.placedOrientations[Z];Re&&(this.placedOrientations[Z]=Re,Ie=Re,this.markUsedOrientation(n,Ie,N))}return Ie},te=(Xt,Ie)=>{if(n.allowVerticalPlacement&&W>0&&O.verticalTextBox){for(const Re of n.writingModes)if(Re===vi.vertical?(lt=Ie(),ut=lt):lt=Xt(),lt&&lt.box&&lt.box.length)break}else lt=Xt()};if(s.get("text-variable-anchor")){let Xt=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z]){const ye=this.prevPlacement.variableOffsets[Z];Xt.indexOf(ye.anchor)>0&&(Xt=Xt.filter(si=>si!==ye.anchor),Xt.unshift(ye.anchor))}const Ie=(ye,si,Bi)=>{const ii=n.getSymbolInstanceTextSize(_,N,this.transform.zoom,U),pi=(ye.x2-ye.x1)*ii+2*ye.padding,ji=(ye.y2-ye.y1)*ii+2*ye.padding,Fi=N.hasIconTextFit&&!M?si:null;Fi&&Ot(Fi);let _i={box:[],offscreen:!1,occluded:!1};const Je=S?2*Xt.length:Xt.length;for(let hr=0;hr<Je;++hr){const sn=this.attemptAnchorPlacement(Xt[hr%Xt.length],ye,pi,ji,ii,E,A,p,a,x,hr>=Xt.length,N,U,n,Bi,Fi,_,y);if(sn&&(_i=sn.placedGlyphBoxes,_i&&_i.box&&_i.box.length)){K=!0,rt=sn.shift;break}}return _i};te(()=>Ie(oe,O.iconBox,vi.horizontal),()=>{const ye=O.verticalTextBox;return ye&&Ot(ye),n.allowVerticalPlacement&&!(lt&&lt.box&&lt.box.length)&&W>0&&ye?Ie(ye,O.verticalIconBox,vi.vertical):{box:null,offscreen:null,occluded:null}}),lt&&(K=lt.box,H=lt.offscreen,it=lt.occluded);const Re=ie(!(!lt||!lt.box));if(!K&&this.prevPlacement){const ye=this.prevPlacement.variableOffsets[Z];ye&&(this.variableOffsets[Z]=ye,this.markUsedJustification(n,ye.anchor,N,Re))}}else{const Xt=(Ie,Re)=>{const ye=n.getSymbolInstanceTextSize(_,N,this.transform.zoom,U),si=this.collisionIndex.placeCollisionBox(n,ye,Ie,new B(0,0),S,p,a,x.predicate);return si&&si.box&&si.box.length&&(this.markUsedOrientation(n,Re,N),this.placedOrientations[Z]=Re),si};te(()=>Xt(oe,vi.horizontal),()=>{const Ie=O.verticalTextBox;return n.allowVerticalPlacement&&W>0&&Ie?(Ot(Ie),Xt(Ie,vi.vertical)):{box:null,offscreen:null,occluded:null}}),ie(!!(lt&&lt.box&&lt.box.length))}}if(pt=lt,K=pt&&pt.box&&pt.box.length>0,H=pt&&pt.offscreen,it=pt&&pt.occluded,N.useRuntimeCollisionCircles){const ie=n.text.placedSymbolArray.get(N.centerJustifiedTextSymbolIndex>=0?N.centerJustifiedTextSymbolIndex:N.verticalPlacedTextSymbolIndex),te=Jl(n.textSizeData,_,ie),Xt=s.get("text-padding");nt=this.collisionIndex.placeCollisionCircles(n,S,ie,n.lineVertexArray,n.glyphOffsetArray,te,a,l,c,r,A,x.predicate,N.collisionCircleDiameter*te/lr,Xt,this.retainedQueryData[n.bucketInstanceId].tileID),K=S||nt.circles.length>0&&!nt.collisionDetected,H=H&&nt.offscreen,it=nt.occluded}if(O.iconFeatureIndex&&(Rt=O.iconFeatureIndex),O.iconBox){const ie=te=>{Ot(te);const Xt=N.hasIconTextFit&&rt?yg(rt.x,rt.y,E,A,this.transform.angle):new B(0,0),Ie=n.getSymbolInstanceIconSize(y,this.transform.zoom,N.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(n,Ie,te,Xt,M,p,a,x.predicate)};ut&&ut.box&&ut.box.length&&O.verticalIconBox?(mt=ie(O.verticalIconBox),$=mt.box.length>0):(mt=ie(O.iconBox),$=mt.box.length>0),H=H&&mt.offscreen,ot=mt.occluded}const $t=b||N.numHorizontalGlyphVertices===0&&W===0,Fe=T||N.numIconVertices===0;if($t||Fe?Fe?$t||($=$&&K):K=$&&K:$=K=$&&K,K&&pt&&pt.box&&this.collisionIndex.insertCollisionBox(pt.box,s.get("text-ignore-placement"),n.bucketInstanceId,ut&&ut.box&&kt?kt:It,x.ID),$&&mt&&this.collisionIndex.insertCollisionBox(mt.box,s.get("icon-ignore-placement"),n.bucketInstanceId,Rt,x.ID),nt&&(K&&this.collisionIndex.insertCollisionCircles(nt.circles,s.get("text-ignore-placement"),n.bucketInstanceId,It,x.ID),r)){const ie=n.bucketInstanceId;let te=this.collisionCircleArrays[ie];te===void 0&&(te=this.collisionCircleArrays[ie]=new KI);for(let Xt=0;Xt<nt.circles.length;Xt+=4)te.circles.push(nt.circles[Xt+0]),te.circles.push(nt.circles[Xt+1]),te.circles.push(nt.circles[Xt+2]),te.circles.push(nt.collisionDetected?1:0)}const Ae=n.projection.name!=="globe";P=P&&(Ae||!it),R=R&&(Ae||!ot),this.placements[Z]=new _g(K||P,$||R,H||n.justReloaded),i.add(Z)};if(z&&this.buildingIndex&&(this.buildingIndex.updateZOffset(n,this.retainedQueryData[n.bucketInstanceId].tileID),n.updateZOffset()),I){const N=n.getSortedSymbolIndexes(this.transform.angle);for(let U=N.length-1;U>=0;--U){const O=N[U];F(n.symbolInstances.get(O),O,n.collisionArrays[O])}n.hasAnyZOffset&&Y(`${n.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(n.hasAnyZOffset){const N=n.getSortedIndexesByZOffset();for(let U=0;U<N.length;++U){const O=N[U];F(n.symbolInstances.get(O),O,n.collisionArrays[O])}}else for(let N=t.symbolInstanceStart;N<t.symbolInstanceEnd;N++)F(n.symbolInstances.get(N),N,n.collisionArrays[N]);if(r&&n.bucketInstanceId in this.collisionCircleArrays){const N=this.collisionCircleArrays[n.bucketInstanceId];Q.invert(N.invProjMatrix,a),N.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}markUsedJustification(t,i,r,o){const{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,u=Lm(i),p=o===vi.vertical?l:u==="left"?n:u==="center"?s:u==="right"?a:-1;n>=0&&(t.text.placedSymbolArray.get(n).crossTileID=p>=0&&n!==p?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=p>=0&&s!==p?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=p>=0&&a!==p?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=p>=0&&l!==p?0:c)}markUsedOrientation(t,i,r){const o=i===vi.horizontal||i===vi.horizontalOnly?i:0,n=i===vi.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=o),a>=0&&(u.get(a).placedOrientation=o),l>=0&&(u.get(l).placedOrientation=o),c>=0&&(u.get(c).placedOrientation=n)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let r=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const o=i?i.symbolFadeChange(t):1,n=i?i.opacities:{},s=i?i.variableOffsets:{},a=i?i.placedOrientations:{};for(const l in this.placements){const c=this.placements[l],u=n[l];u?(this.opacities[l]=new xc(u,o,c.text,c.icon,null,c.clipped),r=r||c.text!==u.text.placed||c.icon!==u.icon.placed):(this.opacities[l]=new xc(null,o,c.text,c.icon,c.skipFade,c.clipped),r=r||c.text||c.icon)}for(const l in n){const c=n[l];if(!this.opacities[l]){const u=new xc(c,o,!1,!1);u.isHidden()||(this.opacities[l]=u,r=r||c.text.placed||c.icon.placed)}}for(const l in s)this.variableOffsets[l]||!this.opacities[l]||this.opacities[l].isHidden()||(this.variableOffsets[l]=s[l]);for(const l in a)this.placedOrientations[l]||!this.opacities[l]||this.opacities[l].isHidden()||(this.placedOrientations[l]=a[l]);r?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i){const r=new Set;for(const o of i){const n=o.getBucket(t);n&&o.latestFeatureIndex&&t.fqid===n.layerIds[0]&&(this.updateBucketOpacities(n,r,o.collisionBoxArray),n.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(n,o.tileID),n.updateZOffset()))}}updateBucketOpacities(t,i,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const o=t.layers[0].layout,n=!!t.layers[0].dynamicFilter(),s=new xc(null,0,!1,!1,!0),a=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),c=o.get("text-variable-anchor"),u=o.get("text-rotation-alignment")==="map",p=o.get("text-pitch-alignment")==="map",f=new xc(null,0,a&&(l||!t.hasIconData()||o.get("icon-optional")),l&&(a||!t.hasTextData()||o.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const g=(y,x,b)=>{for(let T=0;T<x/4;T++)y.opacityVertexArray.emplaceBack(b)};let _=0;for(let y=0;y<t.symbolInstances.length;y++){const x=t.symbolInstances.get(y),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,crossTileID:S,numIconVertices:M}=x,E=i.has(S);let A=this.opacities[S];E?A=s:A||(A=f,this.opacities[S]=A),i.add(S);const I=b>0||T>0,z=M>0,P=this.placedOrientations[S],R=P===vi.vertical,F=P===vi.horizontal||P===vi.horizontalOnly;if(!I&&!z||A.isHidden()||_++,I){const N=Tw(A.text);g(t.text,b,R?Zh:N),g(t.text,T,F?Zh:N);const U=A.text.isHidden(),{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:W,verticalPlacedTextSymbolIndex:K}=x,$=t.text.placedSymbolArray,H=U||R?1:0;O>=0&&($.get(O).hidden=H),Z>=0&&($.get(Z).hidden=H),W>=0&&($.get(W).hidden=H),K>=0&&($.get(K).hidden=U||F?1:0);const it=this.variableOffsets[S];it&&this.markUsedJustification(t,it.anchor,x,P);const ot=this.placedOrientations[S];ot&&(this.markUsedJustification(t,"left",x,ot),this.markUsedOrientation(t,ot,x))}if(z){const N=Tw(A.icon),{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:O}=x,Z=t.icon.placedSymbolArray,W=A.icon.isHidden()?1:0;U>=0&&(g(t.icon,M,R?Zh:N),Z.get(U).hidden=W),O>=0&&(g(t.icon,x.numVerticalIconVertices,F?Zh:N),Z.get(O).hidden=W)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const N=t.collisionArrays[y];if(N){let U=new B(0,0),O=!0;if(N.textBox||N.verticalTextBox){if(c){const W=this.variableOffsets[S];W?(U=ww(W.anchor,W.width,W.height,W.textOffset,W.textScale),u&&U._rotate(p?this.transform.angle:-this.transform.angle)):O=!1}n&&(O=!A.clipped),N.textBox&&$h(t.textCollisionBox.collisionVertexArray,A.text.placed,!O||R,U.x,U.y),N.verticalTextBox&&$h(t.textCollisionBox.collisionVertexArray,A.text.placed,!O||F,U.x,U.y)}const Z=O&&!!(!F&&N.verticalIconBox);N.iconBox&&$h(t.iconCollisionBox.collisionVertexArray,A.icon.placed,Z,x.hasIconTextFit?U.x:0,x.hasIconTextFit?U.y:0),N.verticalIconBox&&$h(t.iconCollisionBox.collisionVertexArray,A.icon.placed,!Z,x.hasIconTextFit?U.x:0,x.hasIconTextFit?U.y:0)}}}if(t.fullyClipped=_===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=y.invProjMatrix,t.placementViewportMatrix=y.viewportMatrix,t.collisionCircleArray=y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){const r=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*r>t}setStale(){this.stale=!0}}function $h(e,t,i,r,o){e.emplaceBack(t?1:0,i?1:0,r||0,o||0),e.emplaceBack(t?1:0,i?1:0,r||0,o||0),e.emplaceBack(t?1:0,i?1:0,r||0,o||0),e.emplaceBack(t?1:0,i?1:0,r||0,o||0)}const ik=Math.pow(2,25),rk=Math.pow(2,24),ok=Math.pow(2,17),nk=Math.pow(2,16),sk=Math.pow(2,9),ak=Math.pow(2,8),lk=Math.pow(2,1);function Tw(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*ik+t*rk+i*ok+t*nk+i*sk+t*ak+i*lk+t}const Zh=0;class ck{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,r,o,n){const s=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(s,o,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((a,l)=>a.sortKey-l.sortKey));this._currentPartIndex<s.length;){const a=s[this._currentPartIndex];if(i.placeLayerBucketPart(a,this._seenCrossTileIDs,r,a.symbolInstanceStart===0),this._currentPartIndex++,n())return!0}return!1}}class uk{constructor(t,i,r,o,n,s,a,l,c){this.placement=new ek(t,n,s,a,l,c),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=o,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r,o){const n=ce.now(),s=()=>{const a=ce.now()-n;return!this._forceFullPlacement&&a>2};for(;this._currentPlacementIndex>=0;){const a=i[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if(a.type==="symbol"&&(!a.minzoom||a.minzoom<=l)&&(!a.maxzoom||a.maxzoom>l)){const c=a,u=c.layout.get("symbol-z-elevate"),p=this._inProgressLayer=this._inProgressLayer||new ck(c),f=br(a.source,a.scope);if(p.continuePlacement(u?o[f]:r[f],this.placement,this._showCollisionBoxes,a,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ew=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hh{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=r>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const n=Ew[15&r];if(!n)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(t,2,1),[a]=new Uint32Array(t,4,1);return new Hh(a,s,n,t)}constructor(t,i=64,r=Float64Array,o){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=Ew.indexOf(this.ArrayType),s=2*t*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${r}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+l,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+l),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+l,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=t,this.coords[this._pos++]=i,r}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return xg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:s,nodeSize:a}=this,l=[0,n.length-1,0],c=[];for(;l.length;){const u=l.pop()||0,p=l.pop()||0,f=l.pop()||0;if(p-f<=a){for(let x=f;x<=p;x++){const b=s[2*x],T=s[2*x+1];b>=t&&b<=r&&T>=i&&T<=o&&c.push(n[x])}continue}const g=f+p>>1,_=s[2*g],y=s[2*g+1];_>=t&&_<=r&&y>=i&&y<=o&&c.push(n[g]),(u===0?t<=_:i<=y)&&(l.push(f),l.push(g-1),l.push(1-u)),(u===0?r>=_:o>=y)&&(l.push(g+1),l.push(p),l.push(1-u))}return c}within(t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:n,nodeSize:s}=this,a=[0,o.length-1,0],l=[],c=r*r;for(;a.length;){const u=a.pop()||0,p=a.pop()||0,f=a.pop()||0;if(p-f<=s){for(let x=f;x<=p;x++)Mw(n[2*x],n[2*x+1],t,i)<=c&&l.push(o[x]);continue}const g=f+p>>1,_=n[2*g],y=n[2*g+1];Mw(_,y,t,i)<=c&&l.push(o[g]),(u===0?t-r<=_:i-r<=y)&&(a.push(f),a.push(g-1),a.push(1-u)),(u===0?t+r>=_:i+r>=y)&&(a.push(g+1),a.push(p),a.push(1-u))}return l}}function xg(e,t,i,r,o,n){if(o-r<=i)return;const s=r+o>>1;Sw(e,t,s,r,o,n),xg(e,t,i,r,s-1,1-n),xg(e,t,i,s+1,o,1-n)}function Sw(e,t,i,r,o,n){for(;o>r;){if(o-r>600){const c=o-r+1,u=i-r+1,p=Math.log(c),f=.5*Math.exp(2*p/3),g=.5*Math.sqrt(p*f*(c-f)/c)*(u-c/2<0?-1:1);Sw(e,t,i,Math.max(r,Math.floor(i-u*f/c+g)),Math.min(o,Math.floor(i+(c-u)*f/c+g)),n)}const s=t[2*i+n];let a=r,l=o;for(vc(e,t,r,i),t[2*o+n]>s&&vc(e,t,r,o);a<l;){for(vc(e,t,a,l),a++,l--;t[2*a+n]<s;)a++;for(;t[2*l+n]>s;)l--}t[2*r+n]===s?vc(e,t,r,l):(l++,vc(e,t,l,o)),l<=i&&(r=l+1),i<=l&&(o=l-1)}}function vc(e,t,i,r){vg(e,i,r),vg(t,2*i,2*r),vg(t,2*i+1,2*r+1)}function vg(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Mw(e,t,i,r){const o=e-i,n=t-r;return o*o+n*n}const bg=512/at/2;class hk{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this.index=new Hh(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const o=t.canonical.x*at,n=t.canonical.y*at;for(let s=0;s<i.length;s++){const{key:a,crossTileID:l,tileAnchorX:c,tileAnchorY:u}=i.get(s),p=Math.floor((o+c)*bg),f=Math.floor((n+u)*bg);this.index.add(p,f),this.keys.push(a),this.crossTileIDs.push(l)}this.index.finish()}findMatches(t,i,r){const o=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),n=bg/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*at,a=i.canonical.y*at;for(let l=0;l<t.length;l++){const c=t.get(l);if(c.crossTileID)continue;const{key:u,tileAnchorX:p,tileAnchorY:f}=c,g=Math.floor((s+p)*n),_=Math.floor((a+f)*n),y=this.index.range(g-o,_-o,g+o,_+o);for(const x of y){const b=this.crossTileIDs[x];if(this.keys[x]===u&&!r.has(b)){r.add(b),c.crossTileID=b;break}}}}}class dk{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pk{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const i=Math.round((t-this.lng)/360);if(i!==0)for(const r in this.indexes){const o=this.indexes[r],n={};for(const s in o){const a=o[s];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+i),n[a.tileID.key]=a}this.indexes[r]=n}this.lng=t}addBucket(t,i,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let n=0;n<i.symbolInstances.length;n++)i.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const o=this.usedCrossTileIDs[t.overscaledZ];for(const n in this.indexes){const s=this.indexes[n];if(Number(n)>t.overscaledZ)for(const a in s){const l=s[a];l.tileID.isChildOf(t)&&l.findMatches(i.symbolInstances,t,o)}else{const a=s[t.scaledTo(Number(n)).key];a&&a.findMatches(i.symbolInstances,t,o)}}for(let n=0;n<i.symbolInstances.length;n++){const s=i.symbolInstances.get(n);s.crossTileID||(s.crossTileID=r.generate(),o.add(s.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new hk(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(const r of i.crossTileIDs)this.usedCrossTileIDs[t].delete(r)}removeStaleBuckets(t){let i=!1;for(const r in this.indexes){const o=this.indexes[r];for(const n in o)t[o[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,o[n]),delete o[n],i=!0)}return i}}class fk{constructor(){this.layerIndexes={},this.crossTileIDs=new dk,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,r,o){let n=this.layerIndexes[t.fqid];n===void 0&&(n=this.layerIndexes[t.fqid]=new pk);let s=!1;const a={};o.name!=="globe"&&n.handleWrapJump(r);for(const l of i){const c=l.getBucket(t);c&&t.fqid===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(l.tileID,c,this.crossTileIDs)&&(s=!0),a[c.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(s=!0),s}pruneUnusedLayers(t){const i={};t.forEach(r=>{i[r]=!0});for(const r in this.layerIndexes)i[r]||delete this.layerIndexes[r]}}var Aw=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Cw="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Iw=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,kw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Dw=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,zw=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Pw=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Rw=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lw=[];Yh(Aw,Lw);const Wh={"_prelude_fog.vertex.glsl":kw,"_prelude_terrain.vertex.glsl":Iw,"_prelude_shadow.vertex.glsl":Pw,"_prelude_fog.fragment.glsl":Dw,"_prelude_shadow.fragment.glsl":Rw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":zw},Xh={};Xe("",Iw),Xe(Dw,kw),Xe(Rw,Pw),Xe(zw,"");const Ow=Xe(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),Bw=Aw;var Fw={background:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xe("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xe(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xe("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xe("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:Xe(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Xe(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Xe(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Xe(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Xe(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Xe(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Xe(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xe("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Xe(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cw),skyboxGradient:Xe(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Cw),skyboxCapture:Xe(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xe(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Xe(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Xe(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Xe(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Yh(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let r of i)if(r=r.trim(),r[0]==="#"&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const o=r.split(" ");for(const n of o)t.includes(n)||t.push(n)}}function Xe(e,t){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let o=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);o&&(o=o.map(c=>{const u=c.split(" ");return u[u.length-1]}),o=[...new Set(o)]);const n={},s=[],a=[];e=e.replace(i,(c,u)=>(a.push(u),"")),t=t.replace(i,(c,u)=>(s.push(u),""));let l=[...Lw];Yh(e,l),Yh(t,l);for(const c of[...s,...a])Wh[c]||console.error(`Undefined include: ${c}`),Xh[c]||(Xh[c]=[],Yh(Wh[c],Xh[c])),l=[...l,...Xh[c]];return{fragmentSource:e=e.replace(r,(c,u,p,f,g)=>(n[g]=!0,u==="define"?`
#ifndef HAS_UNIFORM_u_${g}
in ${p} ${f} ${g};
#else
uniform ${p} ${f} u_${g};
#endif
`:u==="initialize"?`
#ifdef HAS_UNIFORM_u_${g}
    ${p} ${f} ${g} = u_${g};
#endif
`:u==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${g}
    in ${p} ${f} ${g};
#endif
`:u==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(r,(c,u,p,f,g)=>{const _=f==="float"?"vec2":f,y=g.match(/color/)?"color":_;return u==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${g}
in ${p} ${f} a_${g};
#endif
`:n[g]?u==="define"?`
#ifndef HAS_UNIFORM_u_${g}
uniform lowp float u_${g}_t;
in ${p} ${_} a_${g};
out ${p} ${f} ${g};
#else
uniform ${p} ${f} u_${g};
#endif
`:u==="initialize"?y==="vec4"?`
#ifndef HAS_UNIFORM_u_${g}
    ${g} = a_${g};
#else
    ${p} ${f} ${g} = u_${g};
#endif
`:`
#ifndef HAS_UNIFORM_u_${g}
    ${g} = unpack_mix_${y}(a_${g}, u_${g}_t);
#else
    ${p} ${f} ${g} = u_${g};
#endif
`:u==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${g}
    in ${p} ${f} a_${g};
    out ${p} ${f} ${g};
#endif
`:u==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${g}
    ${g} = a_${g};
#endif
`:void 0:u==="define"?`
#ifndef HAS_UNIFORM_u_${g}
uniform lowp float u_${g}_t;
in ${p} ${_} a_${g};
#else
uniform ${p} ${f} u_${g};
#endif
`:u==="define-instanced"?y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${g}0;
in vec4 a_${g}1;
in vec4 a_${g}2;
in vec4 a_${g}3;
#else
uniform ${p} ${f} u_${g};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${p} ${_} a_${g};
#else
uniform ${p} ${f} u_${g};
#endif
`:u==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${g}
    ${p} ${f} ${g} = a_${g};
#endif
`:y==="vec4"?`
#ifndef HAS_UNIFORM_u_${g}
    ${p} ${f} ${g} = a_${g};
#else
    ${p} ${f} ${g} = u_${g};
#endif
`:`
#ifndef HAS_UNIFORM_u_${g}
    ${p} ${f} ${g} = unpack_mix_${y}(a_${g}, u_${g}_t);
#else
    ${p} ${f} ${g} = u_${g};
#endif
`}),staticAttributes:o,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class mk{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,r,o,n,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==o.length;for(let p=0;!c&&p<o.length;p++)this.boundPaintVertexBuffers[p]!==o[p]&&(c=!0);let u=this.boundDynamicVertexBuffers.length!==a.length;for(let p=0;!u&&p<a.length;p++)this.boundDynamicVertexBuffers[p]!==a[p]&&(u=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==r||c||u||this.boundIndexBuffer!==n||this.boundVertexOffset!==s)this.freshBind(i,r,o,n,s,a,l);else{t.bindVertexArrayOES.set(this.vao);for(const p of a)p&&(p.bind(),l&&p.instanceCount&&p.setVertexAttribDivisor(t.gl,i,l));n&&n.dynamicDraw&&n.bind()}}freshBind(t,i,r,o,n,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.gl.createVertexArray(),c.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=o,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=s,i.enableAttributes(u,t),i.bind(),i.setVertexAttribPointers(u,t,n);for(const p of r)p.enableAttributes(u,t),p.bind(),p.setVertexAttribPointers(u,t,n);for(const p of s)p&&(p.enableAttributes(u,t),p.bind(),p.setVertexAttribPointers(u,t,n),a&&p.instanceCount&&p.setVertexAttribDivisor(u,t,a));o&&o.bind(),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function gk(e,t){const i=Math.pow(2,t.canonical.z),r=t.canonical.y;return[new De(0,r/i).toLngLat().lat,new De(0,(r+1)/i).toLngLat().lat]}function _k(e,t,i,r,o,n,s){const a=e.context,l=a.gl,c=i.hillshadeFBO;if(!c)return;e.prepareDrawTile();const u=e.isTileAffectedByFog(t),p=e.getOrCreateProgram("hillshade",{overrideFog:u});a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());const f=((x,b,T,S)=>{const M=T.paint.get("hillshade-shadow-color"),E=T.paint.get("hillshade-highlight-color"),A=T.paint.get("hillshade-accent-color"),I=T.paint.get("hillshade-emissive-strength");let z=Ft(T.paint.get("hillshade-illumination-direction"));if(T.paint.get("hillshade-illumination-anchor")==="viewport")z-=x.transform.angle;else if(x.style&&x.style.enable3dLights()&&x.style.directionalLight){const R=x.style.directionalLight.properties.get("direction");z=Ft(Zt(R.x,R.y,R.z)[1])}const P=!x.options.moving;return{u_matrix:S||x.transform.calculateProjMatrix(b.tileID.toUnwrapped(),P),u_image:0,u_latrange:gk(0,b.tileID),u_light:[T.paint.get("hillshade-exaggeration"),z],u_shadow:M,u_highlight:E,u_emissive_strength:I,u_accent:A}})(e,i,r,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(a,p,t.toUnwrapped());const{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:y}=e.getTileBoundsBuffers(i);p.draw(e,l.TRIANGLES,o,n,s,we.disabled,f,r.id,g,_,y)}function Nw(e,t,i){if(!t.needsDEMTextureUpload)return;const r=e.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(i.stride);const n=i.getPixels();t.demTexture?t.demTexture.update(n,{premultiply:!1}):t.demTexture=new Mi(r,n,o.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function yk(e,t,i){const r=e.context,o=r.gl;if(!t.dem)return;const n=t.dem;if(r.activeTexture.set(o.TEXTURE1),Nw(e,t,n),!t.demTexture)return;t.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const s=n.dim;r.activeTexture.set(o.TEXTURE0);let a=t.hillshadeFBO;if(!a){const f=new Mi(r,{width:s,height:s,data:null},o.RGBA);f.bind(o.LINEAR,o.CLAMP_TO_EDGE),a=t.hillshadeFBO=r.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(f.texture)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,s,s]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=e.getMercatorTileBoundsBuffers(),p=[];e.linearFloatFilteringSupported()&&p.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:p}).draw(e,o.TRIANGLES,ee.disabled,ve.disabled,Ve.unblended,we.disabled,((f,g)=>{const _=g.stride,y=Q.create();return Q.ortho(y,0,at,-at,0,0,1),Q.translate(y,y,[0,-at,0]),{u_matrix:y,u_image:1,u_dimension:[_,_],u_zoom:f.overscaledZ}})(t.tileID,n),i.id,l,c,u),t.needsHillshadePrepare=!1}const Vw=e=>({u_matrix:new he(e),u_image0:new Ee(e),u_skirt_height:new yt(e),u_ground_shadow_factor:new fe(e)}),jw=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Uw=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:o,u_merc_center:n,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:p,u_viewport:f,u_grid_matrix:_?Float32Array.from(_):new Float32Array(9),u_skirt_height:g}),tl=(e,t)=>{if(t>0&&e.terrain&&Y("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const i=e.transform,r=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),o=i.isLODDisabled(!1)?oo(60,45,i.pitch):oo(30,15,i.pitch),n=i._farZ-i._nearZ,s=t*i.height,a=((1-(l=o))*(.75*i.cameraToCenterDistance)+l*(i._farZ+s))*r;var l;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(a-i._nearZ)/n,(a-s-i._nearZ)/n]}}};function Gw(e,t){return e!=null&&t!=null&&!(!e.hasData()||!t.hasData())&&e.demTexture!=null&&t.demTexture!=null&&e.tileID.key!==t.tileID.key}const el=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,o){if(e in this.operations){const n=this.operations[e];n.to.tileID.key!==i.tileID.key&&(n.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:o,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},qw={0:null,1:"TERRAIN_VERTEX_MORPHING"};function $w(e,t,i){if(t===0)return 0;const r=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function xk(e,t){const i=1<<e.z;return!t&&(e.x===0||e.x===i-1)||e.y===0||e.y===i-1}const wg=e=>({u_matrix:e});function Zw(e,t,i,r,o){if(o>0){const n=ce.now(),s=(n-e.timeAdded)/o,a=t?(n-t.timeAdded)/o:-1,l=i.getSource(),c=r.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),u=!t||Math.abs(t.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),p=u&&e.refreshedUponExpiration?1:Ut(u?s:1-a,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}class vk extends No{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new $s(yc(),null),o=fg("mock-dem",i,r,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class bk extends No{constructor(t){const i=fg("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new $s(yc(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,r){if(t.freezeTileCoverage)return;this.transform=t;const o=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((n,s)=>{if(n[s.key]="",!this._tiles[s.key]){const a=new ac(s,this._source.tileSize*s.overscaleFactor(),t.tileZoom);a.state="loaded",this._tiles[s.key]=a}return n},{});for(const n in this._tiles)n in o||(this.freeFBO(n),this._tiles[n].unloadVectorData(),delete this._tiles[n])}freeFBO(t){const i=this.proxyCachedFBO[t];if(i!==void 0){const r=Object.values(i);this.renderCachePool.push(...r),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Hw extends Ue{constructor(t,i,r){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=r}}class wk extends tA{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,o,n]=function(l){const c=new Zr,u=new Zi,p=131;c.reserve(17161),u.reserve(33800);const f=at/128,g=at+f/2,_=g+f;for(let x=-f;x<_;x+=f)for(let b=-f;b<_;b+=f){const T=b<0||b>g||x<0||x>g?24575:0,S=Ut(Math.round(b),0,at),M=Ut(Math.round(x),0,at);c.emplaceBack(S+T,M)}const y=(x,b)=>{const T=b*p+x;u.emplaceBack(T+1,T,T+p),u.emplaceBack(T+p,T+p+1,T+1)};for(let x=1;x<129;x++)for(let b=1;b<129;b++)y(b,x);return[0,129].forEach(x=>{for(let b=0;b<130;b++)y(b,x),y(x,b)}),[c,u,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(r,Jn.members),this.gridIndexBuffer=s.createIndexBuffer(o),this.gridSegments=ti.simpleSegment(0,0,r.length,o.length),this.gridNoSkirtSegments=ti.simpleSegment(0,0,r.length,n),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bk(i.map),this.orthoMatrix=Q.create(),Q.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,at,0,at,0,1);const a=s.gl;this._overlapStencilMode=new ve({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vk(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const o=t.terrain.properties,n=t.terrain.drapeRenderMode===0,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ce.now();const a=t.terrain&&t.terrain.scope,l=o.get("source"),c=n?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void Y(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=s?this.calculateExaggeration(i):o.get("exaggeration"),!i.projection.requiresDraping&&s&&this._exaggeration===0)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&Y(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const p=this.getScaledDemTileSize();this.sourceCache.update(i,p,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){const i=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const o=i!=null?r-i:Number.MAX_VALUE;if(Math.abs(o)<2)return this._exaggeration;const n=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(n);let a=n-this._previousZoom;const l=this._previousUpdateTimestamp;let c=n;this._evaluationZoom!=null&&(c=this._evaluationZoom,Math.abs(n-c)>.5&&(a=.5*(n-c+a)),a*o<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),p=u===s.getExaggeration(Math.max(0,c-.1));if(p&&Math.abs(u-this._exaggeration)<.01)return u;let f=Math.min(.1,.00375*(this._updateTimestamp-l));return(p||u<.1||Math.abs(a)<1e-4)&&(f=Math.min(.2,4*f)),ne(this._exaggeration,u,f)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=r._centerAltitude===0&&this.getAtPointOrZero(De.fromLngLat(r.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const o=this.proxyCoords=i.getIds().map(l=>{const c=i.getTileByID(l).tileID;return c.projMatrix=r.calculateProjMatrix(c.toUnwrapped()),c});(function(l,c){const u=c.transform.pointCoordinate(c.transform.getCameraPoint()),p=new B(u.x,u.y);l.sort((f,g)=>{if(g.overscaledZ-f.overscaledZ)return g.overscaledZ-f.overscaledZ;const _=new B(f.canonical.x+(1<<f.canonical.z)*f.wrap,f.canonical.y),y=new B(g.canonical.x+(1<<g.canonical.z)*g.wrap,g.canonical.y),x=p.mult(1<<f.canonical.z);return x.x-=.5,x.y-=.5,x.distSqr(_)-x.distSqr(y)})})(o,this.painter);const n=this.proxyToSource||{};this.proxyToSource={},o.forEach(l=>{this.proxyToSource[l.key]={}}),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const l in s){const c=s[l];if(!c.used||(c!==this.sourceCache&&this.resetTileLookupCache(c.id),this._setupProxiedCoordsForOrtho(c,t[l],n),c.usedForTerrain))continue;const u=t[l];c.getSource().reparseOverscaled&&this._assignTerrainTiles(u)}this.proxiedCoords[i.id]=o.map(l=>new Hw(l,l.key,this.orthoMatrix)),this._assignTerrainTiles(o),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(n),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const l of this.proxyCoords){const c=this.terrainTileForTile[l.key];if(!c)continue;const u=c.tileID.key;u in a||(this._visibleDemTiles.push(c),a[u]=u)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;const r=this._findTileCoveringTileID(i,this.sourceCache);r&&(this.terrainTileForTile[i.key]=r)})}_prepareDEMTextures(){const t=this.painter.context,i=t.gl;for(const r in this.terrainTileForTile){const o=this.terrainTileForTile[r],n=o.dem;!n||o.demTexture&&!o.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),Nw(this.painter,o,n))}}_prepareDemTileUniforms(t,i,r,o){if(!i||i.demTexture==null)return!1;const n=t.tileID.canonical,s=Math.pow(2,i.tileID.canonical.z-n.z),a=o||"";return r[`u_dem_tl${a}`]=[n.x*s%1,n.y*s%1],r[`u_dem_scale${a}`]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const r=new Ui({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Mi(t,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const i=this._visibleDemTiles.reduce((r,o)=>{if(!o.dem)return r;const n=o.dem.tree.minimums[0];return n>0&&t++,r+n},0);return t?i/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[o,n]=(()=>{const a=new Fx({width:1,height:1},new Float32Array([r]));return[i.R32F,a]})();this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(n,{premultiply:!1}):s=this._emptyDEMTexture=new Mi(t,n,o,{premultiply:!1}),s}setupElevationDraw(t,i,r){const o=this.painter.context,n=o.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const f=r.morphing.srcDemTile,g=r.morphing.dstDemTile;c=r.morphing.phase,f&&g&&(this._prepareDemTileUniforms(t,f,s,"_prev")&&(l=f),this._prepareDemTileUniforms(t,g,s)&&(a=g))}const u=f=>f&&f.demTexture&&this.painter.linearFloatFilteringSupported()?n.LINEAR:n.NEAREST,p=f=>{s.u_dem_size=f.size[0]===1?1:f.size[0]-2};if(l&&a)o.activeTexture.set(n.TEXTURE2),a.demTexture.bind(u(a),n.CLAMP_TO_EDGE),o.activeTexture.set(n.TEXTURE4),l.demTexture.bind(u(l),n.CLAMP_TO_EDGE),a.demTexture&&p(a.demTexture),s.u_dem_lerp=c;else{a=this.terrainTileForTile[t.tileID.key],o.activeTexture.set(n.TEXTURE2);const f=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture;f.bind(u(a),n.CLAMP_TO_EDGE),p(f)}if(o.activeTexture.set(n.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&a){const f=(1<<a.tileID.canonical.z)*ni(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=f}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(o,s),this.painter.transform.projection.name==="globe"){const f=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(o,f)}}globeUniformValues(t,i,r){const o=t.projection;return{u_tile_tl_up:o.upVector(i,0,0),u_tile_tr_up:o.upVector(i,at,0),u_tile_br_up:o.upVector(i,at,at),u_tile_bl_up:o.upVector(i,0,at),u_tile_up_scale:r?Gu(1):o.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;t.length!==0&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(o,n,s,a,l){if(o.transform.projection.name==="globe")(function(c,u,p,f,g){const _=c.context,y=_.gl;let x,b;const T=c.transform,S=gx(c,_,T),M=(U,O)=>{if(b===O)return;const Z=[qw[O],"PROJECTION_GLOBE_VIEW"];S&&Z.push("CUSTOM_ANTIALIASING");const W=c.isTileAffectedByFog(U);x=c.getOrCreateProgram("globeRaster",{defines:Z,overrideFog:W}),b=O},E=c.colorModeForRenderPass(),A=new ee(y.LEQUAL,ee.ReadWrite,c.depthRangeFor3D);el.update(g);const I=fx(T),z=[Ji(T.center.lng),Qi(T.center.lat)],P=c.globeSharedBuffers,R=[T.width*ce.devicePixelRatio,T.height*ce.devicePixelRatio],F=Float32Array.from(T.globeMatrix),N={useDenormalizedUpVectorScale:!0};{const U=c.transform,O=$w(U.zoom,u.exaggeration(),u.sourceCache._source.tileSize);b=-1;const Z=y.TRIANGLES;for(const W of f){const K=p.getTile(W),$=ve.disabled,H=u.prevTerrainTileForTile[W.key],it=u.terrainTileForTile[W.key];Gw(H,it)&&el.newMorphing(W.key,H,it,g,250),_.activeTexture.set(y.TEXTURE0),K.texture&&K.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE);const ot=el.getMorphValuesForProxy(W.key),rt=ot?1:0;ot&&pn(N,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:ri(ot.phase)}});const lt=qu(W.canonical),ut=US(lt.getCenter().lat),pt=_x(W.canonical,lt,ut,U.worldSize/U._pixelsPerMercatorPixel),nt=Qn(lo(W.canonical)),mt=Uw(U.expandedFarZProjMatrix,F,I,nt,ar(U.zoom),z,U.frustumCorners.TL,U.frustumCorners.TR,U.frustumCorners.BR,U.frustumCorners.BL,U.globeCenterInViewSpace,U.globeRadius,R,O,pt);if(M(W,rt),x&&(u.setupElevationDraw(K,x,N),c.uploadCommonUniforms(_,x,W.toUnwrapped()),P)){const[It,kt,Rt]=P.getGridBuffers(ut,O!==0);x.draw(c,Z,A,$,E,we.backCCW,mt,"globe_raster",It,kt,Rt)}}}if(P&&(c.renderDefaultNorthPole||c.renderDefaultSouthPole)){const U=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];S&&U.push("CUSTOM_ANTIALIASING"),x=c.getOrCreateProgram("globeRaster",{defines:U});for(const O of f){const{x:Z,y:W,z:K}=O.canonical,$=W===0,H=W===(1<<K)-1,[it,ot,rt,lt]=P.getPoleBuffers(K,!1);if(lt&&($||H)){const ut=p.getTile(O);_.activeTexture.set(y.TEXTURE0),ut.texture&&ut.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE);let pt=mx(K,Z,T);const nt=Qn(lo(O.canonical)),mt=(It,kt)=>It.draw(c,y.TRIANGLES,A,ve.disabled,E,we.disabled,Uw(T.expandedFarZProjMatrix,pt,pt,nt,0,z,T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.globeCenterInViewSpace,T.globeRadius,R,0),"globe_pole_raster",kt,rt,lt);u.setupElevationDraw(ut,x,N),c.uploadCommonUniforms(_,x,O.toUnwrapped()),$&&c.renderDefaultNorthPole&&mt(x,it),H&&c.renderDefaultSouthPole&&(pt=Q.scale(Q.create(),pt,[1,-1,1]),mt(x,ot))}}}})(o,n,s,a,l);else{const c=o.context,u=c.gl;let p,f;const g=o.shadowRenderer,_=tl(o,o.longestCutoffRange),y=E=>{if(f===E)return;const A=[];A.push(qw[E]),_.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),p=o.getOrCreateProgram("terrainRaster",{defines:A}),f=E},x=o.colorModeForRenderPass(),b=new ee(u.LEQUAL,ee.ReadWrite,o.depthRangeFor3D);el.update(l);const T=o.transform,S=$w(T.zoom,n.exaggeration(),n.sourceCache._source.tileSize);let M=[0,0,0];if(g){const E=o.style.directionalLight,A=o.style.ambientLight;E&&A&&(M=Ag(E,A))}{f=-1;const E=u.TRIANGLES,[A,I]=[n.gridIndexBuffer,n.gridSegments];for(const z of a){const P=s.getTile(z),R=ve.disabled,F=n.prevTerrainTileForTile[z.key],N=n.terrainTileForTile[z.key];Gw(F,N)&&el.newMorphing(z.key,F,N,l,250),c.activeTexture.set(u.TEXTURE0),P.texture&&P.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const U=el.getMorphValuesForProxy(z.key),O=U?1:0;let Z;U&&(Z={morphing:{srcDemTile:U.from,dstDemTile:U.to,phase:ri(U.phase)}});const W=jw(z.projMatrix,xk(z.canonical,T.renderWorldCopies)?S/10:S,M);if(y(O),!p)continue;n.setupElevationDraw(P,p,Z);const K=z.toUnwrapped();g&&g.setupShadows(K,p),o.uploadCommonUniforms(c,p,K,null,_),p.draw(o,E,b,R,x,we.backCCW,W,"terrain_raster",n.gridBuffer,A,I)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,o=this.proxySourceCache,n=this.proxiedCoords[o.id],s=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const u of n){const p=o.getTileByID(u.proxyTileKey),f=o.proxyCachedFBO[u.key]?o.proxyCachedFBO[u.key][t]:void 0,g=f!==void 0?o.renderCache[f]:this.pool[c++],_=f!==void 0;if(p.texture=g.tex,_&&!g.dirty){l.push(p.tileID);continue}let y;r.bindFramebuffer.set(g.fb.framebuffer),this.renderedToTile=!1,g.dirty&&(r.clear({color:xe.transparent,stencil:0}),g.dirty=!1);for(let x=s.start;x<=s.end;++x){const b=i.style._mergedLayers[a[x]];if(b.isHidden(i.transform.zoom))continue;const T=i.style.getLayerSourceCache(b),S=T?this.proxyToSource[u.key][T.id]:[u];if(!S)continue;const M=S;r.viewport.set([0,0,g.fb.width,g.fb.height]),y!==(T?T.id:null)&&(this._setupStencil(g,S,b,T),y=T?T.id:null),i.renderLayer(i,T,b,M)}if(this._drapedRenderBatches.length===0)for(const x of this._pendingGroundEffectLayers){const b=i.style._mergedLayers[a[x]];if(b.isHidden(i.transform.zoom))continue;const T=i.style.getLayerSourceCache(b),S=T?this.proxyToSource[u.key][T.id]:[u];if(!S)continue;const M=S;r.viewport.set([0,0,g.fb.width,g.fb.height]),y!==(T?T.id:null)&&(this._setupStencil(g,S,b,T),y=T?T.id:null),i.renderLayer(i,T,b,M)}this.renderedToTile?(g.dirty=!0,l.push(p.tileID)):_||--c,c===5&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){const i=t.order.length;let r=-1,o=i;for(let n=0;n<i;++n)this._style.isLayerDraped(t._mergedLayers[t.order[n]])?r=Math.max(r,n):o=Math.min(o,n);return o>r}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,r){if(!this._visibleDemTiles)return null;const o=this._visibleDemTiles.filter(n=>n.dem).map(n=>{const s=n.tileID,a=1<<s.overscaledZ,{x:l,y:c}=s.canonical,u=l/a,p=(l+1)/a,f=c/a,g=(c+1)/a;return{minx:u,miny:f,maxx:p,maxy:g,t:n.dem.tree.raycastRoot(u,f,p,g,t,i,r),tile:n}});o.sort((n,s)=>(n.t!==null?n.t:Number.MAX_VALUE)-(s.t!==null?s.t:Number.MAX_VALUE));for(const n of o){if(n.t==null)return null;const s=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,t,i,r);if(s!=null)return s}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const o=new Mi(t,{width:r[0],height:r[1],data:null},i.RGBA);o.bind(i.LINEAR,i.CLAMP_TO_EDGE);const n=t.createFramebuffer(r[0],r[1],!0,null);return n.colorAttachment.set(o.texture),n.depthAttachment=new IC(t,n.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,n.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):n.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:n,tex:o,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const i=this._style._mergedLayers[t],r=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!r&&i.shouldRedrape():!r&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const r of this._style.getSources())if(r instanceof ow){t=!0;break}if(!t)return;const i={};for(let r=0;r<this._style.order.length;++r){const o=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(o);if(n&&!i[n.id]&&!o.isHidden(this.painter.transform.zoom)&&o.type==="line"&&o.widthExpression()instanceof Gn){i[n.id]=!0;for(const s of this.proxyCoords){const a=this.proxyToSource[s.key][n.id];if(a)for(const l of a)this._clearRenderCacheForTile(n.id,l)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof rg){t=!0;break}if(!t)return;const i={};for(let r=0;r<this._style.order.length;++r){const o=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(o);if(!n||i[n.id]||o.isHidden(this.painter.transform.zoom)||o.type!=="raster")continue;const s=o.paint.get("raster-fade-duration");for(const a of this.proxyCoords){const l=this.proxyToSource[a.key][n.id];if(l)for(const c of l){const u=Zw(n.getTile(c),n.findLoadedParent(c,0),n,this.painter.transform,s);(u.opacity!==1||u.mix!==0)&&this._clearRenderCacheForTile(n.id,c)}}}}_setupDrapedRenderBatches(){const t=this._style.order,i=t.length;if(i===0)return;const r=[];this._pendingGroundEffectLayers=[];let o,n=0,s=this._style._mergedLayers[t[n]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++n<i;)s=this._style._mergedLayers[t[n]];for(;n<i;++n){const a=this._style._mergedLayers[t[n]];a.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(a)?o===void 0&&(o=n):(a.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(n),o!==void 0&&(r.push({start:o,end:n-1}),o=void 0)))}if(o!==void 0&&r.push({start:o,end:n-1}),r.length!==0){const a=r[r.length-1];this._pendingGroundEffectLayers.every(l=>l>a.end)||Y("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(t){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const s=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let a=0;a<s.length;++a){const l=Object.values(s[a]);i.renderCachePool.push(...l)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,o=this._tilesDirty;for(let s=r.length-1;s>=0;s--){const a=r[s];if(i.getTileByID(a.key),i.proxyCachedFBO[a.key]!==void 0){const l=t[a.key],c=this.proxyToSource[a.key];let u=0;for(const p in c){const f=c[p],g=l[p];if(!g||g.length!==f.length||f.some((_,y)=>_!==g[y]||o[p]&&o[p].hasOwnProperty(_.key))){u=-1;break}++u}for(const p in i.proxyCachedFBO[a.key])i.renderCache[i.proxyCachedFBO[a.key][p]].dirty=u<0||u!==Object.values(l).length}}const n=[...this._drapedRenderBatches];n.sort((s,a)=>a.end-a.start-(s.end-s.start));for(const s of n)for(const a of r){if(i.proxyCachedFBO[a.key])continue;let l=i.renderCachePool.pop();l===void 0&&i.renderCache.length<50&&(l=i.renderCache.length,i.renderCache.push(this._createFBO())),l!==void 0&&(i.proxyCachedFBO[a.key]={},i.proxyCachedFBO[a.key][s.start]=l,i.renderCache[l].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,r,o){if(!o||!this._sourceTilesOverlap[o.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,s=n.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let a;if(r.isTileClipped())a=i.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ve.disabled}_renderTileClippingMasks(t,i){const r=this.painter,o=this.painter.context,n=o.gl;r._tileClippingMaskIDs={},o.setColorMode(Ve.disabled),o.setDepthMode(ee.disabled);const s=r.getOrCreateProgram("clippingMask");for(const a of t){const l=r._tileClippingMaskIDs[a.key]=--i;s.draw(r,n.TRIANGLES,ee.disabled,new ve({func:n.ALWAYS,mask:0},l,255,n.KEEP,n.KEEP,n.REPLACE),Ve.disabled,we.disabled,wg(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];ei.transformMat4(r,r,i.pixelMatrixInverse),ei.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const o=i._camera.position,n=ni(1,i.center.lat),s=[o[0],o[1],o[2]/n,0],a=j.subtract([],r.slice(0,3),s);j.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return l!==null&&l?(j.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=n,s):null}drawDepth(){const t=this.painter,i=t.context,r=this.proxySourceCache,o=Math.ceil(t.width),n=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===o&&this._depthFBO.height===n||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const s=i.gl,a=i.createFramebuffer(o,n,!0,"renderbuffer");i.activeTexture.set(s.TEXTURE0);const l=new Mi(i,{width:o,height:n,data:null},s.RGBA);l.bind(s.NEAREST,s.CLAMP_TO_EDGE),a.colorAttachment.set(l.texture);const c=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,o,n);a.depthAttachment.set(c),this._depthFBO=a,this._depthTexture=l}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,o,n]),function(s,a,l,c){if(s.transform.projection.name==="globe")return;const u=s.context,p=u.gl;u.clear({depth:1});const f=s.getOrCreateProgram("terrainDepth"),g=new ee(p.LESS,ee.ReadWrite,s.depthRangeFor3D);for(const _ of c){const y=l.getTile(_),x=jw(_.projMatrix,0,[0,0,0]);a.setupElevationDraw(y,f),f.draw(s,p.TRIANGLES,g,ve.disabled,Ve.unblended,we.backCCW,x,"terrain_depth",a.gridBuffer,a.gridIndexBuffer,a.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,r){if(t.getSource()instanceof Ao)return this._setupProxiedCoordsForImageSource(t,i,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const o=this.proxiedCoords[t.id]=[],n=this.proxyCoords;for(let a=0;a<n.length;a++){const l=n[a],c=this._findTileCoveringTileID(l,t);if(c){const u=this._createProxiedId(l,c,r[l.key]&&r[l.key][t.id]);o.push(u),this.proxyToSource[l.key][t.id]=[u]}}let s=!1;for(let a=0;a<i.length;a++){const l=t.getTile(i[a]);if(!l||!l.hasData())continue;const c=this._findTileCoveringTileID(l.tileID,this.proxySourceCache);if(c&&c.tileID.canonical.z!==l.tileID.canonical.z){const u=this.proxyToSource[c.tileID.key][t.id],p=this._createProxiedId(c.tileID,l,r[c.tileID.key]&&r[c.tileID.key][t.id]);u?u.splice(u.length-1,0,p):this.proxyToSource[c.tileID.key][t.id]=[p],o.push(p),s=!0}}this._sourceTilesOverlap[t.id]=s}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const o=this.proxiedCoords[t.id]=[],n=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const l=new B(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(De.fromLngLat).reduce((p,f)=>(p.min.x=Math.min(p.min.x,f.x-l.x),p.min.y=Math.min(p.min.y,f.y-l.y),p.max.x=Math.max(p.max.x,f.x-l.x),p.max.y=Math.max(p.max.y,f.y-l.y),p),{min:new B(Number.MAX_VALUE,Number.MAX_VALUE),max:new B(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(p,f)=>{const g=p.wrap+p.canonical.x/(1<<p.canonical.z),_=p.canonical.y/(1<<p.canonical.z),y=at/(1<<p.canonical.z),x=f.wrap+f.canonical.x/(1<<f.canonical.z),b=f.canonical.y/(1<<f.canonical.z);return g+y<x+c.min.x||g>x+c.max.x||_+y<b+c.min.y||_>b+c.max.y};for(let p=0;p<n.length;p++){const f=n[p];for(let g=0;g<i.length;g++){const _=t.getTile(i[g]);if(!_||!_.hasData()||u(f,_.tileID))continue;const y=this._createProxiedId(f,_,r[f.key]&&r[f.key][t.id]),x=this.proxyToSource[f.key][t.id];x?x.push(y):this.proxyToSource[f.key][t.id]=[y],o.push(y)}}}_createProxiedId(t,i,r){let o=this.orthoMatrix;if(r){const n=r.find(s=>s.key===i.tileID.key);if(n)return n}if(i.tileID.key!==t.key){const n=t.canonical.z-i.tileID.canonical.z;let s,a,l;o=Q.create();const c=i.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(s=at>>n,a=s*((i.tileID.canonical.x<<n)-t.canonical.x+c),l=s*((i.tileID.canonical.y<<n)-t.canonical.y)):(s=at<<-n,a=at*(i.tileID.canonical.x-(t.canonical.x+c<<-n)),l=at*(i.tileID.canonical.y-(t.canonical.y<<-n))),Q.ortho(o,0,s,0,s,0,1),Q.translate(o,o,[a,l,0])}return new Hw(i.tileID,t.key,o)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const o=this._findCoveringTileCache[i.id],n=o[t.key];if(r=n?i.getTileByID(n):null,r&&r.hasData()||n===null)return r;let s=r?r.tileID:t,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!n){const p=i.getSource().maxzoom;if(t.canonical.z>=p){const f=t.canonical.z-p;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),s=new Ue(a,t.wrap,p,t.canonical.x>>f,t.canonical.y>>f)):f!==0&&(a=p,s=new Ue(a,t.wrap,p,t.canonical.x>>f,t.canonical.y>>f))}s.key!==t.key&&(c.push(s.key),r=i.getTile(s))}const u=p=>{c.forEach(f=>{o[f]=p}),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const p=s.calculateScaledKey(a);if(r=i.getTileByID(p),r&&r.hasData())break;const f=o[p];if(f===null)break;f===void 0?c.push(p):r=i.getTileByID(f)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let r=this._tilesDirty[t];r||(r=this._tilesDirty[t]={}),r[i.key]=!0}}function Tk(e,t,i){const r=function(a,l,c){const u=j.dot(l,a),p=j.dot(c,[.2126,.7152,.0722]),f=(_,y,x)=>(1-x)*_+x*y,g=f(1-.3*Math.min(p,1),1,Math.min(u+1,1));return f(.92,1,Math.asin(Ut(l[2],-1,1))/Math.PI+.5)*g}(e,[0,0,1],t),o=[0,0,0];j.scale(o,i.slice(0,3),r);const n=[0,0,0];j.scale(n,t.slice(0,3),e[2]);const s=[0,0,0];return j.add(s,o,n),Ni(s)}const Ek=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Sk=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ww{static cacheKey(t,i,r,o){let n=`${i}${o?o.cacheKey:""}`;for(const s of r)t.usedDefines.includes(s)&&(n+=`/${s}`);return n}constructor(t,i,r,o,n,s){const a=t.gl;this.program=a.createProgram(),this.configuration=o,this.name=i,this.fixedDefines=[...s];const l=o?o.getBinderAttributes():[],c=(r.staticAttributes||[]).concat(l);let u=o?o.defines():[];u=u.concat(s.map(x=>`#define ${x}`));const p=`#version 300 es
`;let f=p+u.concat("precision mediump float;",Bw,Ow.fragmentSource).join(`
`);for(const x of r.fragmentIncludes)f+=`
${Wh[x]}`;f+=`
${r.fragmentSource}`;let g=p+u.concat("precision highp float;",Bw,Ow.vertexSource).join(`
`);for(const x of r.vertexIncludes)g+=`
${Wh[x]}`;g+=`
${r.vertexSource}`;const _=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,f),a.compileShader(_),a.attachShader(this.program,_);const y=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(y,g),a.compileShader(y),a.attachShader(this.program,y),this.attributes={},this.numAttributes=c.length;for(let x=0;x<this.numAttributes;x++)if(c[x]){const b=c[x].startsWith("a_")?c[x]:`a_${c[x]}`;a.bindAttribLocation(this.program,x,b),this.attributes[b]=x}a.linkProgram(this.program),a.deleteShader(y),a.deleteShader(_),this.fixedUniforms=n(t),this.binderUniforms=o?o.getUniforms(t):[],s.includes("TERRAIN")&&(this.terrainUniforms=(x=>({u_dem:new Ee(x),u_dem_prev:new Ee(x),u_dem_tl:new Se(x),u_dem_scale:new yt(x),u_dem_tl_prev:new Se(x),u_dem_scale_prev:new yt(x),u_dem_size:new yt(x),u_dem_lerp:new yt(x),u_exaggeration:new yt(x),u_depth:new Ee(x),u_depth_size_inv:new Se(x),u_meter_to_dem:new yt(x),u_label_plane_matrix_inv:new he(x)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(x=>({u_tile_tl_up:new fe(x),u_tile_tr_up:new fe(x),u_tile_br_up:new fe(x),u_tile_bl_up:new fe(x),u_tile_up_scale:new yt(x)}))(t)),s.includes("FOG")&&(this.fogUniforms=(x=>({u_fog_matrix:new he(x),u_fog_range:new Se(x),u_fog_color:new Hr(x),u_fog_horizon_blend:new yt(x),u_fog_vertical_limit:new Se(x),u_fog_temporal_offset:new yt(x),u_frustum_tl:new fe(x),u_frustum_tr:new fe(x),u_frustum_br:new fe(x),u_frustum_bl:new fe(x),u_globe_pos:new fe(x),u_globe_radius:new yt(x),u_globe_transition:new yt(x),u_is_globe:new Ee(x),u_viewport:new Se(x)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(x=>({u_cutoff_params:new Hr(x)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(x=>({u_lighting_ambient_color:new fe(x),u_lighting_directional_dir:new fe(x),u_lighting_directional_color:new fe(x),u_ground_radiance:new fe(x)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(x=>({u_light_matrix_0:new he(x),u_light_matrix_1:new he(x),u_fade_range:new Se(x),u_shadow_normal_offset:new fe(x),u_shadow_intensity:new yt(x),u_shadow_texel_size:new yt(x),u_shadow_map_resolution:new yt(x),u_shadow_direction:new fe(x),u_shadow_bias:new fe(x),u_shadowmap_0:new Ee(x),u_shadowmap_1:new Ee(x)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const o in i)r[o]&&r[o].set(this.program,o,i[o])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const o in i)r[o]&&r[o].set(this.program,o,i[o])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const o in i)r[o].set(this.program,o,i[o])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const o in i)r[o].set(this.program,o,i[o])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const o in i)r[o].set(this.program,o,i[o])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;t.program.set(this.program);for(const o in i)r[o].set(this.program,o,i[o])}_drawDebugWireframe(t,i,r,o,n,s,a,l,c,u){const p=t.options.wireframe;if(p.terrain===!1&&p.layers2D===!1&&p.layers3D===!1)return;const f=t.context;if(!(!(!p.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!p.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ek.includes(this.name))||!(!p.layers3D||!Sk.includes(this.name))))return;const g=f.gl,_=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,n,f);if(!_)return;const y=[...this.fixedDefines];y.push("DEBUG_WIREFRAME");const x=t.getOrCreateProgram(this.name,{config:this.configuration,defines:y});f.program.set(x.program);const b=(M,E,A)=>{if(E[M]&&A[M])for(const I in E[M])A[M][I]&&A[M][I].set(A.program,I,E[M][I].current)};c&&c.setUniforms(x.program,f,x.binderUniforms,a,{zoom:l}),b("fixedUniforms",this,x),b("terrainUniforms",this,x),b("globeUniforms",this,x),b("fogUniforms",this,x),b("lightsUniforms",this,x),b("shadowUniforms",this,x),_.bind(),f.setColorMode(new Ve([g.ONE,g.ONE_MINUS_SRC_ALPHA,g.ZERO,g.ONE],xe.transparent,[!0,!0,!0,!1])),f.setDepthMode(new ee(i.func===g.LESS?g.LEQUAL:i.func,ee.ReadOnly,i.range)),f.setStencilMode(ve.disabled);const T=3*s.primitiveLength*2,S=3*s.primitiveOffset*2*2;u&&u>1?g.drawElementsInstanced(g.LINES,T,g.UNSIGNED_SHORT,S,u):g.drawElements(g.LINES,T,g.UNSIGNED_SHORT,S),n.bind(),f.program.set(this.program),f.setDepthMode(i),f.setStencilMode(r),f.setColorMode(o)}draw(t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x){const b=t.context,T=b.gl;if(this.failedToCreate)return;b.program.set(this.program),b.setDepthMode(r),b.setStencilMode(o),b.setColorMode(n),b.setCullFace(s);for(const E of Object.keys(this.fixedUniforms))this.fixedUniforms[E].set(this.program,E,a[E]);_&&_.setUniforms(this.program,b,this.binderUniforms,f,{zoom:g});const S={[T.LINES]:2,[T.TRIANGLES]:3,[T.LINE_STRIP]:1}[i],M=x&&x>0?1:void 0;for(const E of p.get()){const A=E.vaos||(E.vaos={});(A[l]||(A[l]=new mk)).bind(b,this,c,_?_.getPaintVertexBuffers():[],u,E.vertexOffset,y||[],M),x&&x>1?T.drawElementsInstanced(i,E.primitiveLength*S,T.UNSIGNED_SHORT,E.primitiveOffset*S*2,x):T.drawElements(i,E.primitiveLength*S,T.UNSIGNED_SHORT,E.primitiveOffset*S*2),i===T.TRIANGLES&&this._drawDebugWireframe(t,r,o,n,u,E,f,g,_,x)}}}function Xw(e,t){const i=Math.pow(2,t.tileID.overscaledZ),r=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,o=r*(t.tileID.canonical.x+t.tileID.wrap*i),n=r*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/js(t,1,e.transform.tileZoom),u_pixel_coord_upper:[o>>16,n>>16],u_pixel_coord_lower:[65535&o,65535&n]}}const Mk=Q.create(),Yw=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y)=>{const x=t.style.light,b=x.properties.get("position"),T=[b.x,b.y,b.z],S=Lr.create();x.properties.get("anchor")==="viewport"&&(Lr.fromRotation(S,-t.transform.angle),j.transformMat3(T,T,S));const M=x.properties.get("color"),E=t.transform,A={u_matrix:e,u_lightpos:T,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+i,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mk,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:n,u_flood_light_color:p,u_vertical_scale:f,u_flood_light_intensity:g,u_ground_shadow_factor:_,u_emissive_strength:y};return E.projection.name==="globe"&&(A.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],A.u_zoom_transition=l,A.u_inv_rot_matrix=u,A.u_merc_center=c,A.u_up_dir=E.projection.upVector(new To(0,0,0),c[0]*at,c[1]*at),A.u_height_lift=a),A},Ak=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),Ck=(e,t,i,r,o,n,s,a,l,c,u,p,f,g)=>{const _=Yw(e,t,i,r,o,n,s,l,c,u,p,f,g,1,[0,0,0],0),y={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return Vt(_,Xw(t,a),y)},Jw=(e,t)=>({u_matrix:e,u_emissive_strength:t}),Kw=(e,t,i,r)=>Vt(Jw(e,t),Xw(i,r)),Ik=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),kk=(e,t,i,r,o)=>Vt(Kw(e,t,i,r),{u_world:o}),Dk=(e,t,i,r)=>{const o=at/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(r),u_extrude_scale:[t.pixelsToGLUnits[0]/o,t.pixelsToGLUnits[1]/o]}},Qw=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),zk=Q.create(),Pk=(e,t,i,r,o,n,s)=>{const a=e.transform,l=a.projection.name==="globe",c=l?dx(a.zoom,t.canonical)*a._pixelsPerMercatorPixel:js(i,1,n),u={u_matrix:t.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:zk,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=o,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=ar(a.zoom);const p=o[0]*at,f=o[1]*at;u.u_up_dir=a.projection.upVector(new To(0,0,0),p,f)}return u},t2=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T,S,M,E)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:o,u_tl_parent:n,u_scale_parent:u,u_fade_t:p.mix,u_opacity:p.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(I=f.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(A=f.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Rk(f.paint.get("raster-hue-rotate")),u_perspective_transform:g,u_raster_elevation:_,u_tl_br:s,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Lk(x,T),u_colorization_offset:Ok(b,T),u_color_ramp:y,u_texture_offset:[M/(S+2*M),S/(S+2*M)],u_texture_res:[S+2*M,S+2*M],u_emissive_strength:E};var A,I};function Rk(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}function Lk([e,t,i,r],[o,n]){if(o===n)return[0,0,0,0];const s=259/257/(n-o);return[e*s,t*s,i*s,r*s]}function Ok(e,[t,i]){return t===i?0:((e-t)/(i-t)*259-1)/257}const e2=Q.create(),i2=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b)=>{const T=o.transform,S={u_is_size_zoom_constant:+(e==="constant"||e==="source"),u_is_size_feature_constant:+(e==="constant"||e==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:T.getCameraToCenterDistance(y),u_rotate_symbol:+i,u_aspect_ratio:T.width/T.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:n,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:e2,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:e2,u_up_vector:[0,-1,0],u_icon_transition:b||0,u_icon_saturation:x};return y.name==="globe"&&(S.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],S.u_zoom_transition=p,S.u_inv_rot_matrix=g,S.u_merc_center=f,S.u_camera_forward=T._camera.forward(),S.u_ecef_origin=function(M,E){const A=[0,0,0],I=Qn(lo(E.canonical));return j.transformMat4(A,A,I),j.transformMat4(A,A,M),A}(T.globeMatrix,u.toUnwrapped()),S.u_tile_matrix=Float32Array.from(T.globeMatrix),S.u_up_vector=_),S},r2=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x)=>Vt(i2(e,t,i,r,o,n,s,a,l,c,p,f,g,_,y,x,1),{u_gamma_scale:r?o.transform.getCameraToCenterDistance(x)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:ce.devicePixelRatio,u_is_halo:+u,undefined:void 0}),Bk=(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y)=>Vt(r2(e,t,i,r,o,n,s,a,!0,l,!0,u,p,f,g,_,y),{u_texsize_icon:c,u_texture_icon:1}),Fk=(e,t,i,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:r}),Nk=(e,t,i,r,o,n,s)=>Vt(function(a,l,c,u){const p=c.imageManager.getPattern(a.toString(),l),{width:f,height:g}=c.imageManager.getPixelSize(l),_=Math.pow(2,u.tileID.overscaledZ),y=u.tileSize*Math.pow(2,c.transform.tileZoom)/_,x=y*(u.tileID.canonical.x+u.tileID.wrap*_),b=y*u.tileID.canonical.y;return{u_image:0,u_pattern_tl:p.tl,u_pattern_br:p.br,u_texsize:[f,g],u_pattern_size:p.displaySize,u_tile_units_to_pixels:1/js(u,1,c.transform.tileZoom),u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}(o,n,r,s),{u_matrix:e,u_emissive_strength:t,u_opacity:i}),Jr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Tg=(e,t,i,r,o,n,s,a,l,c,u,p,f=[0,0,0])=>{const g=r.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],x=Lr.create();g.properties.get("anchor")==="viewport"&&(Lr.fromRotation(x,-r.transform.angle),j.transformMat3(y,y,x));const b=c.alphaMode==="MASK",T=g.properties.get("color"),S=p.paint.get("model-ambient-occlusion-intensity"),M=p.paint.get("model-color").constantOr(xe.white),E=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:i,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_camera_pos:f,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+b,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[n.r,n.g,n.b,n.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:l,u_baseColorTexture:Jr.BaseColor,u_metallicRoughnessTexture:Jr.MetallicRoughness,u_normalTexture:Jr.Normal,u_occlusionTexture:Jr.Occlusion,u_emissionTexture:Jr.Emission,u_color_mix:[M.r,M.g,M.b,E],u_aoIntensity:S,u_emissive_strength:u}},o2=new Float32Array(16),n2=(e,t=o2,i=o2)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),Vk={fillExtrusion:e=>({u_matrix:new he(e),u_lightpos:new fe(e),u_lightintensity:new yt(e),u_lightcolor:new fe(e),u_vertical_gradient:new yt(e),u_opacity:new yt(e),u_edge_radius:new yt(e),u_ao:new Se(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_up_dir:new fe(e),u_height_lift:new yt(e),u_flood_light_color:new fe(e),u_vertical_scale:new yt(e),u_flood_light_intensity:new yt(e),u_ground_shadow_factor:new fe(e),u_emissive_strength:new yt(e)}),fillExtrusionDepth:e=>({u_matrix:new he(e),u_edge_radius:new yt(e),u_vertical_scale:new yt(e)}),fillExtrusionPattern:e=>({u_matrix:new he(e),u_lightpos:new fe(e),u_lightintensity:new yt(e),u_lightcolor:new fe(e),u_vertical_gradient:new yt(e),u_height_factor:new yt(e),u_edge_radius:new yt(e),u_ao:new Se(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_up_dir:new fe(e),u_height_lift:new yt(e),u_image:new Ee(e),u_texsize:new Se(e),u_pixel_coord_upper:new Se(e),u_pixel_coord_lower:new Se(e),u_tile_units_to_pixels:new yt(e),u_opacity:new yt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new he(e),u_opacity:new yt(e),u_ao_pass:new yt(e),u_meter_to_tile:new yt(e),u_ao:new Se(e),u_flood_light_intensity:new yt(e),u_flood_light_color:new fe(e),u_attenuation:new yt(e),u_edge_radius:new yt(e),u_fb:new Ee(e),u_fb_size:new yt(e)}),fill:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e)}),fillPattern:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e),u_image:new Ee(e),u_texsize:new Se(e),u_pixel_coord_upper:new Se(e),u_pixel_coord_lower:new Se(e),u_tile_units_to_pixels:new yt(e)}),fillOutline:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e),u_world:new Se(e)}),fillOutlinePattern:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e),u_world:new Se(e),u_image:new Ee(e),u_texsize:new Se(e),u_pixel_coord_upper:new Se(e),u_pixel_coord_lower:new Se(e),u_tile_units_to_pixels:new yt(e)}),circle:e=>({u_camera_to_center_distance:new yt(e),u_extrude_scale:new Bf(e),u_device_pixel_ratio:new yt(e),u_matrix:new he(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_up_dir:new fe(e),u_emissive_strength:new yt(e)}),collisionBox:e=>({u_matrix:new he(e),u_camera_to_center_distance:new yt(e),u_extrude_scale:new Se(e)}),collisionCircle:e=>({u_matrix:new he(e),u_inv_matrix:new he(e),u_camera_to_center_distance:new yt(e),u_viewport_size:new Se(e)}),debug:e=>({u_color:new za(e),u_matrix:new he(e),u_overlay:new Ee(e),u_overlay_scale:new yt(e)}),clippingMask:e=>({u_matrix:new he(e)}),heatmap:e=>({u_extrude_scale:new yt(e),u_intensity:new yt(e),u_matrix:new he(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_up_dir:new fe(e)}),heatmapTexture:e=>({u_image:new Ee(e),u_color_ramp:new Ee(e),u_opacity:new yt(e)}),hillshade:e=>({u_matrix:new he(e),u_image:new Ee(e),u_latrange:new Se(e),u_light:new Se(e),u_shadow:new za(e),u_highlight:new za(e),u_emissive_strength:new yt(e),u_accent:new za(e)}),hillshadePrepare:e=>({u_matrix:new he(e),u_image:new Ee(e),u_dimension:new Se(e),u_zoom:new yt(e)}),line:e=>({u_matrix:new he(e),u_pixels_to_tile_units:new Bf(e),u_device_pixel_ratio:new yt(e),u_units_to_pixels:new Se(e),u_dash_image:new Ee(e),u_gradient_image:new Ee(e),u_image_height:new yt(e),u_texsize:new Se(e),u_tile_units_to_pixels:new yt(e),u_alpha_discard_threshold:new yt(e),u_trim_offset:new Se(e),u_emissive_strength:new yt(e)}),linePattern:e=>({u_matrix:new he(e),u_texsize:new Se(e),u_pixels_to_tile_units:new Bf(e),u_device_pixel_ratio:new yt(e),u_image:new Ee(e),u_units_to_pixels:new Se(e),u_tile_units_to_pixels:new yt(e),u_alpha_discard_threshold:new yt(e)}),raster:e=>({u_matrix:new he(e),u_normalize_matrix:new he(e),u_globe_matrix:new he(e),u_merc_matrix:new he(e),u_grid_matrix:new Of(e),u_tl_parent:new Se(e),u_scale_parent:new yt(e),u_fade_t:new yt(e),u_opacity:new yt(e),u_image0:new Ee(e),u_image1:new Ee(e),u_brightness_low:new yt(e),u_brightness_high:new yt(e),u_saturation_factor:new yt(e),u_contrast_factor:new yt(e),u_spin_weights:new fe(e),u_perspective_transform:new Se(e),u_raster_elevation:new yt(e),u_tl_br:new Hr(e),u_zoom_transition:new yt(e),u_merc_center:new Se(e),u_cutoff_params:new Hr(e),u_colorization_mix:new Hr(e),u_colorization_offset:new yt(e),u_color_ramp:new Ee(e),u_texture_offset:new Se(e),u_texture_res:new Se(e),u_emissive_strength:new yt(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Ee(e),u_is_size_feature_constant:new Ee(e),u_size_t:new yt(e),u_size:new yt(e),u_camera_to_center_distance:new yt(e),u_rotate_symbol:new Ee(e),u_aspect_ratio:new yt(e),u_fade_change:new yt(e),u_matrix:new he(e),u_label_plane_matrix:new he(e),u_coord_matrix:new he(e),u_is_text:new Ee(e),u_pitch_with_map:new Ee(e),u_texsize:new Se(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_camera_forward:new fe(e),u_tile_matrix:new he(e),u_up_vector:new fe(e),u_ecef_origin:new fe(e),u_texture:new Ee(e),u_icon_transition:new yt(e),u_icon_saturation:new yt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Ee(e),u_is_size_feature_constant:new Ee(e),u_size_t:new yt(e),u_size:new yt(e),u_camera_to_center_distance:new yt(e),u_rotate_symbol:new Ee(e),u_aspect_ratio:new yt(e),u_fade_change:new yt(e),u_matrix:new he(e),u_label_plane_matrix:new he(e),u_coord_matrix:new he(e),u_is_text:new Ee(e),u_pitch_with_map:new Ee(e),u_texsize:new Se(e),u_texture:new Ee(e),u_gamma_scale:new yt(e),u_device_pixel_ratio:new yt(e),u_tile_id:new fe(e),u_zoom_transition:new yt(e),u_inv_rot_matrix:new he(e),u_merc_center:new Se(e),u_camera_forward:new fe(e),u_tile_matrix:new he(e),u_up_vector:new fe(e),u_ecef_origin:new fe(e),u_is_halo:new Ee(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Ee(e),u_is_size_feature_constant:new Ee(e),u_size_t:new yt(e),u_size:new yt(e),u_camera_to_center_distance:new yt(e),u_rotate_symbol:new Ee(e),u_aspect_ratio:new yt(e),u_fade_change:new yt(e),u_matrix:new he(e),u_label_plane_matrix:new he(e),u_coord_matrix:new he(e),u_is_text:new Ee(e),u_pitch_with_map:new Ee(e),u_texsize:new Se(e),u_texsize_icon:new Se(e),u_texture:new Ee(e),u_texture_icon:new Ee(e),u_gamma_scale:new yt(e),u_device_pixel_ratio:new yt(e),u_is_halo:new Ee(e)}),background:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e),u_opacity:new yt(e),u_color:new za(e)}),backgroundPattern:e=>({u_matrix:new he(e),u_emissive_strength:new yt(e),u_opacity:new yt(e),u_image:new Ee(e),u_pattern_tl:new Se(e),u_pattern_br:new Se(e),u_texsize:new Se(e),u_pattern_size:new Se(e),u_pixel_coord_upper:new Se(e),u_pixel_coord_lower:new Se(e),u_tile_units_to_pixels:new yt(e)}),terrainRaster:Vw,terrainDepth:Vw,skybox:e=>({u_matrix:new he(e),u_sun_direction:new fe(e),u_cubemap:new Ee(e),u_opacity:new yt(e),u_temporal_offset:new yt(e)}),skyboxGradient:e=>({u_matrix:new he(e),u_color_ramp:new Ee(e),u_center_direction:new fe(e),u_radius:new yt(e),u_opacity:new yt(e),u_temporal_offset:new yt(e)}),skyboxCapture:e=>({u_matrix_3f:new Of(e),u_sun_direction:new fe(e),u_sun_intensity:new yt(e),u_color_tint_r:new Hr(e),u_color_tint_m:new Hr(e),u_luminance:new yt(e)}),globeRaster:e=>({u_proj_matrix:new he(e),u_globe_matrix:new he(e),u_normalize_matrix:new he(e),u_merc_matrix:new he(e),u_zoom_transition:new yt(e),u_merc_center:new Se(e),u_image0:new Ee(e),u_grid_matrix:new Of(e),u_skirt_height:new yt(e),u_frustum_tl:new fe(e),u_frustum_tr:new fe(e),u_frustum_br:new fe(e),u_frustum_bl:new fe(e),u_globe_pos:new fe(e),u_globe_radius:new yt(e),u_viewport:new Se(e)}),globeAtmosphere:e=>({u_frustum_tl:new fe(e),u_frustum_tr:new fe(e),u_frustum_br:new fe(e),u_frustum_bl:new fe(e),u_horizon:new yt(e),u_transition:new yt(e),u_fadeout_range:new yt(e),u_color:new Hr(e),u_high_color:new Hr(e),u_space_color:new Hr(e),u_temporal_offset:new yt(e),u_horizon_angle:new yt(e)}),model:e=>({u_matrix:new he(e),u_lighting_matrix:new he(e),u_normal_matrix:new he(e),u_lightpos:new fe(e),u_lightintensity:new yt(e),u_lightcolor:new fe(e),u_camera_pos:new fe(e),u_opacity:new yt(e),u_baseColorFactor:new Hr(e),u_emissiveFactor:new Hr(e),u_metallicFactor:new yt(e),u_roughnessFactor:new yt(e),u_baseTextureIsAlpha:new Ee(e),u_alphaMask:new Ee(e),u_alphaCutoff:new yt(e),u_baseColorTexture:new Ee(e),u_metallicRoughnessTexture:new Ee(e),u_normalTexture:new Ee(e),u_occlusionTexture:new Ee(e),u_emissionTexture:new Ee(e),u_color_mix:new Hr(e),u_aoIntensity:new yt(e),u_emissive_strength:new yt(e)}),modelDepth:e=>({u_matrix:new he(e),u_instance:new he(e),u_node_matrix:new he(e)}),groundShadow:e=>({u_matrix:new he(e),u_ground_shadow_factor:new fe(e)}),stars:e=>({u_matrix:new he(e),u_up:new fe(e),u_right:new fe(e),u_intensity_multiplier:new yt(e)})};let Jh;function s2(e,t,i,r,o,n,s){const a=e.context,l=a.gl,c=e.transform,u=e.getOrCreateProgram("collisionBox"),p=[];let f=0,g=0;for(let M=0;M<r.length;M++){const E=r[M],A=t.getTile(E),I=A.getBucket(i);if(!I)continue;const z=JI(E,I,c);let P=z;o[0]===0&&o[1]===0||(P=e.translatePosMatrix(z,A,o,n));const R=s?I.textCollisionBox:I.iconCollisionBox,F=I.collisionCircleArray;if(F.length>0){const N=Q.create(),U=P;Q.mul(N,I.placementInvProjMatrix,c.glCoordMatrix),Q.mul(N,N,I.placementViewportMatrix),p.push({circleArray:F,circleOffset:g,transform:U,invTransform:N,projection:I.getProjection()}),f+=F.length/4,g=f}R&&(e.terrain&&e.terrain.setupElevationDraw(A,u),u.draw(e,l.LINES,ee.disabled,ve.disabled,e.colorModeForRenderPass(),we.disabled,Dk(P,c,A,I.getProjection()),i.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,null,c.zoom,null,[R.collisionVertexBuffer,R.collisionVertexBufferExt]))}if(!s||!p.length)return;const _=e.getOrCreateProgram("collisionCircle"),y=new Sf;y.resize(4*f),y._trim();let x=0;for(const M of p)for(let E=0;E<M.circleArray.length/4;E++){const A=4*E,I=M.circleArray[A+0],z=M.circleArray[A+1],P=M.circleArray[A+2],R=M.circleArray[A+3];y.emplace(x++,I,z,P,R,0),y.emplace(x++,I,z,P,R,1),y.emplace(x++,I,z,P,R,2),y.emplace(x++,I,z,P,R,3)}(!Jh||Jh.length<2*f)&&(Jh=function(M){const E=2*M,A=new Zi;A.resize(E),A._trim();for(let I=0;I<E;I++){const z=6*I;A.uint16[z+0]=4*I+0,A.uint16[z+1]=4*I+1,A.uint16[z+2]=4*I+2,A.uint16[z+3]=4*I+2,A.uint16[z+4]=4*I+3,A.uint16[z+5]=4*I+0}return A}(f));const b=a.createIndexBuffer(Jh,!0),T=a.createVertexBuffer(y,cA.members,!0);for(const M of p){const E={u_matrix:M.transform,u_inv_matrix:M.invTransform,u_camera_to_center_distance:(S=c).getCameraToCenterDistance(M.projection),u_viewport_size:[S.width,S.height]};_.draw(e,l.TRIANGLES,ee.disabled,ve.disabled,e.colorModeForRenderPass(),we.disabled,E,i.id,T,b,ti.simpleSegment(0,2*M.circleOffset,M.circleArray.length,M.circleArray.length/2),null,c.zoom)}var S;T.destroy(),b.destroy()}const a2=Q.create();function jk({width:e,height:t,anchor:i,textOffset:r,textScale:o},n){const{horizontalAlign:s,verticalAlign:a}=dh(i),l=-(s-.5)*e,c=-(a-.5)*t,u=Rm(i,r);return new B((l/o+u[0])*n,(c/o+u[1])*n)}function Uk(e,t,i,r,o,n,s,a,l,c,u){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,g=e.icon.dynamicLayoutVertexArray,_={},y=e.getProjection(),x=gg(a,y,n),b=n.elevation,T=y.upVectorScale(a.canonical,n.center.lat,n.worldSize).metersToTile;f.clear();for(let S=0;S<p.length;S++){const M=p.get(S),{tileAnchorX:E,tileAnchorY:A,numGlyphs:I}=M,z=M.hidden||!M.crossTileID||e.allowVerticalPlacement&&!M.placedOrientation?null:r[M.crossTileID];if(z){let P=0,R=0,F=0;if(b){const it=b?b.getAtTileOffset(a,E,A):0,[ot,rt,lt]=y.upVector(a.canonical,E,A);P=it*ot*T,R=it*rt*T,F=it*lt*T}let[N,U,O,Z]=Vo(M.projectedAnchorX+P,M.projectedAnchorY+R,M.projectedAnchorZ+F,i?x:s);const W=Jv(n.getCameraToCenterDistance(y),Z);let K=o.evaluateSizeForFeature(e.textSizeData,c,M)*W/lr;i&&(K*=e.tilePixelRatio/l);const $=jk(z,K);i?({x:N,y:U,z:O}=y.projectTilePoint(E+$.x,A+$.y,a.canonical),[N,U,O]=Vo(N+P,U+R,O+F,s)):(t&&$._rotate(-n.angle),N+=$.x,U+=$.y,O=0);const H=e.allowVerticalPlacement&&M.placedOrientation===vi.vertical?Math.PI/2:0;for(let it=0;it<I;it++)Xa(f,N,U,O,H);u&&M.associatedIconIndex>=0&&(_[M.associatedIconIndex]={x:N,y:U,z:O,angle:H})}else Ja(I,f)}if(u){g.clear();const S=e.icon.placedSymbolArray;for(let M=0;M<S.length;M++){const E=S.get(M),{numGlyphs:A}=E,I=_[M];if(E.hidden||!I)Ja(A,g);else{const{x:z,y:P,z:R,angle:F}=I;for(let N=0;N<A;N++)Xa(g,z,P,R,F)}}e.icon.dynamicLayoutVertexBuffer.updateData(g)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Gk(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function l2(e,t,i,r,o,n,s,a,l,c,u,p,f){const g=e.context,_=g.gl,y=e.transform,x=a==="map",b=l==="map",T=x&&i.layout.get("symbol-placement")!=="point",S=x&&!b&&!T,M=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let E=!1;const A=e.depthModeForSublayer(0,ee.ReadOnly),I=[Ji(y.center.lng),Qi(y.center.lat)],z=i.layout.get("text-variable-anchor"),P=y.projection.name==="globe",R=[],F=[0,-1,0];let N=F;!P&&!y.mercatorFromTransition||x||(N=function(U){const O=U._camera.getWorldToCamera(U.worldSize,1),Z=Q.multiply([],O,U.globeMatrix);Q.invert(Z,Z);const W=[0,0,0],K=[0,1,0,0];return ei.transformMat4(K,K,Z),W[0]=K[0],W[1]=K[1],W[2]=K[2],j.normalize(W,W),W}(y));for(const U of r){const O=t.getTile(U),Z=O.getBucket(i);if(!Z||Z.projection.name==="mercator"&&P)continue;const W=o?Z.text:Z.icon;if(!W||Z.fullyClipped||!W.segments.get().length)continue;const K=W.programConfigurations.get(i.id),$=o||Z.sdfIcons,H=o?Z.textSizeData:Z.iconSizeData,it=b||y.pitch!==0,ot=Qo(H,y.zoom);let rt,lt,ut,pt,nt=[0,0],mt=null;if(o)lt=O.glyphAtlasTexture?O.glyphAtlasTexture:null,ut=_.LINEAR,rt=O.glyphAtlasTexture?O.glyphAtlasTexture.size:[0,0],Z.iconsInText&&(nt=O.imageAtlasTexture?O.imageAtlasTexture.size:[0,0],mt=O.imageAtlasTexture?O.imageAtlasTexture:null,pt=it||e.options.rotating||e.options.zooming||H.kind==="composite"||H.kind==="camera"?_.LINEAR:_.NEAREST);else{const _i=i.layout.get("icon-size").constantOr(0)!==1||Z.iconsNeedLinear;lt=O.imageAtlasTexture?O.imageAtlasTexture:null,ut=$||e.options.rotating||e.options.zooming||_i||it?_.LINEAR:_.NEAREST,rt=O.imageAtlasTexture?O.imageAtlasTexture.size:[0,0]}const It=Z.projection.name==="globe",kt=It?N:F,Rt=It?ar(y.zoom):0,Ot=gg(U,Z.getProjection(),y),oe=y.calculatePixelsToTileUnitsMatrix(O),$t=Dh(Ot,O.tileID.canonical,b,x,y,Z.getProjection(),oe),Fe=e.terrain&&b&&T?Q.invert(Q.create(),$t):a2,Ae=Yv(Ot,O.tileID.canonical,b,x,y,Z.getProjection(),oe),ie=z&&Z.hasTextData(),te=Z.hasIconTextFit()&&ie&&Z.hasIconData();if(T){const _i=y.elevation,Je=_i?_i.getAtTileOffsetFunc(U,y.center.lat,y.worldSize,Z.getProjection()):null,hr=Xv(Ot,O.tileID.canonical,b,x,y,Z.getProjection(),oe);jC(Z,Ot,e,o,hr,Ae,b,c,Je,U)}const Xt=T||o&&z||te,Ie=e.translatePosMatrix(Ot,O,n,s),Re=Xt?a2:$t,ye=e.translatePosMatrix(Ae,O,n,s,!0),si=Z.getProjection().createInversionMatrix(y,U.canonical),Bi=i.paint.get("icon-image-cross-fade").constantOr(0),ii=[];e.terrainRenderModeElevated()&&b&&ii.push("PITCH_WITH_MAP_TERRAIN"),It&&(ii.push("PROJECTION_GLOBE_VIEW"),Xt&&ii.push("PROJECTED_POS_ON_VIEWPORT")),Bi>0&&ii.push("ICON_TRANSITION"),W.zOffsetVertexBuffer&&ii.push("Z_OFFSET");const pi=$&&i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ji;$?ji=Z.iconsInText?Bk(H.kind,ot,S,b,e,Ie,Re,ye,rt,nt,U,Rt,I,si,kt,Z.getProjection()):r2(H.kind,ot,S,b,e,Ie,Re,ye,o,rt,!0,U,Rt,I,si,kt,Z.getProjection()):(u<1&&ii.push("SATURATION"),ji=i2(H.kind,ot,S,b,e,Ie,Re,ye,o,rt,U,Rt,I,si,kt,Z.getProjection(),u,Bi));const Fi={program:e.getOrCreateProgram(Gk($,o,Z),{config:K,defines:ii}),buffers:W,uniformValues:ji,atlasTexture:lt,atlasTextureIcon:mt,atlasInterpolation:ut,atlasInterpolationIcon:pt,isSDF:$,hasHalo:pi,tile:O,labelPlaneMatrixInv:Fe};if(M&&Z.canOverlap){E=!0;const _i=W.segments.get();for(const Je of _i)R.push({segments:new ti([Je]),sortKey:Je.sortKey,state:Fi})}else R.push({segments:W.segments,sortKey:0,state:Fi})}E&&R.sort((U,O)=>U.sortKey-O.sortKey);for(const U of R){const O=U.state;if(e.terrain&&e.terrain.setupElevationDraw(O.tile,O.program,{useDepthForOcclusion:y.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:O.labelPlaneMatrixInv}),g.activeTexture.set(_.TEXTURE0),O.atlasTexture&&O.atlasTexture.bind(O.atlasInterpolation,_.CLAMP_TO_EDGE),O.atlasTextureIcon&&(g.activeTexture.set(_.TEXTURE1),O.atlasTextureIcon&&O.atlasTextureIcon.bind(O.atlasInterpolationIcon,_.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,O.program),O.hasHalo){const Z=O.uniformValues;Z.u_is_halo=1,Eg(O.buffers,U.segments,i,e,O.program,A,p,f,Z,2),Z.u_is_halo=0}else{if(O.isSDF){const Z=O.uniformValues;O.hasHalo&&(Z.u_is_halo=1,Eg(O.buffers,U.segments,i,e,O.program,A,p,f,Z,1)),Z.u_is_halo=0}Eg(O.buffers,U.segments,i,e,O.program,A,p,f,O.uniformValues,1)}}}function Eg(e,t,i,r,o,n,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];o.draw(r,r.context.gl.TRIANGLES,n,s,a,we.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),u,c)}function c2(e,t,i,r,o,n,s){const a=e.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,p,f,g,_;s?(p=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(p=c?"fillPattern":"fill",u=a.TRIANGLES);for(const y of r){const x=t.getTile(y);if(c&&!x.patternsLoaded())continue;const b=x.getBucket(i);if(!b)continue;e.prepareDrawTile();const T=b.programConfigurations.get(i.id),S=e.isTileAffectedByFog(y),M=e.getOrCreateProgram(p,{config:T,overrideFog:S});c&&(e.context.activeTexture.set(a.TEXTURE0),x.imageAtlasTexture&&x.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),T.updatePaintBuffers());const E=l.constantOr(null);if(E&&x.imageAtlas){const z=x.imageAtlas.patternPositions[E.toString()];z&&T.setConstantPatternPositions(z)}const A=e.translatePosMatrix(y.projMatrix,x,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),I=i.paint.get("fill-emissive-strength");if(s){g=b.indexBuffer2,_=b.segments2;const z=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];f=p==="fillOutlinePattern"&&c?kk(A,I,e,x,z):Ik(A,I,z)}else g=b.indexBuffer,_=b.segments,f=c?Kw(A,I,e,x):Jw(A,I);e.uploadCommonUniforms(e.context,M,y.toUnwrapped()),M.draw(e,u,o,e.stencilModeForClipping(y),n,we.disabled,f,i.id,b.layoutVertexBuffer,g,_,i.paint,e.transform.zoom,T,void 0)}}function Kh(e,t,i,r,o,n,s,a){i.resetLayerRenderingStats();const l=e.context,c=l.gl,u=e.transform,p=i.paint.get("fill-extrusion-pattern"),f=p.constantOr(1),g=i.paint.get("fill-extrusion-opacity"),_=e.style.enable3dLights(),y=i.paint.get(_&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),x=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),y],b=i.layout.get("fill-extrusion-edge-radius"),T=b>0&&!i.paint.get("fill-extrusion-rounded-roof"),S=T?0:b,M=u.projection.name==="globe"?zb():0,E=u.projection.name==="globe",A=E?ar(u.zoom):0,I=[Ji(u.center.lng),Qi(u.center.lat)],z=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),P=i.paint.get("fill-extrusion-flood-light-intensity"),R=i.paint.get("fill-extrusion-vertical-scale"),F=tl(e,i.paint.get("fill-extrusion-cutoff-fade-range")),N=i.paint.get("fill-extrusion-emissive-strength"),U=[];let O;E&&U.push("PROJECTION_GLOBE_VIEW"),x[0]>0&&U.push("FAUX_AO"),T&&U.push("ZERO_ROOF_RADIUS"),a&&U.push("HAS_CENTROID"),P>0&&U.push("FLOOD_LIGHT"),F.shouldRenderCutoff&&U.push("RENDER_CUTOFF");const Z=e.renderPass==="shadow",W=e.shadowRenderer,K=Z&&!!W;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let $=[0,0,0];if(W){const ot=e.style.directionalLight,rt=e.style.ambientLight;ot&&rt&&($=Ag(ot,rt)),O=U.concat(["SHADOWS_SINGLE_CASCADE"])}const H=K?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",it=i.getLayerRenderingStats();for(const ot of r){const rt=t.getTile(ot),lt=rt.getBucket(i);if(!lt||lt.projection.name!==u.projection.name)continue;let ut=!1;W&&(ut=W.getMaxCascadeForTile(ot.toUnwrapped())===0);const pt=e.isTileAffectedByFog(ot),nt=lt.programConfigurations.get(i.id),mt=e.getOrCreateProgram(H,{config:nt,defines:ut?O:U,overrideFog:pt});if(e.terrain&&e.terrain.setupElevationDraw(rt,mt,{useMeterToDem:!0}),!lt.centroidVertexBuffer){const $t=mt.attributes.a_centroid_pos;$t!==void 0&&c.vertexAttrib2f($t,0,0)}!Z&&W&&W.setupShadows(rt.tileID.toUnwrapped(),mt,"vector-tile",rt.tileID.overscaledZ),f&&(e.context.activeTexture.set(c.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),nt.updatePaintBuffers());const It=p.constantOr(null);if(It&&rt.imageAtlas){const $t=rt.imageAtlas.patternPositions[It.toString()];$t&&nt.setConstantPatternPositions($t)}const kt=i.paint.get("fill-extrusion-vertical-gradient");let Rt;if(Z&&W){if(Wk(rt.tileID,lt,e))continue;const $t=W.calculateShadowPassMatrixFromTile(rt.tileID.toUnwrapped());Rt=Ak($t,S,R)}else{const $t=e.translatePosMatrix(ot.expandedProjMatrix,rt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Fe=u.projection.createInversionMatrix(u,ot.canonical);Rt=f?Ck($t,e,kt,g,x,S,ot,rt,M,A,I,Fe,z,R):Yw($t,e,kt,g,x,S,ot,M,A,I,Fe,z,R,P,$,N)}e.uploadCommonUniforms(l,mt,ot.toUnwrapped(),null,F);let Ot=lt.segments;if(u.projection.name==="mercator"&&!Z&&(Ot=lt.getVisibleSegments(rt.tileID,e.terrain,e.transform.getFrustum(0)),!Ot.get().length))continue;if(it)if(Z)for(const $t of Ot.get())it.numRenderedVerticesInShadowPass+=$t.primitiveLength;else for(const $t of Ot.get())it.numRenderedVerticesInTransparentPass+=$t.primitiveLength;const oe=[];(e.terrain||a)&&oe.push(lt.centroidVertexBuffer),E&&oe.push(lt.layoutVertexExtBuffer),mt.draw(e,l.gl.TRIANGLES,o,n,s,we.backCCW,Rt,i.id,lt.layoutVertexBuffer,lt.indexBuffer,Ot,i.paint,e.transform.zoom,nt,oe)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function il(e,t,i,r,o,n,s,a,l,c,u,p,f,g,_,y,x,b,T){const S=e.context,M=S.gl,E=e.transform,A=e.transform.zoom,I=[],z=tl(e,i.paint.get("fill-extrusion-cutoff-fade-range"));c==="clear"?(I.push("CLEAR_SUBPASS"),T&&(I.push("CLEAR_FROM_TEXTURE"),S.activeTexture.set(M.TEXTURE0),T.bind(M.LINEAR,M.CLAMP_TO_EDGE))):c==="sdf"&&I.push("SDF_SUBPASS"),x&&I.push("HAS_CENTROID"),z.shouldRenderCutoff&&I.push("RENDER_CUTOFF");const P=i.layout.get("fill-extrusion-edge-radius"),R=(F,N,U,O,Z)=>{const W=N.programConfigurations.get(i.id),K=e.isTileAffectedByFog(F),$=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:W,defines:I,overrideFog:K}),H=((ot,rt,lt,ut,pt,nt,mt,It,kt,Rt,Ot)=>({u_matrix:rt,u_opacity:lt,u_ao_pass:ut?1:0,u_meter_to_tile:pt,u_ao:nt,u_flood_light_intensity:mt,u_flood_light_color:It,u_attenuation:kt,u_edge_radius:Rt,u_fb:0,u_fb_size:Ot}))(0,O,u,l,Z,[p,f*Z],g,_,y,A>=17?0:P*Z,T?T.size[0]:0),it=[];x&&it.push(N.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(S,$,F.toUnwrapped(),null,z),$.draw(e,S.gl.TRIANGLES,o,n,s,a,H,i.id,N.vertexBuffer,N.indexBuffer,U,i.paint,A,W,it)};for(const F of r){const N=t.getTile(F),U=N.getBucket(i);if(!U||U.projection.name!==E.projection.name||!U.groundEffect||U.groundEffect&&!U.groundEffect.hasData())continue;const O=U.groundEffect,Z=1/U.tileToMeter;{const W=e.translatePosMatrix(F.projMatrix,N,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),K=O.getDefaultSegment();R(F,O,K,W,Z)}if(b)for(let W=0;W<4;W++){const K=ox[W](F),$=t.getTile(K);if(!$)continue;const H=$.getBucket(i);if(!H||H.projection.name!==E.projection.name||!H.groundEffect||H.groundEffect&&!H.groundEffect.hasData())continue;const it=H.groundEffect;let ot,rt;W===0?(ot=[-at,0,0],rt=1):W===1?(ot=[at,0,0],rt=0):W===2?(ot=[0,-at,0],rt=3):(ot=[0,at,0],rt=2);const lt=it.regionSegments[rt];if(!lt)continue;const ut=new Float32Array(16);Q.translate(ut,F.projMatrix,ot),R(F,it,lt,e.translatePosMatrix(ut,N,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Z)}}}function qk(e,t,i,r,o,n,s){r.centroidVertexArray.length===0&&r.createCentroidsBuffer();const a=n?n.findDEMTileFor(i):null;if(!(a&&a.dem||s))return;const l=b=>{const T=t.getSource().minzoom,S=E=>{const A=t.getTileByID(E);if(A&&A.hasData())return A.getBucket(o)},M=[0,-1,1];for(const E of M){if(b.overscaledZ+E<T)continue;const A=S(b.calculateScaledKey(b.overscaledZ+E));if(A)return A}},c=[0,0,0],u=(b,T)=>(c[0]=Math.min(b.min.y,T.min.y),c[1]=Math.max(b.max.y,T.max.y),c[2]=at-T.min.x>b.max.x?T.min.x-at:b.max.x,c),p=(b,T)=>(c[0]=Math.min(b.min.x,T.min.x),c[1]=Math.max(b.max.x,T.max.x),c[2]=at-T.min.y>b.max.y?T.min.y-at:b.max.y,c),f=[(b,T)=>u(b,T),(b,T)=>u(T,b),(b,T)=>p(b,T),(b,T)=>p(T,b)],g=(b,T,S,M,E,A,I)=>{if(!n)return 0;const z=[[A?S:b,A?b:S,0],[A?S:T,A?T:S,0]],P=I<0?at+I:I,R=[A?P:(b+T)/2,A?(b+T)/2:P,0];return S===0&&I<0||S!==0&&I>0?n.getForTilePoints(E,[R],!0,M):z.push(R),n.getForTilePoints(i,z,!0,a),Math.max(z[0][2],z[1][2],R[2])/n.exaggeration()};for(let b=0;b<4;b++){const T=r.borderFeatureIndices[b];if(T.length===0)continue;const S=ox[b](i),M=l(S);if(!(M&&M instanceof fc)||r.borderDoneWithNeighborZ[b]===M.canonical.z)continue;M.centroidVertexArray.length===0&&M.createCentroidsBuffer();const E=n?n.findDEMTileFor(S):null;if(!(E&&E.dem||s))continue;const A=(b<2?1:5)-b,I=M.borderDoneWithNeighborZ[A]!==r.canonical.z,z=M.borderFeatureIndices[A];let P=0;if(r.canonical.z!==M.canonical.z){for(const R of T)r.showCentroid(r.featuresOnBorder[R]);if(I)for(const R of z)M.showCentroid(M.featuresOnBorder[R]);r.borderDoneWithNeighborZ[b]=M.canonical.z,M.borderDoneWithNeighborZ[A]=r.canonical.z}for(const R of T){const F=r.featuresOnBorder[R],N=r.centroidData[F.centroidDataIndex],U=F.borders[b];let O;for(;P<z.length;){O=M.featuresOnBorder[z[P]];const Z=O.borders[A];if(Z[1]>U[0]+3||Z[0]>U[0]-3)break;M.showCentroid(O),P++}if(O&&P<z.length){const Z=P;let W=0;for(;!(O.borders[A][0]>U[1]-3)&&(W++,++P!==z.length);)O=M.featuresOnBorder[z[P]];if(O=M.featuresOnBorder[z[Z]],W>1){const H=O.borders[A];Math.abs(U[0]-H[0])<3&&Math.abs(U[1]-H[1])<3&&(W=1,P=Z+1)}else if(W===0){r.showCentroid(F);continue}const K=M.centroidData[O.centroidDataIndex];s&&W===1&&(((y=N).flags|(x=K).flags)&rn?(y.flags|=rn,x.flags|=rn):(y.flags&=2147483647,x.flags&=2147483647));let $=new B(0,0);if(W>1)P=Z;else if(E&&E.dem&&!(F.intersectsCount()>1||O.intersectsCount()>1)){const H=f[b](N,K),it=b%2?at-1:0;_=g(H[0],Math.min(at-1,H[1]),it,E,S,b<2,H[2]),$=new B(Math.ceil(7*(_+450)),0)}N.centroidXY=K.centroidXY=$,r.writeCentroidToBuffer(N),M.writeCentroidToBuffer(K)}else r.showCentroid(F)}r.borderDoneWithNeighborZ[b]=M.canonical.z,M.borderDoneWithNeighborZ[A]=r.canonical.z}var _,y,x;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&r.centroidVertexArray.length!==0)&&r.uploadCentroid(e)}const $k=[1,0,0],Zk=[0,1,0],Hk=[0,0,1];function Wk(e,t,i){const r=i.transform,o=i.shadowRenderer;if(!o)return!0;const n=e.toUnwrapped(),s=r.tileSize*o._cascades[i.currentShadowCascade].scale;let a=t.maxHeight;if(r.elevation){const y=r.elevation.getMinMaxForTile(e);y&&(a+=y.max)}const l=[...o.shadowDirection];l[2]=-l[2];const c=o.computeSimplifiedTileShadowVolume(n,a,s,l);if(!c)return!1;const u=[$k,Zk,Hk,l,[l[0],0,l[2]],[0,l[1],l[2]]],p=r.projection.name==="globe",f=r.scaleZoom(s),g=En.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,f,!p),_=o.getCurrentCascadeFrustum();return g.intersectsPrecise(c.vertices,c.planes,u)===0||_.intersectsPrecise(c.vertices,c.planes,u)===0}function Xk(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,o=.2*e.height,n=t+o;return[t,i,(n-o-t)/r,(n-t)/r]}const Yk=new xe(1,0,0,1),Jk=new xe(0,1,0,1),Kk=new xe(0,0,1,1),Qk=new xe(1,0,1,1),tD=new xe(0,1,1,1);function eD(e,t,i){const r=e.context,o=e.transform,n=r.gl,s=o.projection.name==="globe",a=s?["PROJECTION_GLOBE_VIEW"]:[];let l=i.projMatrix;if(s&&ar(o.zoom)>0){const R=sm(cx(i.canonical,o));l=Q.multiply(new Float32Array(16),o.globeMatrix,R),Q.multiply(l,o.projMatrix,l)}const c=e.getOrCreateProgram("debug",{defines:a}),u=t.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(u,c);const p=ee.disabled,f=ve.disabled,g=e.colorModeForRenderPass(),_="$debug";r.activeTexture.set(n.TEXTURE0),e.emptyTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE),s?u._makeGlobeTileDebugBuffers(e.context,o):u._makeDebugTileBoundsBuffers(e.context,o.projection);const y=u._tileDebugBuffer||e.debugBuffer,x=u._tileDebugIndexBuffer||e.debugIndexBuffer,b=u._tileDebugSegments||e.debugSegments;c.draw(e,n.LINE_STRIP,p,f,g,we.disabled,Qw(l,xe.red),_,y,x,b,null,null,null,[u._globeTileDebugBorderBuffer]);const T=u.latestRawTileData,S=Math.floor((T&&T.byteLength||0)/1024),M=t.getTile(i).tileSize,E=512/Math.min(M,512)*(i.overscaledZ/o.zoom)*.5;let A=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(A+=` => ${i.overscaledZ}`),A+=` ${S}kb`,function(R,F){R.initDebugOverlayCanvas();const N=R.debugOverlayCanvas,U=R.context.gl,O=R.debugOverlayCanvas.getContext("2d");O.clearRect(0,0,N.width,N.height),O.shadowColor="white",O.shadowBlur=2,O.lineWidth=1.5,O.strokeStyle="white",O.textBaseline="top",O.font="bold 36px Open Sans, sans-serif",O.fillText(F,5,5),O.strokeText(F,5,5),R.debugOverlayTexture.update(N),R.debugOverlayTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE)}(e,A);const I=u._tileDebugTextBuffer||e.debugBuffer,z=u._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,P=u._tileDebugTextSegments||e.debugSegments;c.draw(e,n.TRIANGLES,p,f,Ve.alphaBlended,we.disabled,Qw(l,xe.transparent,E),_,I,z,P,null,null,null,[u._globeTileDebugTextBuffer])}function u2(e,t,i,r){Qh(e,0,t+i/2,e.transform.width,i,r)}function h2(e,t,i,r){Qh(e,t-i/2,0,i,e.transform.height,r)}function Qh(e,t,i,r,o,n){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*ce.devicePixelRatio,i*ce.devicePixelRatio,r*ce.devicePixelRatio,o*ce.devicePixelRatio),s.clear({color:n}),a.disable(a.SCISSOR_TEST)}const iD=He([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:rD}=iD;function ps(e,t,i,r){e.emplaceBack(t,i,r)}class d2{constructor(t){this.vertexArray=new Ls,this.indices=new Zi,ps(this.vertexArray,-1,-1,1),ps(this.vertexArray,1,-1,1),ps(this.vertexArray,-1,1,1),ps(this.vertexArray,1,1,1),ps(this.vertexArray,-1,-1,-1),ps(this.vertexArray,1,-1,-1),ps(this.vertexArray,-1,1,-1),ps(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,rD),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=ti.simpleSegment(0,0,36,12)}}function rl(e,t,i,r,o,n){const s=e.context.gl,a=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),u=((p,f,g,_,y)=>({u_matrix_3f:p,u_sun_direction:f,u_sun_intensity:g,u_color_tint_r:[_.r,_.g,_.b,_.a],u_color_tint_m:[y.r,y.g,y.b,y.a],u_luminance:5e-5}))(Lr.fromMat4(Lr.create(),r),o,c,a,l);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+n,t.skyboxTexture,0),i.draw(e,s.TRIANGLES,ee.disabled,ve.disabled,Ve.unblended,we.frontCW,u,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const oD=He([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nD{constructor(t){const i=new Rs;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new Zi;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,oD.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=ti.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sD=He([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class aD{constructor(){this.colorModeAlphaBlendedWriteRGB=new Ve([1,Ih,1,Ih],xe.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ve([1,0,1,0],xe.transparent,[!1,!1,!1,!0])}update(t){const i=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new nD(i);const r=100,o=200,n=function(u){const p=Jp(30),f=[];for(let g=0;g<16e3;++g){const _=2*Math.PI*p(),y=Math.acos(1-2*p())-.5*Math.PI;f.push(j.fromValues(Math.cos(y)*Math.cos(_),Math.cos(y)*Math.sin(_),Math.sin(y)))}return f}(),s=Jp(300),a=new If,l=new Zi;let c=0;for(let u=0;u<n.length;++u){const p=j.scale([],n[u],200),f=Math.max(0,1+.01*r*(1*s()-.5)),g=Math.max(0,1+.01*o*(1*s()-.5));a.emplaceBack(p[0],p[1],p[2],-1,-1,f,g),a.emplaceBack(p[0],p[1],p[2],1,-1,f,g),a.emplaceBack(p[0],p[1],p[2],1,1,f,g),a.emplaceBack(p[0],p[1],p[2],-1,1,f,g),l.emplaceBack(c+0,c+1,c+2),l.emplaceBack(c+0,c+2,c+3),c+=4}this.starsVx=i.createVertexBuffer(a,sD.members),this.starsIdx=i.createIndexBuffer(l),this.starsSegments=ti.simpleSegment(0,0,a.length,l.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const r=t.context,o=r.gl,n=t.transform,s=new ee(o.LEQUAL,ee.ReadOnly,[0,1]),a=ar(n.zoom),l=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),u=i.properties.get("space-color").toArray01PremultipliedAlpha(),p=5e-4,f=Ut((i.properties.get("horizon-blend")-0)/1*.2495+p,5e-4,.25),g=gx(t,r,n)&&f===p?n.worldSize/(2*Math.PI*1.025)-1:n.globeRadius,_=t.frameCounter/1e3%1,y=j.length(n.globeCenterInViewSpace),x=Math.sqrt(Math.pow(y,2)-Math.pow(g,2)),b=Math.acos(x/y),T=S=>{const M=n.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];S&&M.push("ALPHA_PASS");const E=t.getOrCreateProgram("globeAtmosphere",{defines:M}),A=((z,P,R,F,N,U,O,Z,W,K,$,H)=>({u_frustum_tl:z,u_frustum_tr:P,u_frustum_br:R,u_frustum_bl:F,u_horizon:N,u_transition:U,u_fadeout_range:O,u_color:Z,u_high_color:W,u_space_color:K,u_temporal_offset:$,u_horizon_angle:H}))(n.frustumCorners.TL,n.frustumCorners.TR,n.frustumCorners.BR,n.frustumCorners.BL,n.frustumCorners.horizon,a,f,l,c,u,_,b);t.uploadCommonUniforms(r,E);const I=this.atmosphereBuffer;I&&E.draw(t,o.TRIANGLES,s,ve.disabled,S?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,we.backCW,A,S?"atmosphere_glow_alpha":"atmosphere_glow",I.vertexBuffer,I.indexBuffer,I.segments)};T(!1),T(!0)}drawStars(t,i){const r=Ut(i.properties.get("star-intensity"),0,1);if(r===0)return;const o=t.context,n=o.gl,s=t.transform,a=t.getOrCreateProgram("stars"),l=fr.identity([]);fr.rotateX(l,l,-s._pitch),fr.rotateZ(l,l,-s.angle),fr.rotateX(l,l,Ft(s._center.lat)),fr.rotateY(l,l,-Ft(s._center.lng));const c=Q.fromQuat(new Float32Array(16),l),u=Q.multiply([],s.starsProjMatrix,c),p=Lr.fromMat4([],c),f=Lr.invert([],p),g=[0,1,0];j.transformMat3(g,g,f),j.scale(g,g,.15);const _=[1,0,0];j.transformMat3(_,_,f),j.scale(_,_,.15);const y=((x,b,T,S)=>({u_matrix:Float32Array.from(x),u_up:b,u_right:T,u_intensity_multiplier:S}))(u,g,_,r);t.uploadCommonUniforms(o,a),this.starsVx&&this.starsIdx&&a.draw(t,n.TRIANGLES,ee.disabled,ve.disabled,this.colorModeAlphaBlendedWriteRGB,we.disabled,y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function p2(e,t){const i=[...e],r=t.cameraWorldSizeForFog/t.worldSize,o=Q.identity([]);return Q.scale(o,o,[r,r,1]),Q.multiply(i,o,i),Q.multiply(i,t.worldToFogMatrix,i),i}function Sg(e,t,i,r){const o=i.material,n=r.context,{baseColorTexture:s,metallicRoughnessTexture:a}=o.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=o;function p(f,g,_){if(f&&(e.push(g),n.activeTexture.set(n.gl.TEXTURE0+_),f.gfxTexture)){const{minFilter:y,magFilter:x,wrapS:b,wrapT:T}=f.sampler;f.gfxTexture.bindExtraParam(y,x,b,T)}}p(s,"HAS_TEXTURE_u_baseColorTexture",Jr.BaseColor),p(a,"HAS_TEXTURE_u_metallicRoughnessTexture",Jr.MetallicRoughness),p(l,"HAS_TEXTURE_u_normalTexture",Jr.Normal),p(c,"HAS_TEXTURE_u_occlusionTexture",Jr.Occlusion),p(u,"HAS_TEXTURE_u_emissionTexture",Jr.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),o.alphaMode!=="OPAQUE"&&o.alphaMode!=="MASK"||e.push("UNPREMULT_TEXTURE_IN_SHADER"),o.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function td(e,t,i,r,o,n){const s=i.paint.get("model-opacity"),a=t.context,l=new ee(t.context.gl.LEQUAL,ee.ReadWrite,t.depthRangeFor3D),c=t.transform,u=e.mesh,p=u.material,f=p.pbrMetallicRoughness,g=t.style.fog;let _;_=t.transform.projection.zAxisUnit==="pixels"?[...e.nodeModelMatrix]:Q.multiply([],r.zScaleMatrix,e.nodeModelMatrix),Q.multiply(_,r.negCameraPosMatrix,_);const y=Q.invert([],_);Q.transpose(y,y);const x=i.paint.get("model-emissive-strength").constantOr(0),b=Tg(new Float32Array(e.worldViewProjection),new Float32Array(_),new Float32Array(y),t,s,f.baseColorFactor,p.emissiveFactor,f.metallicFactor,f.roughnessFactor,p,x,i),T={defines:[]},S=[];Sg(T.defines,S,u,t);const M=t.shadowRenderer;M&&(M.useNormalOffset=!1);let E=null;if(g){const z=p2(e.nodeModelMatrix,t.transform);if(E=new Float32Array(z),c.projection.name!=="globe"){const P=u.aabb.min,R=u.aabb.max,[F,N]=g.getOpacityForBounds(z,P[0],P[1],R[0],R[1]);T.overrideFog=F>=qs||N>=qs}}const A=tl(t,i.paint.get("model-cutoff-fade-range"));A.shouldRenderCutoff&&T.defines.push("RENDER_CUTOFF");const I=t.getOrCreateProgram("model",T);t.uploadCommonUniforms(a,I,null,E,A),t.renderPass!=="shadow"&&M&&M.setupShadowsFromMatrix(e.nodeModelMatrix,I),I.draw(t,a.gl.TRIANGLES,l,o,n,u.material.doubleSided?we.disabled:we.backCCW,b,i.id,u.vertexBuffer,u.indexBuffer,u.segments,i.paint,t.transform.zoom,void 0,S)}function f2(e,t,i,r,o,n,s){let a;a=e.projection.name==="globe"?ab(i,e):[...i],Q.multiply(a,a,t.matrix);const l=Q.multiply([],r,a);if(t.meshes)for(const c of t.meshes){if(c.material.alphaMode!=="BLEND"){s.push({mesh:c,depth:0,modelIndex:o,worldViewProjection:l,nodeModelMatrix:a});continue}const u=j.transformMat4([],c.centroid,l);u[2]>0&&n.push({mesh:c,depth:u[2],modelIndex:o,worldViewProjection:l,nodeModelMatrix:a})}if(t.children)for(const c of t.children)f2(e,c,i,r,o,n,s)}function Mg(e,t,i,r){const o=i.shadowRenderer;if(!o)return;const n=o.getShadowPassDepthMode(),s=o.getShadowPassColorMode(),a=o.calculateShadowPassMatrixFromMatrix(t),l=n2(a);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,n,ve.disabled,s,we.backCCW,l,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,void 0)}function lD(e,t,i){const r=t.updateZoomBasedPaintProperties(),o=function(n,s,a){let l,c,u,p=n.terrain?n.terrain.exaggeration():0;if(n.terrain&&p>0){const f=n.terrain,g=f.findDEMTileFor(a);g&&g.dem?l=Ga.create(f,a,g):p=0}if(p===0&&(s.terrainElevationMin=0,s.terrainElevationMax=0),p===s.validForExaggeration&&(p===0||l&&l._demTile&&l._demTile.tileID===s.validForDEMTile.id&&l._dem._timestamp===s.validForDEMTile.timestamp))return!1;for(const f in s.instancesPerModel){const g=s.instancesPerModel[f];for(let _=0;_<g.instancedDataArray.length;++_){const y=(l?p*l.getElevationAt(0|g.instancedDataArray.float32[16*_],0|g.instancedDataArray.float32[16*_+1],!0,!0):0)+g.instancesEvaluatedElevation[_];g.instancedDataArray.float32[16*_+6]=y,c=c?Math.min(s.terrainElevationMin,y):y,u=u?Math.max(s.terrainElevationMax,y):y}}return s.terrainElevationMin=c||0,s.terrainElevationMax=u||0,s.validForExaggeration=p,s.validForDEMTile=l&&l._demTile?{id:l._demTile.tileID,timestamp:l._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,i);(r||o)&&(t.uploaded=!1,t.upload(e.context))}const nn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new di([0,0,0],[at,at,0])};function cD(e,t){const i=1<<e.canonical.z,r=t.getFreeCameraOptions().position,o=t.elevation,n=e.canonical.x/i,s=(e.canonical.x+1)/i,a=e.canonical.y/i,l=(e.canonical.y+1)/i;let c=t._centerAltitude;if(o){const g=o.getMinMaxForTile(e);g&&g.max>c&&(c=g.max)}const u=Ut(r.x,n,s)-r.x,p=Ut(r.y,a,l)-r.y,f=ni(c,t.center.lat)-r.z;return t._zoomFromMercatorZ(Math.sqrt(u*u+p*p+f*f))}function m2(e,t,i,r,o,n,s){const a=e.context,l=e.renderPass==="shadow",c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new ee(a.gl.LEQUAL,ee.ReadWrite,e.depthRangeFor3D),p=e.isTileAffectedByFog(n);if(i.meshes)for(const f of i.meshes){const g=["MODEL_POSITION_ON_GPU"],_=[];let y,x,b;r.instancedDataArray.length>20&&g.push("INSTANCED_ARRAYS");const T=tl(e,t.paint.get("model-cutoff-fade-range"));if(T.shouldRenderCutoff&&g.push("RENDER_CUTOFF"),l&&c)y=e.getOrCreateProgram("modelDepth",{defines:g}),x=n2(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),b=c.getShadowPassColorMode();else{Sg(g,_,f,e),y=e.getOrCreateProgram("model",{defines:g,overrideFog:p});const M=f.material,E=M.pbrMetallicRoughness,A=t.paint.get("model-opacity"),I=t.paint.get("model-emissive-strength").constantOr(0);x=Tg(n.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),e,A,E.baseColorFactor,M.emissiveFactor,E.metallicFactor,E.roughnessFactor,M,I,t,o),c&&(s.shadowUniformsInitialized?y.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(n.toUnwrapped(),y,"model-tile",n.overscaledZ),s.shadowUniformsInitialized=!0)),b=T.shouldRenderCutoff||A<1||M.alphaMode!=="OPAQUE"?Ve.alphaBlended:Ve.unblended}e.uploadCommonUniforms(a,y,n.toUnwrapped(),null,T);const S=f.material.doubleSided?we.disabled:we.backCCW;if(r.instancedDataArray.length>20)_.push(r.instancedDataBuffer),y.draw(e,a.gl.TRIANGLES,u,ve.disabled,b,S,x,t.id,f.vertexBuffer,f.indexBuffer,f.segments,t.paint,e.transform.zoom,void 0,_,r.instancedDataArray.length);else{const M=l?"u_instance":"u_normal_matrix";for(let E=0;E<r.instancedDataArray.length;++E)x[M]=new Float32Array(r.instancedDataArray.arrayBuffer,64*E,16),y.draw(e,a.gl.TRIANGLES,u,ve.disabled,b,S,x,t.id,f.vertexBuffer,f.indexBuffer,f.segments,t.paint,e.transform.zoom,void 0,_)}}if(i.children)for(const f of i.children)m2(e,t,f,r,o,n,s)}const uD=[1,-1,1];function hD(e,t,i,r){if(!i.modelManager)return!0;const o=i.modelManager;if(!i.shadowRenderer)return!0;const n=i.shadowRenderer,s=t.aabb;let a=!0,l=e.maxHeight;if(l===0){let u=0;for(const p in e.instancesPerModel){const f=o.getModel(p,r);f?u=Math.max(u,Math.max(Math.max(f.aabb.max[0],f.aabb.max[1]),f.aabb.max[2])):a=!1}l=e.maxScale*u*1.41+e.maxVerticalOffset,a&&(e.maxHeight=l)}s.max[2]=l,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,j.transformMat4(s.min,s.min,t.tileMatrix),j.transformMat4(s.max,s.max,t.tileMatrix);const c=s.intersects(n.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(e.isInsideFirstShadowMapFrustum=c===2),c===0}class dD{}class pD{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,r){{const p=this._storage.get(i.id);if(p)return p.lastUsedFrameIdx=t,p.buf}const o=r.gl,n=o.getBufferParameter(o.ELEMENT_ARRAY_BUFFER,o.BUFFER_SIZE),s=new ArrayBuffer(n),a=new Int16Array(s);o.getBufferSubData(o.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new Hn;for(let p=0;p<n/2;p+=3){const f=a[p],g=a[p+1],_=a[p+2];l.emplaceBack(f,g),l.emplaceBack(g,_),l.emplaceBack(_,f)}const c=r.bindVertexArrayOES.current,u=new dD;return u.buf=new us(r,l),u.lastUsedFrameIdx=t,this._storage.set(i.id,u),r.bindVertexArrayOES.set(c),u.buf}update(t){for(const[i,r]of this._storage)t-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(i))}destroy(){for(const[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}const g2={symbol:function(e,t,i,r,o){if(e.renderPass!=="translucent")return;const n=ve.disabled,s=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(a,l,c,u,p,f,g){const _=l.transform,y=p==="map",x=f==="map";for(const b of a){const T=u.getTile(b),S=T.getBucket(c);if(!S||!S.text||!S.text.segments.get().length)continue;const M=Qo(S.textSizeData,_.zoom),E=gg(b,S.getProjection(),_),A=_.calculatePixelsToTileUnitsMatrix(T),I=Dh(E,T.tileID.canonical,x,y,_,S.getProjection(),A),z=S.hasIconTextFit()&&S.hasIconData();if(M){const P=Math.pow(2,_.zoom-T.tileID.overscaledZ);Uk(S,y,x,g,uA,_,I,b,P,M,z)}}}(r,e,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),i.paint.get("icon-opacity").constantOr(1)!==0&&l2(e,t,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),n,s),i.paint.get("text-opacity").constantOr(1)!==0&&l2(e,t,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),n,s),t.map.showCollisionBoxes&&(s2(e,t,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),s2(e,t,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,i,r){if(e.renderPass!=="translucent")return;const o=i.paint.get("circle-opacity"),n=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),a=i.layout.get("circle-sort-key").constantOr(1)!==void 0,l=i.paint.get("circle-emissive-strength");if(o.constantOr(1)===0&&(n.constantOr(1)===0||s.constantOr(1)===0))return;const c=e.context,u=c.gl,p=e.transform,f=e.depthModeForSublayer(0,ee.ReadOnly),g=ve.disabled,_=e.colorModeForDrapableLayerRenderPass(l),y=p.projection.name==="globe",x=[Ji(p.center.lng),Qi(p.center.lat)],b=[];for(let S=0;S<r.length;S++){const M=r[S],E=t.getTile(M),A=E.getBucket(i);if(!A||A.projection.name!==p.projection.name)continue;const I=A.programConfigurations.get(i.id),z=zx(i),P=e.isTileAffectedByFog(M);y&&z.push("PROJECTION_GLOBE_VIEW");const R=e.getOrCreateProgram("circle",{config:I,defines:z,overrideFog:P}),F=A.layoutVertexBuffer,N=A.globeExtVertexBuffer,U=A.indexBuffer,O=p.projection.createInversionMatrix(p,M.canonical),Z={programConfiguration:I,program:R,layoutVertexBuffer:F,globeExtVertexBuffer:N,indexBuffer:U,uniformValues:rM(e,M,E,O,x,i),tile:E};if(a){const W=A.segments.get();for(const K of W)b.push({segments:new ti([K]),sortKey:K.sortKey,state:Z})}else b.push({segments:A.segments,sortKey:0,state:Z})}a&&b.sort((S,M)=>S.sortKey-M.sortKey);const T={useDepthForOcclusion:p.depthOcclusionForSymbolsAndCircles};for(const S of b){const{programConfiguration:M,program:E,layoutVertexBuffer:A,globeExtVertexBuffer:I,indexBuffer:z,uniformValues:P,tile:R}=S.state,F=S.segments;e.terrain&&e.terrain.setupElevationDraw(R,E,T),e.uploadCommonUniforms(c,E,R.tileID.toUnwrapped()),E.draw(e,u.TRIANGLES,f,g,_,we.disabled,P,i.id,A,z,F,i.paint,p.zoom,M,[I])}},heatmap:function(e,t,i,r){if(i.paint.get("heatmap-opacity")!==0)if(e.renderPass==="offscreen"){const o=e.context,n=o.gl,s=ve.disabled,a=new Ve([n.ONE,n.ONE,n.ONE,n.ONE],xe.transparent,[!0,!0,!0,!0]);(function(g,_,y,x){const b=g.gl,T=_.width*x,S=_.height*x;g.activeTexture.set(b.TEXTURE1),g.viewport.set([0,0,T,S]);let M=y.heatmapFbo;if(!M||M&&(M.width!==T||M.height!==S)){M&&M.destroy();const E=b.createTexture();b.bindTexture(b.TEXTURE_2D,E),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),M=y.heatmapFbo=g.createFramebuffer(T,S,!0,null),function(A,I,z,P,R,F){const N=A.gl;N.texImage2D(N.TEXTURE_2D,0,A.extRenderToTextureHalfFloat?N.RGBA16F:N.RGBA,R,F,0,N.RGBA,A.extRenderToTextureHalfFloat?N.HALF_FLOAT:N.UNSIGNED_BYTE,null),P.colorAttachment.set(z)}(g,0,E,M,T,S)}else b.bindTexture(b.TEXTURE_2D,M.colorAttachment.get()),g.bindFramebuffer.set(M.framebuffer)})(o,e,i,e.transform.projection.name==="globe"?.5:.25),o.clear({color:xe.transparent});const l=e.transform,c=l.projection.name==="globe",u=c?["PROJECTION_GLOBE_VIEW"]:[],p=c?we.frontCCW:we.disabled,f=[Ji(l.center.lng),Qi(l.center.lat)];for(let g=0;g<r.length;g++){const _=r[g];if(t.hasRenderableParent(_))continue;const y=t.getTile(_),x=y.getBucket(i);if(!x||x.projection.name!==l.projection.name)continue;const b=e.isTileAffectedByFog(_),T=x.programConfigurations.get(i.id),S=e.getOrCreateProgram("heatmap",{config:T,defines:u,overrideFog:b}),{zoom:M}=e.transform;e.terrain&&e.terrain.setupElevationDraw(y,S),e.uploadCommonUniforms(o,S,_.toUnwrapped());const E=l.projection.createInversionMatrix(l,_.canonical);S.draw(e,n.TRIANGLES,ee.disabled,s,a,p,Pk(e,_,y,E,f,M,i.paint.get("heatmap-intensity")),i.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,i.paint,e.transform.zoom,T,c?[x.globeExtVertexBuffer]:null)}o.viewport.set([0,0,e.width,e.height])}else e.renderPass==="translucent"&&(e.context.setColorMode(e.colorModeForRenderPass()),function(o,n){const s=o.context,a=s.gl,l=n.heatmapFbo;if(!l)return;s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l.colorAttachment.get()),s.activeTexture.set(a.TEXTURE1);let c=n.colorRampTexture;c||(c=n.colorRampTexture=new Mi(s,n.colorRamp,a.RGBA)),c.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.getOrCreateProgram("heatmapTexture").draw(o,a.TRIANGLES,ee.disabled,ve.disabled,o.colorModeForRenderPass(),we.disabled,((u,p,f,g)=>({u_image:0,u_color_ramp:1,u_opacity:p.paint.get("heatmap-opacity")}))(0,n),n.id,o.viewportBuffer,o.quadTriangleIndexBuffer,o.viewportSegments,n.paint,o.transform.zoom)}(e,i))},line:function(e,t,i,r){if(e.renderPass!=="translucent")return;const o=i.paint.get("line-opacity"),n=i.paint.get("line-width");if(o.constantOr(1)===0||n.constantOr(1)===0)return;const s=i.paint.get("line-emissive-strength"),a=e.depthModeForSublayer(0,ee.ReadOnly),l=e.colorModeForDrapableLayerRenderPass(s),c=e.terrain&&e.terrain.renderingToTexture?1:ce.devicePixelRatio,u=i.paint.get("line-dasharray"),p=u.constantOr(1),f=i.layout.get("line-cap"),g=i.paint.get("line-pattern"),_=g.constantOr(1),y=i.paint.get("line-pattern").constantOr(1),x=i.paint.get("line-opacity").constantOr(1)!==1;let b=!y&&x;const T=i.paint.get("line-gradient"),S=_?"linePattern":"line",M=e.context,E=M.gl,A=Nb(i);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(b=!1);for(const I of r){const z=t.getTile(I);if(_&&!z.patternsLoaded())continue;const P=z.getBucket(i);if(!P)continue;e.prepareDrawTile();const R=P.programConfigurations.get(i.id),F=e.isTileAffectedByFog(I),N=e.getOrCreateProgram(S,{config:R,defines:A,overrideFog:F}),U=g.constantOr(null);if(U&&z.imageAtlas){const ot=z.imageAtlas.patternPositions[U.toString()];ot&&R.setConstantPatternPositions(ot)}const O=u.constantOr(null),Z=f.constantOr(null);if(!_&&O&&Z&&z.lineAtlas){const ot=z.lineAtlas.getDash(O,Z);ot&&R.setConstantPatternPositions(ot)}let[W,K]=i.paint.get("line-trim-offset");(Z==="round"||Z==="square")&&W!==K&&(W===0&&(W-=1),K===1&&(K+=1));const $=e.terrain?I.projMatrix:null,H=_?cI(e,z,i,$,c):lI(e,z,i,$,P.lineClipsArray.length,c,[W,K]);if(T){const ot=P.gradients[i.id];let rt=ot.texture;if(i.gradientVersion!==ot.version){let lt=256;if(i.stepInterpolant){const ut=t.getSource().maxzoom,pt=I.canonical.z===ut?Math.ceil(1<<e.transform.maxZoom-I.canonical.z):1;lt=Ut(Yc(P.maxLineLength/at*1024*pt),256,M.maxTextureSize)}ot.gradient=Ju({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:lt,image:ot.gradient||void 0,clips:P.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new Mi(M,ot.gradient,E.RGBA),ot.version=i.gradientVersion,rt=ot.texture}M.activeTexture.set(E.TEXTURE1),rt.bind(i.stepInterpolant?E.NEAREST:E.LINEAR,E.CLAMP_TO_EDGE)}p&&(M.activeTexture.set(E.TEXTURE0),z.lineAtlasTexture&&z.lineAtlasTexture.bind(E.LINEAR,E.REPEAT),R.updatePaintBuffers()),_&&(M.activeTexture.set(E.TEXTURE0),z.imageAtlasTexture&&z.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.updatePaintBuffers()),e.uploadCommonUniforms(M,N,I.toUnwrapped());const it=ot=>{N.draw(e,E.TRIANGLES,a,ot,l,we.disabled,H,i.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,i.paint,e.transform.zoom,R,[P.layoutVertexBuffer2])};if(b){const ot=e.stencilModeForClipping(I).ref;ot===0&&e.terrain&&M.clear({stencil:0});const rt={func:E.EQUAL,mask:255};H.u_alpha_discard_threshold=.8,it(new ve(rt,ot,255,E.KEEP,E.KEEP,E.INVERT)),H.u_alpha_discard_threshold=0,it(new ve(rt,ot,255,E.KEEP,E.KEEP,E.KEEP))}else it(e.stencilModeForClipping(I))}b&&(e.resetStencilClippingMasks(),e.terrain&&M.clear({stencil:0}))},fill:function(e,t,i,r){const o=i.paint.get("fill-color"),n=i.paint.get("fill-opacity");if(n.constantOr(1)===0)return;const s=i.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(s),l=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&o.constantOr(xe.transparent).a===1&&n.constantOr(0)===1?"opaque":"translucent";if(e.renderPass===c){const u=e.depthModeForSublayer(1,e.renderPass==="opaque"?ee.ReadWrite:ee.ReadOnly);c2(e,t,i,r,u,a,!1)}if(e.renderPass==="translucent"&&i.paint.get("fill-antialias")){const u=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,ee.ReadOnly);c2(e,t,i,r,u,a,!0)}},"fill-extrusion":function(e,t,i,r){const o=i.paint.get("fill-extrusion-opacity"),n=e.context,s=n.gl,a=e.terrain,l=a&&a.renderingToTexture,c=i.paint.get("fill-extrusion-cutoff-fade-range");if(o===0)return;const u=e.conflationActive&&e.layerUsedInConflation(i,t.getSource());if(u&&function(p,f,g,_){for(const y of _){const x=f.getTile(y).getBucket(g);x&&(x.updateReplacement(y,p.replacementSource),x.uploadCentroid(p.context))}}(e,t,i,r),a||u)for(const p of r){const f=t.getTile(p).getBucket(i);f&&qk(e.context,t,p,f,i,a,u)}if(e.renderPass==="shadow"&&e.shadowRenderer){const p=e.shadowRenderer;if(a&&o<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Gn)return;const f=p.getShadowPassDepthMode(),g=p.getShadowPassColorMode();Kh(e,t,i,r,f,ve.disabled,g,u)}else if(e.renderPass==="translucent"){const p=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const f=new ee(e.context.gl.LEQUAL,ee.ReadWrite,e.depthRangeFor3D);c===0&&o===1&&p?Kh(e,t,i,r,f,ve.disabled,Ve.unblended,u):(Kh(e,t,i,r,f,ve.disabled,Ve.disabled,u),Kh(e,t,i,r,f,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&p&&(!a&&e.transform.projection.name!=="globe"||l)){const f=i.paint.get("fill-extrusion-opacity"),g=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),_=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),y=i.paint.get("fill-extrusion-flood-light-intensity"),x=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),b=g>0&&_>0,T=y>0,S=(E,A,I)=>(1-I)*E+I*A,M=E=>{const A=e.depthModeForSublayer(1,ee.ReadOnly,s.LEQUAL,!0),I=i.paint.get(E?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),z=S(.1,3,I),P=e._showOverdrawInspector;if(!P){const R=new ve({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),F=new Ve([s.ONE,s.ONE,s.ONE,s.ONE],xe.transparent,[!1,!1,!1,!0],s.MIN);il(e,t,i,r,A,R,F,we.disabled,E,"sdf",f,g,_,y,x,z,u,!1)}{const R=P?ve.disabled:new ve({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),F=P?e.colorModeForRenderPass():new Ve([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],xe.transparent,[!0,!0,!0,!0]);il(e,t,i,r,A,R,F,we.disabled,E,"color",f,g,_,y,x,z,u,!1)}};if(l){const E=(A,I,z)=>{const P=e.depthModeForSublayer(1,ee.ReadOnly,s.LEQUAL,!1),R=i.paint.get(A?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),F=S(.1,3,R);{const N=new Ve([s.ONE,s.ONE,s.ONE,s.ONE],xe.transparent,[!1,!1,!1,!0]);il(e,t,i,r,P,ve.disabled,N,we.disabled,A,"clear",f,g,_,y,x,F,u,I)}{const N=new ve({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),U=new Ve([s.ONE,s.ONE,s.ONE,s.ONE],xe.transparent,[!1,!1,!1,!0],s.MIN);il(e,t,i,r,P,N,U,we.disabled,A,"sdf",f,g,_,y,x,F,u,I)}{const N=A?s.ZERO:s.ONE_MINUS_DST_ALPHA,U=new ve({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),O=new Ve([N,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],xe.transparent,[!0,!0,!0,!0]);il(e,t,i,r,P,U,O,we.disabled,A,"color",f,g,_,y,x,F,u,I)}{const N=new Ve([s.ONE,s.ONE,s.ONE,A?s.ZERO:s.ONE],xe.transparent,[!1,!1,!1,!0],A?s.FUNC_ADD:s.MAX);il(e,t,i,r,P,ve.disabled,N,we.disabled,A,"clear",f,g,_,y,x,F,u,I,z)}};if(b||T){let A;if(e.prepareDrawTile(),a){const I=a.drapeBufferSize[0],z=a.drapeBufferSize[1];A=a.framebufferCopyTexture,A&&(!A||A.size[0]===I&&A.size[1]===z)||(A&&A.destroy(),A=a.framebufferCopyTexture=new Mi(n,new Ui({width:I,height:z}),s.RGBA)),A.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,I,z,0)}b&&E(!0,!1,A),T&&E(!1,!0,A)}}else b&&M(!0),T&&M(!1)}}},hillshade:function(e,t,i,r){if(e.renderPass!=="offscreen"&&e.renderPass!=="translucent"||e.style.disableElevatedTerrain)return;const o=e.context,n=e.terrain&&e.terrain.renderingToTexture,[s,a]=e.renderPass!=="translucent"||n?[{},r]:e.stencilConfigForOverlap(r);for(const l of a){const c=t.getTile(l);if(c.needsHillshadePrepare&&e.renderPass==="offscreen")yk(e,c,i);else if(e.renderPass==="translucent"){const u=e.depthModeForSublayer(0,ee.ReadOnly),p=i.paint.get("hillshade-emissive-strength"),f=e.colorModeForDrapableLayerRenderPass(p),g=n&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):s[l.overscaledZ];_k(e,l,c,i,u,g,f)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,i,r,o,n){if(e.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const s=e.context,a=s.gl,l=t.getSource(),c=function(I,z,P){const R=I.paint.get("raster-color"),F=[],N=I.paint.get("raster-resampling"),U=I.paint.get("raster-color-mix"),O=I.paint.get("raster-color-range"),Z=[U[0],U[1],U[2],0],W=U[3],K=N==="nearest"?P.NEAREST:P.LINEAR;if(R&&F.push("RASTER_COLOR"),R){z.activeTexture.set(P.TEXTURE2);let $=I.colorRampTexture;$||($=I.colorRampTexture=new Mi(z,I.colorRamp,P.RGBA)),$.bind(P.LINEAR,P.CLAMP_TO_EDGE)}return{mix:Z,range:O,offset:W,defines:F,resampling:K}}(i,s,a),u=c.defines,p=e.transform.projection.name==="globe";let f=!1;if(l instanceof Ao&&!r.length){if(!p)return;if(l.onNorthPole)f=!0,u.push("GLOBE_POLES");else{if(!l.onSouthPole)return;f=!0,u.push("GLOBE_POLES")}}const g=i.paint.get("raster-emissive-strength"),_=e.colorModeForDrapableLayerRenderPass(g),y=e.terrain&&e.terrain.renderingToTexture,x=l instanceof Ao&&i.paint.get("raster-elevation")!==0,b=!e.options.moving,T=i.paint.get("raster-resampling")==="nearest"?a.NEAREST:a.LINEAR;if(f){const I=t.getSource();if(!(I instanceof Ao))return;const z=I.texture;if(!z)return;const P=e.globeSharedBuffers;if(!P)return;const R=new ee(a.LEQUAL,ee.ReadWrite,e.depthRangeFor3D),F=Float32Array.from(e.transform.expandedFarZProjMatrix);let N=mx(0,0,e.transform);const U=Float32Array.from(Qn(lo(new To(0,0,0)))),O={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),z.bind(T,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),z.bind(T,a.CLAMP_TO_EDGE),z.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[Z,W,K,$]=P.getPoleBuffers(0,!0);let H;I.onNorthPole?(H=Z,e.renderDefaultNorthPole=!1):(N=Q.scale(Q.create(),N,[1,-1,1]),H=W,e.renderDefaultSouthPole=!1);const it=((rt,lt,ut,pt,nt,mt,It,kt,Rt,Ot,oe,$t)=>t2(rt,lt,ut,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,pt,nt,mt||[0,0],It,2,Rt,Ot,oe,1,0,$t))(F,U,N,O,i,I.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,c.mix,c.offset,c.range,g),ot=e.getOrCreateProgram("raster",{defines:c.defines});return e.uploadCommonUniforms(s,ot,null),void ot.draw(e,a.TRIANGLES,R,ve.disabled,_,we.disabled,it,i.id,H,K,$)}if(!r.length)return;const[S,M]=l instanceof Ao||y?[{},r]:e.stencilConfigForOverlap(r),E=M[M.length-1].overscaledZ,A=x&&p;A&&c.defines.push("PROJECTION_GLOBE_VIEW"),x&&c.defines.push("RENDER_CUTOFF");for(const I of M){const z=I.toUnwrapped(),P=t.getTile(I);if(y&&(!P||!P.hasData())||!P.texture)continue;let R,F;y?(R=ee.disabled,F=I.projMatrix):x?(R=new ee(a.LEQUAL,ee.ReadWrite,e.depthRangeFor3D),F=p?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(z,b)):(R=e.depthModeForSublayer(I.overscaledZ-E,i.paint.get("raster-opacity")===1?ee.ReadWrite:ee.ReadOnly,a.LESS),F=e.transform.calculateProjMatrix(z,b));const N=e.terrain&&y?e.terrain.stencilModeForRTTOverlap(I):S[I.overscaledZ],U=n?0:i.paint.get("raster-fade-duration");P.registerFadeDuration(U);const O=t.findLoadedParent(I,0),Z=Zw(P,O,t,e.transform,U);let W,K;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),P.texture&&P.texture.bind(T,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),O?(O.texture&&O.texture.bind(T,a.CLAMP_TO_EDGE),W=Math.pow(2,O.tileID.overscaledZ-P.tileID.overscaledZ),K=[P.tileID.canonical.x*W%1,P.tileID.canonical.y*W%1]):P.texture&&P.texture.bind(T,a.CLAMP_TO_EDGE),P.texture&&P.texture.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const $=e.transform,H=l instanceof Ao?l.perspectiveTransform:[0,0],it=x?Xk($):[0,0,0,0];let ot,rt,lt,ut,pt,nt;if(A&&l instanceof Ao&&l.coordinates.length>3){ot=Float32Array.from(Qn(lo(new To(0,0,0)))),rt=Float32Array.from($.globeMatrix),lt=Float32Array.from(fx($)),ut=[Ji($.center.lng),Qi($.center.lat)],nt=[Ji(l.coordinates[1][0]),Qi(l.coordinates[1][1]),Ji(l.coordinates[3][0]),Qi(l.coordinates[3][1])];const Rt=new Wr(l.coordinates[1],l.coordinates[3]);pt=Float32Array.from(_x(new To(0,0,0),Rt,0,$.worldSize/e.transform._pixelsPerMercatorPixel))}else ot=new Float32Array(16),rt=new Float32Array(9),lt=new Float32Array(16),ut=[0,0],pt=new Float32Array(16),nt=[0,0,0,0];const mt=t2(F,ot,rt,lt,pt,K||[0,0],nt,ar(e.transform.zoom),ut,it,W||1,Z,i,H,x?i.paint.get("raster-elevation"):0,2,c.mix,c.offset,c.range,1,0,g),It=e.isTileAffectedByFog(I),kt=e.getOrCreateProgram("raster",{defines:c.defines,overrideFog:It});if(e.uploadCommonUniforms(s,kt,z),l instanceof Ao){if(y||!p)l.boundsBuffer&&l.boundsSegments&&kt.draw(e,a.TRIANGLES,R,ve.disabled,_,we.disabled,mt,i.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else if(e.globeSharedBuffers){const[Rt,Ot,oe]=e.globeSharedBuffers.getGridBuffers(0,!1);kt.draw(e,a.TRIANGLES,R,ve.disabled,_,we.frontCCW,mt,i.id,Rt,Ot,oe),kt.draw(e,a.TRIANGLES,R,ve.disabled,_,we.backCCW,mt,i.id,Rt,Ot,oe)}}else{const{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Ot,tileBoundsSegments:oe}=e.getTileBoundsBuffers(P);kt.draw(e,a.TRIANGLES,R,N,_,we.disabled,mt,i.id,Rt,Ot,oe)}}e.resetStencilClippingMasks()},background:function(e,t,i,r){const o=i.paint.get("background-color"),n=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(n===0)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,p=i.paint.get("background-pattern");if(e.isPatternMissing(p,i.scope))return;const f=!p&&o.a===1&&n===1&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const g=ve.disabled,_=e.depthModeForSublayer(0,f==="opaque"?ee.ReadWrite:ee.ReadOnly),y=e.colorModeForDrapableLayerRenderPass(s),x=p?"backgroundPattern":"background";let b,T=r;T||(b=e.getBackgroundTiles(),T=Object.values(b).map(S=>S.tileID)),p&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(const S of T){const M=e.isTileAffectedByFog(S),E=e.getOrCreateProgram(x,{overrideFog:M}),A=S.toUnwrapped(),I=r?S.projMatrix:e.transform.calculateProjMatrix(A);e.prepareDrawTile();const z=t?t.getTile(S):b?b[S.key]:new ac(S,u,c.zoom,e),P=p?Nk(I,s,n,e,p,i.scope,{tileID:S,tileSize:u}):Fk(I,s,n,o);e.uploadCommonUniforms(a,E,A);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:F,tileBoundsSegments:N}=e.getTileBoundsBuffers(z);E.draw(e,l.TRIANGLES,_,g,y,we.disabled,P,i.id,R,F,N)}},sky:function(e,t,i){const r=e._atmosphere?ar(e.transform.zoom):1,o=i.paint.get("sky-opacity")*r;if(o===0)return;const n=e.context,s=i.paint.get("sky-type"),a=new ee(n.gl.LEQUAL,ee.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;s==="atmosphere"?e.renderPass==="offscreen"?i.needsSkyboxCapture(e)&&(function(c,u,p,f){const g=c.context,_=g.gl;let y=u.skyboxFbo;if(!y){y=u.skyboxFbo=g.createFramebuffer(32,32,!0,null),u.skyboxGeometry=new d2(g),u.skyboxTexture=g.gl.createTexture(),_.bindTexture(_.TEXTURE_CUBE_MAP,u.skyboxTexture),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAG_FILTER,_.LINEAR);for(let S=0;S<6;++S)_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,_.RGBA,32,32,0,_.RGBA,_.UNSIGNED_BYTE,null)}g.bindFramebuffer.set(y.framebuffer),g.viewport.set([0,0,32,32]);const x=u.getCenter(c,!0),b=c.getOrCreateProgram("skyboxCapture"),T=new Float64Array(16);Q.identity(T),Q.rotateY(T,T,.5*-Math.PI),rl(c,u,b,T,x,0),Q.identity(T),Q.rotateY(T,T,.5*Math.PI),rl(c,u,b,T,x,1),Q.identity(T),Q.rotateX(T,T,.5*-Math.PI),rl(c,u,b,T,x,2),Q.identity(T),Q.rotateX(T,T,.5*Math.PI),rl(c,u,b,T,x,3),Q.identity(T),rl(c,u,b,T,x,4),Q.identity(T),Q.rotateY(T,T,Math.PI),rl(c,u,b,T,x,5),g.viewport.set([0,0,c.width,c.height])}(e,i),i.markSkyboxValid(e)):e.renderPass==="sky"&&function(c,u,p,f,g){const _=c.context,y=_.gl,x=c.transform,b=c.getOrCreateProgram("skybox");_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_CUBE_MAP,u.skyboxTexture);const T=((S,M,E,A,I)=>({u_matrix:S,u_sun_direction:M,u_cubemap:0,u_opacity:A,u_temporal_offset:I}))(x.skyboxMatrix,u.getCenter(c,!1),0,f,g);c.uploadCommonUniforms(_,b),b.draw(c,y.TRIANGLES,p,ve.disabled,c.colorModeForRenderPass(),we.backCW,T,"skybox",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}(e,i,a,o,l):s==="gradient"&&e.renderPass==="sky"&&function(c,u,p,f,g){const _=c.context,y=_.gl,x=c.transform,b=c.getOrCreateProgram("skyboxGradient");u.skyboxGeometry||(u.skyboxGeometry=new d2(_)),_.activeTexture.set(y.TEXTURE0);let T=u.colorRampTexture;T||(T=u.colorRampTexture=new Mi(_,u.colorRamp,y.RGBA)),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const S=((M,E,A,I,z)=>({u_matrix:M,u_color_ramp:0,u_center_direction:E,u_radius:Ft(A),u_opacity:I,u_temporal_offset:z}))(x.skyboxMatrix,u.getCenter(c,!1),u.paint.get("sky-gradient-radius"),f,g);c.uploadCommonUniforms(_,b),b.draw(c,y.TRIANGLES,p,ve.disabled,c.colorModeForRenderPass(),we.backCW,S,"skyboxGradient",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}(e,i,a,o,l)},debug:function(e,t,i){for(let r=0;r<i.length;r++)eD(e,t,i[r])},custom:function(e,t,i,r){const o=e.context,n=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||e.renderPass==="offscreen")&&i.isLayerDraped(t)){if(e.renderPass==="offscreen"){const s=n.prerender;if(s){if(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),e.transform.projection.name==="globe"){const a=e.transform.pointMerc;s.call(n,o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ar(e.transform.zoom),[a.x,a.y],e.transform.pixelsPerMeterRatio)}else s.call(n,o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState()}}else if(e.renderPass==="translucent"){if(e.terrain&&e.terrain.renderingToTexture){const a=n.renderToTile;if(a){const l=r[0].canonical,c=new De(l.x+r[0].wrap*(1<<l.z),l.y,l.z);o.setDepthMode(ee.disabled),o.setStencilMode(ve.disabled),o.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),a.call(n,o.gl,c),o.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(ve.disabled);const s=n.renderingMode==="3d"?new ee(e.context.gl.LEQUAL,ee.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,ee.ReadOnly);if(o.setDepthMode(s),e.transform.projection.name==="globe"){const a=e.transform.pointMerc;n.render(o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ar(e.transform.zoom),[a.x,a.y],e.transform.pixelsPerMeterRatio)}else n.render(o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}else Y("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,i,r){if(e.renderPass==="opaque")return;const o=i.paint.get("model-opacity");if(o===0)return;const n=i.paint.get("model-cast-shadows");if(e.renderPass==="shadow"&&(!n||e.terrain&&o<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof Gn))return;const s=e.shadowRenderer,a=i.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,a||(s.enabled=!1));const l=()=>{s&&(s.useNormalOffset=!0,a||(s.enabled=!0))},c=t.getSource();if(e.renderPass==="light-beam"&&c.type!=="batched-model")return;if(c.type==="vector"||c.type==="geojson")return function(b,T,S,M){const E=b.transform;if(E.projection.name!=="mercator")return void Y(`Drawing 3D models for ${E.projection.name} projection is not yet implemented`);const A=E.getFreeCameraOptions().position;if(!b.modelManager)return;const I=b.modelManager,z=b.shadowRenderer;if(!S._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const P=S._unevaluatedLayout._values["model-id"],R={...S.layout.get("model-id").parameters};for(const F of M){const N=T.getTile(F).getBucket(S);if(!N||N.projection.name!==E.projection.name)continue;const U=cD(F,E);R.zoom=U;const O=P.possiblyEvaluate(R);if(lD(b,N,F),nn.shadowUniformsInitialized=!1,nn.useSingleShadowCascade=!!z&&z.getMaxCascadeForTile(F.toUnwrapped())===0,b.renderPass==="shadow"&&z){if(b.currentShadowCascade===1&&N.isInsideFirstShadowMapFrustum)continue;const K=E.calculatePosMatrix(F.toUnwrapped(),E.worldSize);if(nn.tileMatrix.set(K),nn.shadowTileMatrix=Float32Array.from(z.calculateShadowPassMatrixFromMatrix(K)),nn.aabb.min.fill(0),nn.aabb.max[0]=nn.aabb.max[1]=at,nn.aabb.max[2]=0,hD(N,nn,b,S.scope))continue}const Z=1<<F.canonical.z,W=[((A.x-F.wrap)*Z-F.canonical.x)*at,(A.y*Z-F.canonical.y)*at,A.z*Z*at];for(let K in N.instancesPerModel){const $=N.instancesPerModel[K];$.features.length>0&&(K=O.evaluate($.features[0].feature,{}));const H=I.getModel(K,S.scope);if(H&&H.uploaded)for(const it of H.nodes)m2(b,S,it,$,W,F,nn)}}}(e,t,i,r),void l();if(!c.loaded())return;if(c.type==="batched-model")return function(b,T,S,M){const E=b.context,A=b.transform,I=b.style.fog,z=b.shadowRenderer;if(A.projection.name!=="mercator")return void Y(`Drawing 3D landmark models for ${A.projection.name} projection is not yet implemented`);const P=b.transform.getFreeCameraOptions().position,R=j.scale([],[P.x,P.y,P.z],b.transform.worldSize);j.negate(R,R);const F=Q.identity([]),N=es(A.center.lat,A.zoom),U=Q.fromScaling([],[1,1,1/N]);Q.translate(F,F,R);const O=S.paint.get("model-opacity"),Z=new ee(E.gl.LEQUAL,ee.ReadWrite,b.depthRangeFor3D),W=new ee(E.gl.LEQUAL,ee.ReadOnly,b.depthRangeFor3D),K=function($,H){for(const it of M){const ot=T.getTile(it).getBucket(S);if(!ot||!ot.uploaded)continue;let rt=!1;z&&(rt=z.getMaxCascadeForTile(it.toUnwrapped())===0);const lt=A.calculatePosMatrix(it.toUnwrapped(),A.worldSize),ut=ot.modelTraits;for(const pt of ot.getNodesInfo()){if(pt.hiddenByReplacement||!pt.node.meshes)continue;const nt=pt.node,mt=b.renderPass==="light-beam",It=[...lt],kt=pt.evaluatedScale;let Rt=0;b.terrain&&nt.elevation&&(Rt=nt.elevation*b.terrain.exaggeration()),Q.translate(It,It,[(nt.anchor?nt.anchor[0]:0)*(kt[0]-1),(nt.anchor?nt.anchor[1]:0)*(kt[1]-1),Rt]),kt!==UC&&Q.scale(It,It,kt),Q.multiply(It,It,nt.matrix);const Ot=Q.multiply([],U,It);Q.multiply(Ot,F,Ot);const oe=Q.invert([],Ot);Q.transpose(oe,oe),Q.scale(oe,oe,uD);const $t=Q.multiply([],A.expandedFarZProjMatrix,It);for(let Fe=0;Fe<nt.meshes.length;++Fe){const Ae=nt.meshes[Fe],ie=Fe===nt.lightMeshIndex;if(ie){if(!mt&&!b.terrain&&b.shadowRenderer){b.currentLayer<b.firstLightBeamLayer&&(b.firstLightBeamLayer=b.currentLayer);continue}}else if(mt)continue;const te={defines:[]},Xt=[];Sg(te.defines,Xt,Ae,b),4&ut||te.defines.push("DIFFUSE_SHADED"),rt&&te.defines.push("SHADOWS_SINGLE_CASCADE");const Ie=b.renderPass==="shadow";if(Ie){Mg(Ae,It,b,S);continue}let Re=null;if(I){const ji=p2(It,b.transform);if(Re=new Float32Array(ji),A.projection.name!=="globe"){const Fi=Ae.aabb.min,_i=Ae.aabb.max,[Je,hr]=I.getOpacityForBounds(ji,Fi[0],Fi[1],_i[0],_i[1]);te.overrideFog=Je>=qs||hr>=qs}}const ye=b.getOrCreateProgram("model",te);!Ie&&z&&(z.useNormalOffset=!!Ae.normalBuffer,z.setupShadowsFromMatrix(It,ye,z.useNormalOffset)),b.uploadCommonUniforms(E,ye,it.toUnwrapped(),Re);const si=Ae.material,Bi=si.pbrMetallicRoughness;Bi.metallicFactor=.9,Bi.roughnessFactor=.5;const ii=0,pi=Tg(new Float32Array($t),new Float32Array(Ot),new Float32Array(oe),b,O,Bi.baseColorFactor,si.emissiveFactor,Bi.metallicFactor,Bi.roughnessFactor,si,ii,S);ye.draw(b,E.gl.TRIANGLES,H&&!ie?Z:W,ve.disabled,$?ie||O<1||pt.hasTranslucentParts?Ve.alphaBlended:Ve.unblended:Ve.disabled,we.backCCW,pi,S.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.segments,S.paint,b.transform.zoom,void 0,Xt)}}}};(function($,H,it,ot){const rt=$.terrain?$.terrain.exaggeration():0,lt=$.transform.zoom;for(const ut of ot){const pt=H.getTile(ut).getBucket(it);pt&&($.conflationActive&&pt.updateReplacement(ut,$.replacementSource),pt.evaluateScale($,it),$.terrain&&rt>0&&pt.elevationUpdate($.terrain,rt,ut,it.source),pt.needsReEvaluation($,lt,it)&&pt.evaluate(it))}})(b,T,S,M),O===1?K(!0,!0):(K(!1,!0),K(!0,!1))}(e,t,i,r),void l();const u=c.getModels(),p=[],f=e.transform.getFreeCameraOptions().position,g=j.scale([],[f.x,f.y,f.z],e.transform.worldSize);j.negate(g,g);const _=[],y=[];let x=0;for(const b of u){const T=i.paint.get("model-rotation").constantOr(null),S=i.paint.get("model-scale").constantOr(null),M=i.paint.get("model-translation").constantOr(null);b.computeModelMatrix(e,T,S,M,!0,!0,!1);const E=Q.identity([]),A=es(b.position.lat,e.transform.zoom),I=Q.fromScaling([],[1,1,1/A]);Q.translate(E,E,g),p.push({zScaleMatrix:I,negCameraPosMatrix:E});for(const z of b.nodes)f2(e.transform,z,b.matrix,e.transform.expandedFarZProjMatrix,x,_,y);x++}if(_.sort((b,T)=>T.depth-b.depth),e.renderPass!=="shadow"){if(o===1)for(const b of y)td(b,e,i,p[b.modelIndex],ve.disabled,e.colorModeForRenderPass());else{for(const b of y)td(b,e,i,p[b.modelIndex],ve.disabled,Ve.disabled);for(const b of y)td(b,e,i,p[b.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const b of _)td(b,e,i,p[b.modelIndex],ve.disabled,e.colorModeForRenderPass());l()}else{for(const b of y)Mg(b.mesh,b.nodeModelMatrix,e,i);for(const b of _)Mg(b.mesh,b.nodeModelMatrix,e,i);l()}}},_2={modelUpload:function(e,t,i){const r=t.getSource();if(!r.loaded())return;if(r.type==="vector"||r.type==="geojson")return void(e.modelManager&&e.modelManager.upload(e,i));if(r.type==="batched-model")return;const o=r.getModels();for(const n of o)n.upload(e.context)}};class fD{constructor(t,i,r){this.context=new DC(t,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=No.maxUnderzooming+No.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new WC,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _D(this),this._wireframeDebugCache=new pD,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,i){const r=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wk(this,t));const o=this._terrain;this.transform.elevation=r?o:null,o.update(t,this.transform,i),this.transform.elevation&&!o.enabled&&(this.transform.elevation=null)}_updateFog(t){const i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,o]=i.getFovAdjustedRange(this.transform._fov);if(r>o)return void(this.transform.fogCullDistSq=null);const n=r+.78*(o-r);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*ce.devicePixelRatio,this.height=i*ce.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style.order)this.style._mergedLayers[r].resize()}setup(){const t=this.context,i=new Zr;i.emplaceBack(0,0),i.emplaceBack(at,0),i.emplaceBack(0,at),i.emplaceBack(at,at),this.tileExtentBuffer=t.createVertexBuffer(i,Jn.members),this.tileExtentSegments=ti.simpleSegment(0,0,4,2);const r=new Zr;r.emplaceBack(0,0),r.emplaceBack(at,0),r.emplaceBack(0,at),r.emplaceBack(at,at),this.debugBuffer=t.createVertexBuffer(r,Jn.members),this.debugSegments=ti.simpleSegment(0,0,4,5);const o=new Zr;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(-1,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,Jn.members),this.viewportSegments=ti.simpleSegment(0,0,4,2);const n=new Ps;n.emplaceBack(0,0,0,0),n.emplaceBack(at,0,at,0),n.emplaceBack(0,at,0,at),n.emplaceBack(at,at,at,at),this.mercatorBoundsBuffer=t.createVertexBuffer(n,Vm.members),this.mercatorBoundsSegments=ti.simpleSegment(0,0,4,2);const s=new Zi;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new Nl;for(const c of[0,1,3,2,0])a.emplaceBack(c);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new Mi(t,new Ui({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=Q.create();const l=this.context.gl;this.stencilClearMode=new ve({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(k.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ee.disabled,this.stencilClearMode,Ve.disabled,we.disabled,wg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,r){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!r||r.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let a=!1;for(const l of r)if(this._tileClippingMaskIDs[l.key]===void 0){a=!0;break}if(!a)return}this.currentStencilSource=i.id;const o=this.context,n=o.gl;this.nextStencilID+r.length>256&&this.clearStencil(),o.setColorMode(Ve.disabled),o.setDepthMode(ee.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of r){const l=i.getTile(a),c=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:u,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=this.getTileBoundsBuffers(l);s.draw(this,n.TRIANGLES,ee.disabled,new ve({func:n.ALWAYS,mask:0},c,255,n.KEEP,n.KEEP,n.REPLACE),Ve.disabled,we.disabled,wg(a.projMatrix),"$clipping",u,p,f)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new ve({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new ve({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,r=t.sort((s,a)=>a.overscaledZ-s.overscaledZ),o=r[r.length-1].overscaledZ,n=r[0].overscaledZ-o+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const s={};for(let a=0;a<n;a++)s[a+o]=new ve({func:i.GEQUAL,mask:255},a+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=n,[s,r]}return[{[o]:ve.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ve([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new xe(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ve.unblended:Ve.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ve([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new xe(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,r,o=!1){if(!this.opaquePassEnabledForLayer()&&!o)return ee.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ee(r||this.context.gl.LEQUAL,i,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=i;const r=this.style._mergedLayers,o=this.style.order,n=o.map(E=>r[E]),s=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(ce.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const E in s){const A=s[E];A.used&&(A.prepare(this.context),A.getSource().usedInConflation&&++a)}const c={},u={},p={},f={},g={};for(const E in s){const A=s[E];c[E]=A.getVisibleCoordinates(),u[E]=c[E].slice().reverse(),p[E]=A.getVisibleCoordinates(!0).reverse(),f[E]=A.getShadowCasterCoordinates(),g[E]=A.sortCoordinatesByDistance(c[E])}const _=E=>{const A=this.style.getLayerSourceCache(E);return A&&A.used?A.getSource():null};if(a){const E=[];for(const A of n)this.layerUsedInConflation(A,_(A))&&E.push(A);if(E&&E.length>1){const A=[];for(const I of E){const z=this.style.getLayerSourceCache(I);z&&z.used&&z.getSource().usedInConflation&&A.push({layer:I.fqid,cache:z})}this.replacementSource.setSources(A),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const E of n){const A=E.cutoffRange();if(this.longestCutoffRange=Math.max(A,this.longestCutoffRange),A>0){const I=_(E);I&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom)),E.minzoom&&(this.minCutoffZoom=Math.max(E.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let E=0;E<n.length;E++)if(n[E].is3D()){this.opaquePassCutoff=E;break}const y=this.style&&this.style.fog;y?(this._fogVisible=y.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=y.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(p),this.opaquePassCutoff=0);const x=this._shadowRenderer;if(x){x.updateShadowParameters(this.transform,this.style.directionalLight);for(const E in s)for(const A of c[E]){let I={min:0,max:0};this.terrain&&(I=this.terrain.getMinMaxForTile(A)||I),x.addShadowReceiver(A.toUnwrapped(),I.min,I.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new $S(this.context));for(const E of n){if(E.isHidden(this.transform.zoom))continue;const A=t.getLayerSourceCache(E);this.uploadLayer(this,E,A)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new aD),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Kc.has(this.context.gl))return;this.renderPass="offscreen";for(const E of n){const A=t.getLayerSourceCache(E);if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const I=A?u[A.id]:void 0;(E.type==="custom"||E.type==="raster"||E.isSky()||I&&I.length)&&this.renderLayer(this,A,E,I)}this.depthRangeFor3D=[0,1-(n.length+2)*this.numSublayers*this.depthEpsilon];const b=this.terrain;b&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&b.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,f)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const T=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),S=(()=>{if(i.showOverdrawInspector)return xe.black;if(this.style.fog&&this.transform.projection.supportsFog&&!T){const E=this.style.fog.properties.get("color").toArray01();return new xe(...E)}if(this.style.fog&&this.transform.projection.supportsFog&&T){const E=this.style.fog.properties.get("space-color").toArray01();return new xe(...E)}return xe.transparent})();if(this.context.clear({color:S,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const E=n[this.currentLayer],A=t.getLayerSourceCache(E);if(E.isSky())continue;const I=A?(E.is3D()?g:u)[A.id]:void 0;this._renderTileClippingMasks(E,A,I),this.renderLayer(this,A,E,I)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&T&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||ar(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const E=n[this.currentLayer],A=t.getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,A,E,A?u[A.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let M=0;for(x&&(M=x.getShadowCastingLayerCount());this.currentLayer<o.length;){const E=n[this.currentLayer],A=t.getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(b&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=b.renderBatch(this.currentLayer);continue}let I;if(A&&(I=(E.type==="symbol"?p:E.is3D()?g:u)[A.id]),this._renderTileClippingMasks(E,A,A?c[A.id]:void 0),this.renderLayer(this,A,E,I),!b&&x&&M>0&&E.hasShadowPass()&&--M==0&&(x.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const z=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=z;this.currentLayer++){const P=n[this.currentLayer];if(!P.hasLightBeamPass())continue;const R=t.getLayerSourceCache(P);this.renderLayer(this,R,P,R?u[R.id]:void 0)}this.currentLayer=z,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let E=null;n.forEach(A=>{const I=t.getLayerSourceCache(A);I&&!A.isHidden(this.transform.zoom)&&I.getVisibleCoordinates().length&&(!E||E.getSource().maxzoom<I.getSource().maxzoom)&&(E=I)}),E&&this.options.showTileBoundaries&&g2.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const A=E.transform.padding;u2(E,E.transform.height-(A.top||0),3,Yk),u2(E,A.bottom||0,3,Jk),h2(E,A.left||0,3,Kk),h2(E,E.transform.width-(A.right||0),3,Qk);const I=E.transform.centerPoint;(function(z,P,R,F){Qh(z,P-1,R-10,2,20,F),Qh(z,P-10,R-1,20,2,F)})(E,I.x,E.transform.height-I.y,tD)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(k.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(t,i,r){this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&i.type==="custom")&&_2[`${i.type}Upload`]&&_2[`${i.type}Upload`](t,r,i.scope),this.gpuTimingEnd()}renderLayer(t,i,r,o){r.isHidden(this.transform.zoom)||(r.type==="background"||r.type==="sky"||r.type==="custom"||r.type==="model"||r.type==="raster"||o&&o.length)&&(this.id=r.id,this.gpuTimingStart(r),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(r.type)||t.terrain&&r.type==="custom")&&g2[r.type](t,i,r,o,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,r=this.context.gl;let o=this.gpuTimers[t.id];o||(o=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQuery()}),o.calls++,r.beginQuery(i.TIME_ELAPSED_EXT,o.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,i=this.context.gl,r=i.createQuery();this.deferredRenderGpuTimeQueries.push(r),i.beginQuery(t.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const i={};for(const r in t){const o=t[r],n=this.context.extTimerQuery,s=n.getQueryParameter(o.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(o.query),i[r]=s}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.extTimerQuery,r=this.context.gl;let o=0;for(const n of t)o+=i.getQueryParameter(n,r.QUERY_RESULT)/1e6,i.deleteQueryEXT(n);return o}translatePosMatrix(t,i,r,o,n){if(!r[0]&&!r[1])return t;const s=n?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(s){const c=Math.sin(s),u=Math.cos(s);r=[r[0]*u-r[1]*c,r[0]*c+r[1]*u]}const a=[n?r[0]:js(i,r[0],this.transform.zoom),n?r[1]:js(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return Q.translate(l,t,a),l}saveTileTexture(t){const i=t.size[0],r=this._tileTextures[i];r?r.push(t):this._tileTextures[i]=[t]}getTileTexture(t){const i=this._tileTextures[t];return i&&i.length>0?i.pop():null}isPatternMissing(t,i){return t===null||t!==void 0&&!this.imageManager.getPattern(t.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,r){const o=r===void 0?this.terrain&&this.terrain.renderingToTexture:r,n=this.terrain&&this.terrain.exaggeration()===0,s=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(s.push("LIGHTING_3D_MODE"),s.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):o||s.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||s.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):s.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(s.push("TERRAIN"),this.linearFloatFilteringSupported()&&s.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&s.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&s.push("GLOBE"),!this._fogVisible||o||i!==void 0&&!i||s.push("FOG","FOG_DITHERING"),o&&s.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&s.push("OVERDRAW_INSPECTOR"),s}getOrCreateProgram(t,i){this.cache=this.cache||{};const r=i&&i.defines||[],o=i&&i.config,n=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(r),s=Ww.cacheKey(Fw[t],t,n,o);return this.cache[s]||(this.cache[s]=new Ww(this.context,t,Fw[t],o,Vk[t],n)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=k.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Mi(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,o=this.style.ambientLight;if(r&&o){const n=((s,a)=>{const l=s.properties.get("direction"),c=s.properties.get("color").toArray01(),u=s.properties.get("intensity"),p=a.properties.get("color").toArray01(),f=a.properties.get("intensity"),g=[l.x,l.y,l.z],_=Di(p,f),y=Di(c,u);return{u_lighting_ambient_color:_,u_lighting_directional_dir:g,u_lighting_directional_color:y,u_ground_radiance:Tk(g,y,_)}})(r,o);i.setLightsUniformValues(t,n)}}}uploadCommonUniforms(t,i,r,o,n){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const a=s.getOpacity(this.transform.pitch),l=((c,u,p,f,g,_,y,x,b,T,S,M)=>{const E=c.transform,A=u.properties.get("color").toArray01();A[3]=f;const I=c.frameCounter/1e3%1,[z,P]=u.properties.get("vertical-range");return{u_fog_matrix:p?E.calculateFogTileMatrix(p):M||c.identityMat,u_fog_range:u.getFovAdjustedRange(E._fov),u_fog_color:A,u_fog_horizon_blend:u.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(z,P),P],u_fog_temporal_offset:I,u_frustum_tl:g,u_frustum_tr:_,u_frustum_br:y,u_frustum_bl:x,u_globe_pos:b,u_globe_radius:T,u_viewport:S,u_globe_transition:ar(E.zoom),u_is_globe:+(E.projection.name==="globe")}})(this,s,r,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ce.devicePixelRatio,this.transform.height*ce.devicePixelRatio],o);i.setFogUniformValues(t,l)}n&&i.setCutoffUniformValues(t,n.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const o of r)i[o.key]=t[o.key]||new ac(o,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,i){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||t.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=qs||i[1]>=qs}}const Hs=2048;class mD{constructor(t,i){this.aabb=t,this.lastCascade=i}}class gD{add(t,i){const r=this.receivers[t.key];r!==void 0?(r.aabb.min[0]=Math.min(r.aabb.min[0],i.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],i.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],i.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],i.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],i.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],i.max[2])):this.receivers[t.key]=new mD(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,r){const o=di.fromPoints(t.points);let n=0;for(const s in this.receivers){const a=this.receivers[s];if(!a||!o.intersectsAabb(a.aabb))continue;a.aabb.min=o.closestPoint(a.aabb.min),a.aabb.max=o.closestPoint(a.aabb.max);const l=a.aabb.getCorners();for(let c=0;c<r.length;c++){let u=!0;for(const p of l){const f=[p[0]*i,p[1]*i,p[2]];if(j.transformMat4(f,f,r[c].matrix),f[0]<-1||f[0]>1||f[1]<-1||f[1]>1){u=!1;break}}if(a.lastCascade=c,n=Math.max(n,c),u)break}}return n+1}}class _D{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new gD,this._depthMode=new ee(t.context.gl.LEQUAL,ee.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const o=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||o<=0||(this._shadowLayerCount=r.style.order.reduce((g,_)=>{const y=r.style._mergedLayers[_];return g+(y.hasShadowPass()&&!y.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const n=r.context,s=Hs,a=Hs;if(this._cascades.length===0)for(let g=0;g<2;++g){const _=r._shadowMapDebug,y=n.gl,x=n.createFramebuffer(s,a,_,"texture"),b=new Mi(n,{width:s,height:a,data:null},y.DEPTH_COMPONENT);if(x.depthAttachment.set(b.texture),_){const T=new Mi(n,{width:s,height:a,data:null},y.RGBA);x.colorAttachment.set(T.texture)}this._cascades.push({framebuffer:x,texture:b,matrix:[],far:0,boundingSphereRadius:0,frustum:new En,scale:0})}this.shadowDirection=y2(i);let l=0;if(t.elevation){const g=t.elevation,_=[1e4,-1e4];g.visibleDemTiles.filter(y=>y.dem).forEach(y=>{const x=y.dem.tree;_[0]=Math.min(_[0],x.minimums[0]),_[1]=Math.max(_[1],x.maximums[0])}),_[0]!==1e4&&(l=(_[1]-_[0])*g.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,p=new Float64Array(16);for(let g=0;g<2;++g){const _=this._cascades[g];let y=t.height/50,x=1;g===0?x=c:(y=c,x=u);const[b,T]=yD(t,this.shadowDirection,y,x,Hs,l);_.scale=t.scale,_.matrix=b,_.boundingSphereRadius=T,Q.invert(p,_.matrix),_.frustum=En.fromInvProjectionMatrix(p,1,0,!0),_.far=x}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=o,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Hs,this._uniformValues.u_shadowmap_0=Jr.ShadowMap0,this._uniformValues.u_shadowmap_1=Jr.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const f=r.transform.elevation;for(const g of this._groundShadowTiles){let _={min:0,max:0};if(f){const y=f.getMinMaxForTile(g);y&&(_=y)}this.addShadowReceiver(g.toUnwrapped(),_.min,_.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this._enabled)return;const r=this.painter,o=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),o.viewport.set([0,0,Hs,Hs]);for(let n=0;n<this._numCascadesToRender;++n){r.currentShadowCascade=n,o.bindFramebuffer.set(this._cascades[n].framebuffer.framebuffer),o.clear({color:xe.white,depth:1});for(const s of t.order){const a=t._mergedLayers[s];if(!a.hasShadowPass()||a.isHidden(r.transform.zoom))continue;const l=t.getLayerSourceCache(a),c=l?i[l.id]:void 0;(a.type==="model"||c&&c.length)&&r.renderLayer(r,l,a,c)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,i=t.style,r=t.context,o=i.directionalLight,n=i.ambientLight;if(!o||!n)return;const s=[],a=tl(t,t.longestCutoffRange);a.shouldRenderCutoff&&s.push("RENDER_CUTOFF");const l=Ag(o,n),c=new ee(r.gl.LEQUAL,ee.ReadOnly,t.depthRangeFor3D);for(const u of this._groundShadowTiles){const p=u.toUnwrapped(),f=t.isTileAffectedByFog(u),g=t.getOrCreateProgram("groundShadow",{defines:s,overrideFog:f});this.setupShadows(p,g),t.uploadCommonUniforms(r,g,p,null,a);const _={u_matrix:t.transform.calculateProjMatrix(p),u_ground_shadow_factor:l};g.draw(t,r.gl.TRIANGLES,c,ve.disabled,Ve.multiply,we.disabled,_,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ve.unblended:Ve.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,r=i.calculatePosMatrix(t,i.worldSize);return Q.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return Q.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,r,o=0){if(!this._enabled)return;const n=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,c=new Float64Array(16),u=n.calculatePosMatrix(t,n.worldSize);for(let p=0;p<2;p++)Q.multiply(c,this._cascades[p].matrix,u),l[p===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),s.activeTexture.set(a.TEXTURE0+Jr.ShadowMap0+p),this._cascades[p].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const p=Hl(t.canonical),f=2/n.tileSize*at/Hs,g=f*this._cascades[0].boundingSphereRadius,_=f*this._cascades[1].boundingSphereRadius,y=(r==="vector-tile"?1:3)/Math.pow(2,o-t.canonical.z-(1-n.zoom+Math.floor(n.zoom)));l.u_shadow_normal_offset=[p,g*y,_*y],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,l)}setupShadowsFromMatrix(t,i,r=!1){if(!this._enabled)return;const o=this.painter.context,n=o.gl,s=this._uniformValues,a=new Float64Array(16);for(let l=0;l<2;l++)Q.multiply(a,this._cascades[l].matrix,t),s[l===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),o.activeTexture.set(n.TEXTURE0+Jr.ShadowMap0+l),this._cascades[l].texture.bind(n.NEAREST,n.CLAMP_TO_EDGE);this.useNormalOffset=r,r?(s.u_shadow_normal_offset=[1,5,5],s.u_shadow_bias=[6e-5,.0012,.012]):s.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(o,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,r,o){if(o[2]>=0)return{};const n=function(l,c,u){const p=u/(1<<l.canonical.z);return new di([l.canonical.x*p+l.wrap*u,l.canonical.y*p+l.wrap*u,0],[(l.canonical.x+1)*p+l.wrap*u,(l.canonical.y+1)*p+l.wrap*u,c])}(t,i,r).getCorners(),s=i/-o[2];o[0]<0?(j.add(n[0],n[0],[o[0]*s,0,0]),j.add(n[3],n[3],[o[0]*s,0,0])):o[0]>0&&(j.add(n[1],n[1],[o[0]*s,0,0]),j.add(n[2],n[2],[o[0]*s,0,0])),o[1]<0?(j.add(n[0],n[0],[0,o[1]*s,0]),j.add(n[1],n[1],[0,o[1]*s,0])):o[1]>0&&(j.add(n[2],n[2],[0,o[1]*s,0]),j.add(n[3],n[3],[0,o[1]*s,0]));const a={};return a.vertices=n,a.planes=[ed(n[1],n[0],n[4]),ed(n[2],n[1],n[5]),ed(n[3],n[2],n[6]),ed(n[0],n[3],n[7])],a}addShadowReceiver(t,i,r){this._receivers.add(t,di.fromTileIdAndHeight(t,i,r))}getMaxCascadeForTile(t){const i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function ed(e,t,i){const r=j.sub([],i,t),o=j.sub([],e,t),n=j.cross([],r,o),s=j.length(n);return s===0?[0,0,1,0]:(j.scale(n,n,1/s),[n[0],n[1],n[2],-j.dot(n,t)])}function y2(e){const t=e.properties.get("direction"),i=Zt(t.x,t.y,t.z);i[2]=Ut(i[2],0,75);const r=Bt([i[0],i[1],i[2]]);return j.fromValues(r.x,r.y,r.z)}function Ag(e,t){const i=e.properties.get("color"),r=e.properties.get("intensity"),o=e.properties.get("direction"),n=[o.x,o.y,o.z],s=t.properties.get("color"),a=t.properties.get("intensity"),l=Math.max(j.dot([0,0,1],n),0),c=[0,0,0];j.scale(c,s.toArray01Linear().slice(0,3),a);const u=[0,0,0];return j.scale(u,i.toArray01Linear().slice(0,3),l*r),Ni([c[0]>0?c[0]/(c[0]+u[0]):0,c[1]>0?c[1]/(c[1]+u[1]):0,c[2]>0?c[2]/(c[2]+u[2]):0])}function yD(e,t,i,r,o,n){const s=e.zoom,a=e.scale,l=e.worldSize,c=1/l,u=e.aspect,p=Math.sqrt(1+u*u)*Math.tan(.5*e.fovX),f=p*p,g=r-i,_=r+i;let y,x;f>g/_?(y=r,x=r*p):(y=.5*_*(1+f),x=.5*Math.sqrt(g*g+2*(r*r+i*i)*f+_*_*f*f));const b=e.projection.pixelsPerMeter(e.center.lat,l),T=e._camera.getCameraToWorldMercator(),S=[0,0,-y*c];j.transformMat4(S,S,T);let M=x*c;const E=e._edgeInsets;if(!(E.left===0&&E.top===0&&E.right===0&&E.bottom===0||E.left===E.right&&E.top===E.bottom)){const ot=e._camera.getWorldToCamera(e.worldSize,e.projection.zAxisUnit==="meters"?b:1),rt=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,r);rt[8]=2*-e.centerOffset.x/e.width,rt[9]=2*e.centerOffset.y/e.height;const lt=new Float64Array(16);Q.mul(lt,rt,ot);const ut=new Float64Array(16);Q.invert(ut,lt);const pt=En.fromInvProjectionMatrix(ut,l,s,!0);for(const nt of pt.points){const mt=((A=nt)[0]/=a,A[1]/=a,A[2]=ni(A[2],e._center.lat),A);M=Math.max(M,j.len(j.subtract([],S,mt)))}}var A;M*=o/(o-1);const I=Math.acos(t[2]),z=Math.atan2(-t[0],-t[1]),P=new kh;P.position=S,P.setPitchBearing(I,z);const R=P.getWorldToCamera(l,b),F=M*l,N=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*F),U=P.getCameraToClipOrthographic(-F,F,-F,F,N,(F+n*b)/t[2]),O=new Float64Array(16);Q.multiply(O,U,R);const Z=j.fromValues(Math.floor(1e6*S[0])/1e6*l,Math.floor(1e6*S[1])/1e6*l,0),W=.5*o,K=[0,0,0];j.transformMat4(K,Z,O),j.scale(K,K,W);const $=[Math.floor(K[0]),Math.floor(K[1]),Math.floor(K[2])],H=[0,0,0];j.sub(H,K,$),j.scale(H,H,-1/W);const it=new Float64Array(16);return Q.identity(it),Q.translate(it,it,H),Q.multiply(O,it,O),[O,F]}class xD extends qi{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return dw(this.requestManager.transformRequest(i,ht.Model).url).then(r=>{if(!r)return;const o=dg(r),n=new lb(t,void 0,void 0,o);return n.computeBoundsAndApplyParent(),n}).catch(r=>{this.fire(new ae(new Error(`Could not load model ${t} from ${i}: ${r.message}`)))})}load(t,i){this.models[i]||(this.models[i]={});const r=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const o=[];for(const n of r)o.push(this.loadModel(n,t[n]));Promise.allSettled(o).then(n=>{for(let s=0;s<n.length;s++){const{status:a,value:l}=n[s];a==="fulfilled"&&l&&(this.models[i][r[s]]=l)}this.numModelsLoading[i]-=r.length,this.fire(new Tt("data",{dataType:"style"}))}).catch(n=>{this.fire(new ae(new Error(`Could not load models: ${n.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]}addModel(t,i,r){this.models[r]||(this.models[r]={}),this.hasModel(t,r)&&this.removeModel(t,r),this.load({[t]:this.requestManager.normalizeModelURL(i)},r)}addModels(t,i){const r={};for(const o in t)r[o]=this.requestManager.normalizeModelURL(t[o]);this.load(r,i)}removeModel(t,i){this.models[i]||(this.models[i]={});const r=this.models[i][t];delete this.models[i][t],r.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(const r in this.models[i])this.models[i][r].upload(t.context)}}const bc=(e,t)=>Su(e,t&&t.filter(i=>i.identifier!=="source.canvas")),vD=Vr($e,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),bD=Vr($e,["setCenter","setZoom","setBearing","setPitch"]),x2={version:8,layers:[],sources:{}},v2={duration:300,delay:0},wD=new Set(["fill","line","background","hillshade","raster"]);class Uo extends qi{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=Vt({},v2),this._buildingIndex=new $I(this),this.crossTileSymbolIndex=new fk,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new rS,this.dispatcher=i.dispatcher?i.dispatcher:new $s(yc(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new vI,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new $a(t._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new xD(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",wt());const r=this;this._rtlTextPluginCallback=Uo.registerForPluginStateChange(o=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:o.pluginStatus,pluginURL:o.pluginURL},(n,s)=>{if(vy(n),s&&s.every(a=>a))for(const a in r._sourceCaches){const l=r._sourceCaches[a],c=l.getSource().type;c!=="vector"&&c!=="geojson"||l.reload()}})}),this.on("data",o=>{if(o.dataType!=="source"||o.sourceDataType!=="metadata")return;const n=this.getOwnSource(o.sourceId);if(n&&n.vectorLayerIds)for(const s in this._layers){const a=this._layers[s];a.source===n.id&&this._validateLayer(a)}})}loadURL(t,i={}){this.fire(new Tt("dataloading",{dataType:"style"}));const r=typeof i.validate=="boolean"?i.validate:!Ke(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const o=this.importsCache.get(t);if(o)return this._load(o,r);const n=this.map._requestManager.transformRequest(t,ht.Style);this._request=Mt(n,(s,a)=>{if(this._request=null,s)this.fire(new ae(s));else if(a)return this.importsCache.set(t,a),this._load(a,r)})}loadJSON(t,i={}){this.fire(new Tt("dataloading",{dataType:"style"})),this._request=ce.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new Tt("dataloading",{dataType:"style"})),this._load(x2,!1)}_loadImports(t,i){if(this.importDepth>=4)return Y("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const o of t){const n=this._createFragmentStyle(o),s=new Promise(l=>{n.once("style.import.load",l),n.once("error",l)}).then(()=>this.mergeAll());if(r.push(s),this.resolvedImports.has(o.url)){n.loadEmpty();continue}const a=o.data||this.importsCache.get(o.url);a?n.loadJSON(a,{validate:i}):o.url?n.loadURL(o.url,{validate:i}):n.loadEmpty(),this.fragments.push({style:n,id:o.id,config:o.config})}return Promise.allSettled(r)}_createFragmentStyle(t){const i=this.scope?br(t.id,this.scope):t.id,r=new Uo(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Tt(t?"style.load":"style.import.load"))}_load(t,i){const r=t.schema;if(this.isRootStyle()&&(t.fragment||r&&t.fragment!==!1)){const s=Vt({},x2,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(s,i)}if(this.setConfig(this._config,r),i&&bc(this,Aa(t)))return;this._loaded=!0,this.stylesheet=V(t);for(const s in t.sources)this.addSource(s,t.sources[s],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const o=_w(this.stylesheet.layers);if(this._order=o.map(s=>s.id),this.stylesheet.light&&Y("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const s=this.stylesheet.lights[0];this.light=new qb(s.properties,s.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new qb(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const s of o){const a=Fh(s,this.options);a.setScope(this.scope),a.isConfigDependent&&this._configDependentLayers.add(a.fqid),a.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=a,this._serializedLayers[a.id]=a.serialize();const l=this.getOwnLayerSourceCache(a),c=!!this.directionalLight&&this.directionalLight.shadowsEnabled();l&&a.canCastShadows()&&c&&(l.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const n=this.stylesheet.terrain;n&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=ce.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?Y("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(n,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Tt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,r,o,n,s,a,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{if(c.stylesheet){if(c.light!=null&&(t=c.light),c.stylesheet.lights)for(const u of c.stylesheet.lights)u.type==="ambient"&&c.ambientLight!=null&&(i=c.ambientLight),u.type==="directional"&&c.directionalLight!=null&&(r=c.directionalLight);o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain),c.stylesheet.fog&&c.fog!=null&&(n=c.fog),c.stylesheet.camera!=null&&(l=c.stylesheet.camera),c.stylesheet.projection!=null&&(s=c.stylesheet.projection),c.stylesheet.transition!=null&&(a=c.stylesheet.transition)}}),this.light=t,this.ambientLight=i,this.directionalLight=r,this.fog=n,o===null?delete this.terrain:this.terrain=o,this.camera=l||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=Vt({},v2,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const i=r=>{for(const o of r.fragments)i(o.style);t(r)};i(this)}_prioritizeTerrain(t,i,r){const o=t&&t.drapeRenderMode===0;return r===null?i&&i.drapeRenderMode===0?i:o?t:null:i!=null&&(!t||o||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},i={},r={};this.forEachFragmentStyle(o=>{for(const n in o._sourceCaches){const s=br(n,o.scope);t[s]=o._sourceCaches[n]}for(const n in o._otherSourceCaches){const s=br(n,o.scope);i[s]=o._otherSourceCaches[n]}for(const n in o._symbolSourceCaches){const s=br(n,o.scope);r[s]=o._symbolSourceCaches[n]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const t={},i=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(n=>{for(const s of n._order){const a=n._layers[s];if(a.type==="slot"){const l=Iu(s);if(t[l])continue;t[l]=[]}a.slot&&t[a.slot]?t[a.slot].push(a):i.push(a)}}),this._mergedOrder=[];const o=(n=[])=>{for(const s of n)if(s.type==="slot"){const a=Iu(s.id);t[a]&&o(t[a])}else{const a=br(s.id,s.scope);this._mergedOrder.push(a),r[a]=s,s.is3D()&&(this._has3DLayers=!0),s.type==="circle"&&(this._hasCircleLayers=!0),s.type==="symbol"&&(this._hasSymbolLayers=!0)}};o(i),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Vt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,r,o){let n,s,a;const l=ce.devicePixelRatio>1?"@2x":"";let c=Mt(r.transformRequest(r.normalizeSpriteURL(i,l,".json"),ht.SpriteJSON),(f,g)=>{c=null,a||(a=f,n=g,p())}),u=_e(r.transformRequest(r.normalizeSpriteURL(i,l,".png"),ht.SpriteImage),(f,g)=>{u=null,a||(a=f,s=g,p())});function p(){if(a)o(a);else if(n&&s){const f=ce.getImageData(s),g={};for(const _ in n){const{width:y,height:x,x:b,y:T,sdf:S,pixelRatio:M,stretchX:E,stretchY:A,content:I}=n[_],z=new Ui({width:y,height:x});Ui.copy(f,z,{x:b,y:T},{x:0,y:0},{width:y,height:x}),g[_]={data:z,pixelRatio:M,sdf:S,stretchX:E,stretchY:A,content:I}}o(null,g)}}return{cancel(){c&&(c.cancel(),c=null),u&&(u.cancel(),u=null)}}}(t,this.map._requestManager,(i,r)=>{if(this._spriteRequest=null,i)this.fire(new ae(i));else if(r)for(const o in r)this.imageManager.addImage(o,this.scope,r[o]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Tt("data",{dataType:"style"}))})}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const r=t.sourceLayer;r&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(r)===-1)&&this.fire(new ae(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{const r=this.fragments[i];return r&&r.style&&(t.data=r.style.serialize()),t})}_serializeSources(){const t={};for(const i in this._sourceCaches){const r=this._sourceCaches[i].getSource();t[r.id]||(t[r.id]=r.serialize())}return t}_serializeLayers(t){const i=[];for(const r of t){const o=this._layers[r];o&&o.type!=="custom"&&i.push(o.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&(typeof t.isLayerDraped=="function"?t.isLayerDraped(this.getLayerSourceCache(t)):wD.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new ae(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new ae(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();if(this._changes.isDirty()){const n=this._changes.getLayerUpdatesByScope();for(const s in n){const{updatedIds:a,removedIds:l}=n[s];(a||l)&&this._updateWorkerLayers(s,a,l)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const o={};for(const n in this._mergedSourceCaches){const s=this._mergedSourceCaches[n];o[n]=s.used,s.used=!1}for(const n of this._mergedOrder){const s=this._mergedLayers[n];if(s.recalculate(t,this._availableImages),!s.isHidden(t.zoom)){const a=this.getLayerSourceCache(s);a&&(a.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let a=s.minzoom||0;a<(s.maxzoom||25.5);a++){const l=this.map.painter;if(l){const c=s.getProgramIds();if(!c)continue;for(const u of c){const p=s.getDefaultProgramParams(u,t.zoom);p&&(l.style=this,this.fog&&(l._fogVisible=!0,p.overrideFog=!0,l.getOrCreateProgram(u,p)),l._fogVisible=!1,p.overrideFog=!1,l.getOrCreateProgram(u,p),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(p.overrideRtt=!0,l.getOrCreateProgram(u,p)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const n in o){const s=this._mergedSourceCaches[n];o[n]!==s.used&&s.getSource().fire(new Tt("data",{sourceDataType:"visibility",dataType:"source",sourceId:s.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new Tt("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,i,r){const o=this.getFragmentStyle(t);o&&this.dispatcher.broadcast("updateLayers",{layers:i?o._serializeLayers(i):[],scope:t,removedIds:r||[],options:o.options})}setState(t){if(this._checkLoaded(),bc(this,Aa(t)))return!1;(t=V(t)).layers=_w(t.layers);const i=function(o,n){if(!o)return[{command:$e.setStyle,args:[n]}];let s=[];try{if(!st(o.version,n.version))return[{command:$e.setStyle,args:[n]}];st(o.center,n.center)||s.push({command:$e.setCenter,args:[n.center]}),st(o.zoom,n.zoom)||s.push({command:$e.setZoom,args:[n.zoom]}),st(o.bearing,n.bearing)||s.push({command:$e.setBearing,args:[n.bearing]}),st(o.pitch,n.pitch)||s.push({command:$e.setPitch,args:[n.pitch]}),st(o.sprite,n.sprite)||s.push({command:$e.setSprite,args:[n.sprite]}),st(o.glyphs,n.glyphs)||s.push({command:$e.setGlyphs,args:[n.glyphs]}),st(o.imports,n.imports)||function(p=[],f=[],g){f=f||[];const _=(p=p||[]).map(Gh),y=f.map(Gh),x=p.reduce(qh,{}),b=f.reduce(qh,{}),T=_.slice();let S,M,E,A;for(S=0,M=0;S<_.length;S++)E=_[S],b.hasOwnProperty(E)?M++:(g.push({command:$e.removeImport,args:[E]}),T.splice(T.indexOf(E,M),1));for(S=0,M=0;S<y.length;S++)E=y[y.length-1-S],T[T.length-1-S]!==E&&(x.hasOwnProperty(E)?(g.push({command:$e.removeImport,args:[E]}),T.splice(T.lastIndexOf(E,T.length-M),1)):M++,A=T[T.length-S],g.push({command:$e.addImport,args:[b[E],A]}),T.splice(T.length-S,0,E));for(const I of f){const z=x[I.id];if(!z||st(z,I))continue;st(z.config,I.config)||g.push({command:$e.setImportConfig,args:[I.id,I.config]}),st(z.url,I.url)||g.push({command:$e.setImportUrl,args:[I.id,I.url]});const P=I.data;st(z&&z.data,P)||g.push({command:$e.setImportData,args:[I.id,P]})}}(o.imports,n.imports,s),st(o.transition,n.transition)||s.push({command:$e.setTransition,args:[n.transition]}),st(o.light,n.light)||s.push({command:$e.setLight,args:[n.light]}),st(o.fog,n.fog)||s.push({command:$e.setFog,args:[n.fog]}),st(o.projection,n.projection)||s.push({command:$e.setProjection,args:[n.projection]}),st(o.lights,n.lights)||s.push({command:$e.setLights,args:[n.lights]}),st(o.camera,n.camera)||s.push({command:$e.setCamera,args:[n.camera]});const a={},l=[];(function(p,f,g,_){let y;for(y in f=f||{},p=p||{})p.hasOwnProperty(y)&&(f.hasOwnProperty(y)||xw(y,g,_));for(y in f){if(!f.hasOwnProperty(y))continue;const x=f[y];p.hasOwnProperty(y)?st(p[y],x)||(p[y].type==="geojson"&&x.type==="geojson"&&WI(p,f,y)?g.push({command:$e.setGeoJSONSourceData,args:[y,x.data]}):HI(y,f,g,_)):yw(y,f,g)}})(o.sources,n.sources,l,a);const c=[];o.layers&&o.layers.forEach(p=>{p.source&&a[p.source]?s.push({command:$e.removeLayer,args:[p.id]}):c.push(p)});let u=o.terrain;u&&a[u.source]&&(s.push({command:$e.setTerrain,args:[void 0]}),u=void 0),s=s.concat(l),st(u,n.terrain)||s.push({command:$e.setTerrain,args:[n.terrain]}),function(p,f,g){f=f||[];const _=(p=p||[]).map(Gh),y=f.map(Gh),x=p.reduce(qh,{}),b=f.reduce(qh,{}),T=_.slice(),S=Object.create(null);let M,E,A,I,z,P,R;for(M=0,E=0;M<_.length;M++)A=_[M],b.hasOwnProperty(A)?E++:(g.push({command:$e.removeLayer,args:[A]}),T.splice(T.indexOf(A,E),1));for(M=0,E=0;M<y.length;M++)A=y[y.length-1-M],T[T.length-1-M]!==A&&(x.hasOwnProperty(A)?(g.push({command:$e.removeLayer,args:[A]}),T.splice(T.lastIndexOf(A,T.length-E),1)):E++,P=T[T.length-M],g.push({command:$e.addLayer,args:[b[A],P]}),T.splice(T.length-M,0,A),S[A]=!0);for(M=0;M<y.length;M++)if(A=y[M],I=x[A],z=b[A],!S[A]&&!st(I,z))if(st(I.source,z.source)&&st(I["source-layer"],z["source-layer"])&&st(I.type,z.type)){for(R in Uh(I.layout,z.layout,g,A,null,$e.setLayoutProperty),Uh(I.paint,z.paint,g,A,null,$e.setPaintProperty),st(I.slot,z.slot)||g.push({command:$e.setSlot,args:[A,z.slot]}),st(I.filter,z.filter)||g.push({command:$e.setFilter,args:[A,z.filter]}),st(I.minzoom,z.minzoom)&&st(I.maxzoom,z.maxzoom)||g.push({command:$e.setLayerZoomRange,args:[A,z.minzoom,z.maxzoom]}),I)I.hasOwnProperty(R)&&R!=="layout"&&R!=="paint"&&R!=="filter"&&R!=="metadata"&&R!=="minzoom"&&R!=="maxzoom"&&R!=="slot"&&(R.indexOf("paint.")===0?Uh(I[R],z[R],g,A,R.slice(6),$e.setPaintProperty):st(I[R],z[R])||g.push({command:$e.setLayerProperty,args:[A,R,z[R]]}));for(R in z)z.hasOwnProperty(R)&&!I.hasOwnProperty(R)&&R!=="layout"&&R!=="paint"&&R!=="filter"&&R!=="metadata"&&R!=="minzoom"&&R!=="maxzoom"&&R!=="slot"&&(R.indexOf("paint.")===0?Uh(I[R],z[R],g,A,R.slice(6),$e.setPaintProperty):st(I[R],z[R])||g.push({command:$e.setLayerProperty,args:[A,R,z[R]]}))}else g.push({command:$e.removeLayer,args:[A]}),P=T[T.lastIndexOf(A)+1],g.push({command:$e.addLayer,args:[z,P]})}(c,n.layers,s)}catch(a){console.warn("Unable to compute style diff:",a),s=[{command:$e.setStyle,args:[n]}]}return s}(this.serialize(),t).filter(o=>!(o.command in bD));if(i.length===0)return!1;const r=i.filter(o=>!(o.command in vD));if(r.length>0)throw new Error(`Unimplemented: ${r.map(o=>o.command).join(", ")}.`);return i.forEach(o=>{this[o.command].apply(this,o.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new ae(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(t,i){this.imageManager.updateImage(t,this.scope,i)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new ae(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Tt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,r={}){return this._checkLoaded(),this._validate(Y3,`models.${t}`,i,null,r)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new ae(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,r={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(U3,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const o=fg(t,i,this.dispatcher,this);o.scope=this.scope,o.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o.id),source:o.serialize(),sourceId:o.id}));const n=s=>{const a=(s?"symbol:":"other:")+o.id,l=br(a,this.scope),c=this._sourceCaches[a]=new No(l,o,s);(s?this._symbolSourceCaches:this._otherSourceCaches)[o.id]=c,c.onAdd(this.map)};n(!1),i.type!=="vector"&&i.type!=="geojson"||n(!0),o.onAdd&&o.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new ae(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new ae(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(t);for(const o of r){const n=Iu(o.id);delete this._sourceCaches[n],this._changes.discardSourceCacheUpdate(o.id),o.fire(new Tt("data",{sourceDataType:"metadata",dataType:"source",sourceId:o.getSource().id})),o.setEventedParent(null),o.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){const i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){const t=[];for(const i in this._otherSourceCaches){const r=this.getOwnSourceCache(i);r&&t.push(r.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const o of t){if(this._validate(q3,"lights",o))return;switch(o.type){case"ambient":if(this.ambientLight){const n=this.ambientLight;n.set(o),n.updateTransitions(i)}else this.ambientLight=new Jb(o,CI,this.scope,this.options);break;case"directional":if(this.directionalLight){const n=this.directionalLight;n.set(o),n.updateTransitions(i)}else this.directionalLight=new Jb(o,II,this.scope,this.options)}}const r=new Ti(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const r=p=>.2126*(p[0]<=.03928?p[0]/12.92:Math.pow((p[0]+.055)/1.055,2.4))+.7152*(p[1]<=.03928?p[1]/12.92:Math.pow((p[1]+.055)/1.055,2.4))+.0722*(p[2]<=.03928?p[2]/12.92:Math.pow((p[2]+.055)/1.055,2.4)),o=t.properties.get("color").toArray01(),n=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-Zt(s.x,s.y,s.z)[2]/90,l=r(o)*n*a,c=i.properties.get("color").toArray01(),u=i.properties.get("intensity");return(l+r(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(Ey(t)){const i=function(n){const s=n.indexOf(Cu);return s>=0?n.slice(s+1):""}(t),r=this.fragments.find(({id:n})=>n===i);if(!r)throw new Error(`Style import not found: ${t}`);const o=Iu(t);return r.style.getFragmentStyle(o)}{const i=this.fragments.find(({id:r})=>r===t);if(!i)throw new Error(`Style import not found: ${t}`);return i.style}}getConfigProperty(t,i){const r=this.getFragmentStyle(t);if(!r)return null;const o=r.options.get(i),n=o?o.value||o.default:null;return n?n.serialize():null}setConfigProperty(t,i,r){const o=Un(r);if(o.result!=="success")return void bc(this,o.value);const n=o.value.expression,s=this.getFragmentStyle(t);if(!s)return;const a=s.options.get(i);a&&(s.options.set(i,{...a,value:n}),s.updateConfigDependencies())}setConfig(t,i){if(this._config=t,t||i)if(i){this.options.clear();for(const r in i){let o,n;const s=Un(i[r].default);if(s.result==="success"&&(o=s.value.expression),t&&t[r]!==void 0){const f=Un(t[r]);f.result==="success"&&(n=f.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:p}=i[r];o?this.options.set(r,{default:o,value:n,minValue:a,maxValue:l,stepValue:c,type:u,values:p}):this.fire(new ae(new Error(`No schema defined for config option "${r}".`)))}}else this.fire(new ae(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const i=this.getLayer(t);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i,r={}){this._checkLoaded();const o=t.id;if(this._layers[o])return void this.fire(new ae(new Error(`Layer with id "${o}" already exists on this map`)));let n;if(t.type==="custom"){if(bc(this,function(u){const p=[],f=u.id;return f===void 0&&p.push({message:`layers.${f}: missing required property "id"`}),u.render===void 0&&p.push({message:`layers.${f}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&p.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),p}(t)))return;n=Fh(t,this.options)}else{if(typeof t.source=="object"&&(this.addSource(o,t.source),t=Vt(t=V(t),{source:o})),this._validate(H3,`layers.${o}`,t,{arrayIndex:-1},r))return;n=Fh(t,this.options),this._validateLayer(n),n.setEventedParent(this,{layer:{id:o}}),this._serializedLayers[n.id]=n.serialize()}n.isConfigDependent&&this._configDependentLayers.add(n.fqid),n.setScope(this.scope);let s=this._order.length;if(i){const u=this._order.indexOf(i);if(u===-1)return void this.fire(new ae(new Error(`Layer with id "${i}" does not exist on this map.`)));n.slot===this._layers[i].slot?s=u:Y(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,o),this._layerOrderChanged=!0,this._layers[o]=n;const a=this.getOwnLayerSourceCache(n),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&n.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(n);if(c&&n.source&&a&&n.type!=="custom"){this._changes.discardLayerRemoval(n);const u=br(n.source,n.scope);c.type!==n.type?this._changes.updateSourceCache(u,"clear"):(this._changes.updateSourceCache(u,"reload"),a.pause())}this._updateLayer(n),n.onAdd&&n.onAdd(this.map),n.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const r=this._checkLayer(t);if(!r||t===i)return;const o=this._order.indexOf(t);this._order.splice(o,1);let n=this._order.length;if(i){const s=this._order.indexOf(i);if(s===-1)return void this.fire(new ae(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?n=s:Y(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(n,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const o=this.getOwnLayerSourceCache(i);if(o&&o.castsShadows){let n=!1;for(const s in this._layers)if(this._layers[s].source===i.source&&this._layers[s].canCastShadows()){n=!0;break}o.castsShadows=n}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,r){this._checkLoaded();const o=this._checkLayer(t);o&&(o.minzoom===i&&o.maxzoom===r||(i!=null&&(o.minzoom=i),r!=null&&(o.maxzoom=r),this._updateLayer(o)))}setSlot(t,i){this._checkLoaded();const r=this._checkLayer(t);r&&r.slot!==i&&(r.slot=i,this._updateLayer(r))}setFilter(t,i,r={}){this._checkLoaded();const o=this._checkLayer(t);if(o&&!st(o.filter,i))return i==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(lf,`layers.${o.id}.filter`,i,{layerType:o.type},r)||(o.filter=V(i),this._updateLayer(o)))}getFilter(t){const i=this._checkLayer(t);if(i)return V(i.filter)}setLayoutProperty(t,i,r,o={}){this._checkLoaded();const n=this._checkLayer(t);n&&(st(n.getLayoutProperty(i),r)||(n.setLayoutProperty(i,r,o),n.isConfigDependent&&this._configDependentLayers.add(n.fqid),this._updateLayer(n)))}getLayoutProperty(t,i){const r=this._checkLayer(t);if(r)return r.getLayoutProperty(i)}setPaintProperty(t,i,r,o={}){this._checkLoaded();const n=this._checkLayer(t);if(!n||st(n.getPaintProperty(i),r))return;const s=n.setPaintProperty(i,r,o);n.isConfigDependent&&this._configDependentLayers.add(n.fqid),s&&this._updateLayer(n),this._changes.updatePaintProperties(n)}getPaintProperty(t,i){const r=this._checkLayer(t);if(r)return r.getPaintProperty(i)}setFeatureState(t,i){this._checkLoaded();const r=t.source,o=t.sourceLayer,n=this._checkSource(r);if(!n)return;const s=n.type;if(s==="geojson"&&o)return void this.fire(new ae(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(s==="vector"&&!o)return void this.fire(new ae(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new ae(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(r);for(const l of a)l.setFeatureState(o,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,o=this._checkSource(r);if(!o)return;const n=o.type,s=n==="vector"?t.sourceLayer:void 0;if(n==="vector"&&!s)return void this.fire(new ae(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new ae(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(r);for(const l of a)l.removeFeatureState(s,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,o=this._checkSource(i);if(o){if(o.type!=="vector"||r)return t.id===void 0&&this.fire(new ae(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new ae(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Vt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Vt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return Et({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),r=br(t.source,t.scope),o=this._changes.getUpdatedSourceCaches();t.source&&!o[r]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(r,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const i=a=>this._mergedLayers[a].type==="fill-extrusion",r=this.order,o={},n=[];for(let a=r.length-1;a>=0;a--){const l=r[a];if(i(l)){o[l]=a;for(const c of t){const u=c[l];if(u)for(const p of u)n.push(p)}}}n.sort((a,l)=>l.intersectionZ-a.intersectionZ);const s=[];for(let a=r.length-1;a>=0;a--){const l=r[a];if(i(l))for(let c=n.length-1;c>=0;c--){const u=n[c].feature;if(o[u.layer.id]<a)break;s.push(u),n.pop()}else for(const c of t){const u=c[l];if(u)for(const p of u)s.push(p.feature)}}return s}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(lf,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const o={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new ae(new Error("parameters.layers must be an Array."))),[];for(const c of i.layers){const u=this._mergedLayers[c];if(!u)return this.fire(new ae(new Error(`The layer '${c}' does not exist in the map's style and cannot be queried for features.`))),[];o[u.source]=!0}}const n=[],s=i.serializedLayers||{},a=i&&i.layers?i.layers.some(c=>{const u=this.getLayer(c);return u&&u.is3D()}):this.has3DLayers(),l=Qm.createFromScreenPoints(t,r);for(const c in this._mergedSourceCaches){const u=this._mergedSourceCaches[c].getSource();if(!u||u.scope!==i.scope)continue;const p=this._mergedSourceCaches[c].getSource().id;i.layers&&!o[p]||n.push(GI(this._mergedSourceCaches[c],this._mergedLayers,s,l,i,r,a,!!this.map._showQueryGeometry))}return this.placement&&n.push(function(c,u,p,f,g,_,y){const x={},b=_.queryRenderedSymbols(f),T=[];for(const S of Object.keys(b).map(Number))T.push(y[S]);T.sort(mw);for(const S of T){const M=S.featureIndex.lookupSymbolFeatures(b[S.bucketInstanceId],u,S.bucketIndex,S.sourceLayerIndex,g.filter,g.layers,g.availableImages,c);for(const E in M){const A=x[E]=x[E]||[],I=M[E];I.sort((z,P)=>{const R=S.featureSortOrder;if(R){const F=R.indexOf(z.featureIndex);return R.indexOf(P.featureIndex)-F}return P.featureIndex-z.featureIndex});for(const z of I)A.push(z)}}for(const S in x)x[S].forEach(M=>{const E=M.feature,A=p(c[S]);if(!A)return;const I=A.getFeatureState(E.layer["source-layer"],E.id);E.source=E.layer.source,E.layer["source-layer"]&&(E.sourceLayer=E.layer["source-layer"]),E.state=I});return x}(this._mergedLayers,s,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(n)}querySourceFeatures(t,i){i&&i.filter&&this._validate(lf,"querySourceFeatures.filter",i.filter,null,i);const r=this.getOwnSourceCaches(t);let o=[];for(const n of r)o=o.concat(qI(n,i));return o}addSourceType(t,i,r){return Uo.getSourceType(t)?r(new Error(`A source type called "${t}" already exists.`)):(Uo.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,r={}){this._checkLoaded();const o=this.light.getLight();let n=!1;for(const a in t)if(!st(t[a],o[a])){n=!0;break}if(!n)return;const s=this._getTransitionParameters();this.light.setLight(t,i,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,i=1){if(this._checkLoaded(),!t)return delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=t;const o=t.source==null;if(i===1){if(typeof r.source=="object"){const a="terrain-dem-src";this.addSource(a,r.source),r=V(r),r=Vt(r,{source:a})}const n=Vt({},r),s={};if(this.terrain&&o){n.source=this.terrain.get().source;const a=this.terrain?this.getFragmentStyle(this.terrain.scope):null;a&&(s.style=a.serialize())}if(this._validate($3,"terrain",n,s))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new Tt("data",{dataType:"style"}))}else{const n=this.terrain,s=n.get();for(const a of Object.keys(tt.terrain))!r.hasOwnProperty(a)&&tt.terrain[a].default&&(r[a]=tt.terrain[a].default);for(const a in t)if(!st(t[a],s[a])){n.set(t,this.options),this.stylesheet.terrain=t;const l=this._getTransitionParameters({duration:0});n.updateTransitions(l),this.fire(new Tt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const i=this.fog=new SI(t,this.map.transform);this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!st(i.get(),t)){i.set(t),this.stylesheet.fog=i.get();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:ce.now(),transition:Vt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],i=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?t.push(r):i.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){const r=this.terrain=new TI(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const o=this._getTransitionParameters({duration:0});r.updateTransitions(o)}_force3DLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,r,o,n={}){if(n&&n.validate===!1)return!1;const s=Vt({},this.serialize());return bc(this,t.call(Aa,Vt({key:i,style:s,value:r,styleSpec:tt},o)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),gf.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const i=this.getSourceCaches(t);for(const r of i)r.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const i=this.getSourceCaches(t);for(const r of i)r.resume(),r.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let i;this.directionalLight&&(i=y2(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,r,o,n=!1){let s=!1,a=!1;const l={},c={};for(const u of this._mergedOrder){const p=this._mergedLayers[u];if(p.type!=="symbol")continue;const f=br(p.source,p.scope);let g=l[f];if(!g){const y=this.getLayerSourceCache(p);if(!y)continue;const x=y.getRenderableIds(!0).map(b=>y.getTileByID(b));c[f]=x.slice(),g=l[f]=x.sort((b,T)=>T.tileID.overscaledZ-b.tileID.overscaledZ||(b.tileID.isLessThan(T.tileID)?-1:1))}const _=this.crossTileSymbolIndex.addLayer(p,g,t.center.lng,t.projection);s=s||_}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),n=n||this._layerOrderChanged||r===0,this._layerOrderChanged&&this.fire(new Tt("neworder")),(n||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ce.now(),t.zoom))&&(this.pauseablePlacement=new uk(t,this._mergedOrder,n,i,r,o,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ce.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const u of this._mergedOrder){const p=this._mergedLayers[u];p.type==="symbol"&&this.placement.updateLayerOpacities(p,l[br(p.source,p.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ce.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:r})=>r===t.id)!==-1?this.fire(new ae(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(i.push(t),this._loadImports([t],!0),this)}setImportUrl(t,i){this._checkLoaded();const r=this.stylesheet.imports||[],o=this.getImportIndex(t);if(o===-1)return this;r[o].url=i;const n=this.fragments[o];return n.style=this._createFragmentStyle(r[o]),n.style.on("style.import.load",()=>this.mergeAll()),n.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();const r=this.getImportIndex(t),o=this.stylesheet.imports||[];return r===-1?this:i?(this.fragments[r].style.setState(i),this._reloadImports(),this):(delete o[r].data,this.setImportUrl(t,o[r].url))}setImportConfig(t,i){this._checkLoaded();const r=this.getImportIndex(t),o=this.stylesheet.imports||[];if(r===-1)return this;i?o[r].config=i:delete o[r].config;const n=this.fragments[r],s=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=i,n.style.setConfig(i,s),n.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(t);return r===-1||(i.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex(r=>r.id===t);return i===-1&&this.fire(new ae(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const i in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[i];r&&t.push(r.getSource())}return t}getSource(t,i){const r=this.getSourceCache(t,i);return r&&r.getSource()}getLayerSource(t){const i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){const r=br(t,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const i=br(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){const i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const i in t){const r=t[i];r==="reload"?this.reloadSource(i):r==="clear"&&this.clearSource(i)}}updateLayers(t){const i=this._changes.getUpdatedPaintProperties();for(const r of i){const o=this.getLayer(r);o&&o.updateTransitions(t)}}getImages(t,i,r){this.imageManager.getImages(i.icons,i.scope,r),this._updateTilesForChangedImages();const o=n=>{n&&n.setDependencies(i.tileID.key,i.type,i.icons)};o(this._otherSourceCaches[i.source]),o(this._symbolSourceCaches[i.source])}getGlyphs(t,i,r){this.glyphManager.getGlyphs(i.stacks,i.scope,r)}getResource(t,i,r){return St(i,r)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new ae(new Error(`There is no source with ID '${t}'`))),!1):i.every(r=>r.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function b2(e,t){let i=!1,r=null;const o=()=>{r=null,i&&(e(),r=setTimeout(o,t),i=!1)};return()=>(i=!0,r||o(),r)}Uo.getSourceType=function(e){return pg[e]},Uo.setSourceType=function(e,t){pg[e]=t},Uo.registerForPluginStateChange=function(e){return e({pluginStatus:$r,pluginURL:$n}),gf.on("pluginStateChange",e),e};class TD{constructor(t){this._hashName=t&&encodeURIComponent(t),ir(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=b2(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,k.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),k.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=w2(t);if(this._hashName){const r=this._hashName;let o=!1;const n=k.location.hash.slice(1).split("&").map(s=>{const a=s.split("=")[0];return a===r?(o=!0,`${a}=${i}`):s}).filter(s=>s);return o||n.push(`${r}=${i}`),`#${n.join("&")}`}return`#${i}`}_getCurrentHash(){const t=k.location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(r=>r.split("=")).forEach(r=>{r[0]===this._hashName&&(i=r)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(r=>isNaN(r))){const r=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:r,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=k.location.href.replace(/(#.+)?$/,this.getHashString());k.history.replaceState(k.history.state,null,t)}}function w2(e,t){const i=e.getCenter(),r=Math.round(100*e.getZoom())/100,o=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,o),s=Math.round(i.lng*n)/n,a=Math.round(i.lat*n)/n,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const id={linearity:.3,easing:Mr(0,0,.3,1)},ED=Vt({deceleration:2500,maxSpeed:1400},id),SD=Vt({deceleration:20,maxSpeed:1400},id),MD=Vt({deceleration:1e3,maxSpeed:360},id),AD=Vt({deceleration:1e3,maxSpeed:90},id);class CD{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ce.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=ce.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new B(0,0),pinchAround:void 0,around:void 0};for(const{settings:n}of this._inertiaBuffer)i.zoom+=n.zoomDelta||0,i.bearing+=n.bearingDelta||0,i.pitch+=n.pitchDelta||0,n.panDelta&&i.pan._add(n.panDelta),n.around&&(i.around=n.around),n.pinchAround&&(i.pinchAround=n.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(i.pan.mag()){const n=od(i.pan.mag(),r,Vt({},ED,t||{}));o.offset=i.pan.mult(n.amount/i.pan.mag()),o.center=this._map.transform.center,rd(o,n)}if(i.zoom){const n=od(i.zoom,r,SD);o.zoom=this._map.transform.zoom+n.amount,rd(o,n)}if(i.bearing){const n=od(i.bearing,r,MD);o.bearing=this._map.transform.bearing+Ut(n.amount,-179,179),rd(o,n)}if(i.pitch){const n=od(i.pitch,r,AD);o.pitch=this._map.transform.pitch+n.amount,rd(o,n)}if(o.zoom||o.bearing){const n=i.pinchAround===void 0?i.around:i.pinchAround;o.around=n?this._map.unproject(n):this._map.getCenter()}return this.clear(),o.noMoveStart=!0,o}}function rd(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function od(e,t,i){const{maxSpeed:r,linearity:o,deceleration:n}=i,s=Ut(e*o/(t/1e3),-r,r),a=Math.abs(s)/(n*o);return{easing:i.easing,duration:1e3*a,amount:s*(a/2)}}class co extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,o={}){const n=_l(i.getCanvasContainer(),r);super(t,Vt({point:n,lngLat:i.unproject(n),originalEvent:r},o)),this._defaultPrevented=!1,this.target=i}}class nd extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const o=t==="touchend"?r.changedTouches:r.touches,n=iu(i.getCanvasContainer(),o),s=n.map(l=>i.unproject(l)),a=n.reduce((l,c,u,p)=>l.add(c.div(p.length)),new B(0,0));super(t,{points:n,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class ID extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){super(t,{originalEvent:r}),this._defaultPrevented=!1}}class kD{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ID(t.type,this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new co(t.type,this._map,t))}mouseup(t){this._map.fire(new co(t.type,this._map,t))}preclick(t){const i=Vt({},t);i.type="preclick",this._map.fire(new co(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new co(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new co(t.type,this._map,t))}mouseover(t){this._map.fire(new co(t.type,this._map,t))}mouseout(t){this._map.fire(new co(t.type,this._map,t))}touchstart(t){return this._firePreventable(new nd(t.type,this._map,t))}touchmove(t){this._map.fire(new nd(t.type,this._map,t))}touchend(t){this._map.fire(new nd(t.type,this._map,t))}touchcancel(t){this._map.fire(new nd(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class DD{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new co(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new co(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zD{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(K_(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;const r=i,o=this._startPos,n=this._lastPos;if(!o||!n||n.equals(r)||!this._box&&r.dist(o)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=ci("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(o.x,r.x),a=Math.max(o.x,r.x),l=Math.min(o.y,r.y),c=Math.max(o.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")})}mouseupWindow(t,i){if(!this._active)return;const r=this._startPos,o=i;if(r&&t.button===0){if(this.reset(),ap(),r.x!==o.x||r.y!==o.y)return this._map.fire(new Tt("boxzoomend",{originalEvent:t})),{cameraAnimation:n=>n.fitScreenCoordinates(r,o,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q_(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new Tt(t,{originalEvent:i}))}}function Cg(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class PD{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(o){const n=new B(0,0);for(const s of o)n._add(s);return n.div(o.length)}(i),this.touches=Cg(r,i)))}touchmove(t,i,r){if(this.aborted||!this.centroid)return;const o=Cg(r,i);for(const n in this.touches){const s=o[n];(!s||s.dist(this.touches[n])>30)&&(this.aborted=!0)}}touchend(t,i,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),r.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Ig{constructor(t){this.singleTap=new PD(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,r){this.singleTap.touchstart(t,i,r)}touchmove(t,i,r){this.singleTap.touchmove(t,i,r)}touchend(t,i,r){const o=this.singleTap.touchend(t,i,r);if(o){const n=t.timeStamp-this.lastTime<500,s=!this.lastTap||this.lastTap.dist(o)<30;if(n&&s||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class RD{constructor(){this._zoomIn=new Ig({numTouches:1,numTaps:2}),this._zoomOut=new Ig({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,r){this._zoomIn.touchstart(t,i,r),this._zoomOut.touchstart(t,i,r)}touchmove(t,i,r){this._zoomIn.touchmove(t,i,r),this._zoomOut.touchmove(t,i,r)}touchend(t,i,r){const o=this._zoomIn.touchend(t,i,r),n=this._zoomOut.touchend(t,i,r);return o?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:s.getZoom()+1,around:s.unproject(o)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:s.getZoom()-1,around:s.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const LD={0:1,2:2};class kg{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;const r=t0(t);this._correctButton(t,r)&&(this._lastPoint=i,this._eventButton=r)}mousemoveWindow(t,i){const r=this._lastPoint;if(r){if(t.preventDefault(),this._eventButton!=null&&function(o,n){const s=LD[n];return o.buttons===void 0||(o.buttons&s)!==s}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(r,i)}}mouseupWindow(t){this._lastPoint&&t0(t)===this._eventButton&&(this._moved&&ap(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class OD extends kg{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class T2 extends kg{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){const r=.8*(i.x-t.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(t){t.preventDefault()}}class E2 extends kg{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){const r=-.5*(i.y-t.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(t){t.preventDefault()}}class BD{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),ir(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new B(0,0)}touchstart(t,i,r){return this._calculateTransform(t,i,r)}touchmove(t,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(r.length===1&&!le())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,r)}}touchend(t,i,r){this._calculateTransform(t,i,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const o=Cg(r,i),n=new B(0,0),s=new B(0,0);let a=0;for(const c in o){const u=o[c],p=this._touches[c];p&&(n._add(u),s._add(u.sub(p)),a++,o[c]=u)}if(this._touches=o,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:n.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ci("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Dg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,r){return{}}touchstart(t,i,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,r){const o=this._firstTwoTouches;if(!o)return;t.preventDefault();const[n,s]=o,a=sd(r,i,n),l=sd(r,i,s);if(!a||!l)return;const c=this._aroundCenter?null:a.add(l).div(2);return this._move([a,l],c,t)}touchend(t,i,r){if(!this._firstTwoTouches)return;const[o,n]=this._firstTwoTouches,s=sd(r,i,o),a=sd(r,i,n);s&&a||(this._active&&ap(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function sd(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function S2(e,t){return Math.log(e/t)/Math.LN2}class FD extends Dg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){const r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(S2(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:S2(this._distance,r),pinchAround:i}}}function M2(e,t){return 180*e.angleWith(t)/Math.PI}class ND extends Dg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){const r=this._vector;if(this._vector=t[0].sub(t[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:M2(this._vector,r),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const i=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const o=M2(t,r);return Math.abs(o)<i}}function zg(e){return Math.abs(e.y)>Math.abs(e.x)}class VD extends Dg{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,zg(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,r){const o=this._lastPoints;if(!o)return;const n=t[0].sub(o[0]),s=t[1].sub(o[1]);return this._map._cooperativeGestures&&!le()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(n,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+s.y)/2*-.5})}gestureBeginsVertically(t,i,r){if(this._valid!==void 0)return this._valid;const o=t.mag()>=2,n=i.mag()>=2;if(!o&&!n)return;if(!o||!n)return this._firstMove==null&&(this._firstMove=r),r-this._firstMove<100&&void 0;const s=t.y>0==i.y>0;return zg(t)&&zg(i)&&s}}const jD={panStep:100,bearingStep:15,pitchStep:10};class UD{constructor(){const t=jD;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,r=0,o=0,n=0,s=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?o=1:(t.preventDefault(),s=-1);break;case 40:t.shiftKey?o=-1:(t.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(r=0,o=0),{cameraAnimation:a=>{const l=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:GD,zoom:i?Math.round(l)+i*(t.shiftKey?2:1):l,bearing:a.getBearing()+r*this._bearingStep,pitch:a.getPitch()+o*this._pitchStep,offset:[-n*this._panStep,-s*this._panStep],center:a.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function GD(e){return e*(2-e)}const A2=4.000244140625;class qD{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,ir(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||le()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===k.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=ce.now(),o=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,i!==0&&i%A2==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=_l(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const c=this._type==="wheel"&&Math.abs(this._delta)>A2?this._wheelZoomRate:this._defaultZoomRate;let u=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&u!==0&&(u=1/u);const p=i(),f=Math.pow(2,p),g=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):f;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(g*u))),this._type==="wheel"&&(this._startZoom=p,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:i(),o=this._startZoom,n=this._easing;let s,a=!1;if(this._type==="wheel"&&o&&n){const c=Math.min((ce.now()-this._lastWheelEventTime)/200,1);s=ne(o,r,n(c)),c<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=s-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=Gi;if(this._prevEase){const r=this._prevEase,o=(ce.now()-r.start)/r.duration,n=r.easing(o+.01)-r.easing(o),s=.27/Math.sqrt(n*n+1e-4)*.01;i=Mr(s,Math.sqrt(.0729-s*s),.25,1)}return this._prevEase={start:ce.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ci("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(k.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class $D{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ZD{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class HD{constructor(){this._tap=new Ig({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=i[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,i,r))}touchmove(t,i,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const o=i[0],n=o.y-this._swipePoint.y;return this._swipePoint=o,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,i,r)}touchend(t,i,r){this._tapTime?this._swipePoint&&r.length===0&&this.reset():this._tap.touchend(t,i,r)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class WD{constructor(t,i,r){this._el=t,this._mousePan=i,this._touchPan=r}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class XD{constructor(t,i,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class YD{constructor(t,i,r,o){this._el=t,this._touchZoom=i,this._touchRotate=r,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ad=e=>e.zoom||e.drag||e.pitch||e.rotate;class JD extends Tt{}class KD{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=j.sub([],i,t);this.radius=j.length(r[2]<0?j.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){j.div(t,t,this.constants),j.normalize(t,t),j.mul(t,t,this.constants);const i=j.scale([],t,this.radius);if(i[2]>0){const r=j.scale([],[0,0,1],j.dot(i,[0,0,1])),o=j.scale([],j.normalize([],[i[0],i[1],0]),this.radius),n=j.add([],i,j.scale([],j.sub([],j.add([],o,r),i),2));i[0]=n[0],i[1]=n[1]}return i}}function ld(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class QD{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new CD(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new KD,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),ir(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[k.document,"mousemove",{capture:!0}],[k.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[k,"blur",void 0]];for(const[o,n,s]of this._listeners)o.addEventListener(n,o===k.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[t,i,r]of this._listeners)t.removeEventListener(i,t===k.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new kD(i,t));const o=i.boxZoom=new zD(i,t);this._add("boxZoom",o);const n=new RD,s=new ZD;i.doubleClickZoom=new $D(s,n),this._add("tapZoom",n),this._add("clickZoom",s);const a=new HD;this._add("tapDragZoom",a);const l=i.touchPitch=new VD(i);this._add("touchPitch",l);const c=new T2(t),u=new E2(t);i.dragRotate=new XD(t,c,u),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);const p=new OD(t),f=new BD(i,t);i.dragPan=new WD(r,p,f),this._add("mousePan",p),this._add("touchPan",f,["touchZoom","touchRotate"]);const g=new ND,_=new FD;i.touchZoomRotate=new YD(r,_,g,a),this._add("touchRotate",g,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),this._add("blockableMapEvent",new DD(i));const y=i.scrollZoom=new qD(i,this);this._add("scrollZoom",y,["mousePan"]);const x=i.keyboard=new UD;this._add("keyboard",x);for(const b of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[b]&&i[b].enable(t[b])}_add(t,i,r){this._handlers.push({handlerName:t,handler:i,allowed:r}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ad(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,r){for(const o in t)if(o!==r&&(!i||i.indexOf(o)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const i=[];for(const r of t)this._el.contains(r.target)&&i.push(r);return i}handleEvent(t,i){this._updatingCamera=!0;const r=t.type==="renderFrame",o=r?void 0:t,n={needsRenderFrame:!1},s={},a={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?iu(this._el,l):r?void 0:_l(this._el,t);for(const{handlerName:f,handler:g,allowed:_}of this._handlers){if(!g.isEnabled())continue;let y;this._blockedByActive(a,_,f)?g.reset():g[i||t.type]&&(y=g[i||t.type](t,c,l),this.mergeHandlerResult(n,s,y,f,o),y&&y.needsRenderFrame&&this._triggerRenderFrame()),(y||g.isActive())&&(a[f]=g)}const u={};for(const f in this._previousActiveHandlers)a[f]||(u[f]=o);this._previousActiveHandlers=a,(Object.keys(u).length||ld(n))&&(this._changes.push([n,s,u]),this._triggerRenderFrame()),(Object.keys(a).length||ld(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:p}=n;p&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],p(this._map))}mergeHandlerResult(t,i,r,o,n){if(!r)return;Vt(t,r);const s={handlerName:o,originalEvent:r.originalEvent||n};r.zoomDelta!==void 0&&(i.zoom=s),r.panDelta!==void 0&&(i.drag=s),r.pitchDelta!==void 0&&(i.pitch=s),r.bearingDelta!==void 0&&(i.rotate=s)}_applyChanges(){const t={},i={},r={};for(const[o,n,s]of this._changes)o.panDelta&&(t.panDelta=(t.panDelta||new B(0,0))._add(o.panDelta)),o.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(t.around=o.around),o.aroundCoord!==void 0&&(t.aroundCoord=o.aroundCoord),o.pinchAround!==void 0&&(t.pinchAround=o.pinchAround),o.noInertia&&(t.noInertia=o.noInertia),Vt(i,n),Vt(r,s);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const o=this._map,n=o.transform,s=T=>[T.x,T.y,T.z];if((T=>{const S=this._eventsInProgress.drag;return S&&!this._handlersById[S.handlerName].isActive()})()&&!ld(t)){const T=n.zoom;n.cameraElevationReference="sea",this._originalZoom!=null&&n._orthographicProjectionAtLowPitch&&n.projection.name!=="globe"&&n.pitch===0?(n.cameraElevationReference="ground",n.zoom=this._originalZoom):(n.recenterOnTerrain(),n.cameraElevationReference="ground"),T!==n.zoom&&this._map._update(!0)}if(n._isCameraConstrained&&o._stop(!0),!ld(t))return void this._fireEvents(i,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:p,aroundCoord:f,pinchAround:g}=t;n._isCameraConstrained&&(l>0&&(l=0),n._isCameraConstrained=!1),g!==void 0&&(p=g),(l||(T=>i[T]&&!this._eventsInProgress[T])("drag"))&&p&&(this._dragOrigin=s(n.pointCoordinate3D(p)),this._originalZoom=n.zoom,this._trackingEllipsoid.setup(n._camera.position,this._dragOrigin)),n.cameraElevationReference="sea",o._stop(!0),p=p||o.transform.centerPoint,c&&(n.bearing+=c),u&&(n.pitch+=u),n._updateCameraState();const _=[0,0,0];if(a)if(n.projection.name==="mercator"){const T=this._trackingEllipsoid.projectRay(n.screenPointToMercatorRay(p).dir),S=this._trackingEllipsoid.projectRay(n.screenPointToMercatorRay(p.sub(a)).dir);_[0]=S[0]-T[0],_[1]=S[1]-T[1]}else{const T=n.pointCoordinate(p);if(n.projection.name==="globe"){a=a.rotate(-n.angle);const S=n._pixelsPerMercatorPixel/n.worldSize;_[0]=-a.x*cm(Hi(T.y))*S,_[1]=-a.y*cm(n.center.lat)*S}else{const S=n.pointCoordinate(p.sub(a));T&&S&&(_[0]=S.x-T.x,_[1]=S.y-T.y)}}const y=n.zoom,x=[0,0,0];if(l){const T=s(f||n.pointCoordinate3D(p)),S={dir:j.normalize([],j.sub([],T,n._camera.position))};if(S.dir[2]<0){const M=n.zoomDeltaToMovement(T,l);j.scale(x,S.dir,M)}}const b=j.add(_,_,x);n._translateCameraConstrained(b),l&&Math.abs(n.zoom-y)>1e-4&&n.recenterOnTerrain(),n.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const o=ad(this._eventsInProgress),n=ad(t),s={};for(const u in t){const{originalEvent:p}=t[u];this._eventsInProgress[u]||(s[`${u}start`]=p),this._eventsInProgress[u]=t[u]}!o&&n&&this._fireEvent("movestart",n.originalEvent);for(const u in s)this._fireEvent(u,s[u]);n&&this._fireEvent("move",n.originalEvent);for(const u in t){const{originalEvent:p}=t[u];this._fireEvent(u,p)}const a={};let l;for(const u in this._eventsInProgress){const{handlerName:p,originalEvent:f}=this._eventsInProgress[u];this._handlersById[p].isActive()||(delete this._eventsInProgress[u],l=i[p]||f,a[`${u}end`]=l)}for(const u in a)this._fireEvent(u,a[u]);const c=ad(this._eventsInProgress);if(r&&(o||n)&&!c){this._updatingCamera=!0;const u=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),p=f=>f!==0&&-this._bearingSnap<f&&f<this._bearingSnap;u?(p(u.bearing||this._map.getBearing())&&(u.bearing=0),this._map.easeTo(u,{originalEvent:l})):(this._map.fire(new Tt("moveend",{originalEvent:l})),p(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new Tt(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new JD("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const C2="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class t5 extends qi{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,ir(["_renderFrameCallback"],this)}getCenter(){return new se(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,r){return t=B.convert(t).mult(-1),this.panTo(this.transform.center,Vt({offset:t},i),r)}panTo(t,i,r){return this.easeTo(Vt({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,r){return this.easeTo(Vt({zoom:t},i),r)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,r){return this.easeTo(Vt({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,Vt({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(Vt({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=Wr.convert(t);const r=i&&i.bearing||0,o=i&&i.pitch||0,n=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,n,s,r,o,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if(typeof(t=Vt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const r=t.padding;t.padding={top:r,bottom:r,right:r,left:r}}return t.padding=Vt(i,t.padding),t}_minimumAABBFrustumDistance(t,i){const r=i.max[0]-i.min[0],o=i.max[1]-i.min[1];return r/o>t.aspect?r/(2*Math.tan(.5*t.fovX)*t.aspect):o/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,r,o,n,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=o,a.pitch=n;const c=se.convert(i),u=se.convert(r),p=.5*(c.lat+u.lat),f=.5*(c.lng+u.lng),g=Or(p,f),_=j.normalize([],g),y=j.normalize([],j.cross([],_,[0,1,0])),x=j.cross([],y,_),b=[y[0],y[1],y[2],0,x[0],x[1],x[2],0,_[0],_[1],_[2],0,0,0,0,1],T=[g,Or(c.lat,c.lng),Or(u.lat,c.lng),Or(u.lat,u.lng),Or(c.lat,u.lng),Or(p,c.lng),Or(p,u.lng),Or(c.lat,f),Or(u.lat,f)];let S=di.fromPoints(T.map(H=>[j.dot(y,H),j.dot(x,H),j.dot(_,H)]));const M=j.transformMat4([],S.center,b);j.squaredLength(M)===0&&j.set(M,0,0,1),j.normalize(M,M),j.scale(M,M,Ar),a.center=function([H,it,ot]){const rt=Math.hypot(H,it,ot),lt=Math.atan2(H,ot),ut=.5*Math.PI-Math.acos(-it/rt);return new se(Te(lt),Te(ut))}(M);const E=a.getWorldToCameraMatrix(),A=Q.invert(new Float64Array(16),E);S=di.applyTransform(S,Q.multiply([],E,b)),j.transformMat4(M,M,E);const I=.5*(S.max[2]-S.min[2]),z=this._minimumAABBFrustumDistance(a,S),P=j.scale([],[0,0,1],I),R=j.add(P,M,P),F=z+(a.pitch===0?0:j.distance(M,R)),N=a.globeCenterInViewSpace,U=j.sub([],M,[N[0],N[1],N[2]]);j.normalize(U,U),j.scale(U,U,F);const O=j.add([],M,U);j.transformMat4(O,O,A);const Z=Ba/Ar,W=j.length(O),K=ni(Math.max(W*Z-Ba,Number.EPSILON),0),$=Math.min(a.zoomFromMercatorZAdjusted(K),l.maxZoom);return $>.5*($l+Kn)?(a.setProjection({name:"mercator"}),a.zoom=$,this._cameraForBounds(a,i,r,o,n,s)):{center:a.center,zoom:$,bearing:o,pitch:n}}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=Vt({},{exaggerated:!0},i),r.getAtPoint(De.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,r,o,n,s){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,r,o,n,s);const a=t.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=o,a.pitch=n;const u=se.convert(i),p=se.convert(r),f=new se(u.lng,p.lat),g=new se(p.lng,u.lat),_=a.project(u),y=a.project(p),x=this.queryTerrainElevation(u),b=this.queryTerrainElevation(p),T=this.queryTerrainElevation(f),S=this.queryTerrainElevation(g),M=[[_.x,_.y,Math.min(x||0,b||0,T||0,S||0)],[y.x,y.y,Math.max(x||0,b||0,T||0,S||0)]];let E=di.fromPoints(M);const A=a.getWorldToCameraMatrix(),I=Q.invert(new Float64Array(16),A);E=di.applyTransform(E,A);const z=j.sub([],E.max,E.min),P=c.left||0,R=c.right||0,F=c.bottom||0,N=c.top||0,{left:U,right:O,top:Z,bottom:W}=l.padding,K=.5*(P+R),$=.5*(N+F),H=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(P+R+U+O))/z[0],(a.height-(F+N+W+Z))/z[1])),l.maxZoom),it=a.scale/a.zoomScale(H);E=new di([E.min[0]-(U+K)*it,E.min[1]-(W+$)*it,E.min[2]],[E.max[0]+(O+K)*it,E.max[1]+(Z+$)*it,E.max[2]]);const ot=.5*z[2],rt=this._minimumAABBFrustumDistance(a,E),lt=[0,0,1,0];ei.transformMat4(lt,lt,A),ei.normalize(lt,lt);const ut=j.scale([],lt,rt+ot),pt=j.add([],E.center,ut),nt=(typeof l.offset.x=="number"&&typeof l.offset.y=="number"?new B(l.offset.x,l.offset.y):B.convert(l.offset)).rotate(-Ft(o));E.center[0]-=nt.x*it,E.center[1]+=nt.y*it,j.transformMat4(E.center,E.center,I),j.transformMat4(pt,pt,I);const mt=[E.center[0],E.center[1],pt[2]*a.pixelsPerMeter];j.scale(mt,mt,1/a.worldSize);const It=Xr(mt[0]),kt=Hi(mt[1]),Rt=Math.min(a._zoomFromMercatorZ(mt[2]),l.maxZoom),Ot=new se(It,kt);return a.mercatorFromTransition&&Rt<.5*($l+Kn)?(a.setProjection({name:"globe"}),a.zoom=Rt,this._cameraForBounds(a,i,r,o,n,s)):{center:Ot,zoom:Rt,bearing:o,pitch:n}}fitBounds(t,i,r){const o=this.cameraForBounds(t,i);return this._fitInternal(o,i,r)}fitScreenCoordinates(t,i,r,o,n){const s=B.convert(t),a=B.convert(i),l=new B(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new B(Math.max(s.x,a.x),Math.max(s.y,a.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),p=this.transform.pointLocation3D(c),f=this.transform.pointLocation3D(new B(l.x,c.y)),g=this.transform.pointLocation3D(new B(c.x,l.y)),_=[Math.min(u.lng,p.lng,f.lng,g.lng),Math.min(u.lat,p.lat,f.lat,g.lat)],y=[Math.max(u.lng,p.lng,f.lng,g.lng),Math.max(u.lat,p.lat,f.lat,g.lat)],x=o&&o.pitch?o.pitch:this.getPitch(),b=this._cameraForBounds(this.transform,_,y,r,x,o);return this._fitInternal(b,o,n)}_fitInternal(t,i,r){return t?(delete(i=Vt(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let o=!1,n=!1,s=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(o=!0,r.zoom=+t.zoom),t.center!==void 0&&(r.center=se.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(n=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch),t.padding==null||r.isPaddingEqual(t.padding)||(r.padding=t.padding),t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new Tt("movestart",i)).fire(new Tt("move",i)),o&&this.fire(new Tt("zoomstart",i)).fire(new Tt("zoom",i)).fire(new Tt("zoomend",i)),n&&this.fire(new Tt("rotatestart",i)).fire(new Tt("rotate",i)).fire(new Tt("rotateend",i)),s&&this.fire(new Tt("pitchstart",i)).fire(new Tt("pitch",i)).fire(new Tt("pitchend",i)),this.fire(new Tt("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Y(C2),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return Y(C2),this;this.stop();const o=r.zoom,n=r.pitch,s=r.bearing;r.setFreeCameraOptions(t);const a=o!==r.zoom,l=n!==r.pitch,c=s!==r.bearing;return this.fire(new Tt("movestart",i)).fire(new Tt("move",i)),a&&this.fire(new Tt("zoomstart",i)).fire(new Tt("zoom",i)).fire(new Tt("zoomend",i)),c&&this.fire(new Tt("rotatestart",i)).fire(new Tt("rotate",i)).fire(new Tt("rotateend",i)),l&&this.fire(new Tt("pitchstart",i)).fire(new Tt("pitch",i)).fire(new Tt("pitchend",i)),this.fire(new Tt("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=Vt({offset:[0,0],duration:500,easing:Gi},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,o=this.getZoom(),n=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:o,c="bearing"in t?this._normalizeBearing(t.bearing,n):n,u="pitch"in t?+t.pitch:s,p="padding"in t?t.padding:r.padding,f=B.convert(t.offset);let g,_,y;if(r.projection.name==="globe"){const P=De.fromLngLat(r.center),R=f.rotate(-r.angle);P.x+=R.x/r.worldSize,P.y+=R.y/r.worldSize;const F=P.toLngLat(),N=se.convert(t.center||F);this._normalizeCenter(N),g=r.centerPoint.add(R),_=new B(P.x,P.y).mult(r.worldSize),y=new B(Ji(N.lng),Qi(N.lat)).mult(r.worldSize).sub(_)}else{g=r.centerPoint.add(f);const P=r.pointLocation(g),R=se.convert(t.center||P);this._normalizeCenter(R),_=r.project(P),y=r.project(R).sub(_)}const x=r.zoomScale(l-o);let b,T;t.around&&(b=se.convert(t.around),T=r.locationPoint(b));const S=this._zooming||l!==o,M=this._rotating||n!==c,E=this._pitching||u!==s,A=!r.isPaddingEqual(p),I=P=>R=>{if(S&&(P.zoom=ne(o,l,R)),M&&(P.bearing=ne(n,c,R)),E&&(P.pitch=ne(s,u,R)),A&&(P.interpolatePadding(a,p,R),g=P.centerPoint.add(f)),b)P.setLocationAtPoint(b,T);else{const F=P.zoomScale(P.zoom-o),N=l>o?Math.min(2,x):Math.max(.5,x),U=Math.pow(N,1-R),O=P.unproject(_.add(y.mult(R*U)).mult(F));P.setLocationAtPoint(P.renderWorldCopies?O.wrap():O,g)}return t.preloadOnly||this._fireMoveEvents(i),P};if(t.preloadOnly){const P=this._emulate(I,t.duration,r);return this._preloadTiles(P),this}const z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=S,this._rotating=M,this._pitching=E,this._padding=A,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,z),this._ease(I(r),P=>{r.cameraElevationReference==="sea"&&r.recenterOnTerrain(),this._afterEase(i,P)},t),this}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new Tt("movestart",t)),this._zooming&&!r.zooming&&this.fire(new Tt("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new Tt("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new Tt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Tt("move",t)),this._zooming&&this.fire(new Tt("zoom",t)),this._rotating&&this.fire(new Tt("rotate",t)),this._pitching&&this.fire(new Tt("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,o=this._rotating,n=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new Tt("zoomend",t)),o&&this.fire(new Tt("rotateend",t)),n&&this.fire(new Tt("pitchend",t)),this.fire(new Tt("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const H=Vr(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(H,i)}this.stop(),t=Vt({offset:[0,0],speed:1.2,curve:1.42,easing:Gi},t);const r=this.transform,o=this.getZoom(),n=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?Ut(+t.zoom,r.minZoom,r.maxZoom):o,c="bearing"in t?this._normalizeBearing(t.bearing,n):n,u="pitch"in t?+t.pitch:s,p="padding"in t?t.padding:r.padding,f=r.zoomScale(l-o),g=B.convert(t.offset);let _=r.centerPoint.add(g);const y=r.pointLocation(_),x=se.convert(t.center||y);this._normalizeCenter(x);const b=r.project(y),T=r.project(x).sub(b);let S=t.curve;const M=Math.max(r.width,r.height),E=M/f,A=T.mag();if("minZoom"in t){const H=Ut(Math.min(t.minZoom,o,l),r.minZoom,r.maxZoom),it=M/r.zoomScale(H-o);S=Math.sqrt(it/A*2)}const I=S*S;function z(H){const it=(E*E-M*M+(H?-1:1)*I*I*A*A)/(2*(H?E:M)*I*A);return Math.log(Math.sqrt(it*it+1)-it)}function P(H){return(Math.exp(H)-Math.exp(-H))/2}function R(H){return(Math.exp(H)+Math.exp(-H))/2}const F=z(0);let N=function(H){return R(F)/R(F+S*H)},U=function(H){return M*((R(F)*(P(it=F+S*H)/R(it))-P(F))/I)/A;var it},O=(z(1)-F)/S;if(Math.abs(A)<1e-6||!isFinite(O)){if(Math.abs(M-E)<1e-6)return this.easeTo(t,i);const H=E<M?-1:1;O=Math.abs(Math.log(E/M))/S,U=function(){return 0},N=function(it){return Math.exp(H*S*it)}}t.duration="duration"in t?+t.duration:1e3*O/("screenSpeed"in t?+t.screenSpeed/S:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Z=n!==c,W=u!==s,K=!r.isPaddingEqual(p),$=H=>it=>{const ot=it*O,rt=1/N(ot);H.zoom=it===1?l:o+H.scaleZoom(rt),Z&&(H.bearing=ne(n,c,it)),W&&(H.pitch=ne(s,u,it)),K&&(H.interpolatePadding(a,p,it),_=H.centerPoint.add(g));const lt=it===1?x:H.unproject(b.add(T.mult(U(ot))).mult(rt));return H.setLocationAtPoint(H.renderWorldCopies?lt.wrap():lt,_),H._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),H};if(t.preloadOnly){const H=this._emulate($,t.duration,r);return this._preloadTiles(H),this}return this._zooming=!0,this._rotating=Z,this._pitching=W,this._padding=K,this._prepareEase(i,!1),this._ease($(r),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const r=this._onEaseEnd;this._onEaseEnd=void 0,r.call(this,i)}if(!t){const r=this.handlers;r&&r.stop(!1)}return this}_ease(t,i,r){r.animate===!1||r.duration===0?(t(1),i()):(this._easeStart=ce.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((ce.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=Nr(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(t){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const r=t.lng-i.center.lng;t.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&ce.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,r){const o=Math.ceil(15*i/1e3),n=[],s=t(r.clone());for(let a=0;a<=o;a++){const l=s(a/o);n.push(l.clone())}return n}}class I2{constructor(t={}){this.options=t,ir(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const i=this.options&&this.options.compact;return this._map=t,this._container=ci("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ci("button","mapboxgl-ctrl-attrib-button",this._container),ci("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ci("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,i){const r=this._map._getUIString(`AttributionControl.${i}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||X.ACCESS_TOKEN}];if(t){const r=i.reduce((o,n,s)=>(n.value&&(o+=`${n.key}=${n.value}${s<i.length-1?"&":""}`),o),"?");t.href=`${X.FEEDBACK_URL}/${r}#${w2(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const i=this._map.style._mergedSourceCaches;for(const o in i){const n=i[o];if(n.used){const s=n.getSource();s.attribution&&t.indexOf(s.attribution)<0&&t.push(s.attribution)}}t.sort((o,n)=>o.length-n.length),t=t.filter((o,n)=>{for(let s=n+1;s<t.length;s++)if(t[s].indexOf(o)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const r=t.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,t.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class k2{constructor(){ir(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ci("div","mapboxgl-ctrl");const i=ci("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const i in t){const r=t[i].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class D2{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){const i=this._currentlyRunning,r=i?this._queue.concat(i):this._queue;for(const o of r)if(o.id===t)return void(o.cancelled=!0)}run(t=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const r of i)if(!r.cancelled&&(r.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function z2(e,t,i){if(e=new se(e.lng,e.lat),t){const r=new se(e.lng-360,e.lat),o=new se(e.lng+360,e.lat),n=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),s=i.locationPoint(e).distSqr(t),a=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint(r).distSqr(t)<s&&(a||Math.abs(r.lng-i.center.lng)<n)?e=r:i.locationPoint(o).distSqr(t)<s&&(a||Math.abs(o.lng-i.center.lng)<n)&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){const r=i.locationPoint(e);if(r.x>=0&&r.y>=0&&r.x<=i.width&&r.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}const Pg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Rg extends qi{constructor(t,i){if(super(),(t instanceof k.HTMLElement||i)&&(t=Vt({element:t},i)),ir(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=B.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ci("div");const n=41,s=27,a=dn("svg",{display:"block",height:n*this._scale+"px",width:s*this._scale+"px",viewBox:`0 0 ${s} ${n}`},this._element),l=dn("radialGradient",{id:"shadowGradient"},dn("defs",{},a));dn("stop",{offset:"10%","stop-opacity":.4},l),dn("stop",{offset:"100%","stop-opacity":.05},l),dn("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a),dn("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),dn("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),dn("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),this._offset=B.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()});const r=this._element.classList;for(const n in Pg)r.remove(`mapboxgl-marker-anchor-${n}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const o=t&&t.className?t.className.trim().split(/\s+/):[];r.add(...o),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=se.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const i=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[i,-1*(38.1-13.5+i)],"bottom-right":[-i,-1*(38.1-13.5+i)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const i=t.code,r=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&r!==32&&r!==13||this.togglePopup()}_onMapClick(t){const i=t.originalEvent.target,r=this._element;this._popup&&(i===r||r.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,i=this._pos;if(!t||!i)return!1;const r=t.unproject(i),o=t.getFreeCameraOptions();if(!o.position)return!1;const n=o.position.toLngLat();return n.distanceTo(r)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i);let o;t._showingGlobe()&&Zu(t.transform,this._lngLat)?o=0:(o=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(o*=this._occludedOpacity)),this._element.style.opacity=`${o}`,this._element.style.pointerEvents=o>0?"auto":"none",this._popup&&this._popup._setOpacity(o),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Pg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const t=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!t||r!=="map")return"";if(!i._showingGlobe()){const l=i.getPitch();return l?`rotateX(${l}deg)`:""}const o=Te(xx(i.transform,this._lngLat)),n=t.sub(yx(i.transform)),s=Math.abs(n.x)+Math.abs(n.y);if(s===0)return"";const a=o/s;return`rotateX(${-n.y*a}deg) rotateY(${n.x*a}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let r=0;const o=this.getRotationAlignment();if(o==="map")if(i._showingGlobe()){const n=i.project(new se(this._lngLat.lng,this._lngLat.lat+.001)),s=i.project(new se(this._lngLat.lng,this._lngLat.lat-.001)).sub(n);r=Te(Math.atan2(s.y,s.x))-90}else r=-i.getBearing();else if(o==="horizon"){const n=oo(4,6,i.getZoom()),s=yx(i.transform);s.y+=n*i.transform.height;const a=t.sub(s),l=Te(Math.atan2(a.y,a.x));r=(l>90?l-270:l+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(t){k.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=z2(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),t===!0?this._updateFrameId=k.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=B.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const i=this._map;if(!i)return;const r=this._pointerdownPos,o=this._positionDelta;if(r&&o){if(!this._isDragging){const n=this._clickTolerance||i._clickTolerance;if(t.point.dist(r)<n)return;this._isDragging=!0}this._pos=t.point.sub(o),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Tt("dragstart"))),this.fire(new Tt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Tt("dragend")),this._state="inactive"}_addDragHandler(t){const i=this._map,r=this._pos;i&&r&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(r),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const e5={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},i5=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function P2(e=new B(0,0),t="bottom"){if(typeof e=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new B(0,e);case"top-left":return new B(i,i);case"top-right":return new B(-i,i);case"bottom":return new B(0,-e);case"bottom-left":return new B(i,-i);case"bottom-right":return new B(-i,-i);case"left":return new B(e,0);case"right":return new B(-e,0)}return new B(0,0)}return e instanceof B||Array.isArray(e)?B.convert(e):B.convert(e[t]||[0,0])}class r5{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=ri((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,r){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+r}}const o5={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},n5={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},s5={showCompass:!0,showZoom:!0,visualizePitch:!1};class a5{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new T2({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new E2({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),ir(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),K_()}move(t,i){const r=this.map,o=this.mouseRotate.mousemoveWindow(t,i),n=o&&o.bearingDelta;if(n&&r.setBearing(r.getBearing()+n),this.mousePitch){const s=this.mousePitch.mousemoveWindow(t,i),a=s&&s.pitchDelta;a&&r.setPitch(r.getPitch()+a)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q_(),k.removeEventListener("mousemove",this.mousemove),k.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Vt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),_l(this.element,t)),k.addEventListener("mousemove",this.mousemove),k.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,_l(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=iu(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=iu(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const l5={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},c5={maxWidth:100,unit:"metric"},u5={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cd={version:J,supported:X_,setRTLTextPlugin:function(e,t,i=!1){if($r===hf||$r===df||$r===pf)throw new Error("setRTLTextPlugin cannot be called multiple times.");$n=ce.resolveURL(e),$r=hf,ff=t,mf(),i||by()},getRTLTextPluginStatus:_f,Map:class extends t5{constructor(e){H_.mark(Qc.create);const t=e;if((e=Vt({},n5,e)).minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(i){const r=i.navigator?i.navigator.userAgent:null;return!!function(o){if(ue==null){const n=o.navigator?o.navigator.userAgent:null;ue=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ue}(i)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(k)&&(e.antialias=!1,Y("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wm(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new D2,this._domRenderTaskQueue=new D2,this._controls=[],this._markers=[],this._popups=[],this._mapId=ca(),this._locale=Vt({},o5,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new r5(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Kt(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},typeof e.container=="string"){if(this._container=k.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof k.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&Y("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),ir(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),k!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in k.document?"fullscreenchange":"webkitfullscreenchange",k.addEventListener("online",this._onWindowOnline,!1),k.addEventListener("resize",this._onWindowResize,!1),k.addEventListener("orientationchange",this._onWindowResize,!1),k.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),k.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new QD(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||X.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new TD(typeof e.hash=="string"&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const i=e.bounds;i&&(this.resize(),this.fitBounds(i,Vt({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new I2({customAttribution:e.customAttribution})),this._logoControl=new k2,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new Tt(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new Tt(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(e,t){if(t===void 0&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new ae(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[t];return t.indexOf("bottom")!==-1?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new ae(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Tt("movestart",e)).fire(new Tt("move",e)),this.fire(new Tt("resize",e)),t&&this.fire(new Tt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Wr.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Tt("zoomstart")).fire(new Tt("zoom")).fire(new Tt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Tt("zoomstart")).fire(new Tt("zoom")).fire(new Tt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Tt("pitchstart")).fire(new Tt("pitch")).fire(new Tt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Tt("pitchstart")).fire(new Tt("pitch")).fire(new Tt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return e==="auto"?k.navigator.language:Array.isArray(e)?e.length===0?void 0:e.map(t=>t==="auto"?k.navigator.language:t):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(e){return this._lazyInitEmptyStyle(),e?typeof e=="string"&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const e=this.transform,t=e.projection.name;let i;t==="globe"&&e.zoom>=Kn?(e.setMercatorFromTransition(),i=!0):t==="mercator"&&e.zoom<Kn&&(e.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t=e.name==="globe"&&this.transform.zoom>=Kn?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(se.convert(e))}unproject(e){return this.transform.pointLocation3D(B.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if(e==="mouseenter"||e==="mouseover"){let r=!1;const o=s=>{const a=t.filter(c=>this.getLayer(c)),l=a.length?this.queryRenderedFeatures(s.point,{layers:a}):[];l.length?r||(r=!0,i.call(this,new co(e,this,s.originalEvent,{features:l}))):r=!1},n=()=>{r=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:o,mouseout:n}}}if(e==="mouseleave"||e==="mouseout"){let r=!1;const o=s=>{const a=t.filter(l=>this.getLayer(l));(a.length?this.queryRenderedFeatures(s.point,{layers:a}):[]).length?r=!0:r&&(r=!1,i.call(this,new co(e,this,s.originalEvent)))},n=s=>{r&&(r=!1,i.call(this,new co(e,this,s.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:o,mouseout:n}}}{const r=o=>{const n=t.filter(a=>this.getLayer(a)),s=n.length?this.queryRenderedFeatures(o.point,{layers:n}):[];s.length&&(o.features=s,i.call(this,o),delete o.features)};return{layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if(i===void 0)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t){for(const o of t)if(!this._isValidId(o))return this}const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const o in r.delegates)this.on(o,r.delegates[o]);return this}once(e,t,i){if(i===void 0)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t){for(const o of t)if(!this._isValidId(o))return this}const r=this._createDelegatedListener(e,t,i);for(const o in r.delegates)this.once(o,r.delegates[o]);return this}off(e,t,i){if(i===void 0)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const n of t)if(!this._isValidId(n))return this;const r=(n,s)=>{if(n.size!==s.size)return!1;for(const a of n)if(!s.has(a))return!1;return!0},o=this._delegatedListeners?this._delegatedListeners[e]:void 0;return o&&(n=>{for(let s=0;s<n.length;s++){const a=n[s];if(a.listener===i&&r(a.layers,t)){for(const l in a.delegates)this.off(l,a.delegates[l]);return n.splice(s,1),this}}})(o),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(t!==void 0||e===void 0||e instanceof B||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(const i of t.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&Y(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(B.convert(e))}setStyle(e,t){return(t=Vt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(t==null)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Uo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e=="string"?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Uo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if(typeof e=="string"){const i=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(i,ht.Style);Mt(r,(o,n)=>{o?this.fire(new ae(o)):n&&this._updateDiff(n,t)})}else typeof e=="object"&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(i){Y(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Y("There is no style added to the map."),!1)}_isValidId(e){return e==null?(this.fire(new ae(new Error("IDs can't be empty."))),!1):!Ey(e)||(this.fire(new ae(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const r in i){const o=i[r];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:n,content:s}={}){if(this._lazyInitEmptyStyle(),t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap){const{width:a,height:l,data:c}=ce.getImageData(t);this.style.addImage(e,{data:new Ui({width:a,height:l},c),pixelRatio:i,stretchX:o,stretchY:n,content:s,sdf:r,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new ae(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:a,height:l}=t,c=t;this.style.addImage(e,{data:new Ui({width:a,height:l},new Uint8Array(c.data)),pixelRatio:i,stretchX:o,stretchY:n,content:s,sdf:r,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();const i=this.style.getImage(e);if(!i)return void this.fire(new ae(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap?ce.getImageData(t):t,{width:o,height:n}=r;o!==void 0&&n!==void 0?o===i.data.width&&n===i.data.height?(i.data.replace(r.data,!(t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new ae(new Error(`The width and height of the updated image (${o}, ${n})
                must be that same as the previous version of the image
                (${i.data.width}, ${i.data.height})`))):this.fire(new ae(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new ae(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){_e(this._requestManager.transformRequest(e,ht.Image),(i,r)=>{t(i,r instanceof k.HTMLImageElement?ce.getImageData(r):r)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new ae(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&e.length===1&&e[0].type==="flat"){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return e.length===0&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch(e["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(se.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,r,o,n=this._container;for(;n&&(!r||!o);){const s=k.getComputedStyle(n).transform;s&&s!=="none"&&(i=s.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(r=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(o=i[3])),n=n.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=o?Math.abs(t/o):t}_detectMissingCSS(){k.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&Y("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=ci("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ci("div","mapboxgl-canvas-container",e);this._canvas=ci("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=ci("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(o=>{r[o]=ci("div",`mapboxgl-ctrl-${o}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const i=ce.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);t!==-1&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const e=Vt({},X_.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(Z_(t,!0),this.painter=new fD(t,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),et.testSupport(t)):this.fire(new ae(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Tt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Tt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Tt("renderstart"));const i=this.painter.context.extTimerQuery,r=ce.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=o.createQuery(),o.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],k.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],k.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const n=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,c=this.transform.pitch,u=ce.now(),p=new Ti(l,{now:u,fadeDuration:n,pitch:c,transition:this.style.transition});this.style.update(p)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Tt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Tt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const l=ce.now()-r;o.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const c=o.getQueryParameter(t,o.QUERY_RESULT)/1e6;o.deleteQuery(t),this.fire(new Tt("gpu-timing-frame",{cpuTime:l,gpuTime:c})),k.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:c}})},50)}if(this.listens("gpu-timing-layer")){const l=this.painter.collectGpuTimers();setTimeout(()=>{const c=this.painter.queryGpuTimers(l);this.fire(new Tt("gpu-timing-layer",{layerTimes:c}))},50)}if(this.listens("gpu-timing-deferred-render")){const l=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const c=this.painter.queryGpuTimeDeferredRender(l);this.fire(new Tt("gpu-timing-deferred-render",{gpuTime:c}))},50)}const a=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(a||this._repaint)this.triggerRepaint();else{const l=!this.isMoving()&&this.loaded();if(l&&(s=this._updateAverageElevation(r,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),l&&(this.fire(new Tt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const c=this._calculateSpeedIndex();this.fire(new Tt("speedindexcompleted",{speedIndex:c})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,H_.mark(Qc.fullLoad),this._performanceMetricsCollection&&WE(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const i=o=>(this.transform.averageElevation=o,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const o=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const s=Math.abs(o-n);if(s>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){XE(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===oi||e.status===401)){const t=this.painter.context.gl;Z_(t,!1),this._logoControl instanceof k2&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new ae(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),HE(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function o(n){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0);const s=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,s),s}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(o(e),t.canvasCopies.map(o),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const o=e.length/4;for(let n=0;n<t.length;n++){const s=t[n];let a=0;for(let l=0;l<s.length;l+=4)s[l]===e[l]&&s[l+1]===e[l+1]&&s[l+2]===e[l+2]&&s[l+3]===e[l+3]&&(a+=1);r+=(i[n+2]-i[n+1])*(1-a/o)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),k!==void 0&&(k.removeEventListener("resize",this._onWindowResize,!1),k.removeEventListener("orientationchange",this._onWindowResize,!1),k.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),k.removeEventListener("online",this._onWindowOnline,!1),k.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Kc.delete(this.painter.context.gl),this._removed=!0,this.fire(new Tt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ce.frame(t=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(e){return Do(this.style?Object.values(this.style._sourceCaches):[],(t,i)=>t._preloadTiles(e,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){k.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){(function(i,r){yr=i,Dr=r})(e,t)}get version(){return J}},NavigationControl:class{constructor(e){this.options=Vt({},s5,e),this._container=ci("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(ir(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ci("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ci("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(ir(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=ci("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new a5(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=ci("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends qi{constructor(e){super(),this.options=Vt({geolocation:k.navigator.geolocation},l5,e),ir(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=b2(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=ci("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,e(i)};this._supportsGeolocation!==void 0?e(this._supportsGeolocation):k.navigator.permissions!==void 0?k.navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Tt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Tt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new se(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=Vt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),r,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new se(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=ni(1,e._center.lat)*e.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Tt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ci("button","mapboxgl-ctrl-geolocate",this._container),ci("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){Y("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ci("div","mapboxgl-user-location"),this._dotElement.appendChild(ci("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ci("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Rg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ci("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Tt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:e.absolute===!0&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Y("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Tt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Tt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Tt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{k.addEventListener("ondeviceorientationabsolute"in k?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};k.DeviceMotionEvent!==void 0&&typeof k.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),k.removeEventListener("deviceorientation",this._onDeviceOrientation),k.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:I2,ScaleControl:class{constructor(e){this.options=Vt({},c5,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),ir(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,o=t.unproject([r,i]),n=t.unproject([r+e,i]),s=o.distanceTo(n);if(this.options.unit==="imperial"){const a=3.2808*s;a>5280?this._setScale(e,a/5280,"mile"):this._setScale(e,a,"foot")}else this.options.unit==="nautical"?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,i){this._map._requestDomTask(()=>{const r=function(n){const s=Math.pow(10,`${Math.floor(n)}`.length-1);let a=n/s;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(l){const c=Math.pow(10,Math.ceil(-Math.log(l)/Math.LN10));return Math.round(l*c)/c}(a),s*a}(t),o=r/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${u5[i]}`,this._container.style.width=e*o+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=ci("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof k.HTMLElement?this._container=e.container:Y("Full screen control 'container' must be a DOM element.")),ir(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in k.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in k.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=ci("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Y("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,k.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!k.document.fullscreenEnabled&&!k.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=ci("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ci("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),k.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(k.document.fullscreenElement||k.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?k.document.exitFullscreen?k.document.exitFullscreen():k.document.webkitCancelFullScreen&&k.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends qi{constructor(e){super(),this.options=Vt(Object.create(e5),e),ir(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Tt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Tt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=se.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(k.document.createTextNode(e))}setHTML(e){const t=k.document.createDocumentFragment(),i=k.document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ci("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const i=this._closeButton=ci("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const o=i.offsetWidth,n=i.offsetHeight,s=r.x<o/2,a=r.x>t.transform.width-o/2;if(r.y+e<n)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-n){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let r=this._container;if(r||(r=this._container=ci("div","mapboxgl-popup",t.getContainer()),this._tip=ci("div","mapboxgl-popup-tip",r),r.appendChild(i)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=z2(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const o=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),n=P2(this.options.offset),s=this._anchor=this._getAnchor(n.y),a=P2(this.options.offset,s),l=o.add(a).round();t._requestDomTask(()=>{this._container&&s&&(this._container.style.transform=`${Pg[s]} translate(${l.x}px,${l.y}px)`)})}if(!this._marker&&t._showingGlobe()){const o=Zu(t.transform,this._lngLat)?0:1;this._setOpacity(o)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(i5);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Rg,Style:Uo,LngLat:se,LngLatBounds:Wr,Point:B,MercatorCoordinate:De,FreeCameraOptions:qv,Evented:qi,config:X,prewarm:function(){yc().acquire(og)},clearPrewarmedResources:function(){const e=_c;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(og),_c=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return X.ACCESS_TOKEN},set accessToken(e){X.ACCESS_TOKEN=e},get baseApiUrl(){return X.API_URL},set baseApiUrl(e){X.API_URL=e},get workerCount(){return Qa.workerCount},set workerCount(e){Qa.workerCount=e},get maxParallelImageRequests(){return X.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){X.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){(function(t){if(!da())return;const i=k.caches.delete(mi);t&&i.catch(t).then(()=>t())})(e)},workerUrl:"",workerClass:null,get dracoUrl(){return nw()},set dracoUrl(e){(function(t){ng=ce.resolveURL(t),sg||(sg=new $s(yc(),new qi)),sg.broadcast("setDracoUrl",ng)})(e)},setNow:ce.setNow,restoreNow:ce.restoreNow};L.A=Yb,L.D=uh,L.E=at,L.F=Am,L.K=Hh,L.O=Ue,L.P=B,L.T=mb,L.V=nh,L.a=oh,L.b=Hx,L.c=Fh,L.d=class extends qi{constructor(e,t,i,r,o,n){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=o||rw,this.loading={},this.loaded={},this.deduped=new iw(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler,this.brightness=n}loadTile(e,t){const i=e.uid,r=e&&e.request,o=r&&r.collectResourceTiming,n=this.loading[i]=new kI(e);n.abort=this.loadVectorData(e,(s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return n.status="done",l||(this.loaded[i]=n),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),n.vectorTile=a.vectorTile||new Sm(new ch(c));const p=()=>{n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,(f,g)=>{if(f||!g)return t(f);const _={};if(o){const y=W_(r);y.length>0&&(_.resourceTiming=JSON.parse(JSON.stringify(y)))}t(null,Vt({rawTileData:c.slice(0)},g,u,_))})};this.isSpriteLoaded?p():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):p()}),this.loaded=this.loaded||{},this.loaded[i]=n})}reloadTile(e,t){const i=this.loaded,r=e.uid,o=this;if(i&&i[r]){const n=i[r];n.showCollisionBoxes=e.showCollisionBoxes,n.projection=e.projection,n.brightness=e.brightness,n.tileTransform=Vs(e.tileID.canonical,e.projection),n.extraShadowCaster=e.extraShadowCaster;const s=(a,l)=>{const c=n.reloadCallback;c&&(delete n.reloadCallback,n.parse(n.vectorTile,o.layerIndex,this.availableImages,o.actor,c)),t(a,l)};n.status==="parsing"?n.reloadCallback=s:n.status==="done"&&(n.vectorTile?n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else t(null,void 0)}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}},L.e=Un,L.f=W_,L.g=ke,L.h=Mt,L.i=Dt,L.j=function(e,t){const i=dg(e);for(const r of i){for(const o of r.meshes)VI(o);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(jI(r.lights,t)))}return i},L.k=Ti,L.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==aw){const i=new Uint32Array(e,0,7),[,,r,o,n,s]=i;t=i.byteLength+o+n+s+n,(r!==e.byteLength||t>=e.byteLength)&&Y("Invalid b3dm header information.")}return hw(e,t)},L.m=xh,L.n=bo,L.o=Tt,L.p=yi,L.q=function(e){jr(),zr&&zr.then(t=>{t.keys().then(i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])})})},L.r=gw,L.s=cd,L.t=Hl,L.v=ws,L.w=k}),C(["./shared"],function(L){function k(Et){if(typeof Et=="number"||typeof Et=="boolean"||typeof Et=="string"||Et==null)return JSON.stringify(Et);if(Array.isArray(Et)){let q="[";for(const Y of Et)q+=`${k(Y)},`;return`${q}]`}let V="{";for(const q of Object.keys(Et).sort())V+=`${q}:${k(Et[q])},`;return`${V}}`}function J(Et){let V="";for(const q of L.r)V+=`/${k(Et[q])}`;return V}class G{constructor(V){this.keyCache={},this._layers={},this._layerConfigs={},V&&this.replace(V)}replace(V,q){this._layerConfigs={},this._layers={},this.update(V,[],q)}update(V,q,Y){this._options=Y;for(const xt of V){this._layerConfigs[xt.id]=xt;const Bt=this._layers[xt.id]=L.c(xt,this._options);Bt.setScope(this.scope),Bt.compileFilter(),this.keyCache[xt.id]&&delete this.keyCache[xt.id]}for(const xt of q)delete this.keyCache[xt],delete this._layerConfigs[xt],delete this._layers[xt];this.familiesBySource={};const _t=function(xt,Bt){const Zt={};for(let Wt=0;Wt<xt.length;Wt++){const ue=Bt&&Bt[xt[Wt].id]||J(xt[Wt]);Bt&&(Bt[xt[Wt].id]=ue);let le=Zt[ue];le||(le=Zt[ue]=[]),le.push(xt[Wt])}const vt=[];for(const Wt in Zt)vt.push(Zt[Wt]);return vt}(L.v(this._layerConfigs),this.keyCache);for(const xt of _t){const Bt=xt.map(ui=>this._layers[ui.id]),Zt=Bt[0];if(Zt.visibility==="none")continue;const vt=Zt.source||"";let Wt=this.familiesBySource[vt];Wt||(Wt=this.familiesBySource[vt]={});const ue=Zt.sourceLayer||"_geojsonTileLayer";let le=Wt[ue];le||(le=Wt[ue]=[]),le.push(Bt)}}}class X{loadTile(V,q){const{uid:Y,encoding:_t,rawImageData:xt,padding:Bt}=V,Zt=L.w.ImageBitmap&&xt instanceof L.w.ImageBitmap?this.getImageData(xt,Bt):xt;q(null,new L.D(Y,Zt,_t,Bt<1))}getImageData(V,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const Y=this.offscreenCanvasContext.getImageData(-q,-q,V.width+2*q,V.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Y}}function et(Et,V){if(Et.length!==0){ct(Et[0],V);for(var q=1;q<Et.length;q++)ct(Et[q],!V)}}function ct(Et,V){for(var q=0,Y=0,_t=0,xt=Et.length,Bt=xt-1;_t<xt;Bt=_t++){var Zt=(Et[_t][0]-Et[Bt][0])*(Et[Bt][1]+Et[_t][1]),vt=q+Zt;Y+=Math.abs(q)>=Math.abs(Zt)?q-vt+Zt:Zt-vt+q,q=vt}q+Y>=0!=!!V&&Et.reverse()}var gt=L.g(function Et(V,q){var Y,_t=V&&V.type;if(_t==="FeatureCollection")for(Y=0;Y<V.features.length;Y++)Et(V.features[Y],q);else if(_t==="GeometryCollection")for(Y=0;Y<V.geometries.length;Y++)Et(V.geometries[Y],q);else if(_t==="Feature")Et(V.geometry,q);else if(_t==="Polygon")et(V.coordinates,q);else if(_t==="MultiPolygon")for(Y=0;Y<V.coordinates.length;Y++)et(V.coordinates[Y],q);return V});const dt=L.V.prototype.toGeoJSON;var At={exports:{}},Jt=L.p,qe=L.a.VectorTileFeature,ke=Be;function Be(Et,V){this.options=V||{},this.features=Et,this.length=Et.length}function hi(Et,V){this.id=typeof Et.id=="number"?Et.id:void 0,this.type=Et.type,this.rawGeometry=Et.type===1?[Et.geometry]:Et.geometry,this.properties=Et.tags,this.extent=V||4096}Be.prototype.feature=function(Et){return new hi(this.features[Et],this.options.extent)},hi.prototype.loadGeometry=function(){var Et=this.rawGeometry;this.geometry=[];for(var V=0;V<Et.length;V++){for(var q=Et[V],Y=[],_t=0;_t<q.length;_t++)Y.push(new Jt(q[_t][0],q[_t][1]));this.geometry.push(Y)}return this.geometry},hi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Et=this.geometry,V=1/0,q=-1/0,Y=1/0,_t=-1/0,xt=0;xt<Et.length;xt++)for(var Bt=Et[xt],Zt=0;Zt<Bt.length;Zt++){var vt=Bt[Zt];V=Math.min(V,vt.x),q=Math.max(q,vt.x),Y=Math.min(Y,vt.y),_t=Math.max(_t,vt.y)}return[V,Y,q,_t]},hi.prototype.toGeoJSON=qe.prototype.toGeoJSON;var ze=L.b,yi=ke;function pe(Et){var V=new ze;return function(q,Y){for(var _t in q.layers)Y.writeMessage(3,B,q.layers[_t])}(Et,V),V.finish()}function B(Et,V){var q;V.writeVarintField(15,Et.version||1),V.writeStringField(1,Et.name||""),V.writeVarintField(5,Et.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<Et.length;q++)Y.feature=Et.feature(q),V.writeMessage(2,st,Y);var _t=Y.keys;for(q=0;q<_t.length;q++)V.writeStringField(3,_t[q]);var xt=Y.values;for(q=0;q<xt.length;q++)V.writeMessage(4,ai,xt[q])}function st(Et,V){var q=Et.feature;q.id!==void 0&&V.writeVarintField(1,q.id),V.writeMessage(2,Qt,Et),V.writeVarintField(3,q.type),V.writeMessage(4,Te,q)}function Qt(Et,V){var q=Et.feature,Y=Et.keys,_t=Et.values,xt=Et.keycache,Bt=Et.valuecache;for(var Zt in q.properties){var vt=q.properties[Zt],Wt=xt[Zt];if(vt!==null){Wt===void 0&&(Y.push(Zt),xt[Zt]=Wt=Y.length-1),V.writeVarint(Wt);var ue=typeof vt;ue!=="string"&&ue!=="boolean"&&ue!=="number"&&(vt=JSON.stringify(vt));var le=ue+":"+vt,ui=Bt[le];ui===void 0&&(_t.push(vt),Bt[le]=ui=_t.length-1),V.writeVarint(ui)}}}function Le(Et,V){return(V<<3)+(7&Et)}function Ft(Et){return Et<<1^Et>>31}function Te(Et,V){for(var q=Et.loadGeometry(),Y=Et.type,_t=0,xt=0,Bt=q.length,Zt=0;Zt<Bt;Zt++){var vt=q[Zt],Wt=1;Y===1&&(Wt=vt.length),V.writeVarint(Le(1,Wt));for(var ue=Y===3?vt.length-1:vt.length,le=0;le<ue;le++){le===1&&Y!==1&&V.writeVarint(Le(2,ue-1));var ui=vt[le].x-_t,ki=vt[le].y-xt;V.writeVarint(Ft(ui)),V.writeVarint(Ft(ki)),_t+=ui,xt+=ki}Y===3&&V.writeVarint(Le(7,1))}}function ai(Et,V){var q=typeof Et;q==="string"?V.writeStringField(1,Et):q==="boolean"?V.writeBooleanField(7,Et):q==="number"&&(Et%1!=0?V.writeDoubleField(3,Et):Et<0?V.writeSVarintField(6,Et):V.writeVarintField(5,Et))}At.exports=pe,At.exports.fromVectorTileJs=pe,At.exports.fromGeojsonVt=function(Et,V){V=V||{};var q={};for(var Y in Et)q[Y]=new yi(Et[Y].features,V),q[Y].name=Y,q[Y].version=V.version,q[Y].extent=V.extent;return pe({layers:q})},At.exports.GeoJSONWrapper=yi;var ri=L.g(At.exports);const Ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Et=>Et},Sr=Math.fround||(Mr=new Float32Array(1),Et=>(Mr[0]=+Et,Mr[0]));var Mr;const Gi=3,Ut=5,oo=6;class Nr{constructor(V){this.options=Object.assign(Object.create(Ai),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:q,minZoom:Y,maxZoom:_t}=this.options;q&&console.time("total time");const xt=`prepare ${V.length} points`;q&&console.time(xt),this.points=V;const Bt=[];for(let vt=0;vt<V.length;vt++){const Wt=V[vt];if(!Wt.geometry)continue;const[ue,le]=Wt.geometry.coordinates,ui=Sr(Vt(ue)),ki=Sr(Vr(le));Bt.push(ui,ki,1/0,vt,-1,1),this.options.reduce&&Bt.push(0)}let Zt=this.trees[_t+1]=this._createTree(Bt);q&&console.timeEnd(xt);for(let vt=_t;vt>=Y;vt--){const Wt=+Date.now();Zt=this.trees[vt]=this._createTree(this._cluster(Zt,vt)),q&&console.log("z%d: %d clusters in %dms",vt,Zt.numItems,+Date.now()-Wt)}return q&&console.timeEnd("total time"),this}getClusters(V,q){let Y=((V[0]+180)%360+360)%360-180;const _t=Math.max(-90,Math.min(90,V[1]));let xt=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Bt=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Y=-180,xt=180;else if(Y>xt){const le=this.getClusters([Y,_t,180,Bt],q),ui=this.getClusters([-180,_t,xt,Bt],q);return le.concat(ui)}const Zt=this.trees[this._limitZoom(q)],vt=Zt.range(Vt(Y),Vr(Bt),Vt(xt),Vr(_t)),Wt=Zt.data,ue=[];for(const le of vt){const ui=this.stride*le;ue.push(Wt[ui+Ut]>1?Do(Wt,ui,this.clusterProps):this.points[Wt[ui+Gi]])}return ue}getChildren(V){const q=this._getOriginId(V),Y=this._getOriginZoom(V),_t="No cluster with the specified id.",xt=this.trees[Y];if(!xt)throw new Error(_t);const Bt=xt.data;if(q*this.stride>=Bt.length)throw new Error(_t);const Zt=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),vt=xt.within(Bt[q*this.stride],Bt[q*this.stride+1],Zt),Wt=[];for(const ue of vt){const le=ue*this.stride;Bt[le+4]===V&&Wt.push(Bt[le+Ut]>1?Do(Bt,le,this.clusterProps):this.points[Bt[le+Gi]])}if(Wt.length===0)throw new Error(_t);return Wt}getLeaves(V,q,Y){const _t=[];return this._appendLeaves(_t,V,q=q||10,Y=Y||0,0),_t}getTile(V,q,Y){const _t=this.trees[this._limitZoom(V)],xt=Math.pow(2,V),{extent:Bt,radius:Zt}=this.options,vt=Zt/Bt,Wt=(Y-vt)/xt,ue=(Y+1+vt)/xt,le={features:[]};return this._addTileFeatures(_t.range((q-vt)/xt,Wt,(q+1+vt)/xt,ue),_t.data,q,Y,xt,le),q===0&&this._addTileFeatures(_t.range(1-vt/xt,Wt,1,ue),_t.data,xt,Y,xt,le),q===xt-1&&this._addTileFeatures(_t.range(0,Wt,vt/xt,ue),_t.data,-1,Y,xt,le),le.features.length?le:null}getClusterExpansionZoom(V){let q=this._getOriginZoom(V)-1;for(;q<=this.options.maxZoom;){const Y=this.getChildren(V);if(q++,Y.length!==1)break;V=Y[0].properties.cluster_id}return q}_appendLeaves(V,q,Y,_t,xt){const Bt=this.getChildren(q);for(const Zt of Bt){const vt=Zt.properties;if(vt&&vt.cluster?xt+vt.point_count<=_t?xt+=vt.point_count:xt=this._appendLeaves(V,vt.cluster_id,Y,_t,xt):xt<_t?xt++:V.push(Zt),V.length===Y)break}return xt}_createTree(V){const q=new L.K(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<V.length;Y+=this.stride)q.add(V[Y],V[Y+1]);return q.finish(),q.data=V,q}_addTileFeatures(V,q,Y,_t,xt,Bt){for(const Zt of V){const vt=Zt*this.stride,Wt=q[vt+Ut]>1;let ue,le,ui;if(Wt)ue=ws(q,vt,this.clusterProps),le=q[vt],ui=q[vt+1];else{const Di=this.points[q[vt+Gi]];ue=Di.properties;const[Ni,mi]=Di.geometry.coordinates;le=Vt(Ni),ui=Vr(mi)}const ki={type:1,geometry:[[Math.round(this.options.extent*(le*xt-Y)),Math.round(this.options.extent*(ui*xt-_t))]],tags:ue};let cr;cr=Wt||this.options.generateId?q[vt+Gi]:this.points[q[vt+Gi]].id,cr!==void 0&&(ki.id=cr),Bt.features.push(ki)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,q){const{radius:Y,extent:_t,reduce:xt,minPoints:Bt}=this.options,Zt=Y/(_t*Math.pow(2,q)),vt=V.data,Wt=[],ue=this.stride;for(let le=0;le<vt.length;le+=ue){if(vt[le+2]<=q)continue;vt[le+2]=q;const ui=vt[le],ki=vt[le+1],cr=V.within(vt[le],vt[le+1],Zt),Di=vt[le+Ut];let Ni=Di;for(const mi of cr){const yr=mi*ue;vt[yr+2]>q&&(Ni+=vt[yr+Ut])}if(Ni>Di&&Ni>=Bt){let mi,yr=ui*Di,Dr=ki*Di,zr=-1;const zo=((le/ue|0)<<5)+(q+1)+this.points.length;for(const da of cr){const jr=da*ue;if(vt[jr+2]<=q)continue;vt[jr+2]=q;const hn=vt[jr+Ut];yr+=vt[jr]*hn,Dr+=vt[jr+1]*hn,vt[jr+4]=zo,xt&&(mi||(mi=this._map(vt,le,!0),zr=this.clusterProps.length,this.clusterProps.push(mi)),xt(mi,this._map(vt,jr)))}vt[le+4]=zo,Wt.push(yr/Ni,Dr/Ni,1/0,zo,-1,Ni),xt&&Wt.push(zr)}else{for(let mi=0;mi<ue;mi++)Wt.push(vt[le+mi]);if(Ni>1)for(const mi of cr){const yr=mi*ue;if(!(vt[yr+2]<=q)){vt[yr+2]=q;for(let Dr=0;Dr<ue;Dr++)Wt.push(vt[yr+Dr])}}}}return Wt}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,q,Y){if(V[q+Ut]>1){const Bt=this.clusterProps[V[q+oo]];return Y?Object.assign({},Bt):Bt}const _t=this.points[V[q+Gi]].properties,xt=this.options.map(_t);return Y&&xt===_t?Object.assign({},xt):xt}}function Do(Et,V,q){return{type:"Feature",id:Et[V+Gi],properties:ws(Et,V,q),geometry:{type:"Point",coordinates:[(Y=Et[V],360*(Y-.5)),tp(Et[V+1])]}};var Y}function ws(Et,V,q){const Y=Et[V+Ut],_t=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,xt=Et[V+oo],Bt=xt===-1?{}:Object.assign({},q[xt]);return Object.assign(Bt,{cluster:!0,cluster_id:Et[V+Gi],point_count:Y,point_count_abbreviated:_t})}function Vt(Et){return Et/360+.5}function Vr(Et){const V=Math.sin(Et*Math.PI/180),q=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return q<0?0:q>1?1:q}function tp(Et){const V=(180-360*Et)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}var ca={exports:{}};ca.exports=function(){function Et(ht,ft,wt,St){for(var Mt,Dt=St,Pt=wt-ft>>1,Ct=wt-ft,Gt=ht[ft],zt=ht[ft+1],_e=ht[wt],oi=ht[wt+1],Kt=ft+3;Kt<wt;Kt+=3){var Ke=V(ht[Kt],ht[Kt+1],Gt,zt,_e,oi);if(Ke>Dt)Mt=Kt,Dt=Ke;else if(Ke===Dt){var zi=Math.abs(Kt-Pt);zi<Ct&&(Mt=Kt,Ct=zi)}}Dt>St&&(Mt-ft>3&&Et(ht,ft,Mt,St),ht[Mt+2]=Dt,wt-Mt>3&&Et(ht,Mt,wt,St))}function V(ht,ft,wt,St,Mt,Dt){var Pt=Mt-wt,Ct=Dt-St;if(Pt!==0||Ct!==0){var Gt=((ht-wt)*Pt+(ft-St)*Ct)/(Pt*Pt+Ct*Ct);Gt>1?(wt=Mt,St=Dt):Gt>0&&(wt+=Pt*Gt,St+=Ct*Gt)}return(Pt=ht-wt)*Pt+(Ct=ft-St)*Ct}function q(ht,ft,wt,St){var Mt={id:ht===void 0?null:ht,type:ft,geometry:wt,tags:St,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Dt){var Pt=Dt.geometry,Ct=Dt.type;if(Ct==="Point"||Ct==="MultiPoint"||Ct==="LineString")Y(Dt,Pt);else if(Ct==="Polygon"||Ct==="MultiLineString")for(var Gt=0;Gt<Pt.length;Gt++)Y(Dt,Pt[Gt]);else if(Ct==="MultiPolygon")for(Gt=0;Gt<Pt.length;Gt++)for(var zt=0;zt<Pt[Gt].length;zt++)Y(Dt,Pt[Gt][zt])}(Mt),Mt}function Y(ht,ft){for(var wt=0;wt<ft.length;wt+=3)ht.minX=Math.min(ht.minX,ft[wt]),ht.minY=Math.min(ht.minY,ft[wt+1]),ht.maxX=Math.max(ht.maxX,ft[wt]),ht.maxY=Math.max(ht.maxY,ft[wt+1])}function _t(ht,ft,wt,St){if(ft.geometry){var Mt=ft.geometry.coordinates,Dt=ft.geometry.type,Pt=Math.pow(wt.tolerance/((1<<wt.maxZoom)*wt.extent),2),Ct=[],Gt=ft.id;if(wt.promoteId?Gt=ft.properties[wt.promoteId]:wt.generateId&&(Gt=St||0),Dt==="Point")xt(Mt,Ct);else if(Dt==="MultiPoint")for(var zt=0;zt<Mt.length;zt++)xt(Mt[zt],Ct);else if(Dt==="LineString")Bt(Mt,Ct,Pt,!1);else if(Dt==="MultiLineString"){if(wt.lineMetrics){for(zt=0;zt<Mt.length;zt++)Bt(Mt[zt],Ct=[],Pt,!1),ht.push(q(Gt,"LineString",Ct,ft.properties));return}Zt(Mt,Ct,Pt,!1)}else if(Dt==="Polygon")Zt(Mt,Ct,Pt,!0);else{if(Dt!=="MultiPolygon"){if(Dt==="GeometryCollection"){for(zt=0;zt<ft.geometry.geometries.length;zt++)_t(ht,{id:Gt,geometry:ft.geometry.geometries[zt],properties:ft.properties},wt,St);return}throw new Error("Input data is not a valid GeoJSON object.")}for(zt=0;zt<Mt.length;zt++){var _e=[];Zt(Mt[zt],_e,Pt,!0),Ct.push(_e)}}ht.push(q(Gt,Dt,Ct,ft.properties))}}function xt(ht,ft){ft.push(vt(ht[0])),ft.push(Wt(ht[1])),ft.push(0)}function Bt(ht,ft,wt,St){for(var Mt,Dt,Pt=0,Ct=0;Ct<ht.length;Ct++){var Gt=vt(ht[Ct][0]),zt=Wt(ht[Ct][1]);ft.push(Gt),ft.push(zt),ft.push(0),Ct>0&&(Pt+=St?(Mt*zt-Gt*Dt)/2:Math.sqrt(Math.pow(Gt-Mt,2)+Math.pow(zt-Dt,2))),Mt=Gt,Dt=zt}var _e=ft.length-3;ft[2]=1,Et(ft,0,_e,wt),ft[_e+2]=1,ft.size=Math.abs(Pt),ft.start=0,ft.end=ft.size}function Zt(ht,ft,wt,St){for(var Mt=0;Mt<ht.length;Mt++){var Dt=[];Bt(ht[Mt],Dt,wt,St),ft.push(Dt)}}function vt(ht){return ht/360+.5}function Wt(ht){var ft=Math.sin(ht*Math.PI/180),wt=.5-.25*Math.log((1+ft)/(1-ft))/Math.PI;return wt<0?0:wt>1?1:wt}function ue(ht,ft,wt,St,Mt,Dt,Pt,Ct){if(St/=ft,Dt>=(wt/=ft)&&Pt<St)return ht;if(Pt<wt||Dt>=St)return null;for(var Gt=[],zt=0;zt<ht.length;zt++){var _e=ht[zt],oi=_e.geometry,Kt=_e.type,Ke=Mt===0?_e.minX:_e.minY,zi=Mt===0?_e.maxX:_e.maxY;if(Ke>=wt&&zi<St)Gt.push(_e);else if(!(zi<wt||Ke>=St)){var Vi=[];if(Kt==="Point"||Kt==="MultiPoint")le(oi,Vi,wt,St,Mt);else if(Kt==="LineString")ui(oi,Vi,wt,St,Mt,!1,Ct.lineMetrics);else if(Kt==="MultiLineString")cr(oi,Vi,wt,St,Mt,!1);else if(Kt==="Polygon")cr(oi,Vi,wt,St,Mt,!0);else if(Kt==="MultiPolygon")for(var Xi=0;Xi<oi.length;Xi++){var xr=[];cr(oi[Xi],xr,wt,St,Mt,!0),xr.length&&Vi.push(xr)}if(Vi.length){if(Ct.lineMetrics&&Kt==="LineString"){for(Xi=0;Xi<Vi.length;Xi++)Gt.push(q(_e.id,Kt,Vi[Xi],_e.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(Vi.length===1?(Kt="LineString",Vi=Vi[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=Vi.length===3?"Point":"MultiPoint"),Gt.push(q(_e.id,Kt,Vi,_e.tags))}}}return Gt.length?Gt:null}function le(ht,ft,wt,St,Mt){for(var Dt=0;Dt<ht.length;Dt+=3){var Pt=ht[Dt+Mt];Pt>=wt&&Pt<=St&&(ft.push(ht[Dt]),ft.push(ht[Dt+1]),ft.push(ht[Dt+2]))}}function ui(ht,ft,wt,St,Mt,Dt,Pt){for(var Ct,Gt,zt=ki(ht),_e=Mt===0?Ni:mi,oi=ht.start,Kt=0;Kt<ht.length-3;Kt+=3){var Ke=ht[Kt],zi=ht[Kt+1],Vi=ht[Kt+2],Xi=ht[Kt+3],xr=ht[Kt+4],_o=Mt===0?Ke:zi,rr=Mt===0?Xi:xr,Pr=!1;Pt&&(Ct=Math.sqrt(Math.pow(Ke-Xi,2)+Math.pow(zi-xr,2))),_o<wt?rr>wt&&(Gt=_e(zt,Ke,zi,Xi,xr,wt),Pt&&(zt.start=oi+Ct*Gt)):_o>St?rr<St&&(Gt=_e(zt,Ke,zi,Xi,xr,St),Pt&&(zt.start=oi+Ct*Gt)):Di(zt,Ke,zi,Vi),rr<wt&&_o>=wt&&(Gt=_e(zt,Ke,zi,Xi,xr,wt),Pr=!0),rr>St&&_o<=St&&(Gt=_e(zt,Ke,zi,Xi,xr,St),Pr=!0),!Dt&&Pr&&(Pt&&(zt.end=oi+Ct*Gt),ft.push(zt),zt=ki(ht)),Pt&&(oi+=Ct)}var vr=ht.length-3;Ke=ht[vr],zi=ht[vr+1],Vi=ht[vr+2],(_o=Mt===0?Ke:zi)>=wt&&_o<=St&&Di(zt,Ke,zi,Vi),vr=zt.length-3,Dt&&vr>=3&&(zt[vr]!==zt[0]||zt[vr+1]!==zt[1])&&Di(zt,zt[0],zt[1],zt[2]),zt.length&&ft.push(zt)}function ki(ht){var ft=[];return ft.size=ht.size,ft.start=ht.start,ft.end=ht.end,ft}function cr(ht,ft,wt,St,Mt,Dt){for(var Pt=0;Pt<ht.length;Pt++)ui(ht[Pt],ft,wt,St,Mt,Dt,!1)}function Di(ht,ft,wt,St){ht.push(ft),ht.push(wt),ht.push(St)}function Ni(ht,ft,wt,St,Mt,Dt){var Pt=(Dt-ft)/(St-ft);return ht.push(Dt),ht.push(wt+(Mt-wt)*Pt),ht.push(1),Pt}function mi(ht,ft,wt,St,Mt,Dt){var Pt=(Dt-wt)/(Mt-wt);return ht.push(ft+(St-ft)*Pt),ht.push(Dt),ht.push(1),Pt}function yr(ht,ft){for(var wt=[],St=0;St<ht.length;St++){var Mt,Dt=ht[St],Pt=Dt.type;if(Pt==="Point"||Pt==="MultiPoint"||Pt==="LineString")Mt=Dr(Dt.geometry,ft);else if(Pt==="MultiLineString"||Pt==="Polygon"){Mt=[];for(var Ct=0;Ct<Dt.geometry.length;Ct++)Mt.push(Dr(Dt.geometry[Ct],ft))}else if(Pt==="MultiPolygon")for(Mt=[],Ct=0;Ct<Dt.geometry.length;Ct++){for(var Gt=[],zt=0;zt<Dt.geometry[Ct].length;zt++)Gt.push(Dr(Dt.geometry[Ct][zt],ft));Mt.push(Gt)}wt.push(q(Dt.id,Pt,Mt,Dt.tags))}return wt}function Dr(ht,ft){var wt=[];wt.size=ht.size,ht.start!==void 0&&(wt.start=ht.start,wt.end=ht.end);for(var St=0;St<ht.length;St+=3)wt.push(ht[St]+ft,ht[St+1],ht[St+2]);return wt}function zr(ht,ft){if(ht.transformed)return ht;var wt,St,Mt,Dt=1<<ht.z,Pt=ht.x,Ct=ht.y;for(wt=0;wt<ht.features.length;wt++){var Gt=ht.features[wt],zt=Gt.geometry,_e=Gt.type;if(Gt.geometry=[],_e===1)for(St=0;St<zt.length;St+=2)Gt.geometry.push(zo(zt[St],zt[St+1],ft,Dt,Pt,Ct));else for(St=0;St<zt.length;St++){var oi=[];for(Mt=0;Mt<zt[St].length;Mt+=2)oi.push(zo(zt[St][Mt],zt[St][Mt+1],ft,Dt,Pt,Ct));Gt.geometry.push(oi)}}return ht.transformed=!0,ht}function zo(ht,ft,wt,St,Mt,Dt){return[Math.round(wt*(ht*St-Mt)),Math.round(wt*(ft*St-Dt))]}function da(ht,ft,wt,St,Mt){for(var Dt=ft===Mt.maxZoom?0:Mt.tolerance/((1<<ft)*Mt.extent),Pt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:wt,y:St,z:ft,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<ht.length;Ct++){Pt.numFeatures++,jr(Pt,ht[Ct],Dt,Mt);var Gt=ht[Ct].minX,zt=ht[Ct].minY,_e=ht[Ct].maxX,oi=ht[Ct].maxY;Gt<Pt.minX&&(Pt.minX=Gt),zt<Pt.minY&&(Pt.minY=zt),_e>Pt.maxX&&(Pt.maxX=_e),oi>Pt.maxY&&(Pt.maxY=oi)}return Pt}function jr(ht,ft,wt,St){var Mt=ft.geometry,Dt=ft.type,Pt=[];if(Dt==="Point"||Dt==="MultiPoint")for(var Ct=0;Ct<Mt.length;Ct+=3)Pt.push(Mt[Ct]),Pt.push(Mt[Ct+1]),ht.numPoints++,ht.numSimplified++;else if(Dt==="LineString")hn(Pt,Mt,ht,wt,!1,!1);else if(Dt==="MultiLineString"||Dt==="Polygon")for(Ct=0;Ct<Mt.length;Ct++)hn(Pt,Mt[Ct],ht,wt,Dt==="Polygon",Ct===0);else if(Dt==="MultiPolygon")for(var Gt=0;Gt<Mt.length;Gt++){var zt=Mt[Gt];for(Ct=0;Ct<zt.length;Ct++)hn(Pt,zt[Ct],ht,wt,!0,Ct===0)}if(Pt.length){var _e=ft.tags||null;if(Dt==="LineString"&&St.lineMetrics){for(var oi in _e={},ft.tags)_e[oi]=ft.tags[oi];_e.mapbox_clip_start=Mt.start/Mt.size,_e.mapbox_clip_end=Mt.end/Mt.size}var Kt={geometry:Pt,type:Dt==="Polygon"||Dt==="MultiPolygon"?3:Dt==="LineString"||Dt==="MultiLineString"?2:1,tags:_e};ft.id!==null&&(Kt.id=ft.id),ht.features.push(Kt)}}function hn(ht,ft,wt,St,Mt,Dt){var Pt=St*St;if(St>0&&ft.size<(Mt?Pt:St))wt.numPoints+=ft.length/3;else{for(var Ct=[],Gt=0;Gt<ft.length;Gt+=3)(St===0||ft[Gt+2]>Pt)&&(wt.numSimplified++,Ct.push(ft[Gt]),Ct.push(ft[Gt+1])),wt.numPoints++;Mt&&function(zt,_e){for(var oi=0,Kt=0,Ke=zt.length,zi=Ke-2;Kt<Ke;zi=Kt,Kt+=2)oi+=(zt[Kt]-zt[zi])*(zt[Kt+1]+zt[zi+1]);if(oi>0===_e)for(Kt=0,Ke=zt.length;Kt<Ke/2;Kt+=2){var Vi=zt[Kt],Xi=zt[Kt+1];zt[Kt]=zt[Ke-2-Kt],zt[Kt+1]=zt[Ke-1-Kt],zt[Ke-2-Kt]=Vi,zt[Ke-1-Kt]=Xi}}(Ct,Dt),ht.push(Ct)}}function Nn(ht,ft){var wt=(ft=this.options=function(Mt,Dt){for(var Pt in Dt)Mt[Pt]=Dt[Pt];return Mt}(Object.create(this.options),ft)).debug;if(wt&&console.time("preprocess data"),ft.maxZoom<0||ft.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ft.promoteId&&ft.generateId)throw new Error("promoteId and generateId cannot be used together.");var St=function(Mt,Dt){var Pt=[];if(Mt.type==="FeatureCollection")for(var Ct=0;Ct<Mt.features.length;Ct++)_t(Pt,Mt.features[Ct],Dt,Ct);else _t(Pt,Mt.type==="Feature"?Mt:{geometry:Mt},Dt);return Pt}(ht,ft);this.tiles={},this.tileCoords=[],wt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ft.indexMaxZoom,ft.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(St=function(Mt,Dt){var Pt=Dt.buffer/Dt.extent,Ct=Mt,Gt=ue(Mt,1,-1-Pt,Pt,0,-1,2,Dt),zt=ue(Mt,1,1-Pt,2+Pt,0,-1,2,Dt);return(Gt||zt)&&(Ct=ue(Mt,1,-Pt,1+Pt,0,-1,2,Dt)||[],Gt&&(Ct=yr(Gt,1).concat(Ct)),zt&&(Ct=Ct.concat(yr(zt,-1)))),Ct}(St,ft)).length&&this.splitTile(St,0,0,0),wt&&(St.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pa(ht,ft,wt){return 32*((1<<ht)*wt+ft)+ht}return Nn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nn.prototype.splitTile=function(ht,ft,wt,St,Mt,Dt,Pt){for(var Ct=[ht,ft,wt,St],Gt=this.options,zt=Gt.debug;Ct.length;){St=Ct.pop(),wt=Ct.pop(),ft=Ct.pop(),ht=Ct.pop();var _e=1<<ft,oi=pa(ft,wt,St),Kt=this.tiles[oi];if(!Kt&&(zt>1&&console.time("creation"),Kt=this.tiles[oi]=da(ht,ft,wt,St,Gt),this.tileCoords.push({z:ft,x:wt,y:St}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ft,wt,St,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var Ke="z"+ft;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Kt.source=ht,Mt){if(ft===Gt.maxZoom||ft===Mt)continue;var zi=1<<Mt-ft;if(wt!==Math.floor(Dt/zi)||St!==Math.floor(Pt/zi))continue}else if(ft===Gt.indexMaxZoom||Kt.numPoints<=Gt.indexMaxPoints)continue;if(Kt.source=null,ht.length!==0){zt>1&&console.time("clipping");var Vi,Xi,xr,_o,rr,Pr,vr=.5*Gt.buffer/Gt.extent,fa=.5-vr,Vn=.5+vr,ma=1+vr;Vi=Xi=xr=_o=null,rr=ue(ht,_e,wt-vr,wt+Vn,0,Kt.minX,Kt.maxX,Gt),Pr=ue(ht,_e,wt+fa,wt+ma,0,Kt.minX,Kt.maxX,Gt),ht=null,rr&&(Vi=ue(rr,_e,St-vr,St+Vn,1,Kt.minY,Kt.maxY,Gt),Xi=ue(rr,_e,St+fa,St+ma,1,Kt.minY,Kt.maxY,Gt),rr=null),Pr&&(xr=ue(Pr,_e,St-vr,St+Vn,1,Kt.minY,Kt.maxY,Gt),_o=ue(Pr,_e,St+fa,St+ma,1,Kt.minY,Kt.maxY,Gt),Pr=null),zt>1&&console.timeEnd("clipping"),Ct.push(Vi||[],ft+1,2*wt,2*St),Ct.push(Xi||[],ft+1,2*wt,2*St+1),Ct.push(xr||[],ft+1,2*wt+1,2*St),Ct.push(_o||[],ft+1,2*wt+1,2*St+1)}}},Nn.prototype.getTile=function(ht,ft,wt){var St=this.options,Mt=St.extent,Dt=St.debug;if(ht<0||ht>24)return null;var Pt=1<<ht,Ct=pa(ht,ft=(ft%Pt+Pt)%Pt,wt);if(this.tiles[Ct])return zr(this.tiles[Ct],Mt);Dt>1&&console.log("drilling down to z%d-%d-%d",ht,ft,wt);for(var Gt,zt=ht,_e=ft,oi=wt;!Gt&&zt>0;)zt--,_e=Math.floor(_e/2),oi=Math.floor(oi/2),Gt=this.tiles[pa(zt,_e,oi)];return Gt&&Gt.source?(Dt>1&&console.log("found parent tile z%d-%d-%d",zt,_e,oi),Dt>1&&console.time("drilling down"),this.splitTile(Gt.source,zt,_e,oi,ht,ft,wt),Dt>1&&console.timeEnd("drilling down"),this.tiles[Ct]?zr(this.tiles[Ct],Mt):null):null},function(ht,ft){return new Nn(ht,ft)}}();var Xc=L.g(ca.exports);function Yc(Et,V){const q=Et.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const Y=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!Y)return V(null,null);const _t=new class{constructor(Bt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=L.E,this.length=Bt.length,this._features=Bt}feature(Bt){return new class{constructor(Zt){this._feature=Zt,this.extent=L.E,this.type=Zt.type,this.properties=Zt.tags,"id"in Zt&&!isNaN(Zt.id)&&(this.id=parseInt(Zt.id,10))}loadGeometry(){if(this._feature.type===1){const Zt=[];for(const vt of this._feature.geometry)Zt.push([new L.P(vt[0],vt[1])]);return Zt}{const Zt=[];for(const vt of this._feature.geometry){const Wt=[];for(const ue of vt)Wt.push(new L.P(ue[0],ue[1]));Zt.push(Wt)}return Zt}}toGeoJSON(Zt,vt,Wt){return dt.call(this,Zt,vt,Wt)}}(this._features[Bt])}}(Y.features);let xt=ri(_t);xt.byteOffset===0&&xt.byteLength===xt.buffer.byteLength||(xt=new Uint8Array(xt)),V(null,{vectorTile:_t,rawData:xt.buffer})}class Jc extends L.d{constructor(V,q,Y,_t,xt,Bt){super(V,q,Y,_t,Yc,Bt),xt&&(this.loadGeoJSON=xt)}loadData(V,q){const Y=V&&V.request,_t=Y&&Y.collectResourceTiming;this.loadGeoJSON(V,(xt,Bt)=>{if(xt||!Bt)return q(xt);if(typeof Bt!="object")return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{gt(Bt,!0);try{if(V.filter){const vt=L.e(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(vt.result==="error")throw new Error(vt.value.map(Wt=>`${Wt.key}: ${Wt.message}`).join(", "));Bt={type:"FeatureCollection",features:Bt.features.filter(Wt=>vt.value.evaluate({zoom:0},Wt))}}this._geoJSONIndex=V.cluster?new Nr(function({superclusterOptions:vt,clusterProperties:Wt}){if(!Wt||!vt)return vt;const ue={},le={},ui={accumulated:null,zoom:0},ki={properties:null},cr=Object.keys(Wt);for(const Di of cr){const[Ni,mi]=Wt[Di],yr=L.e(mi),Dr=L.e(typeof Ni=="string"?[Ni,["accumulated"],["get",Di]]:Ni);ue[Di]=yr.value,le[Di]=Dr.value}return vt.map=Di=>{ki.properties=Di;const Ni={};for(const mi of cr)Ni[mi]=ue[mi].evaluate(ui,ki);return Ni},vt.reduce=(Di,Ni)=>{ki.properties=Ni;for(const mi of cr)ui.accumulated=Di[mi],Di[mi]=le[mi].evaluate(ui,ki)},vt}(V)).load(Bt.features):Xc(Bt,V.geojsonVtOptions)}catch(vt){return q(vt)}this.loaded={};const Zt={};if(_t){const vt=L.f(Y);vt&&(Zt.resourceTiming={},Zt.resourceTiming[V.source]=JSON.parse(JSON.stringify(vt)))}q(null,Zt)}})}reloadTile(V,q){const Y=this.loaded;return Y&&Y[V.uid]?super.reloadTile(V,q):this.loadTile(V,q)}loadGeoJSON(V,q){if(V.request)L.h(V.request,q);else{if(typeof V.data!="string")return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(V.data))}catch{return q(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(Y){q(Y)}}getClusterChildren(V,q){try{q(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(Y){q(Y)}}getClusterLeaves(V,q){try{q(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(Y){q(Y)}}}class ir{constructor(V,q){this.tileID=new L.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=V.projection,this.brightness=q}parse(V,q,Y,_t){this.status="parsing";const xt=new L.O(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),Bt={},Zt=q.familiesBySource[Y.source],vt=new L.F(xt,Y.promoteId);return vt.bucketLayerIDs=[],L.l(V).then(Wt=>{if(!Wt)return _t(new Error("Could not parse tile"));const ue=L.j(Wt,1/L.t(Y.tileID.canonical)),le=Wt.json.extensionsUsed&&Wt.json.extensionsUsed.includes("MAPBOX_mesh_features"),ui=new L.k(this.zoom,{brightness:this.brightness});for(const ki in Zt)for(const cr of Zt[ki]){const Di=cr[0],Ni=Wt.json.extensionsUsed;Di.recalculate(ui,[]);const mi=new L.T(ue,xt,Ni&&Ni.includes("MAPBOX_mesh_features"),this.brightness);le||(mi.needsUpload=!0),Bt[Di.fqid]=mi,mi.evaluate(Di)}this.status="done",_t(null,{buckets:Bt,featureIndex:vt})}).catch(Wt=>_t(new Error(Wt.message)))}}class ua{constructor(V,q,Y,_t,xt,Bt){this.actor=V,this.layerIndex=q,this.brightness=Bt,this.loading={},this.loaded={}}loadTile(V,q){const Y=V.uid,_t=this.loading[Y]=new ir(V,this.brightness);L.i(V.request,(xt,Bt)=>{const Zt=!this.loading[Y];return delete this.loading[Y],Zt||xt?(_t.status="done",Zt||(this.loaded[Y]=_t),q(xt)):Bt&&Bt.byteLength!==0?void _t.parse(Bt,this.layerIndex,V,(vt,Wt)=>{_t.status="done",this.loaded=this.loaded||{},this.loaded[Y]=_t,vt||!Wt?q(vt):q(null,Wt)}):(_t.status="done",this.loaded[Y]=_t,q())})}reloadTile(V,q){const Y=this.loaded,_t=V.uid;if(Y&&Y[_t]){const xt=Y[_t];xt.projection=V.projection,xt.brightness=V.brightness;const Bt=(Zt,vt)=>{xt.reloadCallback&&(delete xt.reloadCallback,this.loadTile(V,q)),q(Zt,vt)};xt.status==="parsing"?xt.reloadCallback=Bt:xt.status==="done"&&this.loadTile(V,q)}}abortTile(V,q){const Y=V.uid;this.loading[Y]&&delete this.loading[Y],q()}removeTile(V,q){const Y=this.loaded,_t=V.uid;Y&&Y[_t]&&delete Y[_t],q()}}class ha{constructor(V){this.self=V,this.actor=new L.A(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=L.m({name:"mercator"}),this.workerSourceTypes={vector:L.d,geojson:Jc,"batched-model":ua},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,Y)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=Y},this.self.registerRTLTextPlugin=q=>{if(L.n.isParsed())throw new Error("RTL text plugin already registered.");L.n.applyArabicShaping=q.applyArabicShaping,L.n.processBidirectionalText=q.processBidirectionalText,L.n.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(V,q,Y){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],Y()}checkIfReady(V,q,Y){Y()}setReferrer(V,q){this.referrer=q}spriteLoaded(V,{scope:q,isLoaded:Y}){if(this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),this.isSpriteLoaded[V][q]=Y,this.workerSources[V]&&this.workerSources[V][q])for(const _t in this.workerSources[V][q]){const xt=this.workerSources[V][q][_t];for(const Bt in xt)xt[Bt]instanceof L.d&&(xt[Bt].isSpriteLoaded=Y,xt[Bt].fire(new L.o("isSpriteLoaded")))}}setImages(V,{scope:q,images:Y},_t){if(this.availableImages[V]||(this.availableImages[V]={}),this.availableImages[V][q]=Y,this.workerSources[V]&&this.workerSources[V][q]){for(const xt in this.workerSources[V][q]){const Bt=this.workerSources[V][q][xt];for(const Zt in Bt)Bt[Zt].availableImages=Y}_t()}else _t()}setProjection(V,q){this.projections[V]=L.m(q)}setBrightness(V,q,Y){this.brightness=q,Y()}setLayers(V,q,Y){this.getLayerIndex(V,q.scope).replace(q.layers,q.options),Y()}updateLayers(V,q,Y){this.getLayerIndex(V,q.scope).update(q.layers,q.removedIds,q.options),Y()}loadTile(V,q,Y){q.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,q.type,q.source,q.scope).loadTile(q,Y)}loadDEMTile(V,q,Y){this.getDEMWorkerSource(V,q.source,q.scope).loadTile(q,Y)}reloadTile(V,q,Y){q.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,q.type,q.source,q.scope).reloadTile(q,Y)}abortTile(V,q,Y){this.getWorkerSource(V,q.type,q.source,q.scope).abortTile(q,Y)}removeTile(V,q,Y){this.getWorkerSource(V,q.type,q.source,q.scope).removeTile(q,Y)}removeSource(V,q,Y){if(!(this.workerSources[V]&&this.workerSources[V][q.scope]&&this.workerSources[V][q.scope][q.type]&&this.workerSources[V][q.scope][q.type][q.source]))return;const _t=this.workerSources[V][q.scope][q.type][q.source];delete this.workerSources[V][q.scope][q.type][q.source],_t.removeSource!==void 0?_t.removeSource(q,Y):Y()}loadWorkerSource(V,q,Y){try{this.self.importScripts(q.url),Y()}catch(_t){Y(_t.toString())}}syncRTLPluginState(V,q,Y){try{L.n.setState(q);const _t=L.n.getPluginURL();if(L.n.isLoaded()&&!L.n.isParsed()&&_t!=null){this.self.importScripts(_t);const xt=L.n.isParsed();Y(xt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_t}`),xt)}}catch(_t){Y(_t.toString())}}setDracoUrl(V,q){this.dracoUrl=q}getAvailableImages(V,q){this.availableImages[V]||(this.availableImages[V]={});let Y=this.availableImages[V][q];return Y||(Y=[]),Y}getLayerIndex(V,q){this.layerIndexes[V]||(this.layerIndexes[V]={});let Y=this.layerIndexes[V][q];return Y||(Y=this.layerIndexes[V][q]=new G,Y.scope=q),Y}getWorkerSource(V,q,Y,_t){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][_t]||(this.workerSources[V][_t]={}),this.workerSources[V][_t][q]||(this.workerSources[V][_t][q]={}),this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),!this.workerSources[V][_t][q][Y]){const xt={send:(Bt,Zt,vt,Wt,ue,le)=>{this.actor.send(Bt,Zt,vt,V,ue,le)},scheduler:this.actor.scheduler};this.workerSources[V][_t][q][Y]=new this.workerSourceTypes[q](xt,this.getLayerIndex(V,_t),this.getAvailableImages(V,_t),this.isSpriteLoaded[V][_t],void 0,this.brightness)}return this.workerSources[V][_t][q][Y]}getDEMWorkerSource(V,q,Y){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Y]||(this.demWorkerSources[V][Y]={}),this.demWorkerSources[V][Y][q]||(this.demWorkerSources[V][Y][q]=new X),this.demWorkerSources[V][Y][q]}enforceCacheSizeLimit(V,q){L.q(q)}getWorkerPerformanceMetrics(V,q,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ha(self)),ha}),C(["./shared"],function(L){return L.s});var D=w;return D})})(qT);var Ug=qT.exports;const S5={key:0,class:"kvass-map__address"},M5=go({__name:"Map",props:{coordinates:{},address:{},markers:{},aspectRatio:{default:"2/1"},mapOptions:{},markerOptions:{},showControls:{type:Boolean,default:!0},showAddress:{type:Boolean,default:!1}},setup(d){const h=d,m=kr(),v=kr(),w=gr(()=>({center:h.coordinates,zoom:12,dragPan:!0,scrollZoom:!1,dragRotate:!1,cooperativeGestures:!1,...h.mapOptions}));function C(){h.coordinates&&m.value&&(v.value=new Ug.Map({container:m.value,center:h.coordinates,...w.value,language:document.querySelector("html")?.getAttribute("lang")||"auto"}),k(),J())}Gc(()=>{C()}),Hd(()=>{v.value?.remove()});const D=gr(()=>({color:"var(--kvass-map-primary-color)",...h.markerOptions})),L=kr([]);function k(){v.value&&(L.value.forEach(G=>G.remove()),(h.markers||[h.coordinates]).forEach(G=>{G&&L.value.push(new Ug.Marker({...D.value}).setLngLat(G).addTo(v.value))}))}function J(){!v.value||!h.showControls||[new Ug.NavigationControl].forEach(G=>v.value.addControl(G))}return(G,X)=>(wi(),Er("div",{class:"kvass-map",style:qc({"--kvass-map-aspect-ratio":h.aspectRatio})},[ys("div",{ref_key:"mapEl",ref:m,class:"kvass-map__map"},null,512),h.showAddress?(wi(),Er("div",S5,Ln(h.address),1)):Tr("",!0)],4))}});function ZT(d){var h,m,v="";if(typeof d=="string"||typeof d=="number")v+=d;else if(typeof d=="object")if(Array.isArray(d))for(h=0;h<d.length;h++)d[h]&&(m=ZT(d[h]))&&(v&&(v+=" "),v+=m);else for(h in d)d[h]&&(v&&(v+=" "),v+=h);return v}function A5(){for(var d,h,m=0,v="";m<arguments.length;)(d=arguments[m++])&&(h=ZT(d))&&(v&&(v+=" "),v+=h);return v}const $2=d=>typeof d=="boolean"?"".concat(d):d===0?"0":d,Z2=A5,C5=(d,h)=>m=>{var v;if(h?.variants==null)return Z2(d,m?.class,m?.className);const{variants:w,defaultVariants:C}=h,D=Object.keys(w).map(J=>{const G=m?.[J],X=C?.[J];if(G===null)return null;const et=$2(G)||$2(X);return w[J][et]}),L=m&&Object.entries(m).reduce((J,G)=>{let[X,et]=G;return et===void 0||(J[X]=et),J},{}),k=h==null||(v=h.compoundVariants)===null||v===void 0?void 0:v.reduce((J,G)=>{let{class:X,className:et,...ct}=G;return Object.entries(ct).every(gt=>{let[dt,At]=gt;return Array.isArray(At)?At.includes({...C,...L}[dt]):{...C,...L}[dt]===At})?[...J,X,et]:J},[]);return Z2(d,D,k,m?.class,m?.className)},kc=/^[a-z0-9]+(-[a-z0-9]+)*$/,Xd=(d,h,m,v="")=>{const w=d.split(":");if(d.slice(0,1)==="@"){if(w.length<2||w.length>3)return null;v=w.shift().slice(1)}if(w.length>3||!w.length)return null;if(w.length>1){const L=w.pop(),k=w.pop(),J={provider:w.length>0?w[0]:v,prefix:k,name:L};return h&&!vd(J)?null:J}const C=w[0],D=C.split("-");if(D.length>1){const L={provider:v,prefix:D.shift(),name:D.join("-")};return h&&!vd(L)?null:L}if(m&&v===""){const L={provider:v,prefix:"",name:C};return h&&!vd(L,m)?null:L}return null},vd=(d,h)=>d?!!((d.provider===""||d.provider.match(kc))&&(h&&d.prefix===""||d.prefix.match(kc))&&d.name.match(kc)):!1,HT=Object.freeze({left:0,top:0,width:16,height:16}),kd=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Yd=Object.freeze({...HT,...kd}),c_=Object.freeze({...Yd,body:"",hidden:!1});function I5(d,h){const m={};!d.hFlip!=!h.hFlip&&(m.hFlip=!0),!d.vFlip!=!h.vFlip&&(m.vFlip=!0);const v=((d.rotate||0)+(h.rotate||0))%4;return v&&(m.rotate=v),m}function H2(d,h){const m=I5(d,h);for(const v in c_)v in kd?v in d&&!(v in m)&&(m[v]=kd[v]):v in h?m[v]=h[v]:v in d&&(m[v]=d[v]);return m}function k5(d,h){const m=d.icons,v=d.aliases||Object.create(null),w=Object.create(null);function C(D){if(m[D])return w[D]=[];if(!(D in w)){w[D]=null;const L=v[D]&&v[D].parent,k=L&&C(L);k&&(w[D]=[L].concat(k))}return w[D]}return(h||Object.keys(m).concat(Object.keys(v))).forEach(C),w}function D5(d,h,m){const v=d.icons,w=d.aliases||Object.create(null);let C={};function D(L){C=H2(v[L]||w[L],C)}return D(h),m.forEach(D),H2(d,C)}function WT(d,h){const m=[];if(typeof d!="object"||typeof d.icons!="object")return m;d.not_found instanceof Array&&d.not_found.forEach(w=>{h(w,null),m.push(w)});const v=k5(d);for(const w in v){const C=v[w];C&&(h(w,D5(d,w,C)),m.push(w))}return m}const z5={provider:"",aliases:{},not_found:{},...HT};function Gg(d,h){for(const m in h)if(m in d&&typeof d[m]!=typeof h[m])return!1;return!0}function XT(d){if(typeof d!="object"||d===null)return null;const h=d;if(typeof h.prefix!="string"||!d.icons||typeof d.icons!="object"||!Gg(d,z5))return null;const m=h.icons;for(const w in m){const C=m[w];if(!w.match(kc)||typeof C.body!="string"||!Gg(C,c_))return null}const v=h.aliases||Object.create(null);for(const w in v){const C=v[w],D=C.parent;if(!w.match(kc)||typeof D!="string"||!m[D]&&!v[D]||!Gg(C,c_))return null}return h}const W2=Object.create(null);function P5(d,h){return{provider:d,prefix:h,icons:Object.create(null),missing:new Set}}function na(d,h){const m=W2[d]||(W2[d]=Object.create(null));return m[h]||(m[h]=P5(d,h))}function k_(d,h){return XT(h)?WT(h,(m,v)=>{v?d.icons[m]=v:d.missing.add(m)}):[]}function R5(d,h,m){try{if(typeof m.body=="string")return d.icons[h]={...m},!0}catch{}return!1}let Nc=!1;function YT(d){return typeof d=="boolean"&&(Nc=d),Nc}function L5(d){const h=typeof d=="string"?Xd(d,!0,Nc):d;if(h){const m=na(h.provider,h.prefix),v=h.name;return m.icons[v]||(m.missing.has(v)?null:void 0)}}function O5(d,h){const m=Xd(d,!0,Nc);if(!m)return!1;const v=na(m.provider,m.prefix);return R5(v,m.name,h)}function B5(d,h){if(typeof d!="object")return!1;if(typeof h!="string"&&(h=d.provider||""),Nc&&!h&&!d.prefix){let w=!1;return XT(d)&&(d.prefix="",WT(d,(C,D)=>{D&&O5(C,D)&&(w=!0)})),w}const m=d.prefix;if(!vd({provider:h,prefix:m,name:"a"}))return!1;const v=na(h,m);return!!k_(v,d)}const JT=Object.freeze({width:null,height:null}),KT=Object.freeze({...JT,...kd}),F5=/(-?[0-9.]*[0-9]+[0-9.]*)/g,N5=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function X2(d,h,m){if(h===1)return d;if(m=m||100,typeof d=="number")return Math.ceil(d*h*m)/m;if(typeof d!="string")return d;const v=d.split(F5);if(v===null||!v.length)return d;const w=[];let C=v.shift(),D=N5.test(C);for(;;){if(D){const L=parseFloat(C);isNaN(L)?w.push(C):w.push(Math.ceil(L*h*m)/m)}else w.push(C);if(C=v.shift(),C===void 0)return w.join("");D=!D}}const V5=d=>d==="unset"||d==="undefined"||d==="none";function j5(d,h){const m={...Yd,...d},v={...KT,...h},w={left:m.left,top:m.top,width:m.width,height:m.height};let C=m.body;[m,v].forEach(gt=>{const dt=[],At=gt.hFlip,Jt=gt.vFlip;let qe=gt.rotate;At?Jt?qe+=2:(dt.push("translate("+(w.width+w.left).toString()+" "+(0-w.top).toString()+")"),dt.push("scale(-1 1)"),w.top=w.left=0):Jt&&(dt.push("translate("+(0-w.left).toString()+" "+(w.height+w.top).toString()+")"),dt.push("scale(1 -1)"),w.top=w.left=0);let ke;switch(qe<0&&(qe-=Math.floor(qe/4)*4),qe=qe%4,qe){case 1:ke=w.height/2+w.top,dt.unshift("rotate(90 "+ke.toString()+" "+ke.toString()+")");break;case 2:dt.unshift("rotate(180 "+(w.width/2+w.left).toString()+" "+(w.height/2+w.top).toString()+")");break;case 3:ke=w.width/2+w.left,dt.unshift("rotate(-90 "+ke.toString()+" "+ke.toString()+")");break}qe%2===1&&(w.left!==w.top&&(ke=w.left,w.left=w.top,w.top=ke),w.width!==w.height&&(ke=w.width,w.width=w.height,w.height=ke)),dt.length&&(C='<g transform="'+dt.join(" ")+'">'+C+"</g>")});const D=v.width,L=v.height,k=w.width,J=w.height;let G,X;D===null?(X=L===null?"1em":L==="auto"?J:L,G=X2(X,k/J)):(G=D==="auto"?k:D,X=L===null?X2(G,J/k):L==="auto"?J:L);const et={},ct=(gt,dt)=>{V5(dt)||(et[gt]=dt.toString())};return ct("width",G),ct("height",X),et.viewBox=w.left.toString()+" "+w.top.toString()+" "+k.toString()+" "+J.toString(),{attributes:et,body:C}}const U5=/\sid="(\S+)"/g,G5="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let q5=0;function $5(d,h=G5){const m=[];let v;for(;v=U5.exec(d);)m.push(v[1]);if(!m.length)return d;const w="suffix"+(Math.random()*16777216|Date.now()).toString(16);return m.forEach(C=>{const D=typeof h=="function"?h(C):h+(q5++).toString(),L=C.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");d=d.replace(new RegExp('([#;"])('+L+')([")]|\\.[a-z])',"g"),"$1"+D+w+"$3")}),d=d.replace(new RegExp(w,"g"),""),d}const u_=Object.create(null);function Z5(d,h){u_[d]=h}function h_(d){return u_[d]||u_[""]}function D_(d){let h;if(typeof d.resources=="string")h=[d.resources];else if(h=d.resources,!(h instanceof Array)||!h.length)return null;return{resources:h,path:d.path||"/",maxURL:d.maxURL||500,rotate:d.rotate||750,timeout:d.timeout||5e3,random:d.random===!0,index:d.index||0,dataAfterTimeout:d.dataAfterTimeout!==!1}}const z_=Object.create(null),hd=["https://api.simplesvg.com","https://api.unisvg.com"],d_=[];for(;hd.length>0;)hd.length===1||Math.random()>.5?d_.push(hd.shift()):d_.push(hd.pop());z_[""]=D_({resources:["https://api.iconify.design"].concat(d_)});function QT(d,h){const m=D_(h);return m===null?!1:(z_[d]=m,!0)}function P_(d){return z_[d]}const H5=()=>{let d;try{if(d=fetch,typeof d=="function")return d}catch{}};let Y2=H5();function W5(d,h){const m=P_(d);if(!m)return 0;let v;if(!m.maxURL)v=0;else{let w=0;m.resources.forEach(D=>{w=Math.max(w,D.length)});const C=h+".json?icons=";v=m.maxURL-w-m.path.length-C.length}return v}function X5(d){return d===404}const Y5=(d,h,m)=>{const v=[],w=W5(d,h),C="icons";let D={type:C,provider:d,prefix:h,icons:[]},L=0;return m.forEach((k,J)=>{L+=k.length+1,L>=w&&J>0&&(v.push(D),D={type:C,provider:d,prefix:h,icons:[]},L=k.length),D.icons.push(k)}),v.push(D),v};function J5(d){if(typeof d=="string"){const h=P_(d);if(h)return h.path}return"/"}const K5=(d,h,m)=>{if(!Y2){m("abort",424);return}let v=J5(h.provider);switch(h.type){case"icons":{const C=h.prefix,D=h.icons.join(","),L=new URLSearchParams({icons:D});v+=C+".json?"+L.toString();break}case"custom":{const C=h.uri;v+=C.slice(0,1)==="/"?C.slice(1):C;break}default:m("abort",400);return}let w=503;Y2(d+v).then(C=>{const D=C.status;if(D!==200){setTimeout(()=>{m(X5(D)?"abort":"next",D)});return}return w=501,C.json()}).then(C=>{if(typeof C!="object"||C===null){setTimeout(()=>{C===404?m("abort",C):m("next",w)});return}setTimeout(()=>{m("success",C)})}).catch(()=>{m("next",w)})},Q5={prepare:Y5,send:K5};function tz(d){const h={loaded:[],missing:[],pending:[]},m=Object.create(null);d.sort((w,C)=>w.provider!==C.provider?w.provider.localeCompare(C.provider):w.prefix!==C.prefix?w.prefix.localeCompare(C.prefix):w.name.localeCompare(C.name));let v={provider:"",prefix:"",name:""};return d.forEach(w=>{if(v.name===w.name&&v.prefix===w.prefix&&v.provider===w.provider)return;v=w;const C=w.provider,D=w.prefix,L=w.name,k=m[C]||(m[C]=Object.create(null)),J=k[D]||(k[D]=na(C,D));let G;L in J.icons?G=h.loaded:D===""||J.missing.has(L)?G=h.missing:G=h.pending;const X={provider:C,prefix:D,name:L};G.push(X)}),h}function tE(d,h){d.forEach(m=>{const v=m.loaderCallbacks;v&&(m.loaderCallbacks=v.filter(w=>w.id!==h))})}function ez(d){d.pendingCallbacksFlag||(d.pendingCallbacksFlag=!0,setTimeout(()=>{d.pendingCallbacksFlag=!1;const h=d.loaderCallbacks?d.loaderCallbacks.slice(0):[];if(!h.length)return;let m=!1;const v=d.provider,w=d.prefix;h.forEach(C=>{const D=C.icons,L=D.pending.length;D.pending=D.pending.filter(k=>{if(k.prefix!==w)return!0;const J=k.name;if(d.icons[J])D.loaded.push({provider:v,prefix:w,name:J});else if(d.missing.has(J))D.missing.push({provider:v,prefix:w,name:J});else return m=!0,!0;return!1}),D.pending.length!==L&&(m||tE([d],C.id),C.callback(D.loaded.slice(0),D.missing.slice(0),D.pending.slice(0),C.abort))})}))}let iz=0;function rz(d,h,m){const v=iz++,w=tE.bind(null,m,v);if(!h.pending.length)return w;const C={id:v,icons:h,callback:d,abort:w};return m.forEach(D=>{(D.loaderCallbacks||(D.loaderCallbacks=[])).push(C)}),w}function oz(d,h=!0,m=!1){const v=[];return d.forEach(w=>{const C=typeof w=="string"?Xd(w,h,m):w;C&&v.push(C)}),v}var nz={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function sz(d,h,m,v){const w=d.resources.length,C=d.random?Math.floor(Math.random()*w):d.index;let D;if(d.random){let ze=d.resources.slice(0);for(D=[];ze.length>1;){const yi=Math.floor(Math.random()*ze.length);D.push(ze[yi]),ze=ze.slice(0,yi).concat(ze.slice(yi+1))}D=D.concat(ze)}else D=d.resources.slice(C).concat(d.resources.slice(0,C));const L=Date.now();let k="pending",J=0,G,X=null,et=[],ct=[];typeof v=="function"&&ct.push(v);function gt(){X&&(clearTimeout(X),X=null)}function dt(){k==="pending"&&(k="aborted"),gt(),et.forEach(ze=>{ze.status==="pending"&&(ze.status="aborted")}),et=[]}function At(ze,yi){yi&&(ct=[]),typeof ze=="function"&&ct.push(ze)}function Jt(){return{startTime:L,payload:h,status:k,queriesSent:J,queriesPending:et.length,subscribe:At,abort:dt}}function qe(){k="failed",ct.forEach(ze=>{ze(void 0,G)})}function ke(){et.forEach(ze=>{ze.status==="pending"&&(ze.status="aborted")}),et=[]}function Be(ze,yi,pe){const B=yi!=="success";switch(et=et.filter(st=>st!==ze),k){case"pending":break;case"failed":if(B||!d.dataAfterTimeout)return;break;default:return}if(yi==="abort"){G=pe,qe();return}if(B){G=pe,et.length||(D.length?hi():qe());return}if(gt(),ke(),!d.random){const st=d.resources.indexOf(ze.resource);st!==-1&&st!==d.index&&(d.index=st)}k="completed",ct.forEach(st=>{st(pe)})}function hi(){if(k!=="pending")return;gt();const ze=D.shift();if(ze===void 0){if(et.length){X=setTimeout(()=>{gt(),k==="pending"&&(ke(),qe())},d.timeout);return}qe();return}const yi={status:"pending",resource:ze,callback:(pe,B)=>{Be(yi,pe,B)}};et.push(yi),J++,X=setTimeout(hi,d.rotate),m(ze,h,yi.callback)}return setTimeout(hi),Jt}function eE(d){const h={...nz,...d};let m=[];function v(){m=m.filter(D=>D().status==="pending")}function w(D,L,k){const J=sz(h,D,L,(G,X)=>{v(),k&&k(G,X)});return m.push(J),J}function C(D){return m.find(L=>D(L))||null}return{query:w,find:C,setIndex:D=>{h.index=D},getIndex:()=>h.index,cleanup:v}}function J2(){}const qg=Object.create(null);function az(d){if(!qg[d]){const h=P_(d);if(!h)return;const m=eE(h),v={config:h,redundancy:m};qg[d]=v}return qg[d]}function lz(d,h,m){let v,w;if(typeof d=="string"){const C=h_(d);if(!C)return m(void 0,424),J2;w=C.send;const D=az(d);D&&(v=D.redundancy)}else{const C=D_(d);if(C){v=eE(C);const D=d.resources?d.resources[0]:"",L=h_(D);L&&(w=L.send)}}return!v||!w?(m(void 0,424),J2):v.query(h,w,m)().abort}const K2="iconify2",Vc="iconify",iE=Vc+"-count",Q2=Vc+"-version",rE=36e5,cz=168;function p_(d,h){try{return d.getItem(h)}catch{}}function R_(d,h,m){try{return d.setItem(h,m),!0}catch{}}function tT(d,h){try{d.removeItem(h)}catch{}}function f_(d,h){return R_(d,iE,h.toString())}function m_(d){return parseInt(p_(d,iE))||0}const Jd={local:!0,session:!0},oE={local:new Set,session:new Set};let L_=!1;function uz(d){L_=d}let dd=typeof window>"u"?{}:window;function nE(d){const h=d+"Storage";try{if(dd&&dd[h]&&typeof dd[h].length=="number")return dd[h]}catch{}Jd[d]=!1}function sE(d,h){const m=nE(d);if(!m)return;const v=p_(m,Q2);if(v!==K2){if(v){const L=m_(m);for(let k=0;k<L;k++)tT(m,Vc+k.toString())}R_(m,Q2,K2),f_(m,0);return}const w=Math.floor(Date.now()/rE)-cz,C=L=>{const k=Vc+L.toString(),J=p_(m,k);if(typeof J=="string"){try{const G=JSON.parse(J);if(typeof G=="object"&&typeof G.cached=="number"&&G.cached>w&&typeof G.provider=="string"&&typeof G.data=="object"&&typeof G.data.prefix=="string"&&h(G,L))return!0}catch{}tT(m,k)}};let D=m_(m);for(let L=D-1;L>=0;L--)C(L)||(L===D-1?(D--,f_(m,D)):oE[d].add(L))}function aE(){if(!L_){uz(!0);for(const d in Jd)sE(d,h=>{const m=h.data,v=h.provider,w=m.prefix,C=na(v,w);if(!k_(C,m).length)return!1;const D=m.lastModified||-1;return C.lastModifiedCached=C.lastModifiedCached?Math.min(C.lastModifiedCached,D):D,!0})}}function hz(d,h){const m=d.lastModifiedCached;if(m&&m>=h)return m===h;if(d.lastModifiedCached=h,m)for(const v in Jd)sE(v,w=>{const C=w.data;return w.provider!==d.provider||C.prefix!==d.prefix||C.lastModified===h});return!0}function dz(d,h){L_||aE();function m(v){let w;if(!Jd[v]||!(w=nE(v)))return;const C=oE[v];let D;if(C.size)C.delete(D=Array.from(C).shift());else if(D=m_(w),!f_(w,D+1))return;const L={cached:Math.floor(Date.now()/rE),provider:d.provider,data:h};return R_(w,Vc+D.toString(),JSON.stringify(L))}h.lastModified&&!hz(d,h.lastModified)||Object.keys(h.icons).length&&(h.not_found&&(h=Object.assign({},h),delete h.not_found),m("local")||m("session"))}function eT(){}function pz(d){d.iconsLoaderFlag||(d.iconsLoaderFlag=!0,setTimeout(()=>{d.iconsLoaderFlag=!1,ez(d)}))}function fz(d,h){d.iconsToLoad?d.iconsToLoad=d.iconsToLoad.concat(h).sort():d.iconsToLoad=h,d.iconsQueueFlag||(d.iconsQueueFlag=!0,setTimeout(()=>{d.iconsQueueFlag=!1;const{provider:m,prefix:v}=d,w=d.iconsToLoad;delete d.iconsToLoad;let C;!w||!(C=h_(m))||C.prepare(m,v,w).forEach(D=>{lz(m,D,L=>{if(typeof L!="object")D.icons.forEach(k=>{d.missing.add(k)});else try{const k=k_(d,L);if(!k.length)return;const J=d.pendingIcons;J&&k.forEach(G=>{J.delete(G)}),dz(d,L)}catch(k){console.error(k)}pz(d)})})}))}const mz=(d,h)=>{const m=oz(d,!0,YT()),v=tz(m);if(!v.pending.length){let k=!0;return h&&setTimeout(()=>{k&&h(v.loaded,v.missing,v.pending,eT)}),()=>{k=!1}}const w=Object.create(null),C=[];let D,L;return v.pending.forEach(k=>{const{provider:J,prefix:G}=k;if(G===L&&J===D)return;D=J,L=G,C.push(na(J,G));const X=w[J]||(w[J]=Object.create(null));X[G]||(X[G]=[])}),v.pending.forEach(k=>{const{provider:J,prefix:G,name:X}=k,et=na(J,G),ct=et.pendingIcons||(et.pendingIcons=new Set);ct.has(X)||(ct.add(X),w[J][G].push(X))}),C.forEach(k=>{const{provider:J,prefix:G}=k;w[J][G].length&&fz(k,w[J][G])}),h?rz(h,v,C):eT};function gz(d,h){const m={...d};for(const v in h){const w=h[v],C=typeof w;v in JT?(w===null||w&&(C==="string"||C==="number"))&&(m[v]=w):C===typeof m[v]&&(m[v]=v==="rotate"?w%4:w)}return m}const _z=/[\s,]+/;function yz(d,h){h.split(_z).forEach(m=>{switch(m.trim()){case"horizontal":d.hFlip=!0;break;case"vertical":d.vFlip=!0;break}})}function xz(d,h=0){const m=d.replace(/^-?[0-9.]*/,"");function v(w){for(;w<0;)w+=4;return w%4}if(m===""){const w=parseInt(d);return isNaN(w)?0:v(w)}else if(m!==d){let w=0;switch(m){case"%":w=25;break;case"deg":w=90}if(w){let C=parseFloat(d.slice(0,d.length-m.length));return isNaN(C)?0:(C=C/w,C%1===0?v(C):0)}}return h}function vz(d,h){let m=d.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const v in h)m+=" "+v+'="'+h[v]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+m+">"+d+"</svg>"}function bz(d){return d.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function wz(d){return"data:image/svg+xml,"+bz(d)}function Tz(d){return'url("'+wz(d)+'")'}const iT={...KT,inline:!1},Ez={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},Sz={display:"inline-block"},g_={backgroundColor:"currentColor"},lE={backgroundColor:"transparent"},rT={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},oT={webkitMask:g_,mask:g_,background:lE};for(const d in oT){const h=oT[d];for(const m in rT)h[d+m]=rT[m]}const bd={};["horizontal","vertical"].forEach(d=>{const h=d.slice(0,1)+"Flip";bd[d+"-flip"]=h,bd[d.slice(0,1)+"-flip"]=h,bd[d+"Flip"]=h});function nT(d){return d+(d.match(/^[-0-9.]+$/)?"px":"")}const sT=(d,h)=>{const m=gz(iT,h),v={...Ez},w=h.mode||"svg",C={},D=h.style,L=typeof D=="object"&&!(D instanceof Array)?D:{};for(let dt in h){const At=h[dt];if(At!==void 0)switch(dt){case"icon":case"style":case"onLoad":case"mode":break;case"inline":case"hFlip":case"vFlip":m[dt]=At===!0||At==="true"||At===1;break;case"flip":typeof At=="string"&&yz(m,At);break;case"color":C.color=At;break;case"rotate":typeof At=="string"?m[dt]=xz(At):typeof At=="number"&&(m[dt]=At);break;case"ariaHidden":case"aria-hidden":At!==!0&&At!=="true"&&delete v["aria-hidden"];break;default:{const Jt=bd[dt];Jt?(At===!0||At==="true"||At===1)&&(m[Jt]=!0):iT[dt]===void 0&&(v[dt]=At)}}}const k=j5(d,m),J=k.attributes;if(m.inline&&(C.verticalAlign="-0.125em"),w==="svg"){v.style={...C,...L},Object.assign(v,J);let dt=0,At=h.id;return typeof At=="string"&&(At=At.replace(/-/g,"_")),v.innerHTML=$5(k.body,At?()=>At+"ID"+dt++:"iconifyVue"),q2("svg",v)}const{body:G,width:X,height:et}=d,ct=w==="mask"||(w==="bg"?!1:G.indexOf("currentColor")!==-1),gt=vz(G,{...J,width:X+"",height:et+""});return v.style={...C,"--svg":Tz(gt),width:nT(J.width),height:nT(J.height),...Sz,...ct?g_:lE,...L},q2("span",v)};YT(!0);Z5("",Q5);if(typeof document<"u"&&typeof window<"u"){aE();const d=window;if(d.IconifyPreload!==void 0){const h=d.IconifyPreload,m="Invalid IconifyPreload syntax.";typeof h=="object"&&h!==null&&(h instanceof Array?h:[h]).forEach(v=>{try{(typeof v!="object"||v===null||v instanceof Array||typeof v.icons!="object"||typeof v.prefix!="string"||!B5(v))&&console.error(m)}catch{console.error(m)}})}if(d.IconifyProviders!==void 0){const h=d.IconifyProviders;if(typeof h=="object"&&h!==null)for(let m in h){const v="IconifyProviders["+m+"] is invalid.";try{const w=h[m];if(typeof w!="object"||!w||w.resources===void 0)continue;QT(m,w)||console.error(v)}catch{console.error(v)}}}}const Mz={...Yd,body:""},$g=go({inheritAttrs:!1,data(){return{iconMounted:!1,counter:0}},mounted(){this._name="",this._loadingIcon=null,this.iconMounted=!0},unmounted(){this.abortLoading()},methods:{abortLoading(){this._loadingIcon&&(this._loadingIcon.abort(),this._loadingIcon=null)},getIcon(d,h){if(typeof d=="object"&&d!==null&&typeof d.body=="string")return this._name="",this.abortLoading(),{data:d};let m;if(typeof d!="string"||(m=Xd(d,!1,!0))===null)return this.abortLoading(),null;const v=L5(m);if(!v)return(!this._loadingIcon||this._loadingIcon.name!==d)&&(this.abortLoading(),this._name="",v!==null&&(this._loadingIcon={name:d,abort:mz([m],()=>{this.counter++})})),null;this.abortLoading(),this._name!==d&&(this._name=d,h&&h(d));const w=["iconify"];return m.prefix!==""&&w.push("iconify--"+m.prefix),m.provider!==""&&w.push("iconify--"+m.provider),{data:v,classes:w}}},render(){this.counter;const d=this.$attrs,h=this.iconMounted?this.getIcon(d.icon,d.onLoad):null;if(!h)return sT(Mz,d);let m=d;return h.classes&&(m={...d,class:(typeof d.class=="string"?d.class+" ":"")+h.classes.join(" ")}),sT({...Yd,...h.data},m)}});QT("",{resources:["https://icons.ui.kvass.no"]});function Az(d){return!d||typeof d!="object"?!1:typeof d.then=="function"&&typeof d.catch=="function"}const Cz=["xxs","xs","sm","default","lg","xl","xxl","3xl","4xl"],Iz=(d,h)=>h==="default"?`var(--k-ui-${d})`:`var(--k-ui-${d}-${h})`,aT=d=>{switch(d){case"start":case"end":return`flex-${d}`;default:return d}},kz=(d,h="spacing")=>d.split(" ").map(m=>typeof m=="number"||typeof m=="string"&&m.match(/^\d+$/)?`${m}rem`:typeof m=="string"&&Cz.includes(m)?Iz(h,m):m).join(" ");function Dz(){var d=new Date().getTime(),h=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var v=Math.random()*16;return d>0?(v=(d+v)%16|0,d=Math.floor(d/16)):(v=(h+v)%16|0,h=Math.floor(h/16)),(m==="x"?v:v&3|8).toString(16)})}const zz=(d,h)=>Object.fromEntries(Object.entries(h).map(([m,v])=>[`--k-${d}-${m}`,v])),cE=go({__name:"Spinner",props:{size:{default:"medium"}},setup(d){return(h,m)=>(wi(),Er("span",{class:Id(`k-spinner k-spinner--size-${h.size}`)},null,2))}}),Pz={class:"k-button__content"},Rz={key:0,class:"k-button__icon k-button__icon--left"},Lz={key:1,class:"k-button__icon k-button__icon--right"},Oz={key:2,class:"k-button__confirm-label"},jc=go({__name:"Button",props:{variant:{default:"secondary"},size:{default:"medium"},loading:{type:Boolean},promise:{},confirm:{type:Boolean},is:{type:[String,Object,Function],default:"button"},stateTimeout:{default:1e3},confirmLabel:{default:"Are you sure?"},label:{},icon:{},iconLeft:{},iconRight:{}},emits:["idle","loading","success","error","confirm","click"],setup(d,{emit:h}){const m=d,v={success:"success",confirm:"warning",error:"danger",loading:null,idle:null},w=gr(()=>!X.value||k.value==="loading"?m.variant:k.value=="confirm"?"warning":v[k.value]||m.variant),C=gr(()=>m.loading||k.value==="loading"),D=kr(),L=gr(()=>{if(k.value)return["error","success"].includes(k.value)||C.value}),k=kr("idle"),J=kr(),G=kr(),X=gr(()=>k.value||C.value),et=gr(()=>["error","success"].includes(k.value)),ct=gr(()=>k.value==="success"?"fa-pro-regular:check":"fa-pro-regular:exclamation-circle");function gt(Be){if(!Be)return;dt(),G.value=Be,D.value=setTimeout(()=>k.value="loading",100);let hi=ze=>{dt(),m.stateTimeout?(k.value=ze,J.value=setTimeout(()=>{dt(),h(ze)},m.stateTimeout)):h(ze)};G.value.then(()=>hi("success")).catch(()=>hi("error"))}function dt(){D.value&&clearTimeout(D.value),J.value&&clearTimeout(J.value),G.value=null,k.value="idle"}C_(()=>m.promise,Be=>{Be&&Az(Be)&&gt(Be)});const At=kr(),Jt=gr(()=>k.value==="confirm");function qe(Be){if(m.confirm&&k.value!=="confirm")return k.value="confirm";dt(),h("click",Be)}const ke=C5("k-button",{variants:{variant:{primary:"k-button--variant-primary",secondary:"k-button--variant-secondary",tertiary:"k-button--variant-tertiary",danger:"k-button--variant-danger",warning:"k-button--variant-warning",success:"k-button--variant-success"},size:{small:"k-button--size-small",medium:"k-button--size-medium",large:"k-button--size-large"},isLoading:{true:"k-button--loading"},isBusy:{true:"k-button--busy"}}});return(Be,hi)=>(wi(),ro(Wd(Be.is),Dn({type:"button",class:ul(ke)({variant:w.value,size:Be.size,isLoading:C.value,isBusy:L.value}),"aria-busy":L.value,inert:L.value},Be.$attrs,{onClick:qe,ref_key:"rootElement",ref:At}),{default:$o(()=>[UT(ys("span",Pz,[Be.icon||Be.iconLeft||Be.$slots.icon||Be.$slots["icon-left"]?(wi(),Er("span",Rz,[_r(Be.$slots,"icon-left",{},()=>[_r(Be.$slots,"icon",{},()=>[ra(ul($g),{icon:Be.icon||Be.iconLeft},null,8,["icon"])])])])):Tr("",!0),_r(Be.$slots,"default",{},()=>[I_(Ln(Be.label),1)]),Be.iconRight||Be.$slots["icon-right"]?(wi(),Er("span",Lz,[_r(Be.$slots,"icon-right",{},()=>[ra(ul($g),{icon:Be.iconRight},null,8,["icon"])])])):Tr("",!0)],512),[[GT,!Jt.value]]),C.value?(wi(),ro(cE,{key:0})):Tr("",!0),et.value?(wi(),ro(ul($g),{key:1,class:"k-button__state-indicator",icon:ct.value},null,8,["icon"])):Tr("",!0),Jt.value?(wi(),Er("span",Oz,Ln(Be.confirmLabel),1)):Tr("",!0)]),_:3},16,["class","aria-busy","inert"]))}});var vs=(d,h=[])=>({parts:(...m)=>{if(Bz(h))return vs(d,m);throw new Error("createAnatomy().parts(...) should only be called once. Did you mean to use .extendWith(...) ?")},extendWith:(...m)=>vs(d,[...h,...m]),rename:m=>vs(m,h),keys:()=>h,build:()=>[...new Set(h)].reduce((m,v)=>Object.assign(m,{[v]:{selector:[`&[data-scope="${nl(d)}"][data-part="${nl(v)}"]`,`& [data-scope="${nl(d)}"][data-part="${nl(v)}"]`].join(", "),attrs:{"data-scope":nl(d),"data-part":nl(v)}}}),{})}),nl=d=>d.replace(/([A-Z])([A-Z])/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase(),Bz=d=>d.length===0;function Dd(d){return typeof d=="object"&&d?.nodeType===Node.ELEMENT_NODE&&typeof d?.nodeName=="string"}function zd(d,h){return!d||!h||!Dd(d)||!Dd(h)?!1:d===h||d.contains(h)}var Fz=d=>d.nodeType===Node.DOCUMENT_NODE?d:d.ownerDocument??document;function $c(d){const h={getRootNode:m=>{var v;return((v=m.getRootNode)==null?void 0:v.call(m))??document},getDoc:m=>Fz(h.getRootNode(m)),getWin:m=>h.getDoc(m).defaultView??window,getActiveElement:m=>h.getDoc(m).activeElement,getById:(m,v)=>h.getRootNode(m).getElementById(v),setValue:(m,v)=>{m==null||v==null||(m.value=v.toString())}};return{...h,...d}}var Nz=d=>d.nodeType===Node.DOCUMENT_NODE;function O_(d){return Nz(d)?d:d?.ownerDocument??document}function Vz(d){return d?.ownerDocument.defaultView??window}function Pd(d){var h;return((h=d.composedPath)==null?void 0:h.call(d)[0])??d.target}var uE=()=>typeof document<"u";function jz(){const d=navigator.userAgentData;return d?.platform??navigator.platform}var hE=d=>uE()&&d.test(jz()),Uz=()=>uE()&&!!navigator.maxTouchPoints,Gz=()=>hE(/^Mac/)&&!Uz(),qz=()=>hE(/mac|iphone|ipad|ipod/i),$z=()=>qz()&&!Gz();function dE(d,h){return Array.from(d?.querySelectorAll(h)??[])}function Zz(d){const h=new Set;function m(v){const w=globalThis.requestAnimationFrame(v);h.add(()=>globalThis.cancelAnimationFrame(w))}return m(()=>m(d)),function(){h.forEach(v=>v())}}function Uc(d){const h=globalThis.requestAnimationFrame(d);return()=>{globalThis.cancelAnimationFrame(h)}}const Hz=Symbol(),lT=Object.getPrototypeOf,__=new WeakMap,Wz=d=>d&&(__.has(d)?__.get(d):lT(d)===Object.prototype||lT(d)===Array.prototype),Xz=d=>Wz(d)&&d[Hz]||null,cT=(d,h=!0)=>{__.set(d,h)};var Zg=d=>typeof d=="object"&&d!==null,ta=new WeakMap,Mc=new WeakSet,Yz=(d=Object.is,h=(J,G)=>new Proxy(J,G),m=J=>Zg(J)&&!Mc.has(J)&&(Array.isArray(J)||!(Symbol.iterator in J))&&!(J instanceof WeakMap)&&!(J instanceof WeakSet)&&!(J instanceof Error)&&!(J instanceof Number)&&!(J instanceof Date)&&!(J instanceof String)&&!(J instanceof RegExp)&&!(J instanceof ArrayBuffer),v=J=>{switch(J.status){case"fulfilled":return J.value;case"rejected":throw J.reason;default:throw J}},w=new WeakMap,C=(J,G,X=v)=>{const et=w.get(J);if(et?.[0]===G)return et[1];const ct=Array.isArray(J)?[]:Object.create(Object.getPrototypeOf(J));return cT(ct,!0),w.set(J,[G,ct]),Reflect.ownKeys(J).forEach(gt=>{const dt=Reflect.get(J,gt);Mc.has(dt)?(cT(dt,!1),ct[gt]=dt):dt instanceof Promise?Object.defineProperty(ct,gt,{get(){return X(dt)}}):ta.has(dt)?ct[gt]=fl(dt,X):ct[gt]=dt}),Object.freeze(ct)},D=new WeakMap,L=[1,1],k=J=>{if(!Zg(J))throw new Error("object required");const G=D.get(J);if(G)return G;let X=L[0];const et=new Set,ct=(pe,B=++L[0])=>{X!==B&&(X=B,et.forEach(st=>st(pe,B)))};let gt=L[1];const dt=(pe=++L[1])=>(gt!==pe&&!et.size&&(gt=pe,Jt.forEach(([B])=>{const st=B[1](pe);st>X&&(X=st)})),X),At=pe=>(B,st)=>{const Qt=[...B];Qt[1]=[pe,...Qt[1]],ct(Qt,st)},Jt=new Map,qe=(pe,B)=>{if(et.size){const st=B[3](At(pe));Jt.set(pe,[B,st])}else Jt.set(pe,[B])},ke=pe=>{var B;const st=Jt.get(pe);st&&(Jt.delete(pe),(B=st[1])==null||B.call(st))},Be=pe=>(et.add(pe),et.size===1&&Jt.forEach(([B,st],Qt)=>{const Le=B[3](At(Qt));Jt.set(Qt,[B,Le])}),()=>{et.delete(pe),et.size===0&&Jt.forEach(([B,st],Qt)=>{st&&(st(),Jt.set(Qt,[B]))})}),hi=Array.isArray(J)?[]:Object.create(Object.getPrototypeOf(J)),ze=h(hi,{deleteProperty(pe,B){const st=Reflect.get(pe,B);ke(B);const Qt=Reflect.deleteProperty(pe,B);return Qt&&ct(["delete",[B],st]),Qt},set(pe,B,st,Qt){var Le;const Ft=Reflect.has(pe,B),Te=Reflect.get(pe,B,Qt);if(Ft&&(d(Te,st)||D.has(st)&&d(Te,D.get(st))))return!0;ke(B),Zg(st)&&(st=Xz(st)||st);let ai=st;if(!((Le=Object.getOwnPropertyDescriptor(pe,B))!=null&&Le.set))if(st instanceof Promise)st.then(ri=>{st.status="fulfilled",st.value=ri,ct(["resolve",[B],ri])}).catch(ri=>{st.status="rejected",st.reason=ri,ct(["reject",[B],ri])});else{!ta.has(st)&&m(st)&&(ai=B_(st));const ri=!Mc.has(ai)&&ta.get(ai);ri&&qe(B,ri)}return Reflect.set(pe,B,ai,Qt),ct(["set",[B],st,Te]),!0}});D.set(J,ze);const yi=[hi,dt,C,Be];return ta.set(ze,yi),Reflect.ownKeys(J).forEach(pe=>{const B=Object.getOwnPropertyDescriptor(J,pe);B.get||B.set?Object.defineProperty(hi,pe,B):ze[pe]=J[pe]}),ze})=>[k,ta,Mc,d,h,m,v,w,C,D,L],[Jz]=Yz();function B_(d={}){return Jz(d)}function y_(d,h,m){const v=ta.get(d);let w;const C=[],D=v[3];let L=!1;const k=D(J=>{if(C.push(J),m){h(C.splice(0));return}w||(w=Promise.resolve().then(()=>{w=void 0,L&&h(C.splice(0))}))});return L=!0,()=>{L=!1,k()}}function fl(d,h){const m=ta.get(d),[v,w,C]=m;return C(v,w(),h)}function uT(d){return Mc.add(d),d}function Kz(d,h){Object.keys(h).forEach(v=>{if(Object.getOwnPropertyDescriptor(d,v))throw new Error("object property already defined");const w=h[v],{get:C,set:D}=typeof w=="function"?{get:w}:w,L={};L.get=()=>C(fl(m)),D&&(L.set=k=>D(m,k)),Object.defineProperty(d,v,L)});const m=B_(d);return m}var Qz=(d,h)=>Object.is(d,h);function hT(d,h,m,v,w){let C=Reflect.get(fl(d),h);const D=w||Qz;function L(){const k=fl(d);D(C,k[h])||(m(k[h]),C=Reflect.get(k,h))}return y_(d,L,v)}function dT(d,h,m){typeof m.value=="object"&&(m.value=hl(m.value)),!m.enumerable||m.get||m.set||!m.configurable||!m.writable||h==="__proto__"?Object.defineProperty(d,h,m):d[h]=m.value}function hl(d){if(typeof d!="object")return d;var h=0,m,v,w,C=Object.prototype.toString.call(d);if(C==="[object Object]"?w=Object.create(d.__proto__||null):C==="[object Array]"?w=Array(d.length):C==="[object Set]"?(w=new Set,d.forEach(function(D){w.add(hl(D))})):C==="[object Map]"?(w=new Map,d.forEach(function(D,L){w.set(hl(L),hl(D))})):C==="[object Date]"?w=new Date(+d):C==="[object RegExp]"?w=new RegExp(d.source,d.flags):C==="[object DataView]"?w=new d.constructor(hl(d.buffer)):C==="[object ArrayBuffer]"?w=d.slice(0):C.slice(-6)==="Array]"&&(w=new d.constructor(d)),w){for(v=Object.getOwnPropertySymbols(d);h<v.length;h++)dT(w,v[h],Object.getOwnPropertyDescriptor(d,v[h]));for(h=0,v=Object.getOwnPropertyNames(d);h<v.length;h++)Object.hasOwnProperty.call(w,m=v[h])&&w[m]===d[m]||dT(w,m,Object.getOwnPropertyDescriptor(d,m))}return w||d}var tP=Object.defineProperty,eP=(d,h,m)=>h in d?tP(d,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):d[h]=m,re=(d,h,m)=>(eP(d,typeof h!="symbol"?h+"":h,m),m);function iP(d){for(;d.length>0;)d.pop();return d}var pT=(d,...h)=>(typeof d=="function"?d(...h):d)??void 0,zn=d=>d,Hg=()=>{},rP=(()=>{let d=0;return()=>(d++,d.toString(36))})(),Dc=d=>Array.isArray(d),zc=d=>!(d==null||typeof d!="object"||Dc(d)),oP=d=>typeof d=="number"&&!Number.isNaN(d),Pn=d=>typeof d=="string",x_=d=>typeof d=="function";function Rd(d){if(!nP(d)||d===void 0)return d;const h=Reflect.ownKeys(d).filter(v=>typeof v=="string"),m={};for(const v of h){const w=d[v];w!==void 0&&(m[v]=Rd(w))}return m}var nP=d=>d&&typeof d=="object"&&d.constructor===Object;function Wg(...d){const h=d.length===1?d[0]:d[1];d.length!==2||d[0]}function wd(...d){const h=d.length===1?d[0]:d[1];d.length!==2||d[0]}function pE(d,...h){for(const m of h){const v=Rd(m);for(const w in v)zc(m[w])?(d[w]||(d[w]={}),pE(d[w],m[w])):d[w]=m[w]}return d}function fT(d){return hl(d)}function to(d){return Pn(d)?{type:d}:d}function ms(d){return d?Dc(d)?d.slice():[d]:[]}function fE(d){return zc(d)&&d.predicate!=null}var sP=()=>!0;function mE(d,h){return d=d??sP,(m,v,w)=>{if(Pn(d)){const C=h[d];return x_(C)?C(m,v,w):C}return fE(d)?d.predicate(h)(m,v,w):d?.(m,v,w)}}function Xg(d,h){return(m,v,w)=>fE(d)?d.predicate(h)(m,v,w):d}function aP(d){const h=d.computed??zn({}),m=d.context??zn({}),v=B_({value:d.initial??"",previousValue:"",event:zn({}),previousEvent:zn({}),context:Kz(m,h),done:!1,tags:[],hasTag(w){return this.tags.includes(w)},matches(...w){return w.includes(this.value)},can(w){return zn(this).nextEvents.includes(w)},get nextEvents(){var w,C;const D=((C=(w=d.states)==null?void 0:w[this.value])==null?void 0:C.on)??{},L=d?.on??{};return Object.keys({...D,...L})},get changed(){return this.event.value==="machine.init"||!this.previousValue?!1:this.value!==this.previousValue}});return zn(v)}function pd(d,h){return(m,v)=>{if(oP(d))return d;if(x_(d))return d(m,v);if(Pn(d)){const w=Number.parseFloat(d);if(!Number.isNaN(w))return w;if(h){const C=h?.[d];return wd(C==null,`[@zag-js/core > determine-delay] Cannot determine delay for \`${d}\`. It doesn't exist in \`options.delays\``),x_(C)?C(m,v):C}}}}function lP(d){return Pn(d)?{target:d}:d}function cP(d,h){return(m,v,w)=>ms(d).map(lP).find(C=>mE(C.guard,h)(m,v,w)??C.target??C.actions)}var uP=class gE{constructor(h,m){var v,w,C,D,L,k;re(this,"status","Not Started"),re(this,"state"),re(this,"initialState"),re(this,"initialContext"),re(this,"id"),re(this,"type","machine"),re(this,"activityEvents",new Map),re(this,"delayedEvents",new Map),re(this,"stateListeners",new Set),re(this,"contextListeners",new Set),re(this,"eventListeners",new Set),re(this,"doneListeners",new Set),re(this,"contextWatchers",new Set),re(this,"removeStateListener",Hg),re(this,"removeEventListener",Hg),re(this,"removeContextListener",Hg),re(this,"parent"),re(this,"children",new Map),re(this,"guardMap"),re(this,"actionMap"),re(this,"delayMap"),re(this,"activityMap"),re(this,"sync"),re(this,"options"),re(this,"config"),re(this,"start",G=>{if(this.state.value="",this.status==="Running")return this;this.status="Running",this.removeStateListener=y_(this.state,()=>{this.stateListeners.forEach(At=>{At(this.stateSnapshot)})},this.sync),this.removeEventListener=hT(this.state,"event",At=>{this.executeActions(this.config.onEvent,At),this.eventListeners.forEach(Jt=>{Jt(At)})},this.sync),this.removeContextListener=y_(this.state.context,()=>{this.log("Context:",this.contextSnapshot),this.contextListeners.forEach(At=>{At(this.contextSnapshot)})},this.sync||this.options.debug),this.setupContextWatchers(),this.executeActivities(to("machine.start"),ms(this.config.activities),"machine.start"),this.executeActions(this.config.entry,to("machine.start"));const X=to("machine.init"),et=zc(G)?G.value:G,ct=zc(G)?G.context:void 0;ct&&this.setContext(ct);const gt={target:et??this.config.initial},dt=this.getNextStateInfo(gt,X);return this.initialState=dt,this.performStateChangeEffects(this.state.value,dt,X),this}),re(this,"setupContextWatchers",()=>{var G;for(const[X,et]of Object.entries(this.config.watch??{})){const ct=(G=this.options.compareFns)==null?void 0:G[X],gt=hT(this.state.context,X,()=>{this.executeActions(et,this.state.event)},this.sync,ct);this.contextWatchers.add(gt)}}),re(this,"stop",()=>{if(this.status!=="Stopped")return this.performExitEffects(this.state.value,to("machine.stop")),this.executeActions(this.config.exit,to("machine.stop")),this.setState(""),this.setEvent("machine.stop"),this.stopStateListeners(),this.stopChildren(),this.stopActivities(),this.stopDelayedEvents(),this.stopContextWatchers(),this.stopEventListeners(),this.stopContextListeners(),this.status="Stopped",this}),re(this,"stopEventListeners",()=>{this.eventListeners.clear(),this.removeEventListener()}),re(this,"stopContextListeners",()=>{this.contextListeners.clear(),this.removeContextListener()}),re(this,"stopStateListeners",()=>{this.removeStateListener(),this.stateListeners.clear()}),re(this,"stopContextWatchers",()=>{this.contextWatchers.forEach(G=>G()),this.contextWatchers.clear()}),re(this,"stopDelayedEvents",()=>{this.delayedEvents.forEach(G=>{G.forEach(X=>X())}),this.delayedEvents.clear()}),re(this,"stopActivities",G=>{var X,et;G?((X=this.activityEvents.get(G))==null||X.forEach(ct=>ct()),(et=this.activityEvents.get(G))==null||et.clear(),this.activityEvents.delete(G)):(this.activityEvents.forEach(ct=>{ct.forEach(gt=>gt()),ct.clear()}),this.activityEvents.clear())}),re(this,"sendChild",(G,X)=>{const et=to(G),ct=pT(X,this.contextSnapshot),gt=this.children.get(ct);gt||wd(`[@zag-js/core] Cannot send '${et.type}' event to unknown child`),gt.send(et)}),re(this,"stopChild",G=>{this.children.has(G)||wd(`[@zag-js/core > stop-child] Cannot stop unknown child ${G}`),this.children.get(G).stop(),this.children.delete(G)}),re(this,"removeChild",G=>{this.children.delete(G)}),re(this,"stopChildren",()=>{this.children.forEach(G=>G.stop()),this.children.clear()}),re(this,"setParent",G=>{this.parent=G}),re(this,"spawn",(G,X)=>{const et=pT(G);return X&&(et.id=X),et.type="machine.actor",et.setParent(this),this.children.set(et.id,zn(et)),et.onDone(()=>{this.removeChild(et.id)}).start(),zn(uT(et))}),re(this,"addActivityCleanup",(G,X)=>{var et;G&&(this.activityEvents.has(G)?(et=this.activityEvents.get(G))==null||et.add(X):this.activityEvents.set(G,new Set([X])))}),re(this,"setState",G=>{this.state.previousValue=this.state.value,this.state.value=G;const X=this.getStateNode(G);G==null?iP(this.state.tags):this.state.tags=ms(X?.tags)}),re(this,"transformContext",G=>{var X,et;return(et=(X=this.options)==null?void 0:X.transformContext)==null||et.call(X,G),G}),re(this,"setContext",G=>{G&&pE(this.state.context,this.transformContext(G))}),re(this,"withContext",G=>{const X=this.transformContext(G),et={...this.config.context,...Rd(X)};return new gE({...this.config,context:et},this.options)}),re(this,"setOptions",G=>{const X=Rd(G);this.actionMap={...this.actionMap,...X.actions},this.delayMap={...this.delayMap,...X.delays},this.activityMap={...this.activityMap,...X.activities},this.guardMap={...this.guardMap,...X.guards}}),re(this,"getStateNode",G=>{var X;if(G)return(X=this.config.states)==null?void 0:X[G]}),re(this,"getNextStateInfo",(G,X)=>{const et=this.determineTransition(G,X),ct=!(et!=null&&et.target),gt=et?.target??this.state.value,dt=this.state.value!==gt,At=this.getStateNode(gt),Jt={reenter:!ct&&!dt&&!(et!=null&&et.internal),transition:et,stateNode:At,target:gt,changed:dt};return this.log("NextState:",`[${X.type}]`,this.state.value,"---->",Jt.target),Jt}),re(this,"getActionFromDelayedTransition",G=>{const X=to("machine.after"),et=pd(G.delay,this.delayMap)(this.contextSnapshot,X);let ct;return{entry:()=>{ct=globalThis.setTimeout(()=>{const gt=this.getNextStateInfo(G,X);this.performStateChangeEffects(this.state.value,gt,X)},et)},exit:()=>{globalThis.clearTimeout(ct)}}}),re(this,"getDelayedEventActions",G=>{const X=this.getStateNode(G),et=to("machine.after");if(!X||!X.after)return;const ct=[],gt=[];if(Dc(X.after)){const dt=this.determineTransition(X.after,et);if(!dt)return;const At=this.getActionFromDelayedTransition(dt);ct.push(At.entry),gt.push(At.exit)}else if(zc(X.after))for(const dt in X.after){const At=X.after[dt];let Jt={};if(Dc(At)){const ke=this.determineTransition(At,et);ke&&(Jt=ke)}else Pn(At)?Jt={target:At,delay:dt}:Jt={...At,delay:dt};const qe=this.getActionFromDelayedTransition(Jt);ct.push(qe.entry),gt.push(qe.exit)}return{entries:ct,exits:gt}}),re(this,"executeActions",(G,X)=>{var et;const ct=Xg(G,this.guardMap)(this.contextSnapshot,X,this.guardMeta);for(const gt of ms(ct)){const dt=Pn(gt)?(et=this.actionMap)==null?void 0:et[gt]:gt;Wg(Pn(gt)&&!dt,`[@zag-js/core > execute-actions] No implementation found for action: \`${gt}\``),dt?.(this.state.context,X,this.meta)}}),re(this,"executeActivities",(G,X,et)=>{var ct;for(const gt of X){const dt=Pn(gt)?(ct=this.activityMap)==null?void 0:ct[gt]:gt;if(!dt){Wg(`[@zag-js/core > execute-activity] No implementation found for activity: \`${gt}\``);continue}const At=dt(this.state.context,G,this.meta);At&&this.addActivityCleanup(et??this.state.value,At)}}),re(this,"createEveryActivities",(G,X)=>{if(!G)return;const et=to("machine.every");if(Dc(G)){const ct=ms(G).find(dt=>{const At=dt.delay,Jt=pd(At,this.delayMap)(this.contextSnapshot,et);return mE(dt.guard,this.guardMap)(this.contextSnapshot,et,this.guardMeta)??Jt!=null});if(!ct)return;const gt=pd(ct.delay,this.delayMap)(this.contextSnapshot,et);X(()=>{const dt=globalThis.setInterval(()=>{this.executeActions(ct.actions,et)},gt);return()=>{globalThis.clearInterval(dt)}})}else for(const ct in G){const gt=G?.[ct],dt=pd(ct,this.delayMap)(this.contextSnapshot,et);X(()=>{const At=globalThis.setInterval(()=>{this.executeActions(gt,et)},dt);return()=>{globalThis.clearInterval(At)}})}}),re(this,"setEvent",G=>{this.state.previousEvent=this.state.event,this.state.event=uT(to(G))}),re(this,"performExitEffects",(G,X)=>{const et=this.state.value;if(et==="")return;const ct=G?this.getStateNode(G):void 0;this.stopActivities(et);const gt=Xg(ct?.exit,this.guardMap)(this.contextSnapshot,X,this.guardMeta),dt=ms(gt),At=this.delayedEvents.get(et);At&&dt.push(...At),this.executeActions(dt,X),this.eventListeners.clear()}),re(this,"performEntryEffects",(G,X)=>{const et=this.getStateNode(G),ct=ms(et?.activities);this.createEveryActivities(et?.every,Jt=>{ct.unshift(Jt)}),ct.length>0&&this.executeActivities(X,ct);const gt=Xg(et?.entry,this.guardMap)(this.contextSnapshot,X,this.guardMeta),dt=ms(gt),At=this.getDelayedEventActions(G);et!=null&&et.after&&At&&(this.delayedEvents.set(G,At?.exits),dt.push(...At.entries)),this.executeActions(dt,X),et?.type==="final"&&(this.state.done=!0,this.doneListeners.forEach(Jt=>{Jt(this.stateSnapshot)}),this.stop())}),re(this,"performTransitionEffects",(G,X)=>{const et=this.determineTransition(G,X);this.executeActions(et?.actions,X)}),re(this,"performStateChangeEffects",(G,X,et)=>{this.setEvent(et);const ct=X.changed||X.reenter;ct&&this.performExitEffects(G,et),this.performTransitionEffects(X.transition,et),this.setState(X.target),ct&&this.performEntryEffects(X.target,et)}),re(this,"determineTransition",(G,X)=>{const et=cP(G,this.guardMap);return et?.(this.contextSnapshot,X,this.guardMeta)}),re(this,"sendParent",G=>{var X;this.parent||wd("[@zag-js/core > send-parent] Cannot send event to an unknown parent");const et=to(G);(X=this.parent)==null||X.send(et)}),re(this,"log",(...G)=>{}),re(this,"send",G=>{const X=to(G);this.transition(this.state.value,X)}),re(this,"transition",(G,X)=>{var et,ct;const gt=Pn(G)?this.getStateNode(G):G?.stateNode,dt=to(X);if(!gt&&!this.config.on){const qe=this.status==="Stopped"?"[@zag-js/core > transition] Cannot transition a stopped machine":`[@zag-js/core > transition] State does not have a definition for \`state\`: ${G}, \`event\`: ${dt.type}`;Wg(qe);return}const At=((et=gt?.on)==null?void 0:et[dt.type])??((ct=this.config.on)==null?void 0:ct[dt.type]),Jt=this.getNextStateInfo(At,dt);return this.performStateChangeEffects(this.state.value,Jt,dt),Jt.stateNode}),re(this,"subscribe",G=>(this.stateListeners.add(G),this.status==="Running"&&G(this.stateSnapshot),()=>{this.stateListeners.delete(G)})),re(this,"onDone",G=>(this.doneListeners.add(G),this)),re(this,"onTransition",G=>(this.stateListeners.add(G),this.status==="Running"&&G(this.stateSnapshot),this)),re(this,"onChange",G=>(this.contextListeners.add(G),this)),re(this,"onEvent",G=>(this.eventListeners.add(G),this)),this.config=fT(h),this.options=fT(m??{}),this.id=this.config.id??`machine-${rP()}`,this.guardMap=((v=this.options)==null?void 0:v.guards)??{},this.actionMap=((w=this.options)==null?void 0:w.actions)??{},this.delayMap=((C=this.options)==null?void 0:C.delays)??{},this.activityMap=((D=this.options)==null?void 0:D.activities)??{},this.sync=((L=this.options)==null?void 0:L.sync)??!1,this.state=aP(this.config),this.initialContext=fl(this.state.context),this.transformContext(this.state.context);const J=to("machine.created");this.executeActions((k=this.config)==null?void 0:k.created,J)}get stateSnapshot(){return zn(fl(this.state))}getState(){return this.stateSnapshot}get contextSnapshot(){return this.stateSnapshot.context}get self(){const h=this;return{id:this.id,send:this.send.bind(this),sendParent:this.sendParent.bind(this),sendChild:this.sendChild.bind(this),stop:this.stop.bind(this),stopChild:this.stopChild.bind(this),spawn:this.spawn.bind(this),get state(){return h.stateSnapshot},get initialContext(){return h.initialContext},get initialState(){var m;return((m=h.initialState)==null?void 0:m.target)??""}}}get meta(){var h;return{state:this.stateSnapshot,guards:this.guardMap,send:this.send.bind(this),self:this.self,initialContext:this.initialContext,initialState:((h=this.initialState)==null?void 0:h.target)??"",getState:()=>this.stateSnapshot,getAction:m=>this.actionMap[m],getGuard:m=>this.guardMap[m]}}get guardMeta(){return{state:this.stateSnapshot}}get[Symbol.toStringTag](){return"Machine"}},hP=(d,h)=>new uP(d,h),_E=d=>d.ownerDocument.defaultView||window;function dP(d,h){const{type:m="HTMLInputElement",property:v="value"}=h,w=_E(d)[m].prototype;return Object.getOwnPropertyDescriptor(w,v)??{}}function pP(d,h,m={}){var v;(v=dP(d,m).set)==null||v.call(d,h)}function yE(d,h){const{value:m,bubbles:v=!0}=h;if(!d)return;const w=_E(d);d instanceof w.HTMLInputElement&&(pP(d,`${m}`),d.dispatchEvent(new w.Event("input",{bubbles:v})))}var mT=(d,...h)=>(typeof d=="function"?d(...h):d)??void 0,gT=(...d)=>(...h)=>{d.forEach(function(m){m?.(...h)})};function xE(d){if(!fP(d)||d===void 0)return d;const h=Reflect.ownKeys(d).filter(v=>typeof v=="string"),m={};for(const v of h){const w=d[v];w!==void 0&&(m[v]=xE(w))}return m}var fP=d=>d&&typeof d=="object"&&d.constructor===Object;function mP(...d){const h=d.length===1?d[0]:d[1];d.length!==2||d[0]}var gP=vs("checkbox").parts("root","label","control");gP.build();var fd=$c({getRootId:d=>{var h;return((h=d.ids)==null?void 0:h.root)??`checkbox:${d.id}`},getLabelId:d=>{var h;return((h=d.ids)==null?void 0:h.label)??`checkbox:${d.id}:label`},getControlId:d=>{var h;return((h=d.ids)==null?void 0:h.control)??`checkbox:${d.id}:control`},getHiddenInputId:d=>{var h;return((h=d.ids)==null?void 0:h.hiddenInput)??`checkbox:${d.id}:hidden`},getRootEl:d=>fd.getById(d,fd.getRootId(d)),getHiddenInputEl:d=>fd.getById(d,fd.getHiddenInputId(d))});function _P(d){return new Proxy({},{get(){return d}})}function yP(d){return d.charAt(0).toUpperCase()+d.substr(1).toLowerCase()}var _T={htmlFor:"for",className:"class",onDoubleClick:"onDblclick",onChange:"onInput",onFocus:"onFocusin",onBlur:"onFocusout",defaultValue:"value",defaultChecked:"checked"};function xP(d){return d in _T?_T[d]:d.startsWith("on")?`on${yP(d.substr(2))}`:d.toLowerCase()}var vP=_P(d=>{const h={};for(const m in d){const v=d[m];m==="children"?typeof v=="string"&&(h.innerHTML=v):h[xP(m)]=d[m]}return h});function bP(d,h){const{actions:m,state:v,context:w}=h??{},C=typeof d=="function"?d():d,D=w?C.withContext(w.value):C;return Gc(()=>{D.start(v),D.state.can("SETUP")&&D.send("SETUP"),Hd(()=>{D.stop()})}),x5(()=>{D.setOptions({actions:m})}),w&&C_(w,D.setContext,{deep:!0}),D}function wP(d,h){const m=bP(d,h),v=g5(m.state);return Gc(()=>{const w=m.subscribe(C=>{v.value=C});Hd(()=>{w?.()})}),[v,m.send,m]}function TP(d={}){const{prefix:h}=d,m=Dz();return h?`${h}-${m}`:m}function bs(d){return typeof d=="string"||d instanceof String}function yT(d){var h;return typeof d=="object"&&d!=null&&(d==null||(h=d.constructor)==null?void 0:h.name)==="Object"}function vE(d,h){return Array.isArray(h)?vE(d,(m,v)=>h.includes(v)):Object.entries(d).reduce((m,v)=>{let[w,C]=v;return h(C,w)&&(m[w]=C),m},{})}const Me={NONE:"NONE",LEFT:"LEFT",FORCE_LEFT:"FORCE_LEFT",RIGHT:"RIGHT",FORCE_RIGHT:"FORCE_RIGHT"};function EP(d){switch(d){case Me.LEFT:return Me.FORCE_LEFT;case Me.RIGHT:return Me.FORCE_RIGHT;default:return d}}function Yg(d){return d.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Ld(d,h){if(h===d)return!0;const m=Array.isArray(h),v=Array.isArray(d);let w;if(m&&v){if(h.length!=d.length)return!1;for(w=0;w<h.length;w++)if(!Ld(h[w],d[w]))return!1;return!0}if(m!=v)return!1;if(h&&d&&typeof h=="object"&&typeof d=="object"){const C=h instanceof Date,D=d instanceof Date;if(C&&D)return h.getTime()==d.getTime();if(C!=D)return!1;const L=h instanceof RegExp,k=d instanceof RegExp;if(L&&k)return h.toString()==d.toString();if(L!=k)return!1;const J=Object.keys(h);for(w=0;w<J.length;w++)if(!Object.prototype.hasOwnProperty.call(d,J[w]))return!1;for(w=0;w<J.length;w++)if(!Ld(d[J[w]],h[J[w]]))return!1;return!0}else if(h&&d&&typeof h=="function"&&typeof d=="function")return h.toString()===d.toString();return!1}class SP{constructor(h){for(Object.assign(this,h);this.value.slice(0,this.startChangePos)!==this.oldValue.slice(0,this.startChangePos);)--this.oldSelection.start}get startChangePos(){return Math.min(this.cursorPos,this.oldSelection.start)}get insertedCount(){return this.cursorPos-this.startChangePos}get inserted(){return this.value.substr(this.startChangePos,this.insertedCount)}get removedCount(){return Math.max(this.oldSelection.end-this.startChangePos||this.oldValue.length-this.value.length,0)}get removed(){return this.oldValue.substr(this.startChangePos,this.removedCount)}get head(){return this.value.substring(0,this.startChangePos)}get tail(){return this.value.substring(this.startChangePos+this.insertedCount)}get removeDirection(){return!this.removedCount||this.insertedCount?Me.NONE:(this.oldSelection.end===this.cursorPos||this.oldSelection.start===this.cursorPos)&&this.oldSelection.end===this.oldSelection.start?Me.RIGHT:Me.LEFT}}function Ye(d,h){return new Ye.InputMask(d,h)}function bE(d){if(d==null)throw new Error("mask property should be defined");return d instanceof RegExp?Ye.MaskedRegExp:bs(d)?Ye.MaskedPattern:d===Date?Ye.MaskedDate:d===Number?Ye.MaskedNumber:Array.isArray(d)||d===Array?Ye.MaskedDynamic:Ye.Masked&&d.prototype instanceof Ye.Masked?d:Ye.Masked&&d instanceof Ye.Masked?d.constructor:d instanceof Function?Ye.MaskedFunction:(console.warn("Mask not found for mask",d),Ye.Masked)}function Od(d){if(!d)throw new Error("Options in not defined");if(Ye.Masked){if(d.prototype instanceof Ye.Masked)return{mask:d};const{mask:h=void 0,...m}=d instanceof Ye.Masked?{mask:d}:yT(d)&&d.mask instanceof Ye.Masked?d:{};if(h){const v=h.mask;return{...vE(h,(w,C)=>!C.startsWith("_")),mask:h.constructor,_mask:v,...m}}}return yT(d)?{...d}:{mask:d}}function sa(d){if(Ye.Masked&&d instanceof Ye.Masked)return d;const h=Od(d),m=bE(h.mask);if(!m)throw new Error("Masked class is not found for provided mask, appropriate module needs to be imported manually before creating mask.");return h.mask===m&&delete h.mask,h._mask&&(h.mask=h._mask,delete h._mask),new m(h)}Ye.createMask=sa;class F_{get selectionStart(){let h;try{h=this._unsafeSelectionStart}catch{}return h??this.value.length}get selectionEnd(){let h;try{h=this._unsafeSelectionEnd}catch{}return h??this.value.length}select(h,m){if(!(h==null||m==null||h===this.selectionStart&&m===this.selectionEnd))try{this._unsafeSelect(h,m)}catch{}}get isActive(){return!1}}Ye.MaskElement=F_;class la extends F_{constructor(h){super(),this.input=h,this._handlers={}}get rootElement(){var h,m,v;return(h=(m=(v=this.input).getRootNode)==null?void 0:m.call(v))!=null?h:document}get isActive(){return this.input===this.rootElement.activeElement}bindEvents(h){Object.keys(h).forEach(m=>this._toggleEventHandler(la.EVENTS_MAP[m],h[m]))}unbindEvents(){Object.keys(this._handlers).forEach(h=>this._toggleEventHandler(h))}_toggleEventHandler(h,m){this._handlers[h]&&(this.input.removeEventListener(h,this._handlers[h]),delete this._handlers[h]),m&&(this.input.addEventListener(h,m),this._handlers[h]=m)}}la.EVENTS_MAP={selectionChange:"keydown",input:"input",drop:"drop",click:"click",focus:"focus",commit:"blur"};Ye.HTMLMaskElement=la;class MP extends la{constructor(h){super(h),this.input=h,this._handlers={}}get _unsafeSelectionStart(){return this.input.selectionStart!=null?this.input.selectionStart:this.value.length}get _unsafeSelectionEnd(){return this.input.selectionEnd}_unsafeSelect(h,m){this.input.setSelectionRange(h,m)}get value(){return this.input.value}set value(h){this.input.value=h}}Ye.HTMLMaskElement=la;class wE extends la{get _unsafeSelectionStart(){const h=this.rootElement,m=h.getSelection&&h.getSelection(),v=m&&m.anchorOffset,w=m&&m.focusOffset;return w==null||v==null||v<w?v:w}get _unsafeSelectionEnd(){const h=this.rootElement,m=h.getSelection&&h.getSelection(),v=m&&m.anchorOffset,w=m&&m.focusOffset;return w==null||v==null||v>w?v:w}_unsafeSelect(h,m){if(!this.rootElement.createRange)return;const v=this.rootElement.createRange();v.setStart(this.input.firstChild||this.input,h),v.setEnd(this.input.lastChild||this.input,m);const w=this.rootElement,C=w.getSelection&&w.getSelection();C&&(C.removeAllRanges(),C.addRange(v))}get value(){return this.input.textContent||""}set value(h){this.input.textContent=h}}Ye.HTMLContenteditableMaskElement=wE;class AP{constructor(h,m){this.el=h instanceof F_?h:h.isContentEditable&&h.tagName!=="INPUT"&&h.tagName!=="TEXTAREA"?new wE(h):new MP(h),this.masked=sa(m),this._listeners={},this._value="",this._unmaskedValue="",this._saveSelection=this._saveSelection.bind(this),this._onInput=this._onInput.bind(this),this._onChange=this._onChange.bind(this),this._onDrop=this._onDrop.bind(this),this._onFocus=this._onFocus.bind(this),this._onClick=this._onClick.bind(this),this.alignCursor=this.alignCursor.bind(this),this.alignCursorFriendly=this.alignCursorFriendly.bind(this),this._bindEvents(),this.updateValue(),this._onChange()}maskEquals(h){var m;return h==null||((m=this.masked)==null?void 0:m.maskEquals(h))}get mask(){return this.masked.mask}set mask(h){if(this.maskEquals(h))return;if(!(h instanceof Ye.Masked)&&this.masked.constructor===bE(h)){this.masked.updateOptions({mask:h});return}const m=h instanceof Ye.Masked?h:sa({mask:h});m.unmaskedValue=this.masked.unmaskedValue,this.masked=m}get value(){return this._value}set value(h){this.value!==h&&(this.masked.value=h,this.updateControl(),this.alignCursor())}get unmaskedValue(){return this._unmaskedValue}set unmaskedValue(h){this.unmaskedValue!==h&&(this.masked.unmaskedValue=h,this.updateControl(),this.alignCursor())}get typedValue(){return this.masked.typedValue}set typedValue(h){this.masked.typedValueEquals(h)||(this.masked.typedValue=h,this.updateControl(),this.alignCursor())}get displayValue(){return this.masked.displayValue}_bindEvents(){this.el.bindEvents({selectionChange:this._saveSelection,input:this._onInput,drop:this._onDrop,click:this._onClick,focus:this._onFocus,commit:this._onChange})}_unbindEvents(){this.el&&this.el.unbindEvents()}_fireEvent(h,m){const v=this._listeners[h];v&&v.forEach(w=>w(m))}get selectionStart(){return this._cursorChanging?this._changingCursorPos:this.el.selectionStart}get cursorPos(){return this._cursorChanging?this._changingCursorPos:this.el.selectionEnd}set cursorPos(h){!this.el||!this.el.isActive||(this.el.select(h,h),this._saveSelection())}_saveSelection(){this.displayValue!==this.el.value&&console.warn("Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly."),this._selection={start:this.selectionStart,end:this.cursorPos}}updateValue(){this.masked.value=this.el.value,this._value=this.masked.value}updateControl(){const h=this.masked.unmaskedValue,m=this.masked.value,v=this.displayValue,w=this.unmaskedValue!==h||this.value!==m;this._unmaskedValue=h,this._value=m,this.el.value!==v&&(this.el.value=v),w&&this._fireChangeEvents()}updateOptions(h){const{mask:m,...v}=h,w=!this.maskEquals(m),C=!Ld(this.masked,v);w&&(this.mask=m),C&&this.masked.updateOptions(v),(w||C)&&this.updateControl()}updateCursor(h){h!=null&&(this.cursorPos=h,this._delayUpdateCursor(h))}_delayUpdateCursor(h){this._abortUpdateCursor(),this._changingCursorPos=h,this._cursorChanging=setTimeout(()=>{this.el&&(this.cursorPos=this._changingCursorPos,this._abortUpdateCursor())},10)}_fireChangeEvents(){this._fireEvent("accept",this._inputEvent),this.masked.isComplete&&this._fireEvent("complete",this._inputEvent)}_abortUpdateCursor(){this._cursorChanging&&(clearTimeout(this._cursorChanging),delete this._cursorChanging)}alignCursor(){this.cursorPos=this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos,Me.LEFT))}alignCursorFriendly(){this.selectionStart===this.cursorPos&&this.alignCursor()}on(h,m){return this._listeners[h]||(this._listeners[h]=[]),this._listeners[h].push(m),this}off(h,m){if(!this._listeners[h])return this;if(!m)return delete this._listeners[h],this;const v=this._listeners[h].indexOf(m);return v>=0&&this._listeners[h].splice(v,1),this}_onInput(h){if(this._inputEvent=h,this._abortUpdateCursor(),!this._selection)return this.updateValue();const m=new SP({value:this.el.value,cursorPos:this.cursorPos,oldValue:this.displayValue,oldSelection:this._selection}),v=this.masked.rawInputValue,w=this.masked.splice(m.startChangePos,m.removed.length,m.inserted,m.removeDirection,{input:!0,raw:!0}).offset,C=v===this.masked.rawInputValue?m.removeDirection:Me.NONE;let D=this.masked.nearestInputPos(m.startChangePos+w,C);C!==Me.NONE&&(D=this.masked.nearestInputPos(D,Me.NONE)),this.updateControl(),this.updateCursor(D),delete this._inputEvent}_onChange(){this.displayValue!==this.el.value&&this.updateValue(),this.masked.doCommit(),this.updateControl(),this._saveSelection()}_onDrop(h){h.preventDefault(),h.stopPropagation()}_onFocus(h){this.alignCursorFriendly()}_onClick(h){this.alignCursorFriendly()}destroy(){this._unbindEvents(),this._listeners.length=0,delete this.el}}Ye.InputMask=AP;class Ri{static normalize(h){return Array.isArray(h)?h:[h,new Ri]}constructor(h){Object.assign(this,{inserted:"",rawInserted:"",skip:!1,tailShift:0},h)}aggregate(h){return this.rawInserted+=h.rawInserted,this.skip=this.skip||h.skip,this.inserted+=h.inserted,this.tailShift+=h.tailShift,this}get offset(){return this.tailShift+this.inserted.length}}Ye.ChangeDetails=Ri;class Rn{constructor(h,m,v){h===void 0&&(h=""),m===void 0&&(m=0),this.value=h,this.from=m,this.stop=v}toString(){return this.value}extend(h){this.value+=String(h)}appendTo(h){return h.append(this.toString(),{tail:!0}).aggregate(h._appendPlaceholder())}get state(){return{value:this.value,from:this.from,stop:this.stop}}set state(h){Object.assign(this,h)}unshift(h){if(!this.value.length||h!=null&&this.from>=h)return"";const m=this.value[0];return this.value=this.value.slice(1),m}shift(){if(!this.value.length)return"";const h=this.value[this.value.length-1];return this.value=this.value.slice(0,-1),h}}class fo{constructor(h){this._value="",this._update({...fo.DEFAULTS,...h}),this._initialized=!0}updateOptions(h){Object.keys(h).length&&this.withValueRefresh(this._update.bind(this,h))}_update(h){Object.assign(this,h)}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue}}set state(h){this._value=h._value}reset(){this._value=""}get value(){return this._value}set value(h){this.resolve(h,{input:!0})}resolve(h,m){m===void 0&&(m={input:!0}),this.reset(),this.append(h,m,""),this.doCommit()}get unmaskedValue(){return this.value}set unmaskedValue(h){this.resolve(h,{})}get typedValue(){return this.parse?this.parse(this.value,this):this.unmaskedValue}set typedValue(h){this.format?this.value=this.format(h,this):this.unmaskedValue=String(h)}get rawInputValue(){return this.extractInput(0,this.displayValue.length,{raw:!0})}set rawInputValue(h){this.resolve(h,{raw:!0})}get displayValue(){return this.value}get isComplete(){return!0}get isFilled(){return this.isComplete}nearestInputPos(h,m){return h}totalInputPositions(h,m){return h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),Math.min(this.displayValue.length,m-h)}extractInput(h,m,v){return h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),this.displayValue.slice(h,m)}extractTail(h,m){return h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),new Rn(this.extractInput(h,m),h)}appendTail(h){return bs(h)&&(h=new Rn(String(h))),h.appendTo(this)}_appendCharRaw(h,m){return h?(this._value+=h,new Ri({inserted:h,rawInserted:h})):new Ri}_appendChar(h,m,v){m===void 0&&(m={});const w=this.state;let C;if([h,C]=this.doPrepareChar(h,m),C=C.aggregate(this._appendCharRaw(h,m)),C.inserted){let D,L=this.doValidate(m)!==!1;if(L&&v!=null){const k=this.state;this.overwrite===!0&&(D=v.state,v.unshift(this.displayValue.length-C.tailShift));let J=this.appendTail(v);L=J.rawInserted===v.toString(),!(L&&J.inserted)&&this.overwrite==="shift"&&(this.state=k,D=v.state,v.shift(),J=this.appendTail(v),L=J.rawInserted===v.toString()),L&&J.inserted&&(this.state=k)}L||(C=new Ri,this.state=w,v&&D&&(v.state=D))}return C}_appendPlaceholder(){return new Ri}_appendEager(){return new Ri}append(h,m,v){if(!bs(h))throw new Error("value should be string");const w=bs(v)?new Rn(String(v)):v;m!=null&&m.tail&&(m._beforeTailState=this.state);let C;[h,C]=this.doPrepare(h,m);for(let D=0;D<h.length;++D){const L=this._appendChar(h[D],m,w);if(!L.rawInserted&&!this.doSkipInvalid(h[D],m,w))break;C.aggregate(L)}return(this.eager===!0||this.eager==="append")&&m!=null&&m.input&&h&&C.aggregate(this._appendEager()),w!=null&&(C.tailShift+=this.appendTail(w).tailShift),C}remove(h,m){return h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),this._value=this.displayValue.slice(0,h)+this.displayValue.slice(m),new Ri}withValueRefresh(h){if(this._refreshing||!this._initialized)return h();this._refreshing=!0;const m=this.rawInputValue,v=this.value,w=h();return this.rawInputValue=m,this.value&&this.value!==v&&v.indexOf(this.value)===0&&this.append(v.slice(this.displayValue.length),{},""),delete this._refreshing,w}runIsolated(h){if(this._isolated||!this._initialized)return h(this);this._isolated=!0;const m=this.state,v=h(this);return this.state=m,delete this._isolated,v}doSkipInvalid(h,m,v){return!!this.skipInvalid}doPrepare(h,m){return m===void 0&&(m={}),Ri.normalize(this.prepare?this.prepare(h,this,m):h)}doPrepareChar(h,m){return m===void 0&&(m={}),Ri.normalize(this.prepareChar?this.prepareChar(h,this,m):h)}doValidate(h){return(!this.validate||this.validate(this.value,this,h))&&(!this.parent||this.parent.doValidate(h))}doCommit(){this.commit&&this.commit(this.value,this)}splice(h,m,v,w,C){w===void 0&&(w=Me.NONE),C===void 0&&(C={input:!0});const D=h+m,L=this.extractTail(D),k=this.eager===!0||this.eager==="remove";let J;k&&(w=EP(w),J=this.extractInput(0,D,{raw:!0}));let G=h;const X=new Ri;if(w!==Me.NONE&&(G=this.nearestInputPos(h,m>1&&h!==0&&!k?Me.NONE:w),X.tailShift=G-h),X.aggregate(this.remove(G)),k&&w!==Me.NONE&&J===this.rawInputValue)if(w===Me.FORCE_LEFT){let et;for(;J===this.rawInputValue&&(et=this.displayValue.length);)X.aggregate(new Ri({tailShift:-1})).aggregate(this.remove(et-1))}else w===Me.FORCE_RIGHT&&L.unshift();return X.aggregate(this.append(v,C,L))}maskEquals(h){return this.mask===h}typedValueEquals(h){const m=this.typedValue;return h===m||fo.EMPTY_VALUES.includes(h)&&fo.EMPTY_VALUES.includes(m)||(this.format?this.format(h,this)===this.format(this.typedValue,this):!1)}}fo.DEFAULTS={skipInvalid:!0};fo.EMPTY_VALUES=[void 0,null,""];Ye.Masked=fo;class ia{constructor(h,m){h===void 0&&(h=[]),m===void 0&&(m=0),this.chunks=h,this.from=m}toString(){return this.chunks.map(String).join("")}extend(h){if(!String(h))return;h=bs(h)?new Rn(String(h)):h;const m=this.chunks[this.chunks.length-1],v=m&&(m.stop===h.stop||h.stop==null)&&h.from===m.from+m.toString().length;if(h instanceof Rn)v?m.extend(h.toString()):this.chunks.push(h);else if(h instanceof ia){if(h.stop==null){let w;for(;h.chunks.length&&h.chunks[0].stop==null;)w=h.chunks.shift(),w.from+=h.from,this.extend(w)}h.toString()&&(h.stop=h.blockIndex,this.chunks.push(h))}}appendTo(h){if(!(h instanceof Ye.MaskedPattern))return new Rn(this.toString()).appendTo(h);const m=new Ri;for(let v=0;v<this.chunks.length&&!m.skip;++v){const w=this.chunks[v],C=h._mapPosToBlock(h.displayValue.length),D=w.stop;let L;if(D!=null&&(!C||C.index<=D)){if(w instanceof ia||h._stops.indexOf(D)>=0){const k=h._appendPlaceholder(D);m.aggregate(k)}L=w instanceof ia&&h._blocks[D]}if(L){const k=L.appendTail(w);k.skip=!1,m.aggregate(k),h._value+=k.inserted;const J=w.toString().slice(k.rawInserted.length);J&&m.aggregate(h.append(J,{tail:!0}))}else m.aggregate(h.append(w.toString(),{tail:!0}))}return m}get state(){return{chunks:this.chunks.map(h=>h.state),from:this.from,stop:this.stop,blockIndex:this.blockIndex}}set state(h){const{chunks:m,...v}=h;Object.assign(this,v),this.chunks=m.map(w=>{const C="chunks"in w?new ia:new Rn;return C.state=w,C})}unshift(h){if(!this.chunks.length||h!=null&&this.from>=h)return"";const m=h!=null?h-this.from:h;let v=0;for(;v<this.chunks.length;){const w=this.chunks[v],C=w.unshift(m);if(w.toString()){if(!C)break;++v}else this.chunks.splice(v,1);if(C)return C}return""}shift(){if(!this.chunks.length)return"";let h=this.chunks.length-1;for(;0<=h;){const m=this.chunks[h],v=m.shift();if(m.toString()){if(!v)break;--h}else this.chunks.splice(h,1);if(v)return v}return""}}class CP{constructor(h,m){this.masked=h,this._log=[];const{offset:v,index:w}=h._mapPosToBlock(m)||(m<0?{index:0,offset:0}:{index:this.masked._blocks.length,offset:0});this.offset=v,this.index=w,this.ok=!1}get block(){return this.masked._blocks[this.index]}get pos(){return this.masked._blockStartPos(this.index)+this.offset}get state(){return{index:this.index,offset:this.offset,ok:this.ok}}set state(h){Object.assign(this,h)}pushState(){this._log.push(this.state)}popState(){const h=this._log.pop();return h&&(this.state=h),h}bindBlock(){this.block||(this.index<0&&(this.index=0,this.offset=0),this.index>=this.masked._blocks.length&&(this.index=this.masked._blocks.length-1,this.offset=this.block.displayValue.length))}_pushLeft(h){for(this.pushState(),this.bindBlock();0<=this.index;--this.index,this.offset=((m=this.block)==null?void 0:m.displayValue.length)||0){var m;if(h())return this.ok=!0}return this.ok=!1}_pushRight(h){for(this.pushState(),this.bindBlock();this.index<this.masked._blocks.length;++this.index,this.offset=0)if(h())return this.ok=!0;return this.ok=!1}pushLeftBeforeFilled(){return this._pushLeft(()=>{if(!(this.block.isFixed||!this.block.value)&&(this.offset=this.block.nearestInputPos(this.offset,Me.FORCE_LEFT),this.offset!==0))return!0})}pushLeftBeforeInput(){return this._pushLeft(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,Me.LEFT),!0})}pushLeftBeforeRequired(){return this._pushLeft(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,Me.LEFT),!0})}pushRightBeforeFilled(){return this._pushRight(()=>{if(!(this.block.isFixed||!this.block.value)&&(this.offset=this.block.nearestInputPos(this.offset,Me.FORCE_RIGHT),this.offset!==this.block.value.length))return!0})}pushRightBeforeInput(){return this._pushRight(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,Me.NONE),!0})}pushRightBeforeRequired(){return this._pushRight(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,Me.NONE),!0})}}class TE{constructor(h){Object.assign(this,h),this._value="",this.isFixed=!0}get value(){return this._value}get unmaskedValue(){return this.isUnmasking?this.value:""}get rawInputValue(){return this._isRawInput?this.value:""}get displayValue(){return this.value}reset(){this._isRawInput=!1,this._value=""}remove(h,m){return h===void 0&&(h=0),m===void 0&&(m=this._value.length),this._value=this._value.slice(0,h)+this._value.slice(m),this._value||(this._isRawInput=!1),new Ri}nearestInputPos(h,m){m===void 0&&(m=Me.NONE);const v=0,w=this._value.length;switch(m){case Me.LEFT:case Me.FORCE_LEFT:return v;case Me.NONE:case Me.RIGHT:case Me.FORCE_RIGHT:default:return w}}totalInputPositions(h,m){return h===void 0&&(h=0),m===void 0&&(m=this._value.length),this._isRawInput?m-h:0}extractInput(h,m,v){return h===void 0&&(h=0),m===void 0&&(m=this._value.length),v===void 0&&(v={}),v.raw&&this._isRawInput&&this._value.slice(h,m)||""}get isComplete(){return!0}get isFilled(){return!!this._value}_appendChar(h,m){m===void 0&&(m={});const v=new Ri;if(this.isFilled)return v;const w=this.eager===!0||this.eager==="append",C=this.char===h&&(this.isUnmasking||m.input||m.raw)&&(!m.raw||!w)&&!m.tail;return C&&(v.rawInserted=this.char),this._value=v.inserted=this.char,this._isRawInput=C&&(m.raw||m.input),v}_appendEager(){return this._appendChar(this.char,{tail:!0})}_appendPlaceholder(){const h=new Ri;return this.isFilled||(this._value=h.inserted=this.char),h}extractTail(){return new Rn("")}appendTail(h){return bs(h)&&(h=new Rn(String(h))),h.appendTo(this)}append(h,m,v){const w=this._appendChar(h[0],m);return v!=null&&(w.tailShift+=this.appendTail(v).tailShift),w}doCommit(){}get state(){return{_value:this._value,_rawInputValue:this.rawInputValue}}set state(h){this._value=h._value,this._isRawInput=!!h._rawInputValue}}class Bd{constructor(h){const{parent:m,isOptional:v,placeholderChar:w,displayChar:C,lazy:D,eager:L,...k}=h;this.masked=sa(k),Object.assign(this,{parent:m,isOptional:v,placeholderChar:w,displayChar:C,lazy:D,eager:L})}reset(){this.isFilled=!1,this.masked.reset()}remove(h,m){return h===void 0&&(h=0),m===void 0&&(m=this.value.length),h===0&&m>=1?(this.isFilled=!1,this.masked.remove(h,m)):new Ri}get value(){return this.masked.value||(this.isFilled&&!this.isOptional?this.placeholderChar:"")}get unmaskedValue(){return this.masked.unmaskedValue}get rawInputValue(){return this.masked.rawInputValue}get displayValue(){return this.masked.value&&this.displayChar||this.value}get isComplete(){return!!this.masked.value||this.isOptional}_appendChar(h,m){if(m===void 0&&(m={}),this.isFilled)return new Ri;const v=this.masked.state,w=this.masked._appendChar(h,this.currentMaskFlags(m));return w.inserted&&this.doValidate(m)===!1&&(w.inserted=w.rawInserted="",this.masked.state=v),!w.inserted&&!this.isOptional&&!this.lazy&&!m.input&&(w.inserted=this.placeholderChar),w.skip=!w.inserted&&!this.isOptional,this.isFilled=!!w.inserted,w}append(h,m,v){return this.masked.append(h,this.currentMaskFlags(m),v)}_appendPlaceholder(){const h=new Ri;return this.isFilled||this.isOptional||(this.isFilled=!0,h.inserted=this.placeholderChar),h}_appendEager(){return new Ri}extractTail(h,m){return this.masked.extractTail(h,m)}appendTail(h){return this.masked.appendTail(h)}extractInput(h,m,v){return h===void 0&&(h=0),m===void 0&&(m=this.value.length),this.masked.extractInput(h,m,v)}nearestInputPos(h,m){m===void 0&&(m=Me.NONE);const v=0,w=this.value.length,C=Math.min(Math.max(h,v),w);switch(m){case Me.LEFT:case Me.FORCE_LEFT:return this.isComplete?C:v;case Me.RIGHT:case Me.FORCE_RIGHT:return this.isComplete?C:w;case Me.NONE:default:return C}}totalInputPositions(h,m){return h===void 0&&(h=0),m===void 0&&(m=this.value.length),this.value.slice(h,m).length}doValidate(h){return this.masked.doValidate(this.currentMaskFlags(h))&&(!this.parent||this.parent.doValidate(this.currentMaskFlags(h)))}doCommit(){this.masked.doCommit()}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue,masked:this.masked.state,isFilled:this.isFilled}}set state(h){this.masked.state=h.masked,this.isFilled=h.isFilled}currentMaskFlags(h){var m;return{...h,_beforeTailState:(h==null||(m=h._beforeTailState)==null?void 0:m.masked)||h?._beforeTailState}}}Bd.DEFAULT_DEFINITIONS={0:/\d/,a:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,"*":/./};class IP extends fo{updateOptions(h){super.updateOptions(h)}_update(h){const m=h.mask;m&&(h.validate=v=>v.search(m)>=0),super._update(h)}}Ye.MaskedRegExp=IP;class mo extends fo{constructor(h){super({...mo.DEFAULTS,...h,definitions:Object.assign({},Bd.DEFAULT_DEFINITIONS,h?.definitions)})}updateOptions(h){super.updateOptions(h)}_update(h){h.definitions=Object.assign({},this.definitions,h.definitions),super._update(h),this._rebuildMask()}_rebuildMask(){const h=this.definitions;this._blocks=[],this.exposeBlock=void 0,this._stops=[],this._maskedBlocks={};const m=this.mask;if(!m||!h)return;let v=!1,w=!1;for(let C=0;C<m.length;++C){if(this.blocks){const J=m.slice(C),G=Object.keys(this.blocks).filter(et=>J.indexOf(et)===0);G.sort((et,ct)=>ct.length-et.length);const X=G[0];if(X){const{expose:et,...ct}=Od(this.blocks[X]),gt=sa({lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar,overwrite:this.overwrite,...ct,parent:this});gt&&(this._blocks.push(gt),et&&(this.exposeBlock=gt),this._maskedBlocks[X]||(this._maskedBlocks[X]=[]),this._maskedBlocks[X].push(this._blocks.length-1)),C+=X.length-1;continue}}let D=m[C],L=D in h;if(D===mo.STOP_CHAR){this._stops.push(this._blocks.length);continue}if(D==="{"||D==="}"){v=!v;continue}if(D==="["||D==="]"){w=!w;continue}if(D===mo.ESCAPE_CHAR){if(++C,D=m[C],!D)break;L=!1}const k=L?new Bd({isOptional:w,lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar,...Od(h[D]),parent:this}):new TE({char:D,eager:this.eager,isUnmasking:v});this._blocks.push(k)}}get state(){return{...super.state,_blocks:this._blocks.map(h=>h.state)}}set state(h){const{_blocks:m,...v}=h;this._blocks.forEach((w,C)=>w.state=m[C]),super.state=v}reset(){super.reset(),this._blocks.forEach(h=>h.reset())}get isComplete(){return this.exposeBlock?this.exposeBlock.isComplete:this._blocks.every(h=>h.isComplete)}get isFilled(){return this._blocks.every(h=>h.isFilled)}get isFixed(){return this._blocks.every(h=>h.isFixed)}get isOptional(){return this._blocks.every(h=>h.isOptional)}doCommit(){this._blocks.forEach(h=>h.doCommit()),super.doCommit()}get unmaskedValue(){return this.exposeBlock?this.exposeBlock.unmaskedValue:this._blocks.reduce((h,m)=>h+=m.unmaskedValue,"")}set unmaskedValue(h){if(this.exposeBlock){const m=this.extractTail(this._blockStartPos(this._blocks.indexOf(this.exposeBlock))+this.exposeBlock.displayValue.length);this.exposeBlock.unmaskedValue=h,this.appendTail(m),this.doCommit()}else super.unmaskedValue=h}get value(){return this.exposeBlock?this.exposeBlock.value:this._blocks.reduce((h,m)=>h+=m.value,"")}set value(h){if(this.exposeBlock){const m=this.extractTail(this._blockStartPos(this._blocks.indexOf(this.exposeBlock))+this.exposeBlock.displayValue.length);this.exposeBlock.value=h,this.appendTail(m),this.doCommit()}else super.value=h}get typedValue(){return this.exposeBlock?this.exposeBlock.typedValue:super.typedValue}set typedValue(h){if(this.exposeBlock){const m=this.extractTail(this._blockStartPos(this._blocks.indexOf(this.exposeBlock))+this.exposeBlock.displayValue.length);this.exposeBlock.typedValue=h,this.appendTail(m),this.doCommit()}else super.typedValue=h}get displayValue(){return this._blocks.reduce((h,m)=>h+=m.displayValue,"")}appendTail(h){return super.appendTail(h).aggregate(this._appendPlaceholder())}_appendEager(){var h;const m=new Ri;let v=(h=this._mapPosToBlock(this.displayValue.length))==null?void 0:h.index;if(v==null)return m;this._blocks[v].isFilled&&++v;for(let w=v;w<this._blocks.length;++w){const C=this._blocks[w]._appendEager();if(!C.inserted)break;m.aggregate(C)}return m}_appendCharRaw(h,m){m===void 0&&(m={});const v=this._mapPosToBlock(this.displayValue.length),w=new Ri;if(!v)return w;for(let D=v.index;;++D){var C;const L=this._blocks[D];if(!L)break;const k=L._appendChar(h,{...m,_beforeTailState:(C=m._beforeTailState)==null||(C=C._blocks)==null?void 0:C[D]}),J=k.skip;if(w.aggregate(k),J||k.rawInserted)break}return w}extractTail(h,m){h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length);const v=new ia;return h===m||this._forEachBlocksInRange(h,m,(w,C,D,L)=>{const k=w.extractTail(D,L);k.stop=this._findStopBefore(C),k.from=this._blockStartPos(C),k instanceof ia&&(k.blockIndex=C),v.extend(k)}),v}extractInput(h,m,v){if(h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),v===void 0&&(v={}),h===m)return"";let w="";return this._forEachBlocksInRange(h,m,(C,D,L,k)=>{w+=C.extractInput(L,k,v)}),w}_findStopBefore(h){let m;for(let v=0;v<this._stops.length;++v){const w=this._stops[v];if(w<=h)m=w;else break}return m}_appendPlaceholder(h){const m=new Ri;if(this.lazy&&h==null)return m;const v=this._mapPosToBlock(this.displayValue.length);if(!v)return m;const w=v.index,C=h??this._blocks.length;return this._blocks.slice(w,C).forEach(D=>{if(!D.lazy||h!=null){var L;const k=D._appendPlaceholder((L=D._blocks)==null?void 0:L.length);this._value+=k.inserted,m.aggregate(k)}}),m}_mapPosToBlock(h){let m="";for(let v=0;v<this._blocks.length;++v){const w=this._blocks[v],C=m.length;if(m+=w.displayValue,h<=m.length)return{index:v,offset:h-C}}}_blockStartPos(h){return this._blocks.slice(0,h).reduce((m,v)=>m+=v.displayValue.length,0)}_forEachBlocksInRange(h,m,v){m===void 0&&(m=this.displayValue.length);const w=this._mapPosToBlock(h);if(w){const C=this._mapPosToBlock(m),D=C&&w.index===C.index,L=w.offset,k=C&&D?C.offset:this._blocks[w.index].displayValue.length;if(v(this._blocks[w.index],w.index,L,k),C&&!D){for(let J=w.index+1;J<C.index;++J)v(this._blocks[J],J,0,this._blocks[J].displayValue.length);v(this._blocks[C.index],C.index,0,C.offset)}}}remove(h,m){h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length);const v=super.remove(h,m);return this._forEachBlocksInRange(h,m,(w,C,D,L)=>{v.aggregate(w.remove(D,L))}),v}nearestInputPos(h,m){if(m===void 0&&(m=Me.NONE),!this._blocks.length)return 0;const v=new CP(this,h);if(m===Me.NONE)return v.pushRightBeforeInput()||(v.popState(),v.pushLeftBeforeInput())?v.pos:this.displayValue.length;if(m===Me.LEFT||m===Me.FORCE_LEFT){if(m===Me.LEFT){if(v.pushRightBeforeFilled(),v.ok&&v.pos===h)return h;v.popState()}if(v.pushLeftBeforeInput(),v.pushLeftBeforeRequired(),v.pushLeftBeforeFilled(),m===Me.LEFT){if(v.pushRightBeforeInput(),v.pushRightBeforeRequired(),v.ok&&v.pos<=h||(v.popState(),v.ok&&v.pos<=h))return v.pos;v.popState()}return v.ok?v.pos:m===Me.FORCE_LEFT?0:(v.popState(),v.ok||(v.popState(),v.ok)?v.pos:0)}return m===Me.RIGHT||m===Me.FORCE_RIGHT?(v.pushRightBeforeInput(),v.pushRightBeforeRequired(),v.pushRightBeforeFilled()?v.pos:m===Me.FORCE_RIGHT?this.displayValue.length:(v.popState(),v.ok||(v.popState(),v.ok)?v.pos:this.nearestInputPos(h,Me.LEFT))):h}totalInputPositions(h,m){h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length);let v=0;return this._forEachBlocksInRange(h,m,(w,C,D,L)=>{v+=w.totalInputPositions(D,L)}),v}maskedBlock(h){return this.maskedBlocks(h)[0]}maskedBlocks(h){const m=this._maskedBlocks[h];return m?m.map(v=>this._blocks[v]):[]}}mo.DEFAULTS={lazy:!0,placeholderChar:"_"};mo.STOP_CHAR="`";mo.ESCAPE_CHAR="\\";mo.InputDefinition=Bd;mo.FixedDefinition=TE;Ye.MaskedPattern=mo;class Td extends mo{get _matchFrom(){return this.maxLength-String(this.from).length}constructor(h){super(h)}updateOptions(h){super.updateOptions(h)}_update(h){const{to:m=this.to||0,from:v=this.from||0,maxLength:w=this.maxLength||0,autofix:C=this.autofix,...D}=h;this.to=m,this.from=v,this.maxLength=Math.max(String(m).length,w),this.autofix=C;const L=String(this.from).padStart(this.maxLength,"0"),k=String(this.to).padStart(this.maxLength,"0");let J=0;for(;J<k.length&&k[J]===L[J];)++J;D.mask=k.slice(0,J).replace(/0/g,"\\0")+"0".repeat(this.maxLength-J),super._update(D)}get isComplete(){return super.isComplete&&!!this.value}boundaries(h){let m="",v="";const[,w,C]=h.match(/^(\D*)(\d*)(\D*)/)||[];return C&&(m="0".repeat(w.length)+C,v="9".repeat(w.length)+C),m=m.padEnd(this.maxLength,"0"),v=v.padEnd(this.maxLength,"9"),[m,v]}doPrepareChar(h,m){m===void 0&&(m={});let v;if([h,v]=super.doPrepareChar(h.replace(/\D/g,""),m),!this.autofix||!h)return[h,v];const w=String(this.from).padStart(this.maxLength,"0"),C=String(this.to).padStart(this.maxLength,"0"),D=this.value+h;if(D.length>this.maxLength)return["",v];const[L,k]=this.boundaries(D);return Number(k)<this.from?[w[D.length-1],v]:Number(L)>this.to?this.autofix==="pad"&&D.length<this.maxLength?["",v.aggregate(this.append(w[D.length-1]+h,m))]:[C[D.length-1],v]:[h,v]}doValidate(h){const m=this.value;if(m.search(/[^0]/)===-1&&m.length<=this._matchFrom)return!0;const[v,w]=this.boundaries(m);return this.from<=Number(w)&&Number(v)<=this.to&&super.doValidate(h)}}Ye.MaskedRange=Td;class oa extends mo{constructor(h){const{mask:m,pattern:v,...w}={...oa.DEFAULTS,...h};super({...w,mask:bs(m)?m:v})}updateOptions(h){super.updateOptions(h)}_update(h){const{mask:m,pattern:v,blocks:w,...C}={...oa.DEFAULTS,...h},D=Object.assign({},oa.GET_DEFAULT_BLOCKS());h.min&&(D.Y.from=h.min.getFullYear()),h.max&&(D.Y.to=h.max.getFullYear()),h.min&&h.max&&D.Y.from===D.Y.to&&(D.m.from=h.min.getMonth()+1,D.m.to=h.max.getMonth()+1,D.m.from===D.m.to&&(D.d.from=h.min.getDate(),D.d.to=h.max.getDate())),Object.assign(D,this.blocks,w),Object.keys(D).forEach(L=>{const k=D[L];!("autofix"in k)&&"autofix"in h&&(k.autofix=h.autofix)}),super._update({...C,mask:bs(m)?m:v,blocks:D})}doValidate(h){const m=this.date;return super.doValidate(h)&&(!this.isComplete||this.isDateExist(this.value)&&m!=null&&(this.min==null||this.min<=m)&&(this.max==null||m<=this.max))}isDateExist(h){return this.format(this.parse(h,this),this).indexOf(h)>=0}get date(){return this.typedValue}set date(h){this.typedValue=h}get typedValue(){return this.isComplete?super.typedValue:null}set typedValue(h){super.typedValue=h}maskEquals(h){return h===Date||super.maskEquals(h)}}oa.GET_DEFAULT_BLOCKS=()=>({d:{mask:Td,from:1,to:31,maxLength:2},m:{mask:Td,from:1,to:12,maxLength:2},Y:{mask:Td,from:1900,to:9999}});oa.DEFAULTS={mask:Date,pattern:"d{.}`m{.}`Y",format:(d,h)=>{if(!d)return"";const m=String(d.getDate()).padStart(2,"0"),v=String(d.getMonth()+1).padStart(2,"0"),w=d.getFullYear();return[m,v,w].join(".")},parse:(d,h)=>{const[m,v,w]=d.split(".").map(Number);return new Date(w,v-1,m)}};Ye.MaskedDate=oa;class Zc extends fo{constructor(h){super({...Zc.DEFAULTS,...h}),this.currentMask=void 0}updateOptions(h){super.updateOptions(h)}_update(h){super._update(h),"mask"in h&&(this.exposeMask=void 0,this.compiledMasks=Array.isArray(h.mask)?h.mask.map(m=>{const{expose:v,...w}=Od(m),C=sa({overwrite:this._overwrite,eager:this._eager,skipInvalid:this._skipInvalid,...w});return v&&(this.exposeMask=C),C}):[])}_appendCharRaw(h,m){m===void 0&&(m={});const v=this._applyDispatch(h,m);return this.currentMask&&v.aggregate(this.currentMask._appendChar(h,this.currentMaskFlags(m))),v}_applyDispatch(h,m,v){h===void 0&&(h=""),m===void 0&&(m={}),v===void 0&&(v="");const w=m.tail&&m._beforeTailState!=null?m._beforeTailState._value:this.value,C=this.rawInputValue,D=m.tail&&m._beforeTailState!=null?m._beforeTailState._rawInputValue:C,L=C.slice(D.length),k=this.currentMask,J=new Ri,G=k?.state;if(this.currentMask=this.doDispatch(h,{...m},v),this.currentMask)if(this.currentMask!==k){if(this.currentMask.reset(),D){const X=this.currentMask.append(D,{raw:!0});J.tailShift=X.inserted.length-w.length}L&&(J.tailShift+=this.currentMask.append(L,{raw:!0,tail:!0}).tailShift)}else G&&(this.currentMask.state=G);return J}_appendPlaceholder(){const h=this._applyDispatch();return this.currentMask&&h.aggregate(this.currentMask._appendPlaceholder()),h}_appendEager(){const h=this._applyDispatch();return this.currentMask&&h.aggregate(this.currentMask._appendEager()),h}appendTail(h){const m=new Ri;return h&&m.aggregate(this._applyDispatch("",{},h)),m.aggregate(this.currentMask?this.currentMask.appendTail(h):super.appendTail(h))}currentMaskFlags(h){var m,v;return{...h,_beforeTailState:((m=h._beforeTailState)==null?void 0:m.currentMaskRef)===this.currentMask&&((v=h._beforeTailState)==null?void 0:v.currentMask)||h._beforeTailState}}doDispatch(h,m,v){return m===void 0&&(m={}),v===void 0&&(v=""),this.dispatch(h,this,m,v)}doValidate(h){return super.doValidate(h)&&(!this.currentMask||this.currentMask.doValidate(this.currentMaskFlags(h)))}doPrepare(h,m){m===void 0&&(m={});let[v,w]=super.doPrepare(h,m);if(this.currentMask){let C;[v,C]=super.doPrepare(v,this.currentMaskFlags(m)),w=w.aggregate(C)}return[v,w]}doPrepareChar(h,m){m===void 0&&(m={});let[v,w]=super.doPrepareChar(h,m);if(this.currentMask){let C;[v,C]=super.doPrepareChar(v,this.currentMaskFlags(m)),w=w.aggregate(C)}return[v,w]}reset(){var h;(h=this.currentMask)==null||h.reset(),this.compiledMasks.forEach(m=>m.reset())}get value(){return this.exposeMask?this.exposeMask.value:this.currentMask?this.currentMask.value:""}set value(h){this.exposeMask?(this.exposeMask.value=h,this.currentMask=this.exposeMask,this._applyDispatch()):super.value=h}get unmaskedValue(){return this.exposeMask?this.exposeMask.unmaskedValue:this.currentMask?this.currentMask.unmaskedValue:""}set unmaskedValue(h){this.exposeMask?(this.exposeMask.unmaskedValue=h,this.currentMask=this.exposeMask,this._applyDispatch()):super.unmaskedValue=h}get typedValue(){return this.exposeMask?this.exposeMask.typedValue:this.currentMask?this.currentMask.typedValue:""}set typedValue(h){if(this.exposeMask){this.exposeMask.typedValue=h,this.currentMask=this.exposeMask,this._applyDispatch();return}let m=String(h);this.currentMask&&(this.currentMask.typedValue=h,m=this.currentMask.unmaskedValue),this.unmaskedValue=m}get displayValue(){return this.currentMask?this.currentMask.displayValue:""}get isComplete(){var h;return!!((h=this.currentMask)!=null&&h.isComplete)}get isFilled(){var h;return!!((h=this.currentMask)!=null&&h.isFilled)}remove(h,m){const v=new Ri;return this.currentMask&&v.aggregate(this.currentMask.remove(h,m)).aggregate(this._applyDispatch()),v}get state(){var h;return{...super.state,_rawInputValue:this.rawInputValue,compiledMasks:this.compiledMasks.map(m=>m.state),currentMaskRef:this.currentMask,currentMask:(h=this.currentMask)==null?void 0:h.state}}set state(h){const{compiledMasks:m,currentMaskRef:v,currentMask:w,...C}=h;m&&this.compiledMasks.forEach((D,L)=>D.state=m[L]),v!=null&&(this.currentMask=v,this.currentMask.state=w),super.state=C}extractInput(h,m,v){return this.currentMask?this.currentMask.extractInput(h,m,v):""}extractTail(h,m){return this.currentMask?this.currentMask.extractTail(h,m):super.extractTail(h,m)}doCommit(){this.currentMask&&this.currentMask.doCommit(),super.doCommit()}nearestInputPos(h,m){return this.currentMask?this.currentMask.nearestInputPos(h,m):super.nearestInputPos(h,m)}get overwrite(){return this.currentMask?this.currentMask.overwrite:this._overwrite}set overwrite(h){this._overwrite=h}get eager(){return this.currentMask?this.currentMask.eager:this._eager}set eager(h){this._eager=h}get skipInvalid(){return this.currentMask?this.currentMask.skipInvalid:this._skipInvalid}set skipInvalid(h){this._skipInvalid=h}maskEquals(h){return Array.isArray(h)?this.compiledMasks.every((m,v)=>{if(!h[v])return;const{mask:w,...C}=h[v];return Ld(m,C)&&m.maskEquals(w)}):super.maskEquals(h)}typedValueEquals(h){var m;return!!((m=this.currentMask)!=null&&m.typedValueEquals(h))}}Zc.DEFAULTS=void 0;Zc.DEFAULTS={dispatch:(d,h,m,v)=>{if(!h.compiledMasks.length)return;const w=h.rawInputValue,C=h.compiledMasks.map((D,L)=>{const k=h.currentMask===D,J=k?D.displayValue.length:D.nearestInputPos(D.displayValue.length,Me.FORCE_LEFT);return D.rawInputValue!==w?(D.reset(),D.append(w,{raw:!0})):k||D.remove(J),D.append(d,h.currentMaskFlags(m)),D.appendTail(v),{index:L,weight:D.rawInputValue.length,totalInputPositions:D.totalInputPositions(0,Math.max(J,D.nearestInputPos(D.displayValue.length,Me.FORCE_LEFT)))}});return C.sort((D,L)=>L.weight-D.weight||L.totalInputPositions-D.totalInputPositions),h.compiledMasks[C[0].index]}};Ye.MaskedDynamic=Zc;class kP extends mo{constructor(h){super(h)}updateOptions(h){super.updateOptions(h)}_update(h){const{enum:m,...v}=h;if(m){const w=m.map(L=>L.length),C=Math.min(...w),D=Math.max(...w)-C;v.mask="*".repeat(C),D&&(v.mask+="["+"*".repeat(D)+"]"),this.enum=m}super._update(v)}doValidate(h){return this.enum.some(m=>m.indexOf(this.unmaskedValue)===0)&&super.doValidate(h)}}Ye.MaskedEnum=kP;class DP extends fo{updateOptions(h){super.updateOptions(h)}_update(h){super._update({...h,validate:h.mask})}}Ye.MaskedFunction=DP;class ko extends fo{constructor(h){super({...ko.DEFAULTS,...h})}updateOptions(h){super.updateOptions(h)}_update(h){super._update(h),this._updateRegExps()}_updateRegExps(){const h="^"+(this.allowNegative?"[+|\\-]?":""),m="\\d*",v=(this.scale?"("+Yg(this.radix)+"\\d{0,"+this.scale+"})?":"")+"$";this._numberRegExp=new RegExp(h+m+v),this._mapToRadixRegExp=new RegExp("["+this.mapToRadix.map(Yg).join("")+"]","g"),this._thousandsSeparatorRegExp=new RegExp(Yg(this.thousandsSeparator),"g")}_removeThousandsSeparators(h){return h.replace(this._thousandsSeparatorRegExp,"")}_insertThousandsSeparators(h){const m=h.split(this.radix);return m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandsSeparator),m.join(this.radix)}doPrepareChar(h,m){m===void 0&&(m={});const[v,w]=super.doPrepareChar(this._removeThousandsSeparators(this.scale&&this.mapToRadix.length&&(m.input&&m.raw||!m.input&&!m.raw)?h.replace(this._mapToRadixRegExp,this.radix):h),m);return h&&!v&&(w.skip=!0),v&&!this.allowPositive&&!this.value&&v!=="-"&&w.aggregate(this._appendChar("-")),[v,w]}_separatorsCount(h,m){m===void 0&&(m=!1);let v=0;for(let w=0;w<h;++w)this._value.indexOf(this.thousandsSeparator,w)===w&&(++v,m&&(h+=this.thousandsSeparator.length));return v}_separatorsCountFromSlice(h){return h===void 0&&(h=this._value),this._separatorsCount(this._removeThousandsSeparators(h).length,!0)}extractInput(h,m,v){return h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),[h,m]=this._adjustRangeWithSeparators(h,m),this._removeThousandsSeparators(super.extractInput(h,m,v))}_appendCharRaw(h,m){if(m===void 0&&(m={}),!this.thousandsSeparator)return super._appendCharRaw(h,m);const v=m.tail&&m._beforeTailState?m._beforeTailState._value:this._value,w=this._separatorsCountFromSlice(v);this._value=this._removeThousandsSeparators(this.value);const C=super._appendCharRaw(h,m);this._value=this._insertThousandsSeparators(this._value);const D=m.tail&&m._beforeTailState?m._beforeTailState._value:this._value,L=this._separatorsCountFromSlice(D);return C.tailShift+=(L-w)*this.thousandsSeparator.length,C.skip=!C.rawInserted&&h===this.thousandsSeparator,C}_findSeparatorAround(h){if(this.thousandsSeparator){const m=h-this.thousandsSeparator.length+1,v=this.value.indexOf(this.thousandsSeparator,m);if(v<=h)return v}return-1}_adjustRangeWithSeparators(h,m){const v=this._findSeparatorAround(h);v>=0&&(h=v);const w=this._findSeparatorAround(m);return w>=0&&(m=w+this.thousandsSeparator.length),[h,m]}remove(h,m){h===void 0&&(h=0),m===void 0&&(m=this.displayValue.length),[h,m]=this._adjustRangeWithSeparators(h,m);const v=this.value.slice(0,h),w=this.value.slice(m),C=this._separatorsCount(v.length);this._value=this._insertThousandsSeparators(this._removeThousandsSeparators(v+w));const D=this._separatorsCountFromSlice(v);return new Ri({tailShift:(D-C)*this.thousandsSeparator.length})}nearestInputPos(h,m){if(!this.thousandsSeparator)return h;switch(m){case Me.NONE:case Me.LEFT:case Me.FORCE_LEFT:{const v=this._findSeparatorAround(h-1);if(v>=0){const w=v+this.thousandsSeparator.length;if(h<w||this.value.length<=w||m===Me.FORCE_LEFT)return v}break}case Me.RIGHT:case Me.FORCE_RIGHT:{const v=this._findSeparatorAround(h);if(v>=0)return v+this.thousandsSeparator.length}}return h}doValidate(h){let m=!!this._removeThousandsSeparators(this.value).match(this._numberRegExp);if(m){const v=this.number;m=m&&!isNaN(v)&&(this.min==null||this.min>=0||this.min<=this.number)&&(this.max==null||this.max<=0||this.number<=this.max)}return m&&super.doValidate(h)}doCommit(){if(this.value){const h=this.number;let m=h;this.min!=null&&(m=Math.max(m,this.min)),this.max!=null&&(m=Math.min(m,this.max)),m!==h&&(this.unmaskedValue=this.format(m,this));let v=this.value;this.normalizeZeros&&(v=this._normalizeZeros(v)),this.padFractionalZeros&&this.scale>0&&(v=this._padFractionalZeros(v)),this._value=v}super.doCommit()}_normalizeZeros(h){const m=this._removeThousandsSeparators(h).split(this.radix);return m[0]=m[0].replace(/^(\D*)(0*)(\d*)/,(v,w,C,D)=>w+D),h.length&&!/\d$/.test(m[0])&&(m[0]=m[0]+"0"),m.length>1&&(m[1]=m[1].replace(/0*$/,""),m[1].length||(m.length=1)),this._insertThousandsSeparators(m.join(this.radix))}_padFractionalZeros(h){if(!h)return h;const m=h.split(this.radix);return m.length<2&&m.push(""),m[1]=m[1].padEnd(this.scale,"0"),m.join(this.radix)}doSkipInvalid(h,m,v){m===void 0&&(m={});const w=this.scale===0&&h!==this.thousandsSeparator&&(h===this.radix||h===ko.UNMASKED_RADIX||this.mapToRadix.includes(h));return super.doSkipInvalid(h,m,v)&&!w}get unmaskedValue(){return this._removeThousandsSeparators(this._normalizeZeros(this.value)).replace(this.radix,ko.UNMASKED_RADIX)}set unmaskedValue(h){super.unmaskedValue=h}get typedValue(){return this.parse(this.unmaskedValue,this)}set typedValue(h){this.rawInputValue=this.format(h,this).replace(ko.UNMASKED_RADIX,this.radix)}get number(){return this.typedValue}set number(h){this.typedValue=h}get allowNegative(){return this.min!=null&&this.min<0||this.max!=null&&this.max<0}get allowPositive(){return this.min!=null&&this.min>0||this.max!=null&&this.max>0}typedValueEquals(h){return(super.typedValueEquals(h)||ko.EMPTY_VALUES.includes(h)&&ko.EMPTY_VALUES.includes(this.typedValue))&&!(h===0&&this.value==="")}}ko.UNMASKED_RADIX=".";ko.EMPTY_VALUES=[...fo.EMPTY_VALUES,0];ko.DEFAULTS={mask:Number,radix:",",thousandsSeparator:"",mapToRadix:[ko.UNMASKED_RADIX],min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,scale:2,normalizeZeros:!0,padFractionalZeros:!1,parse:Number,format:d=>d.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:20})};Ye.MaskedNumber=ko;const v_={MASKED:"value",UNMASKED:"unmaskedValue",TYPED:"typedValue"};function EE(d,h,m){h===void 0&&(h=v_.MASKED),m===void 0&&(m=v_.MASKED);const v=sa(d);return w=>v.runIsolated(C=>(C[h]=w,C[m]))}function zP(d,h,m,v){return EE(h,m,v)(d)}Ye.PIPE_TYPE=v_;Ye.createPipe=EE;Ye.pipe=zP;try{globalThis.IMask=Ye}catch{}const PP=["src","alt"],RP=go({__name:"Image",props:{src:{},preview:{},alt:{},caption:{},captionVisibility:{default:"hover"},captionTheme:{default:"dark"},size:{default:"cover"},position:{default:"center"},width:{},height:{},aspectRatio:{}},emits:["loaded","error"],setup(d,{emit:h}){const m=d,v=kr(),w=kr(!1),C=kr(!1),D=kr(),L=gr(()=>({"--k-image-size":m.size,"--k-image-preview":m.preview||"","--k-image-position":m.position,"--k-image-width":m.width||"initial","--k-image-height":m.height||"initial","--k-image-aspectratio":(m.aspectRatio==="natural"?D.value:m.aspectRatio)||"initial"}));function k(){w.value=!0;const{naturalWidth:G=0,naturalHeight:X=0}=v.value||{};D.value=`${G}/${X}`,h("loaded")}function J(){w.value=!0,C.value=!0,h("error")}return Gc(()=>{var G;return((G=v.value)==null?void 0:G.complete)&&k()}),(G,X)=>(wi(),Er("figure",{class:Id(["k-image",[`k-image--size-${G.size}`,{"k-image--loaded":w.value,"k-image--loading":!w.value}]]),style:qc(L.value)},[w.value?Tr("",!0):(wi(),ro(cE,{key:0,size:"small"})),UT(ys("img",{src:G.src,alt:G.alt||G.caption,onLoad:k,onError:J,ref_key:"image",ref:v},null,40,PP),[[GT,!C.value]]),G.$slots.caption||G.caption?(wi(),Er("figcaption",{key:1,class:Id(`k-image__caption k-image__caption--visibility-${G.captionVisibility} k-image__caption--theme-${!w.value||C.value?"light":G.captionTheme}`)},[_r(G.$slots,"caption",{},()=>[I_(Ln(G.caption),1)])],2)):Tr("",!0)],6))}}),LP={key:1,class:"k-card__content"},OP={key:0,class:"k-card__title"},BP={key:2,class:"k-card__footer"},FP=go({inheritAttrs:!1,__name:"Card",props:{is:{default:"div"},title:{},variant:{default:"border"},thumbnail:{},thumbnailSize:{default:"cover"},headerMinHeight:{}},setup(d){return(h,m)=>(wi(),ro(Wd(h.is),Dn({class:`k-card k-card--variant-${h.variant}`,style:`--k-header-min-height: ${h.headerMinHeight||""}`},h.$attrs),{default:$o(()=>[h.$slots.header||h.thumbnail?(wi(),Er("div",{key:0,class:Id(["k-card__header",[{"k-card__header--has-thumbnail":!h.$slots.header&&h.thumbnail},`k-card__header--thumbnail-size-${h.thumbnailSize}`]])},[_r(h.$slots,"header",{},()=>[h.thumbnail?(wi(),ro(RP,{key:0,class:"k-card__thumbnail",src:h.thumbnail,size:h.thumbnailSize},null,8,["src","size"])):Tr("",!0)])],2)):Tr("",!0),h.$slots.default||h.title?(wi(),Er("div",LP,[h.title?(wi(),Er("div",OP,Ln(h.title),1)):Tr("",!0),_r(h.$slots,"default")])):Tr("",!0),h.$slots.footer?(wi(),Er("div",BP,[_r(h.$slots,"footer")])):Tr("",!0)]),_:3},16,["class","style"]))}});var b_=(d,h,m,v)=>{const w=typeof d=="function"?d():d;return w?.addEventListener(h,m,v),()=>{w?.removeEventListener(h,m,v)}},NP=d=>d.button===2||VP()&&d.ctrlKey&&d.button===0,VP=()=>/Mac|iPod|iPhone|iPad/.test(window.navigator.platform);function xT(d,h,m){if(!d)return;const v=d.ownerDocument.defaultView||window,w=new v.CustomEvent(h,m);return d.dispatchEvent(w)}function vT(d){return Math.max(0,Math.min(1,d))}function SE(d,h){const{left:m,top:v,width:w,height:C}=h.getBoundingClientRect(),D={x:d.x-m,y:d.y-v},L={x:vT(D.x/w),y:vT(D.y/C)};function k(J={}){const{dir:G="ltr",orientation:X="horizontal",inverted:et}=J,ct=typeof et=="object"?et.x:et,gt=typeof et=="object"?et.y:et;return X==="horizontal"?G==="rtl"||ct?1-L.x:L.x:gt?1-L.y:L.y}return{offset:D,percent:L,getPercentValue:k}}function jP(d,h,m){return Math.round((d-h)/m)*m+h}function UP(d,h,m){return Math.min(Math.max(d,h),m)}function GP(d,h,m){return(d-h)/(m-h)}function ME(d,h,m,v){const w=d*(m-h)+h,C=jP(w,h,v);return UP(C,h,m)}function w_(d,h){const m={min:d[0],max:d[1]},v={min:h[0],max:h[1]};return function(w){if(m.min===m.max||v.min===v.max)return v.min;const C=(v.max-v.min)/(m.max-m.min);return v.min+C*(w-m.min)}}var qP=vs("slider").parts("root","label","thumb","output","track","range","control","markerGroup","marker");qP.build();function $P(d){const{height:h=0}=d.thumbSize??{},m=w_([d.min,d.max],[-h/2,h/2]);return parseFloat(m(d.value).toFixed(2))}function ZP(d){const{width:h=0}=d.thumbSize??{};if(d.isRtl){const v=w_([d.max,d.min],[-h/2,h/2]);return-1*parseFloat(v(d.value).toFixed(2))}const m=w_([d.min,d.max],[-h/2,h/2]);return parseFloat(m(d.value).toFixed(2))}function HP(d,h){if(d.thumbAlignment==="center")return`${h}%`;const m=d.isVertical?$P(d):ZP(d);return`calc(${h}% - ${m}px)`}function N_(d){let h=GP(d.value,d.min,d.max)*100;return HP(d,h)}function AE(d){let h="visible";return d.thumbAlignment==="contain"&&!d.hasMeasuredThumbSize&&(h="hidden"),h}function WP(d){const h=d.isVertical?"bottom":"insetInlineStart";return{visibility:AE(d),position:"absolute",transform:"var(--slider-thumb-transform)",[h]:"var(--slider-thumb-offset)"}}function XP(d){let h="0%",m=`${100-d.valuePercent}%`;if(d.origin==="center"){const v=d.valuePercent<50;h=v?`${d.valuePercent}%`:"50%",m=v?"50%":m}return{start:h,end:m}}function YP(d){return d.isVertical?{position:"absolute",bottom:"var(--slider-range-start)",top:"var(--slider-range-end)"}:{position:"absolute",[d.isRtl?"right":"left"]:"var(--slider-range-start)",[d.isRtl?"left":"right"]:"var(--slider-range-end)"}}function JP(){return{touchAction:"none",userSelect:"none",position:"relative"}}function KP(d){const h=XP(d);return{"--slider-thumb-transform":d.isVertical?"translateY(50%)":d.isRtl?"translateX(50%)":"translateX(-50%)","--slider-thumb-offset":N_(d),"--slider-range-start":h.start,"--slider-range-end":h.end}}function QP(d,h){return{visibility:AE(d),position:"absolute",pointerEvents:"none",[d.isHorizontal?"insetInlineStart":"bottom"]:N_({...d,value:h}),translate:"var(--tx) var(--ty)","--tx":d.isHorizontal?d.isRtl?"50%":"-50%":"0%","--ty":d.isHorizontal?"0%":"50%"}}function tR(){return{userSelect:"none"}}function eR(){return{position:"relative"}}function iR(){return{userSelect:"none",pointerEvents:"none",position:"relative"}}var rR={getThumbOffset:N_,getControlStyle:JP,getThumbStyle:WP,getRangeStyle:YP,getRootStyle:KP,getMarkerStyle:QP,getLabelStyle:tR,getTrackStyle:eR,getMarkerGroupStyle:iR},Fr=$c({...rR,getRootId:d=>{var h;return((h=d.ids)==null?void 0:h.root)??`slider:${d.id}`},getThumbId:d=>{var h;return((h=d.ids)==null?void 0:h.thumb)??`slider:${d.id}:thumb`},getControlId:d=>{var h;return((h=d.ids)==null?void 0:h.control)??`slider:${d.id}:control`},getHiddenInputId:d=>{var h;return((h=d.ids)==null?void 0:h.hiddenInput)??`slider:${d.id}:input`},getOutputId:d=>{var h;return((h=d.ids)==null?void 0:h.output)??`slider:${d.id}:output`},getTrackId:d=>{var h;return((h=d.ids)==null?void 0:h.track)??`slider:${d.id}track`},getRangeId:d=>{var h;return((h=d.ids)==null?void 0:h.track)??`slider:${d.id}:range`},getLabelId:d=>{var h;return((h=d.ids)==null?void 0:h.label)??`slider:${d.id}:label`},getMarkerId:(d,h)=>`slider:${d.id}:marker:${h}`,getRootEl:d=>Fr.getById(d,Fr.getRootId(d)),getThumbEl:d=>Fr.getById(d,Fr.getThumbId(d)),getControlEl:d=>Fr.getById(d,Fr.getControlId(d)),getHiddenInputEl:d=>Fr.getById(d,Fr.getHiddenInputId(d)),getValueFromPoint(d,h){const m=Fr.getControlEl(d);if(!m)return;const v=SE(h,m).getPercentValue({orientation:d.orientation,dir:d.dir,inverted:{y:!0}});return ME(v,d.min,d.max,d.step)},dispatchChangeEvent(d){const h=Fr.getHiddenInputEl(d);h&&yE(h,{value:d.value})}}),oR=vs("range-slider").parts("root","label","thumb","output","track","range","control","markerGroup","marker");oR.build();function nR(d){const h=d[0],m=d[d.length-1];return[h,m]}function sR(d){const[h,m]=nR(d.valuePercent);return{start:`${h}%`,end:`${100-m}%`}}function aR(d){let h="visible";return d.thumbAlignment==="contain"&&!d.hasMeasuredThumbSize&&(h="hidden"),h}function lR(d,h){const m=d.isVertical?"bottom":"insetInlineStart";return{visibility:aR(d),position:"absolute",transform:"var(--slider-thumb-transform)",[m]:`var(--slider-thumb-offset-${h})`}}function cR(d){const h=sR(d);return{...d.value.reduce((m,v,w)=>{const C=Fr.getThumbOffset({...d,value:v});return{...m,[`--slider-thumb-offset-${w}`]:C}},{}),"--slider-thumb-transform":d.isVertical?"translateY(50%)":d.isRtl?"translateX(50%)":"translateX(-50%)","--slider-range-start":h.start,"--slider-range-end":h.end}}var uR={getRootStyle:cR,getControlStyle:Fr.getControlStyle,getThumbStyle:lR,getRangeStyle:Fr.getRangeStyle,getMarkerStyle:Fr.getMarkerStyle,getMarkerGroupStyle:Fr.getMarkerGroupStyle},eo=$c({...uR,getRootId:d=>{var h;return((h=d.ids)==null?void 0:h.root)??`slider:${d.id}`},getThumbId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.thumb)==null?void 0:v.call(m,h))??`slider:${d.id}:thumb:${h}`},getHiddenInputId:(d,h)=>`slider:${d.id}:input:${h}`,getControlId:d=>{var h;return((h=d.ids)==null?void 0:h.control)??`slider:${d.id}:control`},getTrackId:d=>{var h;return((h=d.ids)==null?void 0:h.track)??`slider:${d.id}:track`},getRangeId:d=>{var h;return((h=d.ids)==null?void 0:h.range)??`slider:${d.id}:range`},getLabelId:d=>{var h;return((h=d.ids)==null?void 0:h.label)??`slider:${d.id}:label`},getOutputId:d=>{var h;return((h=d.ids)==null?void 0:h.output)??`slider:${d.id}:output`},getMarkerId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.marker)==null?void 0:v.call(m,h))??`slider:${d.id}:marker:${h}`},getRootEl:d=>eo.getById(d,eo.getRootId(d)),getThumbEl:(d,h)=>eo.getById(d,eo.getThumbId(d,h)),getHiddenInputEl:(d,h)=>eo.getById(d,eo.getHiddenInputId(d,h)),getControlEl:d=>eo.getById(d,eo.getControlId(d)),getElements:d=>dE(eo.getControlEl(d),"[role=slider]"),getFirstEl:d=>eo.getElements(d)[0],getRangeEl:d=>eo.getById(d,eo.getRangeId(d)),getValueFromPoint(d,h){const m=eo.getControlEl(d);if(!m)return;const v=SE(h,m).getPercentValue({orientation:d.orientation,dir:d.dir,inverted:{y:!0}});return ME(v,d.min,d.max,d.step)},dispatchChangeEvent(d){Array.from(d.value).forEach((h,m)=>{const v=eo.getHiddenInputEl(d,m);v&&yE(v,{value:h})})}}),hR=vs("radio-group").parts("root","label","radio","radioLabel","radioControl","indicator");hR.build();var Cr=$c({getRootId:d=>{var h;return((h=d.ids)==null?void 0:h.root)??`radio-group:${d.id}`},getLabelId:d=>{var h;return((h=d.ids)==null?void 0:h.label)??`radio-group:${d.id}:label`},getRadioId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.radio)==null?void 0:v.call(m,h))??`radio-group:${d.id}:radio:${h}`},getRadioHiddenInputId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.radioHiddenInput)==null?void 0:v.call(m,h))??`radio-group:${d.id}:radio:input:${h}`},getRadioControlId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.radioControl)==null?void 0:v.call(m,h))??`radio-group:${d.id}:radio:control:${h}`},getRadioLabelId:(d,h)=>{var m,v;return((v=(m=d.ids)==null?void 0:m.radioLabel)==null?void 0:v.call(m,h))??`radio-group:${d.id}:radio:label:${h}`},getIndicatorId:d=>{var h;return((h=d.ids)==null?void 0:h.indicator)??`radio-group:${d.id}:indicator`},getRootEl:d=>Cr.getById(d,Cr.getRootId(d)),getRadioHiddenInputEl:(d,h)=>Cr.getById(d,Cr.getRadioHiddenInputId(d,h)),getIndicatorEl:d=>Cr.getById(d,Cr.getIndicatorId(d)),getFirstEnabledInputEl:d=>{var h;return(h=Cr.getRootEl(d))==null?void 0:h.querySelector("input:not(:disabled)")},getFirstEnabledAndCheckedInputEl:d=>{var h;return(h=Cr.getRootEl(d))==null?void 0:h.querySelector("input:not(:disabled):checked")},getInputEls:d=>{const h=`input[type=radio][data-ownedby='${CSS.escape(Cr.getRootId(d))}']:not([disabled])`;return dE(Cr.getRootEl(d),h)},getActiveRadioEl:d=>{if(d.value)return Cr.getById(d,Cr.getRadioId(d,d.value))},getOffsetRect:d=>({left:d?.offsetLeft??0,top:d?.offsetTop??0,width:d?.offsetWidth??0,height:d?.offsetHeight??0}),getRectById:(d,h)=>{const m=Cr.getById(d,Cr.getRadioId(d,h));if(m)return Cr.resolveRect(Cr.getOffsetRect(m))},resolveRect:d=>({width:`${d.width}px`,height:`${d.height}px`,left:`${d.left}px`,top:`${d.top}px`})});const dR=go({__name:"Flex",props:{is:{type:[Object,Function],default:"div"},gap:{default:"default"},justify:{},align:{},direction:{default:"row"},nowrap:{type:Boolean}},setup(d){const h=d,m=gr(()=>zz("flex",{justify:aT(h.justify)||"initial",align:aT(h.align)||"initial",wrap:h.nowrap?"nowrap":"wrap",gap:kz(h.gap),direction:h.direction}));return(v,w)=>(wi(),ro(Wd(v.is),{class:"k-flex",style:qc(m.value)},{default:$o(()=>[_r(v.$slots,"default")]),_:3},8,["style"]))}});var Ec=new WeakMap,Co=[];function pR(d,h={}){const{rootEl:m}=h,v=d.filter(Boolean);if(v.length===0)return;const w=v[0].ownerDocument||document,C=w.defaultView??window,D=new Set(v),L=new Set,k=m??w.body;let J=ct=>{for(let Jt of ct.querySelectorAll("[data-live-announcer], [data-zag-top-layer]"))D.add(Jt);let gt=Jt=>{if(D.has(Jt)||L.has(Jt.parentElement)&&Jt.parentElement.getAttribute("role")!=="row")return NodeFilter.FILTER_REJECT;for(let qe of D)if(Jt.contains(qe))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},dt=w.createTreeWalker(ct,NodeFilter.SHOW_ELEMENT,{acceptNode:gt}),At=gt(ct);if(At===NodeFilter.FILTER_ACCEPT&&G(ct),At!==NodeFilter.FILTER_REJECT){let Jt=dt.nextNode();for(;Jt!=null;)G(Jt),Jt=dt.nextNode()}},G=ct=>{let gt=Ec.get(ct)??0;ct.getAttribute("aria-hidden")==="true"&&gt===0||(gt===0&&ct.setAttribute("aria-hidden","true"),L.add(ct),Ec.set(ct,gt+1))};Co.length&&Co[Co.length-1].disconnect(),J(k);const X=new C.MutationObserver(ct=>{for(let gt of ct)if(!(gt.type!=="childList"||gt.addedNodes.length===0)&&![...D,...L].some(dt=>dt.contains(gt.target))){for(let dt of gt.removedNodes)dt instanceof C.Element&&(D.delete(dt),L.delete(dt));for(let dt of gt.addedNodes)(dt instanceof C.HTMLElement||dt instanceof C.SVGElement)&&(dt.dataset.liveAnnouncer==="true"||dt.dataset.zagTopLayer==="true")?D.add(dt):dt instanceof C.Element&&J(dt)}});X.observe(k,{childList:!0,subtree:!0});let et={observe(){X.observe(k,{childList:!0,subtree:!0})},disconnect(){X.disconnect()}};return Co.push(et),()=>{X.disconnect();for(let ct of L){let gt=Ec.get(ct);gt===1?(ct.removeAttribute("aria-hidden"),Ec.delete(ct)):Ec.set(ct,gt-1)}et===Co[Co.length-1]?(Co.pop(),Co.length&&Co[Co.length-1].observe()):Co.splice(Co.indexOf(et),1)}}function fR(d,h={}){const{defer:m}=h,v=m?Uc:C=>C(),w=[];return w.push(v(()=>{const C=typeof d=="function"?d():d;w.push(pR(C,h))})),()=>{w.forEach(C=>C?.())}}var mR=d=>typeof d=="object"&&d!==null&&d.nodeType===1;function gR(d){return mR(d)?d.offsetWidth>0||d.offsetHeight>0||d.getClientRects().length>0:!1}var _R="input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], button:not([disabled]), [tabindex], iframe, object, embed, area[href], audio[controls], video[controls], [contenteditable]:not([contenteditable='false']), details > summary:first-of-type";function CE(d){return!d||d.closest("[inert]")?!1:d.matches(_R)&&gR(d)}function yR(d){const h={each(m){var v;for(let w=0;w<((v=d.frames)==null?void 0:v.length);w+=1){const C=d.frames[w];C&&m(C)}},addEventListener(m,v,w){return h.each(C=>{try{C.document.addEventListener(m,v,w)}catch(D){console.warn(D)}}),()=>{try{h.removeEventListener(m,v,w)}catch(C){console.warn(C)}}},removeEventListener(m,v,w){h.each(C=>{try{C.document.removeEventListener(m,v,w)}catch(D){console.warn(D)}})}};return h}var bT="pointerdown.outside",wT="focus.outside";function xR(d){const h=d.composedPath()??[d.target];for(const m of h)if(Dd(m)&&CE(m))return!0;return!1}var vR=d=>"clientY"in d;function bR(d,h){if(!vR(h)||!d)return!1;const m=d.getBoundingClientRect();return m.width===0||m.height===0?!1:m.top<=h.clientY&&h.clientY<=m.top+m.height&&m.left<=h.clientX&&h.clientX<=m.left+m.width}function wR(d,h){const{exclude:m,onFocusOutside:v,onPointerDownOutside:w,onInteractOutside:C}=h;if(!d)return;const D=O_(d),L=Vz(d),k=yR(L);function J(dt){const At=Pd(dt);return!Dd(At)||zd(d,At)||bR(d,dt)?!1:!(m!=null&&m(At))}let G;function X(dt){function At(){if(!(!d||!J(dt))){if(w||C){const Jt=gT(w,C);d.addEventListener(bT,Jt,{once:!0})}xT(d,bT,{bubbles:!1,cancelable:!0,detail:{originalEvent:dt,contextmenu:NP(dt),focusable:xR(dt)}})}}dt.pointerType==="touch"?(k.removeEventListener("click",At),D.removeEventListener("click",At),G=At,D.addEventListener("click",At,{once:!0}),k.addEventListener("click",At,{once:!0})):At()}const et=new Set,ct=setTimeout(()=>{et.add(k.addEventListener("pointerdown",X,!0)),et.add(b_(D,"pointerdown",X,!0))},0);function gt(dt){if(!(!d||!J(dt))){if(v||C){const At=gT(v,C);d.addEventListener(wT,At,{once:!0})}xT(d,wT,{bubbles:!1,cancelable:!0,detail:{originalEvent:dt,contextmenu:!1,focusable:CE(Pd(dt))}})}}return et.add(b_(D,"focusin",gt,!0)),et.add(k.addEventListener("focusin",gt,!0)),()=>{clearTimeout(ct),G&&(k.removeEventListener("click",G),D.removeEventListener("click",G)),et.forEach(dt=>dt())}}function TR(d,h){const{defer:m}=h,v=m?Uc:C=>C(),w=[];return w.push(v(()=>{const C=typeof d=="function"?d():d;w.push(wR(C,h))})),()=>{w.forEach(C=>C?.())}}function ER(d,h){const m=v=>{v.key==="Escape"&&h?.(v)};return b_(O_(d),"keydown",m)}var qo={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(d=>d.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(d){var h;const m=this.indexOf(d),v=this.topMostPointerBlockingLayer()?this.indexOf((h=this.topMostPointerBlockingLayer())==null?void 0:h.node):-1;return m<v},isTopMost(d){const h=this.layers[this.count()-1];return h?.node===d},getNestedLayers(d){return Array.from(this.layers).slice(this.indexOf(d)+1)},isInNestedLayer(d,h){return this.getNestedLayers(d).some(m=>zd(m.node,h))},isInBranch(d){return Array.from(this.branches).some(h=>zd(h,d))},add(d){this.layers.push(d)},addBranch(d){this.branches.push(d)},remove(d){const h=this.indexOf(d);h<0||(h<this.count()-1&&this.getNestedLayers(d).forEach(m=>m.dismiss()),this.layers.splice(h,1))},removeBranch(d){const h=this.branches.indexOf(d);h>=0&&this.branches.splice(h,1)},indexOf(d){return this.layers.findIndex(h=>h.node===d)},dismiss(d){var h;(h=this.layers[this.indexOf(d)])==null||h.dismiss()},clear(){this.remove(this.layers[0].node)}},TT;function ET(){qo.layers.forEach(({node:d})=>{d.style.pointerEvents=qo.isBelowPointerBlockingLayer(d)?"none":"auto"})}function SR(d){d.style.pointerEvents=""}var Jg="data-inert";function MR(d){const h=O_(d);return qo.hasPointerBlockingLayer()&&!h.body.hasAttribute(Jg)&&(TT=document.body.style.pointerEvents,h.body.style.pointerEvents="none",h.body.setAttribute(Jg,"")),()=>{qo.hasPointerBlockingLayer()||(h.body.style.pointerEvents=TT,h.body.removeAttribute(Jg),h.body.style.length===0&&h.body.removeAttribute("style"))}}function AR(d,h){if(!d){mP("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:m,pointerBlocking:v,exclude:w,debug:C}=h,D={dismiss:m,node:d,pointerBlocking:v};qo.add(D),ET();function L(et){var ct,gt;const dt=Pd(et.detail.originalEvent);qo.isBelowPointerBlockingLayer(d)||qo.isInBranch(dt)||((ct=h.onPointerDownOutside)==null||ct.call(h,et),(gt=h.onInteractOutside)==null||gt.call(h,et),!et.defaultPrevented&&(C&&console.log("onPointerDownOutside:",et.detail.originalEvent),m?.()))}function k(et){var ct,gt;const dt=Pd(et.detail.originalEvent);qo.isInBranch(dt)||((ct=h.onFocusOutside)==null||ct.call(h,et),(gt=h.onInteractOutside)==null||gt.call(h,et),!et.defaultPrevented&&(C&&console.log("onFocusOutside:",et.detail.originalEvent),m?.()))}function J(et){var ct;qo.isTopMost(d)&&((ct=h.onEscapeKeyDown)==null||ct.call(h,et),!et.defaultPrevented&&m&&(et.preventDefault(),m()))}function G(et){if(!d)return!1;const ct=typeof w=="function"?w():w;return(Array.isArray(ct)?ct:[ct]).some(gt=>zd(gt,et))||qo.isInNestedLayer(d,et)}const X=[v?MR(d):void 0,ER(d,J),TR(d,{exclude:G,onFocusOutside:k,onPointerDownOutside:L})];return()=>{qo.remove(d),ET(),SR(d),X.forEach(et=>et?.())}}function CR(d,h){const{defer:m}=h,v=m?Uc:C=>C(),w=[];return w.push(v(()=>{const C=typeof d=="function"?d():d;w.push(AR(C,h))})),()=>{w.forEach(C=>C?.())}}var Kg="data-zag-scroll-lock";function ST(d,h){if(!d)return;const m=d.style.cssText;return Object.assign(d.style,h),()=>{d.style.cssText=m}}function IR(d,h,m){if(!d)return;const v=d.style.getPropertyValue(h);return d.style.setProperty(h,m),()=>{v?d.style.setProperty(h,v):d.style.removeProperty(h)}}function kR(d){const h=d.getBoundingClientRect().left;return Math.round(h)+d.scrollLeft?"paddingLeft":"paddingRight"}function DR(d){const h=d??document,m=h.defaultView??window,{documentElement:v,body:w}=h;if(w.hasAttribute(Kg))return;w.setAttribute(Kg,"");const C=m.innerWidth-v.clientWidth,D=()=>IR(v,"--scrollbar-width",`${C}px`),L=kR(v),k=()=>ST(w,{overflow:"hidden",[L]:`${C}px`}),J=()=>{const{scrollX:X,scrollY:et,visualViewport:ct}=m,gt=ct?.offsetLeft??0,dt=ct?.offsetTop??0,At=ST(w,{position:"fixed",overflow:"hidden",top:`${-(et-Math.floor(dt))}px`,left:`${-(X-Math.floor(gt))}px`,right:"0",[L]:`${C}px`});return()=>{At?.(),m.scrollTo(X,et)}},G=[D(),$z()?J():k()];return()=>{G.forEach(X=>X?.()),w.removeAttribute(Kg)}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var IE=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Fd=IE.join(","),kE=typeof Element>"u",aa=kE?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Nd=!kE&&Element.prototype.getRootNode?function(d){var h;return d==null||(h=d.getRootNode)===null||h===void 0?void 0:h.call(d)}:function(d){return d?.ownerDocument},Vd=function d(h,m){var v;m===void 0&&(m=!0);var w=h==null||(v=h.getAttribute)===null||v===void 0?void 0:v.call(h,"inert"),C=w===""||w==="true",D=C||m&&h&&d(h.parentNode);return D},zR=function(d){var h,m=d==null||(h=d.getAttribute)===null||h===void 0?void 0:h.call(d,"contenteditable");return m===""||m==="true"},DE=function(d,h,m){if(Vd(d))return[];var v=Array.prototype.slice.apply(d.querySelectorAll(Fd));return h&&aa.call(d,Fd)&&v.unshift(d),v=v.filter(m),v},zE=function d(h,m,v){for(var w=[],C=Array.from(h);C.length;){var D=C.shift();if(!Vd(D,!1))if(D.tagName==="SLOT"){var L=D.assignedElements(),k=L.length?L:D.children,J=d(k,!0,v);v.flatten?w.push.apply(w,J):w.push({scopeParent:D,candidates:J})}else{var G=aa.call(D,Fd);G&&v.filter(D)&&(m||!h.includes(D))&&w.push(D);var X=D.shadowRoot||typeof v.getShadowRoot=="function"&&v.getShadowRoot(D),et=!Vd(X,!1)&&(!v.shadowRootFilter||v.shadowRootFilter(D));if(X&&et){var ct=d(X===!0?D.children:X.children,!0,v);v.flatten?w.push.apply(w,ct):w.push({scopeParent:D,candidates:ct})}else C.unshift.apply(C,D.children)}}return w},PE=function(d){return!isNaN(parseInt(d.getAttribute("tabindex"),10))},ea=function(d){if(!d)throw new Error("No node provided");return d.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(d.tagName)||zR(d))&&!PE(d)?0:d.tabIndex},PR=function(d,h){var m=ea(d);return m<0&&h&&!PE(d)?0:m},RR=function(d,h){return d.tabIndex===h.tabIndex?d.documentOrder-h.documentOrder:d.tabIndex-h.tabIndex},RE=function(d){return d.tagName==="INPUT"},LR=function(d){return RE(d)&&d.type==="hidden"},OR=function(d){var h=d.tagName==="DETAILS"&&Array.prototype.slice.apply(d.children).some(function(m){return m.tagName==="SUMMARY"});return h},BR=function(d,h){for(var m=0;m<d.length;m++)if(d[m].checked&&d[m].form===h)return d[m]},FR=function(d){if(!d.name)return!0;var h=d.form||Nd(d),m=function(C){return h.querySelectorAll('input[type="radio"][name="'+C+'"]')},v;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")v=m(window.CSS.escape(d.name));else try{v=m(d.name)}catch(C){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",C.message),!1}var w=BR(v,d.form);return!w||w===d},NR=function(d){return RE(d)&&d.type==="radio"},VR=function(d){return NR(d)&&!FR(d)},jR=function(d){var h,m=d&&Nd(d),v=(h=m)===null||h===void 0?void 0:h.host,w=!1;if(m&&m!==d){var C,D,L;for(w=!!((C=v)!==null&&C!==void 0&&(D=C.ownerDocument)!==null&&D!==void 0&&D.contains(v)||d!=null&&(L=d.ownerDocument)!==null&&L!==void 0&&L.contains(d));!w&&v;){var k,J,G;m=Nd(v),v=(k=m)===null||k===void 0?void 0:k.host,w=!!((J=v)!==null&&J!==void 0&&(G=J.ownerDocument)!==null&&G!==void 0&&G.contains(v))}}return w},MT=function(d){var h=d.getBoundingClientRect(),m=h.width,v=h.height;return m===0&&v===0},UR=function(d,h){var m=h.displayCheck,v=h.getShadowRoot;if(getComputedStyle(d).visibility==="hidden")return!0;var w=aa.call(d,"details>summary:first-of-type"),C=w?d.parentElement:d;if(aa.call(C,"details:not([open]) *"))return!0;if(!m||m==="full"||m==="legacy-full"){if(typeof v=="function"){for(var D=d;d;){var L=d.parentElement,k=Nd(d);if(L&&!L.shadowRoot&&v(L)===!0)return MT(d);d.assignedSlot?d=d.assignedSlot:!L&&k!==d.ownerDocument?d=k.host:d=L}d=D}if(jR(d))return!d.getClientRects().length;if(m!=="legacy-full")return!0}else if(m==="non-zero-area")return MT(d);return!1},GR=function(d){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(d.tagName))for(var h=d.parentElement;h;){if(h.tagName==="FIELDSET"&&h.disabled){for(var m=0;m<h.children.length;m++){var v=h.children.item(m);if(v.tagName==="LEGEND")return aa.call(h,"fieldset[disabled] *")?!0:!v.contains(d)}return!0}h=h.parentElement}return!1},jd=function(d,h){return!(h.disabled||Vd(h)||LR(h)||UR(h,d)||OR(h)||GR(h))},T_=function(d,h){return!(VR(h)||ea(h)<0||!jd(d,h))},qR=function(d){var h=parseInt(d.getAttribute("tabindex"),10);return!!(isNaN(h)||h>=0)},$R=function d(h){var m=[],v=[];return h.forEach(function(w,C){var D=!!w.scopeParent,L=D?w.scopeParent:w,k=PR(L,D),J=D?d(w.candidates):L;k===0?D?m.push.apply(m,J):m.push(L):v.push({documentOrder:C,tabIndex:k,item:w,isScope:D,content:J})}),v.sort(RR).reduce(function(w,C){return C.isScope?w.push.apply(w,C.content):w.push(C.content),w},[]).concat(m)},ZR=function(d,h){h=h||{};var m;return h.getShadowRoot?m=zE([d],h.includeContainer,{filter:T_.bind(null,h),flatten:!1,getShadowRoot:h.getShadowRoot,shadowRootFilter:qR}):m=DE(d,h.includeContainer,T_.bind(null,h)),$R(m)},HR=function(d,h){h=h||{};var m;return h.getShadowRoot?m=zE([d],h.includeContainer,{filter:jd.bind(null,h),flatten:!0,getShadowRoot:h.getShadowRoot}):m=DE(d,h.includeContainer,jd.bind(null,h)),m},sl=function(d,h){if(h=h||{},!d)throw new Error("No node provided");return aa.call(d,Fd)===!1?!1:T_(h,d)},WR=IE.concat("iframe").join(","),Qg=function(d,h){if(h=h||{},!d)throw new Error("No node provided");return aa.call(d,WR)===!1?!1:jd(h,d)};/*!
* focus-trap 7.5.2
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function AT(d,h){var m=Object.keys(d);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(d);h&&(v=v.filter(function(w){return Object.getOwnPropertyDescriptor(d,w).enumerable})),m.push.apply(m,v)}return m}function CT(d){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?AT(Object(m),!0).forEach(function(v){XR(d,v,m[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)):AT(Object(m)).forEach(function(v){Object.defineProperty(d,v,Object.getOwnPropertyDescriptor(m,v))})}return d}function XR(d,h,m){return h=JR(h),h in d?Object.defineProperty(d,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):d[h]=m,d}function YR(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var v=m.call(d,h||"default");if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(d)}function JR(d){var h=YR(d,"string");return typeof h=="symbol"?h:String(h)}var IT={activateTrap:function(d,h){if(d.length>0){var m=d[d.length-1];m!==h&&m.pause()}var v=d.indexOf(h);v===-1||d.splice(v,1),d.push(h)},deactivateTrap:function(d,h){var m=d.indexOf(h);m!==-1&&d.splice(m,1),d.length>0&&d[d.length-1].unpause()}},KR=function(d){return d.tagName&&d.tagName.toLowerCase()==="input"&&typeof d.select=="function"},QR=function(d){return d?.key==="Escape"||d?.key==="Esc"||d?.keyCode===27},Pc=function(d){return d?.key==="Tab"||d?.keyCode===9},tL=function(d){return Pc(d)&&!d.shiftKey},eL=function(d){return Pc(d)&&d.shiftKey},kT=function(d){return setTimeout(d,0)},DT=function(d,h){var m=-1;return d.every(function(v,w){return h(v)?(m=w,!1):!0}),m},Sc=function(d){for(var h=arguments.length,m=new Array(h>1?h-1:0),v=1;v<h;v++)m[v-1]=arguments[v];return typeof d=="function"?d.apply(void 0,m):d},md=function(d){return d.target.shadowRoot&&typeof d.composedPath=="function"?d.composedPath()[0]:d.target},iL=[],rL=function(d,h){var m=h?.document||document,v=h?.trapStack||iL,w=CT({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:tL,isKeyBackward:eL},h),C={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},D,L=function(B,st,Qt){return B&&B[st]!==void 0?B[st]:w[Qt||st]},k=function(B,st){var Qt=typeof st?.composedPath=="function"?st.composedPath():void 0;return C.containerGroups.findIndex(function(Le){var Ft=Le.container,Te=Le.tabbableNodes;return Ft.contains(B)||Qt?.includes(Ft)||Te.find(function(ai){return ai===B})})},J=function(B){var st=w[B];if(typeof st=="function"){for(var Qt=arguments.length,Le=new Array(Qt>1?Qt-1:0),Ft=1;Ft<Qt;Ft++)Le[Ft-1]=arguments[Ft];st=st.apply(void 0,Le)}if(st===!0&&(st=void 0),!st){if(st===void 0||st===!1)return st;throw new Error("`".concat(B,"` was specified but was not a node, or did not return a node"))}var Te=st;if(typeof st=="string"&&(Te=m.querySelector(st),!Te))throw new Error("`".concat(B,"` as selector refers to no known node"));return Te},G=function(){var B=J("initialFocus");if(B===!1)return!1;if(B===void 0||!Qg(B,w.tabbableOptions))if(k(m.activeElement)>=0)B=m.activeElement;else{var st=C.tabbableGroups[0],Qt=st&&st.firstTabbableNode;B=Qt||J("fallbackFocus")}if(!B)throw new Error("Your focus-trap needs to have at least one focusable element");return B},X=function(){if(C.containerGroups=C.containers.map(function(B){var st=ZR(B,w.tabbableOptions),Qt=HR(B,w.tabbableOptions),Le=st.length>0?st[0]:void 0,Ft=st.length>0?st[st.length-1]:void 0,Te=Qt.find(function(Ai){return sl(Ai)}),ai=Qt.slice().reverse().find(function(Ai){return sl(Ai)}),ri=!!st.find(function(Ai){return ea(Ai)>0});return{container:B,tabbableNodes:st,focusableNodes:Qt,posTabIndexesFound:ri,firstTabbableNode:Le,lastTabbableNode:Ft,firstDomTabbableNode:Te,lastDomTabbableNode:ai,nextTabbableNode:function(Ai){var Sr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Mr=st.indexOf(Ai);return Mr<0?Sr?Qt.slice(Qt.indexOf(Ai)+1).find(function(Gi){return sl(Gi)}):Qt.slice(0,Qt.indexOf(Ai)).reverse().find(function(Gi){return sl(Gi)}):st[Mr+(Sr?1:-1)]}}}),C.tabbableGroups=C.containerGroups.filter(function(B){return B.tabbableNodes.length>0}),C.tabbableGroups.length<=0&&!J("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(C.containerGroups.find(function(B){return B.posTabIndexesFound})&&C.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},et=function B(st){if(st!==!1&&st!==m.activeElement){if(!st||!st.focus){B(G());return}st.focus({preventScroll:!!w.preventScroll}),C.mostRecentlyFocusedNode=st,KR(st)&&st.select()}},ct=function(B){var st=J("setReturnFocus",B);return st||(st===!1?!1:B)},gt=function(B){var st=B.target,Qt=B.event,Le=B.isBackward,Ft=Le===void 0?!1:Le;st=st||md(Qt),X();var Te=null;if(C.tabbableGroups.length>0){var ai=k(st,Qt),ri=ai>=0?C.containerGroups[ai]:void 0;if(ai<0)Ft?Te=C.tabbableGroups[C.tabbableGroups.length-1].lastTabbableNode:Te=C.tabbableGroups[0].firstTabbableNode;else if(Ft){var Ai=DT(C.tabbableGroups,function(Nr){var Do=Nr.firstTabbableNode;return st===Do});if(Ai<0&&(ri.container===st||Qg(st,w.tabbableOptions)&&!sl(st,w.tabbableOptions)&&!ri.nextTabbableNode(st,!1))&&(Ai=ai),Ai>=0){var Sr=Ai===0?C.tabbableGroups.length-1:Ai-1,Mr=C.tabbableGroups[Sr];Te=ea(st)>=0?Mr.lastTabbableNode:Mr.lastDomTabbableNode}else Pc(Qt)||(Te=ri.nextTabbableNode(st,!1))}else{var Gi=DT(C.tabbableGroups,function(Nr){var Do=Nr.lastTabbableNode;return st===Do});if(Gi<0&&(ri.container===st||Qg(st,w.tabbableOptions)&&!sl(st,w.tabbableOptions)&&!ri.nextTabbableNode(st))&&(Gi=ai),Gi>=0){var Ut=Gi===C.tabbableGroups.length-1?0:Gi+1,oo=C.tabbableGroups[Ut];Te=ea(st)>=0?oo.firstTabbableNode:oo.firstDomTabbableNode}else Pc(Qt)||(Te=ri.nextTabbableNode(st))}}else Te=J("fallbackFocus");return Te},dt=function(B){var st=md(B);if(!(k(st,B)>=0)){if(Sc(w.clickOutsideDeactivates,B)){D.deactivate({returnFocus:w.returnFocusOnDeactivate});return}Sc(w.allowOutsideClick,B)||B.preventDefault()}},At=function(B){var st=md(B),Qt=k(st,B)>=0;if(Qt||st instanceof Document)Qt&&(C.mostRecentlyFocusedNode=st);else{B.stopImmediatePropagation();var Le,Ft=!0;if(C.mostRecentlyFocusedNode)if(ea(C.mostRecentlyFocusedNode)>0){var Te=k(C.mostRecentlyFocusedNode),ai=C.containerGroups[Te].tabbableNodes;if(ai.length>0){var ri=ai.findIndex(function(Ai){return Ai===C.mostRecentlyFocusedNode});ri>=0&&(w.isKeyForward(C.recentNavEvent)?ri+1<ai.length&&(Le=ai[ri+1],Ft=!1):ri-1>=0&&(Le=ai[ri-1],Ft=!1))}}else C.containerGroups.some(function(Ai){return Ai.tabbableNodes.some(function(Sr){return ea(Sr)>0})})||(Ft=!1);else Ft=!1;Ft&&(Le=gt({target:C.mostRecentlyFocusedNode,isBackward:w.isKeyBackward(C.recentNavEvent)})),et(Le||C.mostRecentlyFocusedNode||G())}C.recentNavEvent=void 0},Jt=function(B){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;C.recentNavEvent=B;var Qt=gt({event:B,isBackward:st});Qt&&(Pc(B)&&B.preventDefault(),et(Qt))},qe=function(B){if(QR(B)&&Sc(w.escapeDeactivates,B)!==!1){B.preventDefault(),D.deactivate();return}(w.isKeyForward(B)||w.isKeyBackward(B))&&Jt(B,w.isKeyBackward(B))},ke=function(B){var st=md(B);k(st,B)>=0||Sc(w.clickOutsideDeactivates,B)||Sc(w.allowOutsideClick,B)||(B.preventDefault(),B.stopImmediatePropagation())},Be=function(){if(C.active)return IT.activateTrap(v,D),C.delayInitialFocusTimer=w.delayInitialFocus?kT(function(){et(G())}):et(G()),m.addEventListener("focusin",At,!0),m.addEventListener("mousedown",dt,{capture:!0,passive:!1}),m.addEventListener("touchstart",dt,{capture:!0,passive:!1}),m.addEventListener("click",ke,{capture:!0,passive:!1}),m.addEventListener("keydown",qe,{capture:!0,passive:!1}),D},hi=function(){if(C.active)return m.removeEventListener("focusin",At,!0),m.removeEventListener("mousedown",dt,!0),m.removeEventListener("touchstart",dt,!0),m.removeEventListener("click",ke,!0),m.removeEventListener("keydown",qe,!0),D},ze=function(B){var st=B.some(function(Qt){var Le=Array.from(Qt.removedNodes);return Le.some(function(Ft){return Ft===C.mostRecentlyFocusedNode})});st&&et(G())},yi=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(ze):void 0,pe=function(){yi&&(yi.disconnect(),C.active&&!C.paused&&C.containers.map(function(B){yi.observe(B,{subtree:!0,childList:!0})}))};return D={get active(){return C.active},get paused(){return C.paused},activate:function(B){if(C.active)return this;var st=L(B,"onActivate"),Qt=L(B,"onPostActivate"),Le=L(B,"checkCanFocusTrap");Le||X(),C.active=!0,C.paused=!1,C.nodeFocusedBeforeActivation=m.activeElement,st?.();var Ft=function(){Le&&X(),Be(),pe(),Qt?.()};return Le?(Le(C.containers.concat()).then(Ft,Ft),this):(Ft(),this)},deactivate:function(B){if(!C.active)return this;var st=CT({onDeactivate:w.onDeactivate,onPostDeactivate:w.onPostDeactivate,checkCanReturnFocus:w.checkCanReturnFocus},B);clearTimeout(C.delayInitialFocusTimer),C.delayInitialFocusTimer=void 0,hi(),C.active=!1,C.paused=!1,pe(),IT.deactivateTrap(v,D);var Qt=L(st,"onDeactivate"),Le=L(st,"onPostDeactivate"),Ft=L(st,"checkCanReturnFocus"),Te=L(st,"returnFocus","returnFocusOnDeactivate");Qt?.();var ai=function(){kT(function(){Te&&et(ct(C.nodeFocusedBeforeActivation)),Le?.()})};return Te&&Ft?(Ft(ct(C.nodeFocusedBeforeActivation)).then(ai,ai),this):(ai(),this)},pause:function(B){if(C.paused||!C.active)return this;var st=L(B,"onPause"),Qt=L(B,"onPostPause");return C.paused=!0,st?.(),hi(),pe(),Qt?.(),this},unpause:function(B){if(!C.paused||!C.active)return this;var st=L(B,"onUnpause"),Qt=L(B,"onPostUnpause");return C.paused=!1,st?.(),X(),Be(),pe(),Qt?.(),this},updateContainerElements:function(B){var st=[].concat(B).filter(Boolean);return C.containers=st.map(function(Qt){return typeof Qt=="string"?m.querySelector(Qt):Qt}),C.active&&X(),pe(),this}},D.updateContainerElements(d),D},oL=vs("dialog").parts("trigger","backdrop","container","content","title","description","closeTrigger"),Ys=oL.build(),Ii=$c({getContainerId:d=>{var h;return((h=d.ids)==null?void 0:h.container)??`dialog:${d.id}:container`},getBackdropId:d=>{var h;return((h=d.ids)==null?void 0:h.backdrop)??`dialog:${d.id}:backdrop`},getContentId:d=>{var h;return((h=d.ids)==null?void 0:h.content)??`dialog:${d.id}:content`},getTriggerId:d=>{var h;return((h=d.ids)==null?void 0:h.trigger)??`dialog:${d.id}:trigger`},getTitleId:d=>{var h;return((h=d.ids)==null?void 0:h.title)??`dialog:${d.id}:title`},getDescriptionId:d=>{var h;return((h=d.ids)==null?void 0:h.description)??`dialog:${d.id}:description`},getCloseTriggerId:d=>{var h;return((h=d.ids)==null?void 0:h.closeTrigger)??`dialog:${d.id}:close`},getContentEl:d=>Ii.getById(d,Ii.getContentId(d)),getTriggerEl:d=>Ii.getById(d,Ii.getTriggerId(d)),getContainerEl:d=>Ii.getById(d,Ii.getContainerId(d)),getTitleEl:d=>Ii.getById(d,Ii.getTitleId(d)),getDescriptionEl:d=>Ii.getById(d,Ii.getDescriptionId(d))});function nL(d,h,m){const v=d.context["aria-label"],w=d.matches("open"),C=d.context.renderedElements;return{isOpen:w,open(){h("OPEN")},close(){h("CLOSE")},triggerProps:m.button({...Ys.trigger.attrs,id:Ii.getTriggerId(d.context),"aria-haspopup":"dialog",type:"button","aria-expanded":w,"data-state":w?"open":"closed","aria-controls":Ii.getContentId(d.context),onClick(){h("TOGGLE")}}),backdropProps:m.element({...Ys.backdrop.attrs,hidden:!w,id:Ii.getBackdropId(d.context),"data-state":w?"open":"closed"}),containerProps:m.element({...Ys.container.attrs,hidden:!w,id:Ii.getContainerId(d.context),"data-state":w?"open":"closed",style:{pointerEvents:w?void 0:"none"}}),contentProps:m.element({...Ys.content.attrs,role:d.context.role,hidden:!w,id:Ii.getContentId(d.context),tabIndex:-1,"data-state":w?"open":"closed","aria-modal":!0,"aria-label":v||void 0,"aria-labelledby":v||!C.title?void 0:Ii.getTitleId(d.context),"aria-describedby":C.description?Ii.getDescriptionId(d.context):void 0}),titleProps:m.element({...Ys.title.attrs,id:Ii.getTitleId(d.context)}),descriptionProps:m.element({...Ys.description.attrs,id:Ii.getDescriptionId(d.context)}),closeTriggerProps:m.button({...Ys.closeTrigger.attrs,id:Ii.getCloseTriggerId(d.context),type:"button",onClick(D){D.stopPropagation(),h("CLOSE")}})}}function sL(d){const h=xE(d);return hP({id:"dialog",initial:h.open?"open":"closed",context:{role:"dialog",renderedElements:{title:!0,description:!0},modal:!0,trapFocus:!0,preventScroll:!0,closeOnOutsideClick:!0,closeOnEsc:!0,restoreFocus:!0,...h},watch:{open:["toggleVisibility"]},states:{open:{entry:["checkRenderedElements"],activities:["trackDismissableElement","trapFocus","preventScroll","hideContentBelow"],on:{CLOSE:{target:"closed",actions:["invokeOnClose","restoreFocus"]},TOGGLE:{target:"closed",actions:["invokeOnClose","restoreFocus"]}}},closed:{on:{OPEN:{target:"open",actions:["invokeOnOpen"]},TOGGLE:{target:"open",actions:["invokeOnOpen"]}}}}},{activities:{trackDismissableElement(m,v,{send:w}){return CR(()=>Ii.getContentEl(m),{defer:!0,pointerBlocking:m.modal,exclude:[Ii.getTriggerEl(m)],onDismiss(){w({type:"CLOSE",src:"interact-outside"})},onEscapeKeyDown(C){var D;m.closeOnEsc?w({type:"CLOSE",src:"escape-key"}):C.preventDefault(),(D=m.onEsc)==null||D.call(m)},onPointerDownOutside(C){var D;m.closeOnOutsideClick||C.preventDefault(),(D=m.onOutsideClick)==null||D.call(m)}})},preventScroll(m){if(m.preventScroll)return DR(Ii.getDoc(m))},trapFocus(m){if(!m.trapFocus)return;let v;return Zz(()=>{const w=Ii.getContentEl(m);if(w){v=rL(w,{document:Ii.getDoc(m),escapeDeactivates:!1,preventScroll:!0,returnFocusOnDeactivate:!1,fallbackFocus:w,allowOutsideClick:!0,initialFocus:mT(m.initialFocusEl)});try{v.activate()}catch{}}}),()=>v?.deactivate()},hideContentBelow(m){return m.modal?fR(()=>[Ii.getContainerEl(m)],{defer:!0}):void 0}},actions:{checkRenderedElements(m){Uc(()=>{m.renderedElements.title=!!Ii.getTitleEl(m),m.renderedElements.description=!!Ii.getDescriptionEl(m)})},invokeOnClose(m){var v;(v=m.onClose)==null||v.call(m)},invokeOnOpen(m){var v;(v=m.onOpen)==null||v.call(m)},toggleVisibility(m,v,{send:w}){w({type:m.open?"OPEN":"CLOSE",src:"controlled"})},restoreFocus(m){m.restoreFocus&&Uc(()=>{const v=mT(m.finalFocusEl)??Ii.getTriggerEl(m);v?.focus({preventScroll:!0})})}}})}const aL=["data-id"],lL=["data-id"],cL=["data-id"],uL={class:"k-dialog__card-header"},hL=go({__name:"Dialog",props:{title:{},description:{},closeOnOutsideClick:{type:Boolean,default:!0},role:{default:"dialog"},alignment:{default:"top"},triggerLabel:{},showCloseTrigger:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},dialogId:{}},emits:["open","close","clickoutside"],setup(d,{expose:h,emit:m}){const v=d,[w,C]=wP(sL({id:TP({prefix:"dialog"}),closeOnOutsideClick:v.closeOnOutsideClick,closeOnEsc:v.closeOnEsc,modal:!0,role:v.role,onClose(){v.closeOnEsc&&m("close")},onOpen(){m("open")},onOutsideClick(){m("clickoutside")}}),{context:gr(()=>v)}),D=gr(()=>nL(w.value,C,vP)),L=k=>v.dialogId?`${v.dialogId}-${k}`:"";return h({open:D.value.open,close:D.value.close}),(k,J)=>(wi(),Er("div",{class:"k-dialog","data-id":k.dialogId},[_r(k.$slots,"trigger",{triggerProps:D.value.triggerProps},()=>[k.triggerLabel?(wi(),ro(jc,Dn({key:0,class:"k-dialog__trigger",variant:"secondary"},D.value.triggerProps),{default:$o(()=>[I_(Ln(k.triggerLabel),1)]),_:1},16)):Tr("",!0)]),(wi(),ro(m5,{to:"body"},[D.value.isOpen?(wi(),Er(p5,{key:0},[ys("div",Dn({class:"k-dialog__backdrop"},D.value.backdropProps,{"data-id":L("backdrop")}),null,16,lL),ys("div",Dn({class:`k-dialog__container k-dialog--align-${k.alignment}`},D.value.containerProps,{"data-id":L("container")}),[ra(FP,Dn({class:"k-dialog__card",variant:"shadow"},D.value.contentProps,{"data-id":L("dialog")}),f5({default:$o(()=>[_r(k.$slots,"header",{titleProps:D.value.titleProps,descriptionProps:D.value.descriptionProps,closeTriggerProps:D.value.closeTriggerProps},()=>[ys("div",uL,[_r(k.$slots,"title",{titleProps:D.value.titleProps},()=>[ys("h2",Dn({class:"k-dialog__title"},D.value.titleProps),Ln(k.title),17)]),_r(k.$slots,"description",{descriptionProps:D.value.descriptionProps},()=>[k.description?(wi(),Er("span",Dn({key:0,class:"k-dialog__description"},D.value.descriptionProps),Ln(k.description),17)):Tr("",!0)]),k.showCloseTrigger?(wi(),ro(jc,Dn({key:0,class:"k-dialog__close-trigger",variant:"tertiary",icon:"fa-pro-light:times",size:"small"},D.value.closeTriggerProps),null,16)):Tr("",!0)])]),_r(k.$slots,"default",{descriptionProps:D.value.descriptionProps})]),_:2},[k.$slots.footer?{name:"footer",fn:$o(()=>[_r(k.$slots,"footer",{close:D.value.close})]),key:"0"}:void 0]),1040,["data-id"])],16,cL)],64)):Tr("",!0)]))],8,aL))}});G2({title:{},description:{},confirmLabel:{default:"Confirm"},cancelLabel:{default:"Cancel"},type:{default:"info"}},{open:{type:Boolean,default:!1}}),G2(["cancel","confirm"],["update:open"]);function Kd(){this._types=Object.create(null),this._extensions=Object.create(null);for(let d=0;d<arguments.length;d++)this.define(arguments[d]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Kd.prototype.define=function(d,h){for(let m in d){let v=d[m].map(function(w){return w.toLowerCase()});m=m.toLowerCase();for(let w=0;w<v.length;w++){const C=v[w];if(C[0]!=="*"){if(!h&&C in this._types)throw new Error('Attempt to change mapping for "'+C+'" extension from "'+this._types[C]+'" to "'+m+'". Pass `force=true` to allow this, otherwise remove "'+C+'" from the list of extensions for "'+m+'".');this._types[C]=m}}if(h||!this._extensions[m]){const w=v[0];this._extensions[m]=w[0]!=="*"?w:w.substr(1)}}};Kd.prototype.getType=function(d){d=String(d);let h=d.replace(/^.*[/\\]/,"").toLowerCase(),m=h.replace(/^.*\./,"").toLowerCase(),v=h.length<d.length;return(m.length<h.length-1||!v)&&this._types[m]||null};Kd.prototype.getExtension=function(d){return d=/^\s*([^;\s]*)/.test(d)&&RegExp.$1,d&&this._extensions[d.toLowerCase()]||null};var dL=Kd,pL={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let fL=dL;new fL(pL);const mL=go({__name:"CreateTrigger",props:{label:{}},setup(d){return(h,m)=>(wi(),ro(jc,{type:"button",class:"k-media-image-create-trigger",label:h.label,iconRight:"fa6-solid:image"},null,8,["label"]))}}),gL=go({__name:"Thumbnail",props:{value:{}},setup(d){const h=d,m=gr(()=>({backgroundImage:`url(${h.value.url})`}));return(v,w)=>(wi(),Er("div",{class:"k-media-image__thumbnail",style:qc(m.value),onClick:w[0]||(w[0]=C=>v.$emit("click"))},null,4))}}),_L=go({__name:"Preview",props:{value:{},size:{}},setup(d){const h=d,m=gr(()=>({padding:h.size==="cover"?"0":"1rem",backgroundSize:h.size,backgroundImage:`url(${h.value.url})`}));return(v,w)=>(wi(),Er("div",{class:"k-media-image-preview",style:qc(m.value)},null,4))}});jg(mL),jg(gL),jg(_L);/**!
 * Sortable 1.14.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function zT(d,h){var m=Object.keys(d);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(d);h&&(v=v.filter(function(w){return Object.getOwnPropertyDescriptor(d,w).enumerable})),m.push.apply(m,v)}return m}function un(d){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?zT(Object(m),!0).forEach(function(v){yL(d,v,m[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)):zT(Object(m)).forEach(function(v){Object.defineProperty(d,v,Object.getOwnPropertyDescriptor(m,v))})}return d}function Ed(d){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ed=function(h){return typeof h}:Ed=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},Ed(d)}function yL(d,h,m){return h in d?Object.defineProperty(d,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):d[h]=m,d}function Bn(){return Bn=Object.assign||function(d){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var v in m)Object.prototype.hasOwnProperty.call(m,v)&&(d[v]=m[v])}return d},Bn.apply(this,arguments)}function xL(d,h){if(d==null)return{};var m={},v=Object.keys(d),w,C;for(C=0;C<v.length;C++)w=v[C],!(h.indexOf(w)>=0)&&(m[w]=d[w]);return m}function vL(d,h){if(d==null)return{};var m=xL(d,h),v,w;if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(d);for(w=0;w<C.length;w++)v=C[w],!(h.indexOf(v)>=0)&&Object.prototype.propertyIsEnumerable.call(d,v)&&(m[v]=d[v])}return m}var bL="1.14.0";function On(d){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(d)}var Fn=On(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Hc=On(/Edge/i),PT=On(/firefox/i),Rc=On(/safari/i)&&!On(/chrome/i)&&!On(/android/i),LE=On(/iP(ad|od|hone)/i),wL=On(/chrome/i)&&On(/android/i),OE={capture:!1,passive:!1};function bi(d,h,m){d.addEventListener(h,m,!Fn&&OE)}function fi(d,h,m){d.removeEventListener(h,m,!Fn&&OE)}function Ud(d,h){if(h){if(h[0]===">"&&(h=h.substring(1)),d)try{if(d.matches)return d.matches(h);if(d.msMatchesSelector)return d.msMatchesSelector(h);if(d.webkitMatchesSelector)return d.webkitMatchesSelector(h)}catch{return!1}return!1}}function TL(d){return d.host&&d!==document&&d.host.nodeType?d.host:d.parentNode}function ln(d,h,m,v){if(d){m=m||document;do{if(h!=null&&(h[0]===">"?d.parentNode===m&&Ud(d,h):Ud(d,h))||v&&d===m)return d;if(d===m)break}while(d=TL(d))}return null}var RT=/\s+/g;function uo(d,h,m){if(d&&h)if(d.classList)d.classList[m?"add":"remove"](h);else{var v=(" "+d.className+" ").replace(RT," ").replace(" "+h+" "," ");d.className=(v+(m?" "+h:"")).replace(RT," ")}}function Oe(d,h,m){var v=d&&d.style;if(v){if(m===void 0)return document.defaultView&&document.defaultView.getComputedStyle?m=document.defaultView.getComputedStyle(d,""):d.currentStyle&&(m=d.currentStyle),h===void 0?m:m[h];!(h in v)&&h.indexOf("webkit")===-1&&(h="-webkit-"+h),v[h]=m+(typeof m=="string"?"":"px")}}function pl(d,h){var m="";if(typeof d=="string")m=d;else do{var v=Oe(d,"transform");v&&v!=="none"&&(m=v+" "+m)}while(!h&&(d=d.parentNode));var w=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return w&&new w(m)}function BE(d,h,m){if(d){var v=d.getElementsByTagName(h),w=0,C=v.length;if(m)for(;w<C;w++)m(v[w],w);return v}return[]}function cn(){var d=document.scrollingElement;return d||document.documentElement}function mr(d,h,m,v,w){if(!(!d.getBoundingClientRect&&d!==window)){var C,D,L,k,J,G,X;if(d!==window&&d.parentNode&&d!==cn()?(C=d.getBoundingClientRect(),D=C.top,L=C.left,k=C.bottom,J=C.right,G=C.height,X=C.width):(D=0,L=0,k=window.innerHeight,J=window.innerWidth,G=window.innerHeight,X=window.innerWidth),(h||m)&&d!==window&&(w=w||d.parentNode,!Fn))do if(w&&w.getBoundingClientRect&&(Oe(w,"transform")!=="none"||m&&Oe(w,"position")!=="static")){var et=w.getBoundingClientRect();D-=et.top+parseInt(Oe(w,"border-top-width")),L-=et.left+parseInt(Oe(w,"border-left-width")),k=D+C.height,J=L+C.width;break}while(w=w.parentNode);if(v&&d!==window){var ct=pl(w||d),gt=ct&&ct.a,dt=ct&&ct.d;ct&&(D/=dt,L/=gt,X/=gt,G/=dt,k=D+G,J=L+X)}return{top:D,left:L,bottom:k,right:J,width:X,height:G}}}function LT(d,h,m){for(var v=xs(d,!0),w=mr(d)[h];v;){var C=mr(v)[m],D=void 0;if(m==="top"||m==="left"?D=w>=C:D=w<=C,!D)return v;if(v===cn())break;v=xs(v,!1)}return!1}function ml(d,h,m,v){for(var w=0,C=0,D=d.children;C<D.length;){if(D[C].style.display!=="none"&&D[C]!==Ne.ghost&&(v||D[C]!==Ne.dragged)&&ln(D[C],m.draggable,d,!1)){if(w===h)return D[C];w++}C++}return null}function V_(d,h){for(var m=d.lastElementChild;m&&(m===Ne.ghost||Oe(m,"display")==="none"||h&&!Ud(m,h));)m=m.previousElementSibling;return m||null}function Io(d,h){var m=0;if(!d||!d.parentNode)return-1;for(;d=d.previousElementSibling;)d.nodeName.toUpperCase()!=="TEMPLATE"&&d!==Ne.clone&&(!h||Ud(d,h))&&m++;return m}function OT(d){var h=0,m=0,v=cn();if(d)do{var w=pl(d),C=w.a,D=w.d;h+=d.scrollLeft*C,m+=d.scrollTop*D}while(d!==v&&(d=d.parentNode));return[h,m]}function EL(d,h){for(var m in d)if(d.hasOwnProperty(m)){for(var v in h)if(h.hasOwnProperty(v)&&h[v]===d[m][v])return Number(m)}return-1}function xs(d,h){if(!d||!d.getBoundingClientRect)return cn();var m=d,v=!1;do if(m.clientWidth<m.scrollWidth||m.clientHeight<m.scrollHeight){var w=Oe(m);if(m.clientWidth<m.scrollWidth&&(w.overflowX=="auto"||w.overflowX=="scroll")||m.clientHeight<m.scrollHeight&&(w.overflowY=="auto"||w.overflowY=="scroll")){if(!m.getBoundingClientRect||m===document.body)return cn();if(v||h)return m;v=!0}}while(m=m.parentNode);return cn()}function SL(d,h){if(d&&h)for(var m in h)h.hasOwnProperty(m)&&(d[m]=h[m]);return d}function t_(d,h){return Math.round(d.top)===Math.round(h.top)&&Math.round(d.left)===Math.round(h.left)&&Math.round(d.height)===Math.round(h.height)&&Math.round(d.width)===Math.round(h.width)}var Lc;function FE(d,h){return function(){if(!Lc){var m=arguments,v=this;m.length===1?d.call(v,m[0]):d.apply(v,m),Lc=setTimeout(function(){Lc=void 0},h)}}}function ML(){clearTimeout(Lc),Lc=void 0}function NE(d,h,m){d.scrollLeft+=h,d.scrollTop+=m}function VE(d){var h=window.Polymer,m=window.jQuery||window.Zepto;return h&&h.dom?h.dom(d).cloneNode(!0):m?m(d).clone(!0)[0]:d.cloneNode(!0)}var po="Sortable"+new Date().getTime();function AL(){var d=[],h;return{captureAnimationState:function(){if(d=[],!!this.options.animation){var m=[].slice.call(this.el.children);m.forEach(function(v){if(!(Oe(v,"display")==="none"||v===Ne.ghost)){d.push({target:v,rect:mr(v)});var w=un({},d[d.length-1].rect);if(v.thisAnimationDuration){var C=pl(v,!0);C&&(w.top-=C.f,w.left-=C.e)}v.fromRect=w}})}},addAnimationState:function(m){d.push(m)},removeAnimationState:function(m){d.splice(EL(d,{target:m}),1)},animateAll:function(m){var v=this;if(!this.options.animation){clearTimeout(h),typeof m=="function"&&m();return}var w=!1,C=0;d.forEach(function(D){var L=0,k=D.target,J=k.fromRect,G=mr(k),X=k.prevFromRect,et=k.prevToRect,ct=D.rect,gt=pl(k,!0);gt&&(G.top-=gt.f,G.left-=gt.e),k.toRect=G,k.thisAnimationDuration&&t_(X,G)&&!t_(J,G)&&(ct.top-G.top)/(ct.left-G.left)===(J.top-G.top)/(J.left-G.left)&&(L=IL(ct,X,et,v.options)),t_(G,J)||(k.prevFromRect=J,k.prevToRect=G,L||(L=v.options.animation),v.animate(k,ct,G,L)),L&&(w=!0,C=Math.max(C,L),clearTimeout(k.animationResetTimer),k.animationResetTimer=setTimeout(function(){k.animationTime=0,k.prevFromRect=null,k.fromRect=null,k.prevToRect=null,k.thisAnimationDuration=null},L),k.thisAnimationDuration=L)}),clearTimeout(h),w?h=setTimeout(function(){typeof m=="function"&&m()},C):typeof m=="function"&&m(),d=[]},animate:function(m,v,w,C){if(C){Oe(m,"transition",""),Oe(m,"transform","");var D=pl(this.el),L=D&&D.a,k=D&&D.d,J=(v.left-w.left)/(L||1),G=(v.top-w.top)/(k||1);m.animatingX=!!J,m.animatingY=!!G,Oe(m,"transform","translate3d("+J+"px,"+G+"px,0)"),this.forRepaintDummy=CL(m),Oe(m,"transition","transform "+C+"ms"+(this.options.easing?" "+this.options.easing:"")),Oe(m,"transform","translate3d(0,0,0)"),typeof m.animated=="number"&&clearTimeout(m.animated),m.animated=setTimeout(function(){Oe(m,"transition",""),Oe(m,"transform",""),m.animated=!1,m.animatingX=!1,m.animatingY=!1},C)}}}}function CL(d){return d.offsetWidth}function IL(d,h,m,v){return Math.sqrt(Math.pow(h.top-d.top,2)+Math.pow(h.left-d.left,2))/Math.sqrt(Math.pow(h.top-m.top,2)+Math.pow(h.left-m.left,2))*v.animation}var al=[],e_={initializeByDefault:!0},Wc={mount:function(d){for(var h in e_)e_.hasOwnProperty(h)&&!(h in d)&&(d[h]=e_[h]);al.forEach(function(m){if(m.pluginName===d.pluginName)throw"Sortable: Cannot mount plugin ".concat(d.pluginName," more than once")}),al.push(d)},pluginEvent:function(d,h,m){var v=this;this.eventCanceled=!1,m.cancel=function(){v.eventCanceled=!0};var w=d+"Global";al.forEach(function(C){h[C.pluginName]&&(h[C.pluginName][w]&&h[C.pluginName][w](un({sortable:h},m)),h.options[C.pluginName]&&h[C.pluginName][d]&&h[C.pluginName][d](un({sortable:h},m)))})},initializePlugins:function(d,h,m,v){al.forEach(function(D){var L=D.pluginName;if(!(!d.options[L]&&!D.initializeByDefault)){var k=new D(d,h,d.options);k.sortable=d,k.options=d.options,d[L]=k,Bn(m,k.defaults)}});for(var w in d.options)if(d.options.hasOwnProperty(w)){var C=this.modifyOption(d,w,d.options[w]);typeof C<"u"&&(d.options[w]=C)}},getEventProperties:function(d,h){var m={};return al.forEach(function(v){typeof v.eventProperties=="function"&&Bn(m,v.eventProperties.call(h[v.pluginName],d))}),m},modifyOption:function(d,h,m){var v;return al.forEach(function(w){d[w.pluginName]&&w.optionListeners&&typeof w.optionListeners[h]=="function"&&(v=w.optionListeners[h].call(d[w.pluginName],m))}),v}};function kL(d){var h=d.sortable,m=d.rootEl,v=d.name,w=d.targetEl,C=d.cloneEl,D=d.toEl,L=d.fromEl,k=d.oldIndex,J=d.newIndex,G=d.oldDraggableIndex,X=d.newDraggableIndex,et=d.originalEvent,ct=d.putSortable,gt=d.extraEventProperties;if(h=h||m&&m[po],!!h){var dt,At=h.options,Jt="on"+v.charAt(0).toUpperCase()+v.substr(1);window.CustomEvent&&!Fn&&!Hc?dt=new CustomEvent(v,{bubbles:!0,cancelable:!0}):(dt=document.createEvent("Event"),dt.initEvent(v,!0,!0)),dt.to=D||m,dt.from=L||m,dt.item=w||m,dt.clone=C,dt.oldIndex=k,dt.newIndex=J,dt.oldDraggableIndex=G,dt.newDraggableIndex=X,dt.originalEvent=et,dt.pullMode=ct?ct.lastPutMode:void 0;var qe=un(un({},gt),Wc.getEventProperties(v,h));for(var ke in qe)dt[ke]=qe[ke];m&&m.dispatchEvent(dt),At[Jt]&&At[Jt].call(h,dt)}}var DL=["evt"],io=function(d,h){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=m.evt,w=vL(m,DL);Wc.pluginEvent.bind(Ne)(d,h,un({dragEl:Ht,parentEl:tr,ghostEl:We,rootEl:Wi,nextEl:Qs,lastDownEl:Sd,cloneEl:er,cloneHidden:_s,dragStarted:Ac,putSortable:wr,activeSortable:Ne.active,originalEvent:v,oldIndex:dl,oldDraggableIndex:Oc,newIndex:ho,newDraggableIndex:gs,hideGhostForTarget:qE,unhideGhostForTarget:$E,cloneNowHidden:function(){_s=!0},cloneNowShown:function(){_s=!1},dispatchSortableEvent:function(C){Br({sortable:h,name:C,originalEvent:v})}},w))};function Br(d){kL(un({putSortable:wr,cloneEl:er,targetEl:Ht,rootEl:Wi,oldIndex:dl,oldDraggableIndex:Oc,newIndex:ho,newDraggableIndex:gs},d))}var Ht,tr,We,Wi,Qs,Sd,er,_s,dl,ho,Oc,gs,gd,wr,cl=!1,Gd=!1,qd=[],Js,Go,i_,r_,BT,FT,Ac,ll,Bc,Fc=!1,_d=!1,Md,Ir,o_=[],E_=!1,$d=[],Qd=typeof document<"u",yd=LE,NT=Hc||Fn?"cssFloat":"float",zL=Qd&&!wL&&!LE&&"draggable"in document.createElement("div"),jE=function(){if(Qd){if(Fn)return!1;var d=document.createElement("x");return d.style.cssText="pointer-events:auto",d.style.pointerEvents==="auto"}}(),UE=function(d,h){var m=Oe(d),v=parseInt(m.width)-parseInt(m.paddingLeft)-parseInt(m.paddingRight)-parseInt(m.borderLeftWidth)-parseInt(m.borderRightWidth),w=ml(d,0,h),C=ml(d,1,h),D=w&&Oe(w),L=C&&Oe(C),k=D&&parseInt(D.marginLeft)+parseInt(D.marginRight)+mr(w).width,J=L&&parseInt(L.marginLeft)+parseInt(L.marginRight)+mr(C).width;if(m.display==="flex")return m.flexDirection==="column"||m.flexDirection==="column-reverse"?"vertical":"horizontal";if(m.display==="grid")return m.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(w&&D.float&&D.float!=="none"){var G=D.float==="left"?"left":"right";return C&&(L.clear==="both"||L.clear===G)?"vertical":"horizontal"}return w&&(D.display==="block"||D.display==="flex"||D.display==="table"||D.display==="grid"||k>=v&&m[NT]==="none"||C&&m[NT]==="none"&&k+J>v)?"vertical":"horizontal"},PL=function(d,h,m){var v=m?d.left:d.top,w=m?d.right:d.bottom,C=m?d.width:d.height,D=m?h.left:h.top,L=m?h.right:h.bottom,k=m?h.width:h.height;return v===D||w===L||v+C/2===D+k/2},RL=function(d,h){var m;return qd.some(function(v){var w=v[po].options.emptyInsertThreshold;if(!(!w||V_(v))){var C=mr(v),D=d>=C.left-w&&d<=C.right+w,L=h>=C.top-w&&h<=C.bottom+w;if(D&&L)return m=v}}),m},GE=function(d){function h(w,C){return function(D,L,k,J){var G=D.options.group.name&&L.options.group.name&&D.options.group.name===L.options.group.name;if(w==null&&(C||G))return!0;if(w==null||w===!1)return!1;if(C&&w==="clone")return w;if(typeof w=="function")return h(w(D,L,k,J),C)(D,L,k,J);var X=(C?D:L).options.group.name;return w===!0||typeof w=="string"&&w===X||w.join&&w.indexOf(X)>-1}}var m={},v=d.group;(!v||Ed(v)!="object")&&(v={name:v}),m.name=v.name,m.checkPull=h(v.pull,!0),m.checkPut=h(v.put),m.revertClone=v.revertClone,d.group=m},qE=function(){!jE&&We&&Oe(We,"display","none")},$E=function(){!jE&&We&&Oe(We,"display","")};Qd&&document.addEventListener("click",function(d){if(Gd)return d.preventDefault(),d.stopPropagation&&d.stopPropagation(),d.stopImmediatePropagation&&d.stopImmediatePropagation(),Gd=!1,!1},!0);var Ks=function(d){if(Ht){d=d.touches?d.touches[0]:d;var h=RL(d.clientX,d.clientY);if(h){var m={};for(var v in d)d.hasOwnProperty(v)&&(m[v]=d[v]);m.target=m.rootEl=h,m.preventDefault=void 0,m.stopPropagation=void 0,h[po]._onDragOver(m)}}},LL=function(d){Ht&&Ht.parentNode[po]._isOutsideThisEl(d.target)};function Ne(d,h){if(!(d&&d.nodeType&&d.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(d));this.el=d,this.options=h=Bn({},h),d[po]=this;var m={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(d.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return UE(d,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(C,D){C.setData("Text",D.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Ne.supportPointer!==!1&&"PointerEvent"in window&&!Rc,emptyInsertThreshold:5};Wc.initializePlugins(this,d,m);for(var v in m)!(v in h)&&(h[v]=m[v]);GE(h);for(var w in this)w.charAt(0)==="_"&&typeof this[w]=="function"&&(this[w]=this[w].bind(this));this.nativeDraggable=h.forceFallback?!1:zL,this.nativeDraggable&&(this.options.touchStartThreshold=1),h.supportPointer?bi(d,"pointerdown",this._onTapStart):(bi(d,"mousedown",this._onTapStart),bi(d,"touchstart",this._onTapStart)),this.nativeDraggable&&(bi(d,"dragover",this),bi(d,"dragenter",this)),qd.push(this.el),h.store&&h.store.get&&this.sort(h.store.get(this)||[]),Bn(this,AL())}Ne.prototype={constructor:Ne,_isOutsideThisEl:function(d){!this.el.contains(d)&&d!==this.el&&(ll=null)},_getDirection:function(d,h){return typeof this.options.direction=="function"?this.options.direction.call(this,d,h,Ht):this.options.direction},_onTapStart:function(d){if(d.cancelable){var h=this,m=this.el,v=this.options,w=v.preventOnFilter,C=d.type,D=d.touches&&d.touches[0]||d.pointerType&&d.pointerType==="touch"&&d,L=(D||d).target,k=d.target.shadowRoot&&(d.path&&d.path[0]||d.composedPath&&d.composedPath()[0])||L,J=v.filter;if(GL(m),!Ht&&!(/mousedown|pointerdown/.test(C)&&d.button!==0||v.disabled)&&!k.isContentEditable&&!(!this.nativeDraggable&&Rc&&L&&L.tagName.toUpperCase()==="SELECT")&&(L=ln(L,v.draggable,m,!1),!(L&&L.animated)&&Sd!==L)){if(dl=Io(L),Oc=Io(L,v.draggable),typeof J=="function"){if(J.call(this,d,L,this)){Br({sortable:h,rootEl:k,name:"filter",targetEl:L,toEl:m,fromEl:m}),io("filter",h,{evt:d}),w&&d.cancelable&&d.preventDefault();return}}else if(J&&(J=J.split(",").some(function(G){if(G=ln(k,G.trim(),m,!1),G)return Br({sortable:h,rootEl:G,name:"filter",targetEl:L,fromEl:m,toEl:m}),io("filter",h,{evt:d}),!0}),J)){w&&d.cancelable&&d.preventDefault();return}v.handle&&!ln(k,v.handle,m,!1)||this._prepareDragStart(d,D,L)}}},_prepareDragStart:function(d,h,m){var v=this,w=v.el,C=v.options,D=w.ownerDocument,L;if(m&&!Ht&&m.parentNode===w){var k=mr(m);if(Wi=w,Ht=m,tr=Ht.parentNode,Qs=Ht.nextSibling,Sd=m,gd=C.group,Ne.dragged=Ht,Js={target:Ht,clientX:(h||d).clientX,clientY:(h||d).clientY},BT=Js.clientX-k.left,FT=Js.clientY-k.top,this._lastX=(h||d).clientX,this._lastY=(h||d).clientY,Ht.style["will-change"]="all",L=function(){if(io("delayEnded",v,{evt:d}),Ne.eventCanceled){v._onDrop();return}v._disableDelayedDragEvents(),!PT&&v.nativeDraggable&&(Ht.draggable=!0),v._triggerDragStart(d,h),Br({sortable:v,name:"choose",originalEvent:d}),uo(Ht,C.chosenClass,!0)},C.ignore.split(",").forEach(function(J){BE(Ht,J.trim(),n_)}),bi(D,"dragover",Ks),bi(D,"mousemove",Ks),bi(D,"touchmove",Ks),bi(D,"mouseup",v._onDrop),bi(D,"touchend",v._onDrop),bi(D,"touchcancel",v._onDrop),PT&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ht.draggable=!0),io("delayStart",this,{evt:d}),C.delay&&(!C.delayOnTouchOnly||h)&&(!this.nativeDraggable||!(Hc||Fn))){if(Ne.eventCanceled){this._onDrop();return}bi(D,"mouseup",v._disableDelayedDrag),bi(D,"touchend",v._disableDelayedDrag),bi(D,"touchcancel",v._disableDelayedDrag),bi(D,"mousemove",v._delayedDragTouchMoveHandler),bi(D,"touchmove",v._delayedDragTouchMoveHandler),C.supportPointer&&bi(D,"pointermove",v._delayedDragTouchMoveHandler),v._dragStartTimer=setTimeout(L,C.delay)}else L()}},_delayedDragTouchMoveHandler:function(d){var h=d.touches?d.touches[0]:d;Math.max(Math.abs(h.clientX-this._lastX),Math.abs(h.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ht&&n_(Ht),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var d=this.el.ownerDocument;fi(d,"mouseup",this._disableDelayedDrag),fi(d,"touchend",this._disableDelayedDrag),fi(d,"touchcancel",this._disableDelayedDrag),fi(d,"mousemove",this._delayedDragTouchMoveHandler),fi(d,"touchmove",this._delayedDragTouchMoveHandler),fi(d,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(d,h){h=h||d.pointerType=="touch"&&d,!this.nativeDraggable||h?this.options.supportPointer?bi(document,"pointermove",this._onTouchMove):h?bi(document,"touchmove",this._onTouchMove):bi(document,"mousemove",this._onTouchMove):(bi(Ht,"dragend",this),bi(Wi,"dragstart",this._onDragStart));try{document.selection?Ad(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(d,h){if(cl=!1,Wi&&Ht){io("dragStarted",this,{evt:h}),this.nativeDraggable&&bi(document,"dragover",LL);var m=this.options;!d&&uo(Ht,m.dragClass,!1),uo(Ht,m.ghostClass,!0),Ne.active=this,d&&this._appendGhost(),Br({sortable:this,name:"start",originalEvent:h})}else this._nulling()},_emulateDragOver:function(){if(Go){this._lastX=Go.clientX,this._lastY=Go.clientY,qE();for(var d=document.elementFromPoint(Go.clientX,Go.clientY),h=d;d&&d.shadowRoot&&(d=d.shadowRoot.elementFromPoint(Go.clientX,Go.clientY),d!==h);)h=d;if(Ht.parentNode[po]._isOutsideThisEl(d),h)do{if(h[po]){var m=void 0;if(m=h[po]._onDragOver({clientX:Go.clientX,clientY:Go.clientY,target:d,rootEl:h}),m&&!this.options.dragoverBubble)break}d=h}while(h=h.parentNode);$E()}},_onTouchMove:function(d){if(Js){var h=this.options,m=h.fallbackTolerance,v=h.fallbackOffset,w=d.touches?d.touches[0]:d,C=We&&pl(We,!0),D=We&&C&&C.a,L=We&&C&&C.d,k=yd&&Ir&&OT(Ir),J=(w.clientX-Js.clientX+v.x)/(D||1)+(k?k[0]-o_[0]:0)/(D||1),G=(w.clientY-Js.clientY+v.y)/(L||1)+(k?k[1]-o_[1]:0)/(L||1);if(!Ne.active&&!cl){if(m&&Math.max(Math.abs(w.clientX-this._lastX),Math.abs(w.clientY-this._lastY))<m)return;this._onDragStart(d,!0)}if(We){C?(C.e+=J-(i_||0),C.f+=G-(r_||0)):C={a:1,b:0,c:0,d:1,e:J,f:G};var X="matrix(".concat(C.a,",").concat(C.b,",").concat(C.c,",").concat(C.d,",").concat(C.e,",").concat(C.f,")");Oe(We,"webkitTransform",X),Oe(We,"mozTransform",X),Oe(We,"msTransform",X),Oe(We,"transform",X),i_=J,r_=G,Go=w}d.cancelable&&d.preventDefault()}},_appendGhost:function(){if(!We){var d=this.options.fallbackOnBody?document.body:Wi,h=mr(Ht,!0,yd,!0,d),m=this.options;if(yd){for(Ir=d;Oe(Ir,"position")==="static"&&Oe(Ir,"transform")==="none"&&Ir!==document;)Ir=Ir.parentNode;Ir!==document.body&&Ir!==document.documentElement?(Ir===document&&(Ir=cn()),h.top+=Ir.scrollTop,h.left+=Ir.scrollLeft):Ir=cn(),o_=OT(Ir)}We=Ht.cloneNode(!0),uo(We,m.ghostClass,!1),uo(We,m.fallbackClass,!0),uo(We,m.dragClass,!0),Oe(We,"transition",""),Oe(We,"transform",""),Oe(We,"box-sizing","border-box"),Oe(We,"margin",0),Oe(We,"top",h.top),Oe(We,"left",h.left),Oe(We,"width",h.width),Oe(We,"height",h.height),Oe(We,"opacity","0.8"),Oe(We,"position",yd?"absolute":"fixed"),Oe(We,"zIndex","100000"),Oe(We,"pointerEvents","none"),Ne.ghost=We,d.appendChild(We),Oe(We,"transform-origin",BT/parseInt(We.style.width)*100+"% "+FT/parseInt(We.style.height)*100+"%")}},_onDragStart:function(d,h){var m=this,v=d.dataTransfer,w=m.options;if(io("dragStart",this,{evt:d}),Ne.eventCanceled){this._onDrop();return}io("setupClone",this),Ne.eventCanceled||(er=VE(Ht),er.draggable=!1,er.style["will-change"]="",this._hideClone(),uo(er,this.options.chosenClass,!1),Ne.clone=er),m.cloneId=Ad(function(){io("clone",m),!Ne.eventCanceled&&(m.options.removeCloneOnHide||Wi.insertBefore(er,Ht),m._hideClone(),Br({sortable:m,name:"clone"}))}),!h&&uo(Ht,w.dragClass,!0),h?(Gd=!0,m._loopId=setInterval(m._emulateDragOver,50)):(fi(document,"mouseup",m._onDrop),fi(document,"touchend",m._onDrop),fi(document,"touchcancel",m._onDrop),v&&(v.effectAllowed="move",w.setData&&w.setData.call(m,v,Ht)),bi(document,"drop",m),Oe(Ht,"transform","translateZ(0)")),cl=!0,m._dragStartId=Ad(m._dragStarted.bind(m,h,d)),bi(document,"selectstart",m),Ac=!0,Rc&&Oe(document.body,"user-select","none")},_onDragOver:function(d){var h=this.el,m=d.target,v,w,C,D=this.options,L=D.group,k=Ne.active,J=gd===L,G=D.sort,X=wr||k,et,ct=this,gt=!1;if(E_)return;function dt(Ai,Sr){io(Ai,ct,un({evt:d,isOwner:J,axis:et?"vertical":"horizontal",revert:C,dragRect:v,targetRect:w,canSort:G,fromSortable:X,target:m,completed:Jt,onMove:function(Mr,Gi){return xd(Wi,h,Ht,v,Mr,mr(Mr),d,Gi)},changed:qe},Sr))}function At(){dt("dragOverAnimationCapture"),ct.captureAnimationState(),ct!==X&&X.captureAnimationState()}function Jt(Ai){return dt("dragOverCompleted",{insertion:Ai}),Ai&&(J?k._hideClone():k._showClone(ct),ct!==X&&(uo(Ht,wr?wr.options.ghostClass:k.options.ghostClass,!1),uo(Ht,D.ghostClass,!0)),wr!==ct&&ct!==Ne.active?wr=ct:ct===Ne.active&&wr&&(wr=null),X===ct&&(ct._ignoreWhileAnimating=m),ct.animateAll(function(){dt("dragOverAnimationComplete"),ct._ignoreWhileAnimating=null}),ct!==X&&(X.animateAll(),X._ignoreWhileAnimating=null)),(m===Ht&&!Ht.animated||m===h&&!m.animated)&&(ll=null),!D.dragoverBubble&&!d.rootEl&&m!==document&&(Ht.parentNode[po]._isOutsideThisEl(d.target),!Ai&&Ks(d)),!D.dragoverBubble&&d.stopPropagation&&d.stopPropagation(),gt=!0}function qe(){ho=Io(Ht),gs=Io(Ht,D.draggable),Br({sortable:ct,name:"change",toEl:h,newIndex:ho,newDraggableIndex:gs,originalEvent:d})}if(d.preventDefault!==void 0&&d.cancelable&&d.preventDefault(),m=ln(m,D.draggable,h,!0),dt("dragOver"),Ne.eventCanceled)return gt;if(Ht.contains(d.target)||m.animated&&m.animatingX&&m.animatingY||ct._ignoreWhileAnimating===m)return Jt(!1);if(Gd=!1,k&&!D.disabled&&(J?G||(C=tr!==Wi):wr===this||(this.lastPutMode=gd.checkPull(this,k,Ht,d))&&L.checkPut(this,k,Ht,d))){if(et=this._getDirection(d,m)==="vertical",v=mr(Ht),dt("dragOverValid"),Ne.eventCanceled)return gt;if(C)return tr=Wi,At(),this._hideClone(),dt("revert"),Ne.eventCanceled||(Qs?Wi.insertBefore(Ht,Qs):Wi.appendChild(Ht)),Jt(!0);var ke=V_(h,D.draggable);if(!ke||NL(d,et,this)&&!ke.animated){if(ke===Ht)return Jt(!1);if(ke&&h===d.target&&(m=ke),m&&(w=mr(m)),xd(Wi,h,Ht,v,m,w,d,!!m)!==!1)return At(),h.appendChild(Ht),tr=h,qe(),Jt(!0)}else if(ke&&FL(d,et,this)){var Be=ml(h,0,D,!0);if(Be===Ht)return Jt(!1);if(m=Be,w=mr(m),xd(Wi,h,Ht,v,m,w,d,!1)!==!1)return At(),h.insertBefore(Ht,Be),tr=h,qe(),Jt(!0)}else if(m.parentNode===h){w=mr(m);var hi=0,ze,yi=Ht.parentNode!==h,pe=!PL(Ht.animated&&Ht.toRect||v,m.animated&&m.toRect||w,et),B=et?"top":"left",st=LT(m,"top","top")||LT(Ht,"top","top"),Qt=st?st.scrollTop:void 0;ll!==m&&(ze=w[B],Fc=!1,_d=!pe&&D.invertSwap||yi),hi=VL(d,m,w,et,pe?1:D.swapThreshold,D.invertedSwapThreshold==null?D.swapThreshold:D.invertedSwapThreshold,_d,ll===m);var Le;if(hi!==0){var Ft=Io(Ht);do Ft-=hi,Le=tr.children[Ft];while(Le&&(Oe(Le,"display")==="none"||Le===We))}if(hi===0||Le===m)return Jt(!1);ll=m,Bc=hi;var Te=m.nextElementSibling,ai=!1;ai=hi===1;var ri=xd(Wi,h,Ht,v,m,w,d,ai);if(ri!==!1)return(ri===1||ri===-1)&&(ai=ri===1),E_=!0,setTimeout(BL,30),At(),ai&&!Te?h.appendChild(Ht):m.parentNode.insertBefore(Ht,ai?Te:m),st&&NE(st,0,Qt-st.scrollTop),tr=Ht.parentNode,ze!==void 0&&!_d&&(Md=Math.abs(ze-mr(m)[B])),qe(),Jt(!0)}if(h.contains(Ht))return Jt(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){fi(document,"mousemove",this._onTouchMove),fi(document,"touchmove",this._onTouchMove),fi(document,"pointermove",this._onTouchMove),fi(document,"dragover",Ks),fi(document,"mousemove",Ks),fi(document,"touchmove",Ks)},_offUpEvents:function(){var d=this.el.ownerDocument;fi(d,"mouseup",this._onDrop),fi(d,"touchend",this._onDrop),fi(d,"pointerup",this._onDrop),fi(d,"touchcancel",this._onDrop),fi(document,"selectstart",this)},_onDrop:function(d){var h=this.el,m=this.options;if(ho=Io(Ht),gs=Io(Ht,m.draggable),io("drop",this,{evt:d}),tr=Ht&&Ht.parentNode,ho=Io(Ht),gs=Io(Ht,m.draggable),Ne.eventCanceled){this._nulling();return}cl=!1,_d=!1,Fc=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),S_(this.cloneId),S_(this._dragStartId),this.nativeDraggable&&(fi(document,"drop",this),fi(h,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Rc&&Oe(document.body,"user-select",""),Oe(Ht,"transform",""),d&&(Ac&&(d.cancelable&&d.preventDefault(),!m.dropBubble&&d.stopPropagation()),We&&We.parentNode&&We.parentNode.removeChild(We),(Wi===tr||wr&&wr.lastPutMode!=="clone")&&er&&er.parentNode&&er.parentNode.removeChild(er),Ht&&(this.nativeDraggable&&fi(Ht,"dragend",this),n_(Ht),Ht.style["will-change"]="",Ac&&!cl&&uo(Ht,wr?wr.options.ghostClass:this.options.ghostClass,!1),uo(Ht,this.options.chosenClass,!1),Br({sortable:this,name:"unchoose",toEl:tr,newIndex:null,newDraggableIndex:null,originalEvent:d}),Wi!==tr?(ho>=0&&(Br({rootEl:tr,name:"add",toEl:tr,fromEl:Wi,originalEvent:d}),Br({sortable:this,name:"remove",toEl:tr,originalEvent:d}),Br({rootEl:tr,name:"sort",toEl:tr,fromEl:Wi,originalEvent:d}),Br({sortable:this,name:"sort",toEl:tr,originalEvent:d})),wr&&wr.save()):ho!==dl&&ho>=0&&(Br({sortable:this,name:"update",toEl:tr,originalEvent:d}),Br({sortable:this,name:"sort",toEl:tr,originalEvent:d})),Ne.active&&((ho==null||ho===-1)&&(ho=dl,gs=Oc),Br({sortable:this,name:"end",toEl:tr,originalEvent:d}),this.save()))),this._nulling()},_nulling:function(){io("nulling",this),Wi=Ht=tr=We=Qs=er=Sd=_s=Js=Go=Ac=ho=gs=dl=Oc=ll=Bc=wr=gd=Ne.dragged=Ne.ghost=Ne.clone=Ne.active=null,$d.forEach(function(d){d.checked=!0}),$d.length=i_=r_=0},handleEvent:function(d){switch(d.type){case"drop":case"dragend":this._onDrop(d);break;case"dragenter":case"dragover":Ht&&(this._onDragOver(d),OL(d));break;case"selectstart":d.preventDefault();break}},toArray:function(){for(var d=[],h,m=this.el.children,v=0,w=m.length,C=this.options;v<w;v++)h=m[v],ln(h,C.draggable,this.el,!1)&&d.push(h.getAttribute(C.dataIdAttr)||UL(h));return d},sort:function(d,h){var m={},v=this.el;this.toArray().forEach(function(w,C){var D=v.children[C];ln(D,this.options.draggable,v,!1)&&(m[w]=D)},this),h&&this.captureAnimationState(),d.forEach(function(w){m[w]&&(v.removeChild(m[w]),v.appendChild(m[w]))}),h&&this.animateAll()},save:function(){var d=this.options.store;d&&d.set&&d.set(this)},closest:function(d,h){return ln(d,h||this.options.draggable,this.el,!1)},option:function(d,h){var m=this.options;if(h===void 0)return m[d];var v=Wc.modifyOption(this,d,h);typeof v<"u"?m[d]=v:m[d]=h,d==="group"&&GE(m)},destroy:function(){io("destroy",this);var d=this.el;d[po]=null,fi(d,"mousedown",this._onTapStart),fi(d,"touchstart",this._onTapStart),fi(d,"pointerdown",this._onTapStart),this.nativeDraggable&&(fi(d,"dragover",this),fi(d,"dragenter",this)),Array.prototype.forEach.call(d.querySelectorAll("[draggable]"),function(h){h.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),qd.splice(qd.indexOf(this.el),1),this.el=d=null},_hideClone:function(){if(!_s){if(io("hideClone",this),Ne.eventCanceled)return;Oe(er,"display","none"),this.options.removeCloneOnHide&&er.parentNode&&er.parentNode.removeChild(er),_s=!0}},_showClone:function(d){if(d.lastPutMode!=="clone"){this._hideClone();return}if(_s){if(io("showClone",this),Ne.eventCanceled)return;Ht.parentNode==Wi&&!this.options.group.revertClone?Wi.insertBefore(er,Ht):Qs?Wi.insertBefore(er,Qs):Wi.appendChild(er),this.options.group.revertClone&&this.animate(Ht,er),Oe(er,"display",""),_s=!1}}};function OL(d){d.dataTransfer&&(d.dataTransfer.dropEffect="move"),d.cancelable&&d.preventDefault()}function xd(d,h,m,v,w,C,D,L){var k,J=d[po],G=J.options.onMove,X;return window.CustomEvent&&!Fn&&!Hc?k=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(k=document.createEvent("Event"),k.initEvent("move",!0,!0)),k.to=h,k.from=d,k.dragged=m,k.draggedRect=v,k.related=w||h,k.relatedRect=C||mr(h),k.willInsertAfter=L,k.originalEvent=D,d.dispatchEvent(k),G&&(X=G.call(J,k,D)),X}function n_(d){d.draggable=!1}function BL(){E_=!1}function FL(d,h,m){var v=mr(ml(m.el,0,m.options,!0)),w=10;return h?d.clientX<v.left-w||d.clientY<v.top&&d.clientX<v.right:d.clientY<v.top-w||d.clientY<v.bottom&&d.clientX<v.left}function NL(d,h,m){var v=mr(V_(m.el,m.options.draggable)),w=10;return h?d.clientX>v.right+w||d.clientX<=v.right&&d.clientY>v.bottom&&d.clientX>=v.left:d.clientX>v.right&&d.clientY>v.top||d.clientX<=v.right&&d.clientY>v.bottom+w}function VL(d,h,m,v,w,C,D,L){var k=v?d.clientY:d.clientX,J=v?m.height:m.width,G=v?m.top:m.left,X=v?m.bottom:m.right,et=!1;if(!D){if(L&&Md<J*w){if(!Fc&&(Bc===1?k>G+J*C/2:k<X-J*C/2)&&(Fc=!0),Fc)et=!0;else if(Bc===1?k<G+Md:k>X-Md)return-Bc}else if(k>G+J*(1-w)/2&&k<X-J*(1-w)/2)return jL(h)}return et=et||D,et&&(k<G+J*C/2||k>X-J*C/2)?k>G+J/2?1:-1:0}function jL(d){return Io(Ht)<Io(d)?1:-1}function UL(d){for(var h=d.tagName+d.className+d.src+d.href+d.textContent,m=h.length,v=0;m--;)v+=h.charCodeAt(m);return v.toString(36)}function GL(d){$d.length=0;for(var h=d.getElementsByTagName("input"),m=h.length;m--;){var v=h[m];v.checked&&$d.push(v)}}function Ad(d){return setTimeout(d,0)}function S_(d){return clearTimeout(d)}Qd&&bi(document,"touchmove",function(d){(Ne.active||cl)&&d.cancelable&&d.preventDefault()});Ne.utils={on:bi,off:fi,css:Oe,find:BE,is:function(d,h){return!!ln(d,h,d,!1)},extend:SL,throttle:FE,closest:ln,toggleClass:uo,clone:VE,index:Io,nextTick:Ad,cancelNextTick:S_,detectDirection:UE,getChild:ml};Ne.get=function(d){return d[po]};Ne.mount=function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];h[0].constructor===Array&&(h=h[0]),h.forEach(function(v){if(!v.prototype||!v.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(v));v.utils&&(Ne.utils=un(un({},Ne.utils),v.utils)),Wc.mount(v)})};Ne.create=function(d,h){return new Ne(d,h)};Ne.version=bL;var dr=[],Cc,M_,A_=!1,s_,a_,Zd,Ic;function qL(){function d(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var h in this)h.charAt(0)==="_"&&typeof this[h]=="function"&&(this[h]=this[h].bind(this))}return d.prototype={dragStarted:function(h){var m=h.originalEvent;this.sortable.nativeDraggable?bi(document,"dragover",this._handleAutoScroll):this.options.supportPointer?bi(document,"pointermove",this._handleFallbackAutoScroll):m.touches?bi(document,"touchmove",this._handleFallbackAutoScroll):bi(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(h){var m=h.originalEvent;!this.options.dragOverBubble&&!m.rootEl&&this._handleAutoScroll(m)},drop:function(){this.sortable.nativeDraggable?fi(document,"dragover",this._handleAutoScroll):(fi(document,"pointermove",this._handleFallbackAutoScroll),fi(document,"touchmove",this._handleFallbackAutoScroll),fi(document,"mousemove",this._handleFallbackAutoScroll)),VT(),Cd(),ML()},nulling:function(){Zd=M_=Cc=A_=Ic=s_=a_=null,dr.length=0},_handleFallbackAutoScroll:function(h){this._handleAutoScroll(h,!0)},_handleAutoScroll:function(h,m){var v=this,w=(h.touches?h.touches[0]:h).clientX,C=(h.touches?h.touches[0]:h).clientY,D=document.elementFromPoint(w,C);if(Zd=h,m||this.options.forceAutoScrollFallback||Hc||Fn||Rc){l_(h,this.options,D,m);var L=xs(D,!0);A_&&(!Ic||w!==s_||C!==a_)&&(Ic&&VT(),Ic=setInterval(function(){var k=xs(document.elementFromPoint(w,C),!0);k!==L&&(L=k,Cd()),l_(h,v.options,k,m)},10),s_=w,a_=C)}else{if(!this.options.bubbleScroll||xs(D,!0)===cn()){Cd();return}l_(h,this.options,xs(D,!1),!1)}}},Bn(d,{pluginName:"scroll",initializeByDefault:!0})}function Cd(){dr.forEach(function(d){clearInterval(d.pid)}),dr=[]}function VT(){clearInterval(Ic)}var l_=FE(function(d,h,m,v){if(h.scroll){var w=(d.touches?d.touches[0]:d).clientX,C=(d.touches?d.touches[0]:d).clientY,D=h.scrollSensitivity,L=h.scrollSpeed,k=cn(),J=!1,G;M_!==m&&(M_=m,Cd(),Cc=h.scroll,G=h.scrollFn,Cc===!0&&(Cc=xs(m,!0)));var X=0,et=Cc;do{var ct=et,gt=mr(ct),dt=gt.top,At=gt.bottom,Jt=gt.left,qe=gt.right,ke=gt.width,Be=gt.height,hi=void 0,ze=void 0,yi=ct.scrollWidth,pe=ct.scrollHeight,B=Oe(ct),st=ct.scrollLeft,Qt=ct.scrollTop;ct===k?(hi=ke<yi&&(B.overflowX==="auto"||B.overflowX==="scroll"||B.overflowX==="visible"),ze=Be<pe&&(B.overflowY==="auto"||B.overflowY==="scroll"||B.overflowY==="visible")):(hi=ke<yi&&(B.overflowX==="auto"||B.overflowX==="scroll"),ze=Be<pe&&(B.overflowY==="auto"||B.overflowY==="scroll"));var Le=hi&&(Math.abs(qe-w)<=D&&st+ke<yi)-(Math.abs(Jt-w)<=D&&!!st),Ft=ze&&(Math.abs(At-C)<=D&&Qt+Be<pe)-(Math.abs(dt-C)<=D&&!!Qt);if(!dr[X])for(var Te=0;Te<=X;Te++)dr[Te]||(dr[Te]={});(dr[X].vx!=Le||dr[X].vy!=Ft||dr[X].el!==ct)&&(dr[X].el=ct,dr[X].vx=Le,dr[X].vy=Ft,clearInterval(dr[X].pid),(Le!=0||Ft!=0)&&(J=!0,dr[X].pid=setInterval(function(){v&&this.layer===0&&Ne.active._onTouchMove(Zd);var ai=dr[this.layer].vy?dr[this.layer].vy*L:0,ri=dr[this.layer].vx?dr[this.layer].vx*L:0;typeof G=="function"&&G.call(Ne.dragged.parentNode[po],ri,ai,d,Zd,dr[this.layer].el)!=="continue"||NE(dr[this.layer].el,ri,ai)}.bind({layer:X}),24))),X++}while(h.bubbleScroll&&et!==k&&(et=xs(et,!1)));A_=J}},30),ZE=function(d){var h=d.originalEvent,m=d.putSortable,v=d.dragEl,w=d.activeSortable,C=d.dispatchSortableEvent,D=d.hideGhostForTarget,L=d.unhideGhostForTarget;if(h){var k=m||w;D();var J=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:h,G=document.elementFromPoint(J.clientX,J.clientY);L(),k&&!k.el.contains(G)&&(C("spill"),this.onSpill({dragEl:v,putSortable:m}))}};function j_(){}j_.prototype={startIndex:null,dragStart:function(d){var h=d.oldDraggableIndex;this.startIndex=h},onSpill:function(d){var h=d.dragEl,m=d.putSortable;this.sortable.captureAnimationState(),m&&m.captureAnimationState();var v=ml(this.sortable.el,this.startIndex,this.options);v?this.sortable.el.insertBefore(h,v):this.sortable.el.appendChild(h),this.sortable.animateAll(),m&&m.animateAll()},drop:ZE};Bn(j_,{pluginName:"revertOnSpill"});function U_(){}U_.prototype={onSpill:function(d){var h=d.dragEl,m=d.putSortable,v=m||this.sortable;v.captureAnimationState(),h.parentNode&&h.parentNode.removeChild(h),v.animateAll()},drop:ZE};Bn(U_,{pluginName:"removeOnSpill"});Ne.mount(new qL);Ne.mount(U_,j_);const $L=["Start","Add","Remove","Update","End"],ZL=["Choose","Unchoose","Sort","Filter","Clone"],HL=["Move"],jT={manage:HL,manageAndEmit:$L,emit:ZL};[...[...jT.manageAndEmit,...jT.emit].map(d=>d.toLowerCase())];const WL=go({__name:"LazyLoad",props:{wrapperTag:{default:"div"},threshold:{default:0},observerRoot:{default:null}},emits:["intersect"],setup(d,{emit:h}){const m=d,v=kr(!1);function w(k){const J=k[0];J.isIntersecting&&(v.value=!0,v5(()=>{h("intersect",J),L()}))}const C=kr(),D=kr();Gc(()=>{C.value=new IntersectionObserver(w,{root:m.observerRoot,threshold:m.threshold}),C.value.observe(D.value)}),Hd(()=>{L()});function L(){C.value&&C.value.disconnect()}return(k,J)=>(wi(),ro(Wd(k.wrapperTag),{ref_key:"rootRef",ref:D,class:"k-lazyload"},{default:$o(()=>[v.value?_r(k.$slots,"default",{key:0}):_r(k.$slots,"placeholder",{key:1})]),_:3},512))}}),XL=`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:#0000000d}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}}@keyframes mapboxgl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:#0000000d}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:#000000bf;text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:#0000000d}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:"";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid transparent;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid transparent;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:#000000b3;color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}.kvass-map{position:relative;aspect-ratio:var(--kvass-map-aspect-ratio);width:100%;background-color:var(--kvass-map-background, rgba(0, 0, 0, .2))}.kvass-map__address{padding:var(--kvass-map-address-padding-y, .5rem) var(--kvass-map-address-padding-x, 1rem);background-color:var(--kvass-map-address-background, rgba(0, 0, 0, .2));color:var(--kvass-map-address-color, rgba(255, 255, 255, .75));position:absolute;bottom:0}.kvass-map__map,.kvass-map .mapboxgl-canvas-container,.kvass-map .mapboxgl-canvas{height:100%;width:100%}.kvass-map .mapboxgl-ctrl-attrib,.kvass-map .mapboxgl-ctrl-logo{display:none}
`,YL={__name:"Map.ce",props:{theme:{type:String,required:!0},mapboxApiToken:{type:String,required:!0},coordinates:{type:String,required:!0},markers:{type:String},zoom:{type:String,default:"8",validator(d){return typeof parseInt(d)=="number"}}},setup(d){const h=d,m=gr(()=>h.coordinates.split(",")),v=gr(()=>h.markers?.split(";").map(C=>C.split(","))),w=w5({style:h.theme,accessToken:h.mapboxApiToken});return(C,D)=>(wi(),ro(ul(WL),null,{default:$o(()=>[ra(ul(M5),{coordinates:m.value,zoom:parseInt(h.zoom),markers:v.value,"map-options":w},null,8,["coordinates","zoom","markers","map-options"])]),_:1}))}},JL=b5(YL,[["styles",[XL]]]);customElements.define("kvass-map",T5(JL));
